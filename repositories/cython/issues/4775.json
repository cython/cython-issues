{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "This issue arose while we tried to turn on `binding=True` cython compiler option in SageMath 9.6.rc3:\r\n\r\nhttps://trac.sagemath.org/ticket/26254#comment:64\r\n\r\nThe function `call_registered_function()` is defined in the file `src/sage/symbolic/pynac_function_impl.pxi`, which is included into `src/sage/symbolic/expression.pyx` by `include \"pynac_function_impl.pxi\"`.\r\n\r\nThen the statement `from .expression import call_registered_function` **in the global scope** of `src/sage/symbolic/function.pyx` throws the exception\r\n\r\n`ImportError: cannot import name call_registered_function`\r\n\r\nThis may be a bug on cython since we don't have this exception with the default `binding=False`. \r\n\r\nSageMath 9.6.rc3 uses python-3.10.3 and cython-0.29.28.\r\n\r\n",
    "closed_at": "2022-05-10T05:54:47Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "To me this looks like a circular import issue possible? From the sage issue:\r\n\r\n```\r\nFile \"sage/symbolic/expression.pyx\", line 1, in init sage.symbolic.expression\r\n    # -*- coding: utf-8 -*-\r\n  File \"sage/symbolic/function.pyx\", line 144, in init sage.symbolic.function\r\n    from .expression import (\r\n```\r\n\r\n`expression` import `function` which imports `expression` (some of these imports may be generated by `cimport` though - I'm not sure).\r\n\r\nWith `binding=False` functions are defined in `PyModuleDef`. I think that means they exist very early in the module import process before the main module init function has run, and therefore you may get away with it. With `binding=True` they're generated in the module init function.\r\n\r\nTherefore I provisionally don't think it's a Cython bug - it looks a lot like code that wouldn't work in Python either",
            "created_at": "2022-05-09T19:13:22Z",
            "html_url": "https://github.com/cython/cython/issues/4775#issuecomment-1121476044",
            "id": 1121476044,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4775",
            "node_id": "IC_kwDOABDGAc5C2F3M",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1121476044/reactions"
            },
            "updated_at": "2022-05-09T19:13:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1121476044",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think if you remove the line\r\n\r\n```\r\nfrom sage.symbolic.function cimport SymbolicFunction\r\n```\r\n\r\nit'll work. You don't look to actually use the cimport so you're losing nothing by removing it.\r\n\r\nHowever I can't work out how the code is working at all with or without binding. At least on a simplified test locally it makes no difference if it's enabled for not.",
            "created_at": "2022-05-09T19:43:58Z",
            "html_url": "https://github.com/cython/cython/issues/4775#issuecomment-1121505290",
            "id": 1121505290,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4775",
            "node_id": "IC_kwDOABDGAc5C2NAK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1121505290/reactions"
            },
            "updated_at": "2022-05-09T19:43:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1121505290",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> To me this looks like a circular import issue possible? \r\n\r\nRight. There was a circular import. We could fix the problem by changing the global imports to local imports. Your explanation below confirms that we did the right thing. \r\n\r\n> With `binding=False` functions are defined in `PyModuleDef`. I think that means they exist very early in the module import process before the main module init function has run, and therefore you may get away with it. With `binding=True` they're generated in the module init function.\r\n\r\nSo `binding=True` simply revealed the existing  circular import. Thank you for the explanation!",
            "created_at": "2022-05-10T04:50:23Z",
            "html_url": "https://github.com/cython/cython/issues/4775#issuecomment-1121929420",
            "id": 1121929420,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4775",
            "node_id": "IC_kwDOABDGAc5C30jM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1121929420/reactions"
            },
            "updated_at": "2022-05-10T04:50:23Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1121929420",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1456101?v=4",
                "events_url": "https://api.github.com/users/kwankyu/events{/privacy}",
                "followers_url": "https://api.github.com/users/kwankyu/followers",
                "following_url": "https://api.github.com/users/kwankyu/following{/other_user}",
                "gists_url": "https://api.github.com/users/kwankyu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kwankyu",
                "id": 1456101,
                "login": "kwankyu",
                "node_id": "MDQ6VXNlcjE0NTYxMDE=",
                "organizations_url": "https://api.github.com/users/kwankyu/orgs",
                "received_events_url": "https://api.github.com/users/kwankyu/received_events",
                "repos_url": "https://api.github.com/users/kwankyu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kwankyu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kwankyu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kwankyu"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> So `binding=True` simply revealed the existing circular import. Thank you for the explanation!\r\n\r\nPossibly... I tried to make a cut-down example to replicate it myself and couldn't make it work with either version!\r\n\r\nAnyway - hopefully you have enough information to fix it... I'll close this issue I think",
            "created_at": "2022-05-10T05:54:47Z",
            "html_url": "https://github.com/cython/cython/issues/4775#issuecomment-1121960683",
            "id": 1121960683,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4775",
            "node_id": "IC_kwDOABDGAc5C38Lr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1121960683/reactions"
            },
            "updated_at": "2022-05-10T05:54:47Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1121960683",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4775/comments",
    "created_at": "2022-05-09T07:23:29Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-05-10T05:54:47Z",
            "event": "closed",
            "id": 6578832327,
            "node_id": "CE_lADOABDGAc5JRYvbzwAAAAGIIQPH",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6578832327"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-05-10T05:55:33Z",
            "event": "labeled",
            "id": 6578836504,
            "label": {
                "color": "444444",
                "name": "R: worksforme"
            },
            "node_id": "LE_lADOABDGAc5JRYvbzwAAAAGIIRQY",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6578836504"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-05-10T05:55:33Z",
            "event": "labeled",
            "id": 6578836508,
            "label": {
                "color": "444444",
                "name": "R: wontfix"
            },
            "node_id": "LE_lADOABDGAc5JRYvbzwAAAAGIIRQc",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6578836508"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4775/events",
    "html_url": "https://github.com/cython/cython/issues/4775",
    "id": 1229294555,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556354,
            "name": "R: worksforme",
            "node_id": "MDU6TGFiZWw0MjU1NTYzNTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20worksforme"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425557400,
            "name": "R: wontfix",
            "node_id": "MDU6TGFiZWw0MjU1NTc0MDA=",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20wontfix"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4775/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5JRYvb",
    "number": 4775,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/4775/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4775/timeline",
    "title": "[BUG] binding=True causes a mysterious import error ",
    "updated_at": "2022-05-10T05:55:33Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4775",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1456101?v=4",
        "events_url": "https://api.github.com/users/kwankyu/events{/privacy}",
        "followers_url": "https://api.github.com/users/kwankyu/followers",
        "following_url": "https://api.github.com/users/kwankyu/following{/other_user}",
        "gists_url": "https://api.github.com/users/kwankyu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kwankyu",
        "id": 1456101,
        "login": "kwankyu",
        "node_id": "MDQ6VXNlcjE0NTYxMDE=",
        "organizations_url": "https://api.github.com/users/kwankyu/orgs",
        "received_events_url": "https://api.github.com/users/kwankyu/received_events",
        "repos_url": "https://api.github.com/users/kwankyu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kwankyu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kwankyu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kwankyu"
    }
}