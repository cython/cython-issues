{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe your issue\r\n\r\n# Bug description\r\n\r\nCython 3 warns when following function is declared (real example from scipy):\r\n```cython\r\n    int build_weights(ckdtree *self,\r\n                         np.float64_t *node_weights,\r\n                         np.float64_t *weights) nogil except +\r\n```\r\nWarn message is as follows:\r\n```\r\n/home/runner/work/scipy/scipy/scipy/spatial/_ckdtree.pyx:75:53: The keyword 'nogil' should appear at the end of the function signature line. Placing it before 'except' or 'noexcept' will be disallowed in a future version of Cython.\r\n```\r\n\r\nWhen the order of `except +` and `nogil` is reversed:\r\n```cython\r\n    int build_weights(ckdtree *self,\r\n                         np.float64_t *node_weights,\r\n                         np.float64_t *weights) except + nogil\r\n```\r\nCython 3 is not emiting the warning but Cython 0.29.X is failing with following exception:\r\n```\r\n Error compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n                         np.intp_t start_idx,\r\n                         np.intp_t end_idx,\r\n                         np.float64_t *maxes,\r\n                         np.float64_t *mins,\r\n                         int _median,\r\n                         int _compact) except + nogil\r\n                                                    ^\r\n------------------------------------------------------------\r\n\r\n/home/runner/work/scipy/scipy/scipy/spatial/_ckdtree.pyx:75:53: undeclared name not builtin: nogil\r\n```\r\n\r\n# Rationale\r\n\r\nUntil Cython 3 is not fully released, projects are gradually migrating to Cython3 by supporting both versions. Current bug is blocking this approach since the syntax is preferred in Cython 3 but not working in Cython 0.29.X.\r\n\r\n# See also\r\nDiscussion in Scipy PR fixing compilation warnings: https://github.com/scipy/scipy/pull/18418#issuecomment-1533746881\r\n\r\n# Describe alternatives you've considered.\r\n\r\nOther possibility is not fixing this in 0.29.X. Projects can fix the warnings when fully migrate to Cython 3. In this case we need to be sure that support of `nogil except ...` will be removed *after* all users migrate to Cython 3. \r\n ",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "We should definitely allow the syntax in 0.29.x. We can't deprecate syntax in 3.0 if the stable release doesn't even support the alternative.\n",
            "created_at": "2023-05-05T04:33:56Z",
            "html_url": "https://github.com/cython/cython/issues/5423#issuecomment-1535684442",
            "id": 1535684442,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5423",
            "node_id": "IC_kwDOABDGAc5biK9a",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1535684442/reactions"
            },
            "updated_at": "2023-05-05T04:33:56Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1535684442",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5423/comments",
    "created_at": "2023-05-04T20:04:58Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5423/events",
    "html_url": "https://github.com/cython/cython/issues/5423",
    "id": 1696623212,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5423/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5lIGps",
    "number": 5423,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5423/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5423/timeline",
    "title": "[BUG] 0.29.X Cython does not support `nogil` keyword after `except +` statement.",
    "updated_at": "2023-05-05T04:33:56Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5423",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/827060?v=4",
        "events_url": "https://api.github.com/users/matusvalo/events{/privacy}",
        "followers_url": "https://api.github.com/users/matusvalo/followers",
        "following_url": "https://api.github.com/users/matusvalo/following{/other_user}",
        "gists_url": "https://api.github.com/users/matusvalo/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/matusvalo",
        "id": 827060,
        "login": "matusvalo",
        "node_id": "MDQ6VXNlcjgyNzA2MA==",
        "organizations_url": "https://api.github.com/users/matusvalo/orgs",
        "received_events_url": "https://api.github.com/users/matusvalo/received_events",
        "repos_url": "https://api.github.com/users/matusvalo/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/matusvalo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/matusvalo/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/matusvalo"
    }
}