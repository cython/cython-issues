{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\n\nCython fails to build itself on cpython main:\r\n\r\n```\r\n  gcc -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/tcaswell/.virtualenvs/bleeding/include -I/home/tcaswell/.pybuild/bleeding/include/python3.12 -c /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c -o build/temp.linux-x86_64-cpython-312/home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.o\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__pyx_f_6Cython_8Compiler_7Parsing_p_dict_or_set_maker’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:31385:9: warning: ‘Py_OptimizeFlag’ is deprecated [-Wdeprecated-declarations]\r\n  31385 |         if (unlikely(!Py_OptimizeFlag)) {\r\n        |         ^~\r\n  In file included from /home/tcaswell/.pybuild/bleeding/include/python3.12/Python.h:48,\r\n                   from /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:31:\r\n  /home/tcaswell/.pybuild/bleeding/include/python3.12/cpython/pydebug.h:13:37: note: declared here\r\n     13 | Py_DEPRECATED(3.12) PyAPI_DATA(int) Py_OptimizeFlag;\r\n        |                                     ^~~~~~~~~~~~~~~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__Pyx_PyErr_ExceptionMatchesInState’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84939:32: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  84939 |     PyObject *exc_type = tstate->curexc_type;\r\n        |                                ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__Pyx_ErrRestoreInState’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84952:22: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  84952 |     tmp_type = tstate->curexc_type;\r\n        |                      ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84953:23: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  84953 |     tmp_value = tstate->curexc_value;\r\n        |                       ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84954:20: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  84954 |     tmp_tb = tstate->curexc_traceback;\r\n        |                    ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84955:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  84955 |     tstate->curexc_type = type;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84956:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  84956 |     tstate->curexc_value = value;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84957:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  84957 |     tstate->curexc_traceback = tb;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__Pyx_ErrFetchInState’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84963:19: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  84963 |     *type = tstate->curexc_type;\r\n        |                   ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84964:20: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  84964 |     *value = tstate->curexc_value;\r\n        |                    ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84965:17: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  84965 |     *tb = tstate->curexc_traceback;\r\n        |                 ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84966:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  84966 |     tstate->curexc_type = 0;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84967:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  84967 |     tstate->curexc_value = 0;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:84968:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  84968 |     tstate->curexc_traceback = 0;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__Pyx_IterFinish’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:85724:32: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  85724 |     PyObject* exc_type = tstate->curexc_type;\r\n        |                                ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:85728:31: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  85728 |             exc_value = tstate->curexc_value;\r\n        |                               ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:85729:28: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  85729 |             exc_tb = tstate->curexc_traceback;\r\n        |                            ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:85730:19: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  85730 |             tstate->curexc_type = 0;\r\n        |                   ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:85731:19: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  85731 |             tstate->curexc_value = 0;\r\n        |                   ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:85732:19: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  85732 |             tstate->curexc_traceback = 0;\r\n        |                   ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__Pyx__GetException’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86515:24: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  86515 |     local_type = tstate->curexc_type;\r\n        |                        ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86516:25: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  86516 |     local_value = tstate->curexc_value;\r\n        |                         ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86517:22: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  86517 |     local_tb = tstate->curexc_traceback;\r\n        |                      ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86518:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  86518 |     tstate->curexc_type = 0;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86519:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_value’\r\n  86519 |     tstate->curexc_value = 0;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86520:11: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  86520 |     tstate->curexc_traceback = 0;\r\n        |           ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86526:24: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_type’\r\n  86526 |     if (unlikely(tstate->curexc_type))\r\n        |                        ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:1279:43: note: in definition of macro ‘unlikely’\r\n   1279 |   #define unlikely(x) __builtin_expect(!!(x), 0)\r\n        |                                           ^\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c: In function ‘__Pyx_Raise’:\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86861:34: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  86861 |         PyObject* tmp_tb = tstate->curexc_traceback;\r\n        |                                  ^~\r\n  /home/tcaswell/source/p/cython/cython/Cython/Compiler/Parsing.c:86864:19: error: ‘PyThreadState’ {aka ‘struct _ts’} has no member named ‘curexc_traceback’\r\n  86864 |             tstate->curexc_traceback = tb;\r\n        |                   ^~\r\n  error: command '/lib/ccache/bin/gcc' failed with exit code 1\r\n```\r\n\r\n\r\nI believe that this is caused by feec49c40736fc05626a183a8d14c4ebbea5ae28 via https://github.com/python/cpython/pull/101607 working on https://github.com/python/cpython/issues/101578 .  Rolling back to 027adf42cd85db41fee05b0a40d89ef822876c97 (the previous commit) does fix cython building itself.\n\n### Code to reproduce the behaviour:\n\n```\r\npip inst -v --no-build-isolation .\r\n```\n\n### Expected behaviour\n\n_No response_\n\n### Environment\n\nOS: [e.g. Linux, Windows, macOS] linux \r\nPython version [e.g. 3.10.2] main (2f62a5da949cd368a9498e6a03e700f4629fa97f)\r\nCython version [e.g. 3.0.0a11] master (94bea6677)\r\n\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "This is now blocking building Cython with Python 3.12.0a6. ",
            "created_at": "2023-03-13T13:12:31Z",
            "html_url": "https://github.com/cython/cython/issues/5286#issuecomment-1466122199",
            "id": 1466122199,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5286",
            "node_id": "IC_kwDOABDGAc5XYz_X",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1466122199/reactions"
            },
            "updated_at": "2023-03-13T13:12:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1466122199",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13086088?v=4",
                "events_url": "https://api.github.com/users/hrnciar/events{/privacy}",
                "followers_url": "https://api.github.com/users/hrnciar/followers",
                "following_url": "https://api.github.com/users/hrnciar/following{/other_user}",
                "gists_url": "https://api.github.com/users/hrnciar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hrnciar",
                "id": 13086088,
                "login": "hrnciar",
                "node_id": "MDQ6VXNlcjEzMDg2MDg4",
                "organizations_url": "https://api.github.com/users/hrnciar/orgs",
                "received_events_url": "https://api.github.com/users/hrnciar/received_events",
                "repos_url": "https://api.github.com/users/hrnciar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hrnciar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hrnciar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hrnciar"
            }
        },
        {
            "author_association": "NONE",
            "body": "(This also affects building other packages, not just Cython itself.)",
            "created_at": "2023-03-13T17:40:43Z",
            "html_url": "https://github.com/cython/cython/issues/5286#issuecomment-1466608308",
            "id": 1466608308,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5286",
            "node_id": "IC_kwDOABDGAc5Xaqq0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1466608308/reactions"
            },
            "updated_at": "2023-03-13T17:40:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1466608308",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
                "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
                "followers_url": "https://api.github.com/users/hroncok/followers",
                "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
                "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hroncok",
                "id": 2401856,
                "login": "hroncok",
                "node_id": "MDQ6VXNlcjI0MDE4NTY=",
                "organizations_url": "https://api.github.com/users/hroncok/orgs",
                "received_events_url": "https://api.github.com/users/hroncok/received_events",
                "repos_url": "https://api.github.com/users/hroncok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hroncok"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5286/comments",
    "created_at": "2023-03-01T20:17:13Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5286/events",
    "html_url": "https://github.com/cython/cython/issues/5286",
    "id": 1605608030,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5286/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5fs6Je",
    "number": 5286,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/5286/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5286/timeline",
    "title": "[BUG] cython does not build with cpython main branch.",
    "updated_at": "2023-03-13T17:40:43Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5286",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/199813?v=4",
        "events_url": "https://api.github.com/users/tacaswell/events{/privacy}",
        "followers_url": "https://api.github.com/users/tacaswell/followers",
        "following_url": "https://api.github.com/users/tacaswell/following{/other_user}",
        "gists_url": "https://api.github.com/users/tacaswell/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tacaswell",
        "id": 199813,
        "login": "tacaswell",
        "node_id": "MDQ6VXNlcjE5OTgxMw==",
        "organizations_url": "https://api.github.com/users/tacaswell/orgs",
        "received_events_url": "https://api.github.com/users/tacaswell/received_events",
        "repos_url": "https://api.github.com/users/tacaswell/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tacaswell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tacaswell/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tacaswell"
    }
}