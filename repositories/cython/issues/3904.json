{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\nAccording to the docs it's possible to use a ctuple as function argument. Unfortunately, this doesn't work if I use a ctuple of fused types.\r\n\r\n\r\n**To Reproduce**\r\nCode to reproduce the behaviour:\r\n```cython\r\n%%cython\r\n\r\ncimport cython\r\n\r\ndef testfkt((cython.integral, cython.integral) a):\r\n     return a[0], a[1]\r\n```\r\n\r\nyields the error message\r\n\r\n<details>\r\n\r\n``` cython\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n\r\nimport cython\r\n\r\ndef testfkt((cython.integral, cython.integral) a):\r\n           ^\r\n------------------------------------------------------------\r\n\r\n/Users/jonathan/.ipython/cython/_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:4:12: Compiler crash in AnalyseDeclarationsTransform\r\n\r\nFile 'ModuleNode.py', line 124, in analyse_declarations: ModuleNode(_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:2:0,\r\n    full_module_name = '_cython_magic_d3cea3f91d31b268cba9352fe29edc36')\r\nFile 'Nodes.py', line 431, in analyse_declarations: StatListNode(_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:2:0)\r\nFile 'Nodes.py', line 431, in analyse_declarations: StatListNode(_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:4:0)\r\nFile 'Nodes.py', line 2885, in analyse_declarations: DefNode(_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:4:0,\r\n    modifiers = [...]/0,\r\n    name = 'testfkt',\r\n    num_required_args = 1,\r\n    outer_attrs = [...]/2,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0')\r\nFile 'Nodes.py', line 2923, in analyse_argument_types: DefNode(_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:4:0,\r\n    modifiers = [...]/0,\r\n    name = 'testfkt',\r\n    num_required_args = 1,\r\n    outer_attrs = [...]/2,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0')\r\nFile 'Nodes.py', line 1230, in analyse: CTupleBaseTypeNode(_cython_magic_d3cea3f91d31b268cba9352fe29edc36.pyx:4:12)\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/Nodes.py\", line 1230, in analyse\r\n    entry = env.declare_tuple_type(self.pos, component_types)\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/Symtab.py\", line 1198, in declare_tuple_type\r\n    ttype = self._cached_tuple_types[components] = PyrexTypes.c_tuple_type(components)\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 4043, in c_tuple_type\r\n    cname = Naming.ctuple_type_prefix + type_list_identifier(components)\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 4703, in type_list_identifier\r\n    return cap_length('__and_'.join(type_identifier(type) for type in types))\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 4703, in <genexpr>\r\n    return cap_length('__and_'.join(type_identifier(type) for type in types))\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 4707, in type_identifier\r\n    decl = type.empty_declaration_code()\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 51, in empty_declaration_code\r\n    self._empty_declaration = self.declaration_code('')\r\n  File \"/usr/local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 1649, in declaration_code\r\n    raise Exception(\"This may never happen, please report a bug\")\r\nException: This may never happen, please report a bug\r\n```\r\n</details>\r\n\r\n**Expected behavior**\r\nIt should be possible to use ctuples of fused types as function arguments.\r\n\r\n**Environment:**\r\n - OS: macOS 10.15.7\r\n - Python version 3.8.5 / 3.9.0 (Tested both)\r\n - Cython version 0.29.21 / 3.0a6 (Tested both)",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "Probably the better description is that it isn't possible to use a [ctuple (description is half-way down the section)](https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#types) of fused types. [I've removed my \"similar example\" since I don't think it'd actually be valid]\r\n\r\nIt should probably work, or at very least not cause a compiler crash",
            "created_at": "2020-11-08T09:19:31Z",
            "html_url": "https://github.com/cython/cython/issues/3904#issuecomment-723550582",
            "id": 723550582,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3904",
            "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzU1MDU4Mg==",
            "performed_via_github_app": null,
            "updated_at": "2020-11-08T10:49:45Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/723550582",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I also consider this more of a missing feature than a bug, but yes, it should be made to work.\r\nAnd for starters, it would be good if it failed with a better error message. :)",
            "created_at": "2020-11-08T09:42:42Z",
            "html_url": "https://github.com/cython/cython/issues/3904#issuecomment-723552984",
            "id": 723552984,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3904",
            "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzU1Mjk4NA==",
            "performed_via_github_app": null,
            "updated_at": "2020-11-08T09:42:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/723552984",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3904/comments",
    "created_at": "2020-11-08T09:13:29Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/8471326?v=4",
                "events_url": "https://api.github.com/users/jhelgert/events{/privacy}",
                "followers_url": "https://api.github.com/users/jhelgert/followers",
                "following_url": "https://api.github.com/users/jhelgert/following{/other_user}",
                "gists_url": "https://api.github.com/users/jhelgert/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jhelgert",
                "id": 8471326,
                "login": "jhelgert",
                "node_id": "MDQ6VXNlcjg0NzEzMjY=",
                "organizations_url": "https://api.github.com/users/jhelgert/orgs",
                "received_events_url": "https://api.github.com/users/jhelgert/received_events",
                "repos_url": "https://api.github.com/users/jhelgert/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jhelgert/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jhelgert/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jhelgert"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-11-08T09:20:57Z",
            "event": "renamed",
            "id": 3970578628,
            "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mzk3MDU3ODYyOA==",
            "performed_via_github_app": null,
            "rename": {
                "from": "[BUG] Not possible to use a tuple of fused types as function argument",
                "to": "[BUG] Not possible to use a ctuple of fused types as function argument"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/3970578628"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-11-08T09:39:36Z",
            "event": "labeled",
            "id": 3970590110,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM5NzA1OTAxMTA=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3970590110"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-11-08T09:40:24Z",
            "event": "unlabeled",
            "id": 3970590663,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDE0OlVubGFiZWxlZEV2ZW50Mzk3MDU5MDY2Mw==",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3970590663"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-11-08T09:40:24Z",
            "event": "labeled",
            "id": 3970590664,
            "label": {
                "color": "444444",
                "name": "enhancement"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM5NzA1OTA2NjQ=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3970590664"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-11-08T09:40:24Z",
            "event": "labeled",
            "id": 3970590665,
            "label": {
                "color": "444444",
                "name": "Type Analysis"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM5NzA1OTA2NjU=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3970590665"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3904/events",
    "html_url": "https://github.com/cython/cython/issues/3904",
    "id": 738424650,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425558824,
            "name": "Type Analysis",
            "node_id": "MDU6TGFiZWw0MjU1NTg4MjQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/Type%20Analysis"
        },
        {
            "color": "444444",
            "default": true,
            "description": null,
            "id": 425556243,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw0MjU1NTYyNDM=",
            "url": "https://api.github.com/repos/cython/cython/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3904/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU3Mzg0MjQ2NTA=",
    "number": 3904,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[BUG] Not possible to use a ctuple of fused types as function argument",
    "updated_at": "2020-11-08T10:49:45Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3904",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/8471326?v=4",
        "events_url": "https://api.github.com/users/jhelgert/events{/privacy}",
        "followers_url": "https://api.github.com/users/jhelgert/followers",
        "following_url": "https://api.github.com/users/jhelgert/following{/other_user}",
        "gists_url": "https://api.github.com/users/jhelgert/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jhelgert",
        "id": 8471326,
        "login": "jhelgert",
        "node_id": "MDQ6VXNlcjg0NzEzMjY=",
        "organizations_url": "https://api.github.com/users/jhelgert/orgs",
        "received_events_url": "https://api.github.com/users/jhelgert/received_events",
        "repos_url": "https://api.github.com/users/jhelgert/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jhelgert/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jhelgert/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jhelgert"
    }
}