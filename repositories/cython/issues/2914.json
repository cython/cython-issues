{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I have the following simplified scenario for my game engine I am writing in cython. I have an \"App\" cdef class that is responsible for processing a list of \"System\" cdef class objects. I would like each \"System\" object to have a reference back to its parent \"App\" object that it belongs to. The \"System\" cdef class has some basic functions, and I want to extend this class in sub-cdef-classes (e.g. \"GraphicsSystem\", \"AudioSystem\", \"PhysicsSystem\", etc.). This boils down to the following code:\r\n\r\n```\r\n#system.pxd\r\nfrom pyorama.app cimport *\r\n\r\ncdef class System:\r\n    cdef App app\r\n    \r\n    cpdef void init(self)\r\n    cpdef void quit(self)\r\n    cpdef void update(self)\r\n\r\n#system.pyx\r\ncdef class System:\r\n    \r\n    def __init__(self):\r\n        self.app = None\r\n    \r\n    cpdef void init(self): print(\"system init\")\r\n    cpdef void quit(self): print(\"system quit\")\r\n    cpdef void update(self): print(\"system update\")\r\n```\r\n\r\n```\r\n#graphics_system.pxd\r\nfrom pyorama.system cimport *\r\n\r\ncdef class GraphicsSystem(System):\r\n    pass\r\n\r\n#graphics_system.pyx\r\ncdef class GraphicsSystem(System):\r\n    pass\r\n```\r\n```\r\n#app.pxd\r\nfrom pyorama.graphics_system cimport *\r\ncdef class App:\r\n    pass\r\n\r\n#app.pyx\r\ncdef class App:\r\n    pass\r\n```\r\n\r\nAttempting to compile this yields the following error message during the cythonization phase:\r\n```\r\nanish@laptop:~/Documents/Programming/cython/inheritance$ python3 setup.py build_ext -i\r\nCompiling ./pyorama/graphics_system.pyx because it depends on ./pyorama/system.pxd.\r\nCompiling ./pyorama/app.pyx because it depends on ./pyorama/system.pxd.\r\nCompiling ./pyorama/system.pyx because it changed.\r\n[1/3] Cythonizing ./pyorama/system.pyx\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nfrom pyorama.system cimport *\r\n\r\ncdef class GraphicsSystem(System):\r\n    ^\r\n------------------------------------------------------------\r\n\r\npyorama/graphics_system.pxd:3:5: Compiler crash in AnalyseDeclarationsTransform\r\n\r\nModuleNode.body = StatListNode(graphics_system.pxd:1:0)\r\nStatListNode.stats[1] = CClassDefNode(graphics_system.pxd:3:5,\r\n    as_name = 'GraphicsSystem',\r\n    class_name = 'GraphicsSystem',\r\n    in_pxd = True,\r\n    module_name = '',\r\n    visibility = 'private')\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"Cython/Compiler/Visitor.py\", line 180, in Cython.Compiler.Visitor.TreeVisitor._visit\r\n  File \"/home/anish/.local/lib/python3.6/site-packages/Cython/Compiler/ParseTreeTransforms.py\", line 1621, in visit_CClassDefNode\r\n    node = self.visit_ClassDefNode(node)\r\n  File \"Cython/Compiler/Visitor.py\", line 383, in Cython.Compiler.Visitor.EnvTransform.visit_ClassDefNode\r\nAttributeError: 'CClassDefNode' object has no attribute 'scope'\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nfrom pyorama.system cimport *\r\n\r\ncdef class GraphicsSystem(System):\r\n    ^\r\n------------------------------------------------------------\r\n\r\npyorama/graphics_system.pxd:3:5: C class 'GraphicsSystem' already defined\r\nTraceback (most recent call last):\r\n  File \"setup.py\", line 66, in <module>\r\n    compiler_directives=directives,\r\n  File \"/home/anish/.local/lib/python3.6/site-packages/Cython/Build/Dependencies.py\", line 1097, in cythonize\r\n    cythonize_one(*args)\r\n  File \"/home/anish/.local/lib/python3.6/site-packages/Cython/Build/Dependencies.py\", line 1220, in cythonize_one\r\n    raise CompileError(None, pyx_file)\r\nCython.Compiler.Errors.CompileError: ./pyorama/system.pyx\r\n```\r\n\r\nCommenting out the cimport in the \"App\" allows the code to compile, and using the \"GraphicsSystem\" cdef class in other cython modules works without issue. Similarly, cimporting \"System\" into the app.pxd file works without issues; it appears that just the subclass causes issues during compilation. Any help would be appreciated!",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2914/comments",
    "created_at": "2019-04-06T02:44:27Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2914/events",
    "html_url": "https://github.com/cython/cython/issues/2914",
    "id": 429988986,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2914/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0Mjk5ODg5ODY=",
    "number": 2914,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Handling cdef class inheritance and circular cimports",
    "updated_at": "2019-04-06T02:44:27Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2914",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/4753028?v=4",
        "events_url": "https://api.github.com/users/AnishN/events{/privacy}",
        "followers_url": "https://api.github.com/users/AnishN/followers",
        "following_url": "https://api.github.com/users/AnishN/following{/other_user}",
        "gists_url": "https://api.github.com/users/AnishN/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/AnishN",
        "id": 4753028,
        "login": "AnishN",
        "node_id": "MDQ6VXNlcjQ3NTMwMjg=",
        "organizations_url": "https://api.github.com/users/AnishN/orgs",
        "received_events_url": "https://api.github.com/users/AnishN/received_events",
        "repos_url": "https://api.github.com/users/AnishN/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/AnishN/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/AnishN/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/AnishN"
    }
}