{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug:**\r\nIf you build a Cython extension with line tracing support and try to profile it with `line_profiler`/`kernprof`, they won't be able to display a source code because an extension contains relative paths to it (introduced in #1565/#1576).\r\n\r\n**To reproduce:**\r\n```Batchfile\r\npath\\to\\module_root> cython -X linetrace=True -X binding=True \"path\\to\\your_module.pyx\"\r\npath\\to\\module_root> pip install -U .\r\npath\\to\\module_root\\debugging_tools> kernprof -l -o nul -v module_runner.py args\r\n```\r\n\r\n**Expected behavior:**\r\n`line_profiler`/`kernprof` display extension source code along profiling results.\r\n\r\n**Environment:**\r\n - OS: Windows\r\n - Python version: any\r\n - Cython version: 0.29.21\r\n\r\n**Additional notes:**\r\nAs a solution you could still use absolute paths for profiling builds and relative otherwise.\r\nHowever, I don't see much point in using relative paths by now in a first place (except for some privacy or code size concerns) as I can't recompile an extension with the same checksum even from the same `.c` file...",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Is this the same underlying issue as #2543?",
            "created_at": "2022-04-30T15:10:02Z",
            "html_url": "https://github.com/cython/cython/issues/3929#issuecomment-1114004052",
            "id": 1114004052,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3929",
            "node_id": "IC_kwDOABDGAc5CZlpU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1114004052/reactions"
            },
            "updated_at": "2022-04-30T15:10:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1114004052",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/966348?v=4",
                "events_url": "https://api.github.com/users/tillahoffmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/tillahoffmann/followers",
                "following_url": "https://api.github.com/users/tillahoffmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/tillahoffmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tillahoffmann",
                "id": 966348,
                "login": "tillahoffmann",
                "node_id": "MDQ6VXNlcjk2NjM0OA==",
                "organizations_url": "https://api.github.com/users/tillahoffmann/orgs",
                "received_events_url": "https://api.github.com/users/tillahoffmann/received_events",
                "repos_url": "https://api.github.com/users/tillahoffmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tillahoffmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tillahoffmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tillahoffmann"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Is this the same underlying issue as #2543?\r\n\r\nYes it definitely looks like it.\r\n\r\nI'm not quite sure what the main issue is here: does line_profiler not understand relative paths at all, are the paths relative to the wrong place, or something else?",
            "created_at": "2022-04-30T17:34:20Z",
            "html_url": "https://github.com/cython/cython/issues/3929#issuecomment-1114025108",
            "id": 1114025108,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3929",
            "node_id": "IC_kwDOABDGAc5CZqyU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1114025108/reactions"
            },
            "updated_at": "2022-04-30T17:34:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1114025108",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The main issue is probably that `line_profiler` retrieves the source file from `co_filename` [here](https://github.com/pyutils/line_profiler/blob/1d14155577fc1a36234db4a7e6ea5012cf7d2570/line_profiler/_line_profiler.pyx#L53) to try and display the source. So it won't be able to find the source unless `line_profiler` is run from the directory from which `cythonize` was run because `cythonize` strips the current working directory if possible (see [here](https://github.com/cython/cython/pull/1576/files)). \r\n\r\nThe behavior is somewhat unexpected, because `co_filename` is usually an absolute path. But maybe asking users to run `line_profiler` from the same directory isn't unreasonable because it's likely to only be used during development anyway.",
            "created_at": "2022-04-30T18:29:50Z",
            "html_url": "https://github.com/cython/cython/issues/3929#issuecomment-1114033215",
            "id": 1114033215,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3929",
            "node_id": "IC_kwDOABDGAc5CZsw_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1114033215/reactions"
            },
            "updated_at": "2022-04-30T18:29:50Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1114033215",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/966348?v=4",
                "events_url": "https://api.github.com/users/tillahoffmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/tillahoffmann/followers",
                "following_url": "https://api.github.com/users/tillahoffmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/tillahoffmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tillahoffmann",
                "id": 966348,
                "login": "tillahoffmann",
                "node_id": "MDQ6VXNlcjk2NjM0OA==",
                "organizations_url": "https://api.github.com/users/tillahoffmann/orgs",
                "received_events_url": "https://api.github.com/users/tillahoffmann/received_events",
                "repos_url": "https://api.github.com/users/tillahoffmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tillahoffmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tillahoffmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tillahoffmann"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The solution proposed in the issue you linked would be to use the `__file__` attribute of the module to work out the full path of the source file at runtime. That'd rely on the source file being distributed alongside the .so file.\r\n\r\nIt seems like it might be more fiddly than it sounds to make work reliably.\r\n\r\nI'd be reluctant to code the full path in at compile time (as the original post suggests) for a few different reasons.",
            "created_at": "2022-04-30T19:43:13Z",
            "html_url": "https://github.com/cython/cython/issues/3929#issuecomment-1114043534",
            "id": 1114043534,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3929",
            "node_id": "IC_kwDOABDGAc5CZvSO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1114043534/reactions"
            },
            "updated_at": "2022-04-30T19:43:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1114043534",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "An option might be to add a line to the [profiling_tutorial](https://github.com/cython/cython/blob/0dffecfa4407b761ba138a6bbcfcffcd65454aa8/docs/src/tutorial/profiling_tutorial.rst) to note that, if you're using `line_profiler`, you must run it from the directory where you ran `cythonize`.",
            "created_at": "2022-05-01T17:03:21Z",
            "html_url": "https://github.com/cython/cython/issues/3929#issuecomment-1114285214",
            "id": 1114285214,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3929",
            "node_id": "IC_kwDOABDGAc5CaqSe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1114285214/reactions"
            },
            "updated_at": "2022-05-01T17:03:21Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1114285214",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/966348?v=4",
                "events_url": "https://api.github.com/users/tillahoffmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/tillahoffmann/followers",
                "following_url": "https://api.github.com/users/tillahoffmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/tillahoffmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tillahoffmann",
                "id": 966348,
                "login": "tillahoffmann",
                "node_id": "MDQ6VXNlcjk2NjM0OA==",
                "organizations_url": "https://api.github.com/users/tillahoffmann/orgs",
                "received_events_url": "https://api.github.com/users/tillahoffmann/received_events",
                "repos_url": "https://api.github.com/users/tillahoffmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tillahoffmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tillahoffmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tillahoffmann"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3929/comments",
    "created_at": "2020-12-02T11:45:59Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6688885?v=4",
                "events_url": "https://api.github.com/users/EvgenKo423/events{/privacy}",
                "followers_url": "https://api.github.com/users/EvgenKo423/followers",
                "following_url": "https://api.github.com/users/EvgenKo423/following{/other_user}",
                "gists_url": "https://api.github.com/users/EvgenKo423/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/EvgenKo423",
                "id": 6688885,
                "login": "EvgenKo423",
                "node_id": "MDQ6VXNlcjY2ODg4ODU=",
                "organizations_url": "https://api.github.com/users/EvgenKo423/orgs",
                "received_events_url": "https://api.github.com/users/EvgenKo423/received_events",
                "repos_url": "https://api.github.com/users/EvgenKo423/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/EvgenKo423/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/EvgenKo423/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/EvgenKo423"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-12-02T11:47:37Z",
            "event": "renamed",
            "id": 4061919209,
            "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDA2MTkxOTIwOQ==",
            "performed_via_github_app": null,
            "rename": {
                "from": "[BUG] line_profiler fails to find original source files because of the relative file paths introduced in #1565/#1576",
                "to": "[BUG] line_profiler fails to find original source files because of the relative file paths"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/4061919209"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3929/events",
    "html_url": "https://github.com/cython/cython/issues/3929",
    "id": 755202378,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3929/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU3NTUyMDIzNzg=",
    "number": 3929,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/3929/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/3929/timeline",
    "title": "[BUG] line_profiler fails to find original source files because of the relative file paths",
    "updated_at": "2022-05-01T17:03:21Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3929",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6688885?v=4",
        "events_url": "https://api.github.com/users/EvgenKo423/events{/privacy}",
        "followers_url": "https://api.github.com/users/EvgenKo423/followers",
        "following_url": "https://api.github.com/users/EvgenKo423/following{/other_user}",
        "gists_url": "https://api.github.com/users/EvgenKo423/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/EvgenKo423",
        "id": 6688885,
        "login": "EvgenKo423",
        "node_id": "MDQ6VXNlcjY2ODg4ODU=",
        "organizations_url": "https://api.github.com/users/EvgenKo423/orgs",
        "received_events_url": "https://api.github.com/users/EvgenKo423/received_events",
        "repos_url": "https://api.github.com/users/EvgenKo423/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/EvgenKo423/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/EvgenKo423/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/EvgenKo423"
    }
}