{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Describe the bug\n\nIf you create a module with `linetrace=True` and try to debug code that imports it then you get an assertion error. Note that this happens even if you step over the Python module.\n\n### Code to reproduce the behaviour:\n\n```cython\n# cython: linetrace=True\n```\n\nJust compile that with `cythonize.py -if my_cython_module.pyx`\n\nThen a Python file:\n\n```python\nprint(1)\nimport my_cython_module\nprint(2)\n```\n\nUsing VSCode, put a breakpoint on line 1 (`print(1)`). Run the module in debug mode. Step to line 2 (`import ...`). Step to line 3. Here you get a popup saying:\n\n```\nException has occurred: AssertionError\n<code object _call_with_frames_removed at 0x798ad8e20570, file \"<frozen importlib._bootstrap>\", line 480> != <code object PyInit_my_cython_module at 0x798ad73d5b00, file \"my_cython_module.pyx\", line 1>\nKeyError: (1, '<path>/my_cython_module.pyx', <code object PyInit_my_cython_module at 0x798ad73d5b00, file \"my_cython_module.pyx\", line 1>)\n\nDuring handling of the above exception, another exception occurred:\n\n  File \"<path>/my_cython_module.pyx\", line 1, in init my_cython_module\n    # cython: linetrace=True\n  File \"<path>/debugimport.py\", line 2, in <module>\n    import my_cython_module\nAssertionError: <code object _call_with_frames_removed at 0x798ad8e20570, file \"<frozen importlib._bootstrap>\", line 480> != <code object PyInit_my_cython_module at 0x798ad73d5b00, file \"my_cython_module.pyx\", line 1>\n```\n\n### Expected behaviour\n\nNo assertion error?\n\n### OS\n\nThis is on Windows VSCode running Python in WSL. I suspect it's general though\n\n### Python version\n\n3.13, probably 3.12\n\n### Cython version\n\nCurrent master. Anything after https://github.com/cython/cython/commit/ed2b40be6cad736ab39cffa2503d816ef2c6741e\n\n### Additional context\n\nThe assertion error comes from https://github.com/fabioz/PyDev.Debugger/blob/3030fa9908187513bdd3e3dd93bfa897a95a6ece/_pydevd_sys_monitoring/_pydevd_sys_monitoring.py#L615\n\nIt's possible the issue may be on their side.\n\nSee https://github.com/rapidfuzz/RapidFuzz/issues/454",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "See also https://github.com/fabioz/PyDev.Debugger/issues/311",
            "created_at": "2025-09-04T09:58:10Z",
            "html_url": "https://github.com/cython/cython/issues/7133#issuecomment-3252893298",
            "id": 3252893298,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7133",
            "node_id": "IC_kwDOABDGAc7B4zZy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3252893298/reactions"
            },
            "updated_at": "2025-09-04T09:58:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3252893298",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "In principle we might be able to pre-disable the debugger tool in the monitoring state (on the basis that it's unlikely to ever be too useful with Cython).\n\nThat seems overly pessimistic though - it does prevent other people doing useful stuff with it in future",
            "created_at": "2025-09-04T11:29:30Z",
            "html_url": "https://github.com/cython/cython/issues/7133#issuecomment-3253245530",
            "id": 3253245530,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7133",
            "node_id": "IC_kwDOABDGAc7B6JZa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3253245530/reactions"
            },
            "updated_at": "2025-09-04T11:29:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3253245530",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Also https://github.com/microsoft/debugpy/issues/1757 - it'd a little unfair to try to blame PyDev.Debugger for this because Microsoft have vendored their library, and so most people will be hitting Microsoft's copy",
            "created_at": "2025-09-04T18:15:34Z",
            "html_url": "https://github.com/cython/cython/issues/7133#issuecomment-3254964274",
            "id": 3254964274,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7133",
            "node_id": "IC_kwDOABDGAc7CAtAy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3254964274/reactions"
            },
            "updated_at": "2025-09-04T18:15:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3254964274",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "A major goal of supporting `sys.monitoring`, from the PoV of Cython, was to get over the need for clumsily emulating frame state. Python interpreter frames are not part of the monitoring infrastructure, code objects are. Thus, it seems reasonable for a Python code debugger to check if the current Python frame refers to the monitored code object, but the effect of this check should not be a failing assertion. It's not invalid for code objects and Python frame state to diverge. A Python code debugger should simply ignore monitoring events for which there is no Python frame, not fail on them.\n\nRegarding a solution or work-around, there are tens of thousands of Cython modules out there but only a hand full of Python debuggers. That hand full seems substantially easier to fix than masses of Python packages.",
            "created_at": "2025-09-06T05:50:27Z",
            "html_url": "https://github.com/cython/cython/issues/7133#issuecomment-3261088141",
            "id": 3261088141,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7133",
            "node_id": "IC_kwDOABDGAc7CYEGN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3261088141/reactions"
            },
            "updated_at": "2025-09-06T05:52:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3261088141",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I agree, although I'm not optimistic about getting debuggers fixed.",
            "created_at": "2025-09-06T07:42:19Z",
            "html_url": "https://github.com/cython/cython/issues/7133#issuecomment-3261521991",
            "id": 3261521991,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7133",
            "node_id": "IC_kwDOABDGAc7CZuBH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3261521991/reactions"
            },
            "updated_at": "2025-09-06T07:42:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3261521991",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/7133/comments",
    "created_at": "2025-09-04T09:50:49Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/959771?v=4",
                "events_url": "https://api.github.com/users/icarocd/events{/privacy}",
                "followers_url": "https://api.github.com/users/icarocd/followers",
                "following_url": "https://api.github.com/users/icarocd/following{/other_user}",
                "gists_url": "https://api.github.com/users/icarocd/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icarocd",
                "id": 959771,
                "login": "icarocd",
                "node_id": "MDQ6VXNlcjk1OTc3MQ==",
                "organizations_url": "https://api.github.com/users/icarocd/orgs",
                "received_events_url": "https://api.github.com/users/icarocd/received_events",
                "repos_url": "https://api.github.com/users/icarocd/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icarocd/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icarocd/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icarocd",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-09-04T11:16:47Z",
            "event": "subscribed",
            "id": 19501916429,
            "node_id": "SE_lADOABDGAc7JpCz3zwAAAASKZ6EN",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/19501916429"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": "85b3d377349b295604b5eaeb5b26202c906ccf88",
            "commit_url": "https://api.github.com/repos/da-woods/cython/commits/85b3d377349b295604b5eaeb5b26202c906ccf88",
            "created_at": "2025-09-04T18:08:43Z",
            "event": "referenced",
            "id": 19511331806,
            "node_id": "REFE_lADOABDGAc7JpCz3zwAAAASK90ve",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/19511331806"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/7133/events",
    "html_url": "https://github.com/cython/cython/issues/7133",
    "id": 3382979831,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/7133/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc7JpCz3",
    "number": 7133,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/7133/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/7133/timeline",
    "title": "[BUG] linetrace=True interacts badly with VSCode debugger",
    "type": null,
    "updated_at": "2025-09-06T07:42:19Z",
    "url": "https://api.github.com/repos/cython/cython/issues/7133",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
        "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
        "followers_url": "https://api.github.com/users/da-woods/followers",
        "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
        "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/da-woods",
        "id": 10536947,
        "login": "da-woods",
        "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
        "organizations_url": "https://api.github.com/users/da-woods/orgs",
        "received_events_url": "https://api.github.com/users/da-woods/received_events",
        "repos_url": "https://api.github.com/users/da-woods/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/da-woods",
        "user_view_type": "public"
    }
}