{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\r\n\r\nWhen testing the impact of Cython upgrade from 3.0.2 to 3.0.4 in Fedora, I discovered reedsolo 1.7.0 failed to build.\r\n\r\nI was able to reproduce this outside of our RPM environment, on x86_64.\r\n\r\nThe problem does not happen with Cython 3.0.3, only 3.0.4.\r\n\r\n### Code to reproduce the behaviour:\r\n\r\n```\r\n$ git clone git@github.com:tomerfiliba-org/reedsolomon.git\r\n...\r\n$ cd reedsolomon/\r\n[reedsolomon (master)]$ git switch -d v1.7.0\r\nHEAD is now at 9d27c91 wording\r\n[reedsolomon ((v1.7.0))]$ python3.12 -m venv __venv__\r\n[reedsolomon ((v1.7.0))]$ . __venv__/bin/activate\r\n(__venv__) [reedsolomon ((v1.7.0))]$ pip install setuptools Cython==3.0.4\r\n...\r\nSuccessfully installed Cython-3.0.4 setuptools-68.2.2\r\n(__venv__) [reedsolomon ((v1.7.0))]$ python setup.py --cythonize build\r\nCython is installed, building creedsolo module\r\n[1/1] Cythonizing creedsolo.pyx\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n\r\n    # For each possible value in the galois field 2^8, we will pre-compute the logarithm and anti-logarithm (exponential) of this value\r\n    # To do that, we generate the Galois Field F(2^p) by building a list starting with the element 0 followed by the (p-1) successive powers of the generator a : 1, a, a^1, a^2, ..., a^(p-1).\r\n    x = 1\r\n    for i in xrange(field_charac): # we could skip index 255 which is equal to index 0 because of modulo: g^255==g^0\r\n        gf_exp[i] = x # compute anti-log for this value and store it in a table\r\n              ^\r\n------------------------------------------------------------\r\n\r\ncreedsolo.pyx:202:14: Compiler crash in AnalyseExpressionsTransform\r\n\r\nModuleNode.body = StatListNode(creedsolo.pyx:86:0)\r\nStatListNode.stats[13] = StatListNode(creedsolo.pyx:181:0)\r\nStatListNode.stats[0] = DefNode(creedsolo.pyx:181:0,\r\n    doc = \"Precompute the logarithm and anti-log tables for faster computation later, using the provided primitive polynomial.\\n    These tables are used for multiplication/division since addition/substraction are simple XOR operations inside GF of characteristic 2.\\n    The basic idea is quite simple: since b**(log_b(x), log_b(y)) == x * y given any number b (the base or generator of the logarithm), then we can use any number b to precompute logarithm and anti-log (exponentiation) tables to use for multiplying two numbers x and y.\\n    That's why when we use a different base/generator number, the log and anti-log tables are drastically different, but the resulting computations are the same given any such tables.\\n    For more infos, see https://en.wikipedia.org/wiki/Finite_field_arithmetic#Implementation_tricks\\n    \",\r\n    is_cyfunction = True,\r\n    modifiers = [...]/0,\r\n    name = 'init_tables',\r\n    np_args_idx = [...]/0,\r\n    outer_attrs = [...]/2,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0',\r\n    used = True)\r\nFile 'Nodes.py', line 397, in analyse_expressions: StatListNode(creedsolo.pyx:182:4,\r\n    is_terminator = True)\r\nFile 'Nodes.py', line 7556, in analyse_expressions: ForInStatNode(creedsolo.pyx:201:4)\r\nFile 'Nodes.py', line 397, in analyse_expressions: StatListNode(creedsolo.pyx:202:8)\r\nFile 'Nodes.py', line 6026, in analyse_expressions: SingleAssignmentNode(creedsolo.pyx:202:20)\r\nFile 'Nodes.py', line 6164, in analyse_types: SingleAssignmentNode(creedsolo.pyx:202:20)\r\nFile 'ExprNodes.py', line 4085, in analyse_target_types: IndexNode(creedsolo.pyx:202:14,\r\n    is_subscript = True,\r\n    result_is_used = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 4123, in analyse_base_and_index_types: IndexNode(creedsolo.pyx:202:14,\r\n    is_subscript = True,\r\n    result_is_used = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 4349, in analyse_as_buffer_operation: IndexNode(creedsolo.pyx:202:14,\r\n    is_subscript = True,\r\n    result_is_used = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 4968, in analyse_types: MemoryViewIndexNode(creedsolo.pyx:202:14,\r\n    is_memview_index = True,\r\n    memslice_index = True,\r\n    result_is_used = True,\r\n    use_managed_ref = True,\r\n    writable_needed = True)\r\n\r\nCompiler crash traceback from this point on:\r\n  File \".../reedsolomon/__venv__/lib64/python3.12/site-packages/Cython/Compiler/ExprNodes.py\", line 4968, in analyse_types\r\n    performance_hint(index.pos, \"Index should be typed for more efficient access\")\r\nTypeError: performance_hint() missing 1 required positional argument: 'env'\r\nTraceback (most recent call last):\r\n  File \".../reedsolomon/setup.py\", line 32, in <module>\r\n    extensions = cythonize([ Extension('creedsolo', ['creedsolo.pyx']) ], force=True)  # this may fail hard if Cython is installed but there is no C compiler for current Python version, and we have no way to know. Alternatively, we could supply exclude_failures=True , but then for those who really want the cythonized compiled extension, it would be much harder to debug\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \".../reedsolomon/__venv__/lib64/python3.12/site-packages/Cython/Build/Dependencies.py\", line 1154, in cythonize\r\n    cythonize_one(*args)\r\n  File \".../reedsolomon/__venv__/lib64/python3.12/site-packages/Cython/Build/Dependencies.py\", line 1321, in cythonize_one\r\n    raise CompileError(None, pyx_file)\r\nCython.Compiler.Errors.CompileError: creedsolo.pyx\r\n```\r\n\r\nAs a thing to paste:\r\n\r\n```\r\ngit clone git@github.com:tomerfiliba-org/reedsolomon.git\r\ncd reedsolomon/\r\ngit switch -d v1.7.0\r\npython3.12 -m venv __venv__\r\n. __venv__/bin/activate\r\npip install setuptools Cython==3.0.4\r\npython setup.py --cythonize build\r\n```\r\n\r\n### Expected behaviour\r\n\r\nWith 3.0.2 and 3.0.3 this compiles fine.\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Python version\r\n\r\n3.12.0\r\n\r\n### Cython version\r\n\r\n3.0.4\r\n\r\n### Additional context\r\n\r\n_No response_",
    "closed_at": "2023-10-23T16:59:40Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Looks like a dupe of https://github.com/cython/cython/issues/5771, sorry for the noise.",
            "created_at": "2023-10-23T16:59:40Z",
            "html_url": "https://github.com/cython/cython/issues/5781#issuecomment-1775625490",
            "id": 1775625490,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5781",
            "node_id": "IC_kwDOABDGAc5p1eUS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1775625490/reactions"
            },
            "updated_at": "2023-10-23T16:59:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1775625490",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
                "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
                "followers_url": "https://api.github.com/users/hroncok/followers",
                "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
                "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hroncok",
                "id": 2401856,
                "login": "hroncok",
                "node_id": "MDQ6VXNlcjI0MDE4NTY=",
                "organizations_url": "https://api.github.com/users/hroncok/orgs",
                "received_events_url": "https://api.github.com/users/hroncok/received_events",
                "repos_url": "https://api.github.com/users/hroncok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hroncok"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5781/comments",
    "created_at": "2023-10-23T16:54:42Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
                "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
                "followers_url": "https://api.github.com/users/hroncok/followers",
                "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
                "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hroncok",
                "id": 2401856,
                "login": "hroncok",
                "node_id": "MDQ6VXNlcjI0MDE4NTY=",
                "organizations_url": "https://api.github.com/users/hroncok/orgs",
                "received_events_url": "https://api.github.com/users/hroncok/received_events",
                "repos_url": "https://api.github.com/users/hroncok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hroncok"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-10-23T16:59:40Z",
            "event": "closed",
            "id": 10743670871,
            "node_id": "CE_lADOABDGAc50rpsjzwAAAAKAX2hX",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10743670871"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5781/events",
    "html_url": "https://github.com/cython/cython/issues/5781",
    "id": 1957600035,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5781/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc50rpsj",
    "number": 5781,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5781/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5781/timeline",
    "title": "[BUG] reedsolo Compiler crash in AnalyseExpressionsTransform (regression in 3.0.4)",
    "updated_at": "2023-10-23T16:59:40Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5781",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
        "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
        "followers_url": "https://api.github.com/users/hroncok/followers",
        "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
        "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/hroncok",
        "id": 2401856,
        "login": "hroncok",
        "node_id": "MDQ6VXNlcjI0MDE4NTY=",
        "organizations_url": "https://api.github.com/users/hroncok/orgs",
        "received_events_url": "https://api.github.com/users/hroncok/received_events",
        "repos_url": "https://api.github.com/users/hroncok/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/hroncok"
    }
}