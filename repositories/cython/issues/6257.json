{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nTrying to compile the cython code via ``python setup.py build`` leads to many errors from undefined variables (full log [here](https://builds.sr.ht/~tfardet/job/1257694#task-setup-2794)):\r\n\r\n```\r\nx86_64-linux-gnu-gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I./nngt/generation -I./nngt/generation/ -I/home/build/.nngt_env/lib/python3.10/site-packages/numpy/core/include -I/home/build/.nngt_env/include -I/usr/include/python3.10 -c ./nngt/generation/cconnect.cpp -o build/temp.linux-x86_64-3.10/./nngt/generation/cconnect.o -DNPY_NO_DEPRECATED_API=NPY_1_9_API_VERSION -std=c++14 -Wno-cpp -Wno-unused-function -ffast-math -msse -ftree-vectorize -O2 -g -fopenmp\r\n./nngt/generation/cconnect.cpp: In function ‘npy_intp __pyx_f_5numpy_5dtype_8itemsize_itemsize(PyArray_Descr*)’:\r\n./nngt/generation/cconnect.cpp:20434:13: error: ‘PyDataType_ELSIZE’ was not declared in this scope; did you mean ‘PyDataType_ISUNSIZED’?\r\n20434 |   __pyx_r = PyDataType_ELSIZE(__pyx_v_self);\r\n      |             ^~~~~~~~~~~~~~~~~\r\n      |             PyDataType_ISUNSIZED\r\n./nngt/generation/cconnect.cpp: In function ‘npy_intp __pyx_f_5numpy_5dtype_9alignment_alignment(PyArray_Descr*)’:\r\n./nngt/generation/cconnect.cpp:20468:13: error: ‘PyDataType_ALIGNMENT’ was not declared in this scope; did you mean ‘PyDataType_ISSIGNED’?\r\n...\r\n```\r\n\r\n### Code to reproduce the behaviour:\r\n\r\nThe ``cconect.pyx/pxd`` file are visible [here](https://git.sr.ht/~tfardet/NNGT/tree/numpy2/item/nngt/generation), the only numpy/cython specific thing is the ``cimport numpy as cnp`` and the use of ``cnp.uint8_t``, ``cnp.int64_t`` and ``cnp.ndarray[cnp.int64_t, ndim=1/2]``.\r\nThe setup.py is [here](https://git.sr.ht/~tfardet/NNGT/tree/numpy2/item/setup.py).\r\n\r\n### Expected behaviour\r\n\r\nCompilation [works fine with cython <= 3.0.8](https://builds.sr.ht/~tfardet/job/1257690#task-test).\r\n\r\n### OS\r\n\r\nUbuntu Jammy\r\n\r\n### Python version\r\n\r\n3.10.12\r\n\r\n### Cython version\r\n\r\n``>= 3.0.9``\r\n\r\n### Additional context\r\n\r\nSurprisingly enough, compiling the same code works fine locally on my Fedora with python 3.12 and cython 3.0.10.\r\nThis is using numpy 1.26.4 in all cases.",
    "closed_at": "2024-06-23T13:48:00Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I don't think this is a Cython bug. `PyDataType_ELSIZE` and `PyDataType_ALIGNMENT` don't appear in the Cython code at all.\r\n\r\nThey look to be new in Numpy 2. I think you're somehow using the Numpy pxd files from Numpy 2, but the headers from Numpy 1.something.",
            "created_at": "2024-06-22T09:14:36Z",
            "html_url": "https://github.com/cython/cython/issues/6257#issuecomment-2183956081",
            "id": 2183956081,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6257",
            "node_id": "IC_kwDOABDGAc6CLIZx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2183956081/reactions"
            },
            "updated_at": "2024-06-22T09:14:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2183956081",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "@da-woods thanks for the quick reply, what I don't understand is why the error happens only with version 3.0.9 and later, while 3.0.8 compiles fine.\r\nThis is the same environment and same numpy, the only thing that changes is the cython version, which seems to point at a change of behavior there.\r\nI'll try to dig in the code to see where that could come from but since I don't know it at all, I was hoping someone from the dev team may know where the issue could come from (at least in terms of which files I should look at).",
            "created_at": "2024-06-22T09:18:37Z",
            "html_url": "https://github.com/cython/cython/issues/6257#issuecomment-2183957053",
            "id": 2183957053,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6257",
            "node_id": "IC_kwDOABDGAc6CLIo9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2183957053/reactions"
            },
            "updated_at": "2024-06-22T09:18:37Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2183957053",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/79037344?v=4",
                "events_url": "https://api.github.com/users/tfardet/events{/privacy}",
                "followers_url": "https://api.github.com/users/tfardet/followers",
                "following_url": "https://api.github.com/users/tfardet/following{/other_user}",
                "gists_url": "https://api.github.com/users/tfardet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tfardet",
                "id": 79037344,
                "login": "tfardet",
                "node_id": "MDQ6VXNlcjc5MDM3MzQ0",
                "organizations_url": "https://api.github.com/users/tfardet/orgs",
                "received_events_url": "https://api.github.com/users/tfardet/received_events",
                "repos_url": "https://api.github.com/users/tfardet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tfardet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tfardet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tfardet"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "You are probably installing a numpy 2.0.0 somehow, perhaps due to build isolation or how you manually created your virtualenv. Your `setup.py` has an `import numpy` and then `np.get_include()`. If you check `np.__version__` and `np.__file__` after import, you should be able to deduce whether the version is indeed 2.0 and where it was installed to (and from there, by what tool/command).",
            "created_at": "2024-06-23T09:34:52Z",
            "html_url": "https://github.com/cython/cython/issues/6257#issuecomment-2184919611",
            "id": 2184919611,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6257",
            "node_id": "IC_kwDOABDGAc6COzo7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2184919611/reactions"
            },
            "updated_at": "2024-06-23T09:34:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2184919611",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/98330?v=4",
                "events_url": "https://api.github.com/users/rgommers/events{/privacy}",
                "followers_url": "https://api.github.com/users/rgommers/followers",
                "following_url": "https://api.github.com/users/rgommers/following{/other_user}",
                "gists_url": "https://api.github.com/users/rgommers/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rgommers",
                "id": 98330,
                "login": "rgommers",
                "node_id": "MDQ6VXNlcjk4MzMw",
                "organizations_url": "https://api.github.com/users/rgommers/orgs",
                "received_events_url": "https://api.github.com/users/rgommers/received_events",
                "repos_url": "https://api.github.com/users/rgommers/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rgommers/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rgommers/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rgommers"
            }
        },
        {
            "author_association": "NONE",
            "body": "@rgommers I will check this out, but I don't understand why this would be a problem with cython > 3.0.8 only... (the failing and passing builds differ only by ``cython < 3.0.8``)",
            "created_at": "2024-06-23T12:16:24Z",
            "html_url": "https://github.com/cython/cython/issues/6257#issuecomment-2184965993",
            "id": 2184965993,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6257",
            "node_id": "IC_kwDOABDGAc6CO-9p",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2184965993/reactions"
            },
            "updated_at": "2024-06-23T12:20:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2184965993",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/79037344?v=4",
                "events_url": "https://api.github.com/users/tfardet/events{/privacy}",
                "followers_url": "https://api.github.com/users/tfardet/followers",
                "following_url": "https://api.github.com/users/tfardet/following{/other_user}",
                "gists_url": "https://api.github.com/users/tfardet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tfardet",
                "id": 79037344,
                "login": "tfardet",
                "node_id": "MDQ6VXNlcjc5MDM3MzQ0",
                "organizations_url": "https://api.github.com/users/tfardet/orgs",
                "received_events_url": "https://api.github.com/users/tfardet/received_events",
                "repos_url": "https://api.github.com/users/tfardet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tfardet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tfardet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tfardet"
            }
        },
        {
            "author_association": "NONE",
            "body": "Re-running the test to check the numpy version (it was indeed 1.26), [the build passed with cython 3.0.10](https://builds.sr.ht/~tfardet/job/1258531), so I've no idea what happened...\r\nI also ran it with cython 3.0.10 and numpy 2 and this passed too.\r\nI'm closing this since it's no longer an issue for me, though I'm afraid it probably won't help anyone who encounters it later on.",
            "created_at": "2024-06-23T13:48:00Z",
            "html_url": "https://github.com/cython/cython/issues/6257#issuecomment-2184996856",
            "id": 2184996856,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6257",
            "node_id": "IC_kwDOABDGAc6CPGf4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2184996856/reactions"
            },
            "updated_at": "2024-06-23T13:48:00Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2184996856",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/79037344?v=4",
                "events_url": "https://api.github.com/users/tfardet/events{/privacy}",
                "followers_url": "https://api.github.com/users/tfardet/followers",
                "following_url": "https://api.github.com/users/tfardet/following{/other_user}",
                "gists_url": "https://api.github.com/users/tfardet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tfardet",
                "id": 79037344,
                "login": "tfardet",
                "node_id": "MDQ6VXNlcjc5MDM3MzQ0",
                "organizations_url": "https://api.github.com/users/tfardet/orgs",
                "received_events_url": "https://api.github.com/users/tfardet/received_events",
                "repos_url": "https://api.github.com/users/tfardet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tfardet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tfardet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tfardet"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6257/comments",
    "created_at": "2024-06-22T07:03:47Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-06-22T09:18:38Z",
            "event": "mentioned",
            "id": 13250182368,
            "node_id": "MEE_lADOABDGAc6NH0s_zwAAAAMVxbzg",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13250182368"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-06-22T09:18:38Z",
            "event": "subscribed",
            "id": 13250182369,
            "node_id": "SE_lADOABDGAc6NH0s_zwAAAAMVxbzh",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13250182369"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/98330?v=4",
                "events_url": "https://api.github.com/users/rgommers/events{/privacy}",
                "followers_url": "https://api.github.com/users/rgommers/followers",
                "following_url": "https://api.github.com/users/rgommers/following{/other_user}",
                "gists_url": "https://api.github.com/users/rgommers/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rgommers",
                "id": 98330,
                "login": "rgommers",
                "node_id": "MDQ6VXNlcjk4MzMw",
                "organizations_url": "https://api.github.com/users/rgommers/orgs",
                "received_events_url": "https://api.github.com/users/rgommers/received_events",
                "repos_url": "https://api.github.com/users/rgommers/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rgommers/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rgommers/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rgommers"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-06-23T12:16:25Z",
            "event": "mentioned",
            "id": 13255563223,
            "node_id": "MEE_lADOABDGAc6NH0s_zwAAAAMWF9fX",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13255563223"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/98330?v=4",
                "events_url": "https://api.github.com/users/rgommers/events{/privacy}",
                "followers_url": "https://api.github.com/users/rgommers/followers",
                "following_url": "https://api.github.com/users/rgommers/following{/other_user}",
                "gists_url": "https://api.github.com/users/rgommers/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rgommers",
                "id": 98330,
                "login": "rgommers",
                "node_id": "MDQ6VXNlcjk4MzMw",
                "organizations_url": "https://api.github.com/users/rgommers/orgs",
                "received_events_url": "https://api.github.com/users/rgommers/received_events",
                "repos_url": "https://api.github.com/users/rgommers/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rgommers/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rgommers/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rgommers"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-06-23T12:16:25Z",
            "event": "subscribed",
            "id": 13255563227,
            "node_id": "SE_lADOABDGAc6NH0s_zwAAAAMWF9fb",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13255563227"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/79037344?v=4",
                "events_url": "https://api.github.com/users/tfardet/events{/privacy}",
                "followers_url": "https://api.github.com/users/tfardet/followers",
                "following_url": "https://api.github.com/users/tfardet/following{/other_user}",
                "gists_url": "https://api.github.com/users/tfardet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tfardet",
                "id": 79037344,
                "login": "tfardet",
                "node_id": "MDQ6VXNlcjc5MDM3MzQ0",
                "organizations_url": "https://api.github.com/users/tfardet/orgs",
                "received_events_url": "https://api.github.com/users/tfardet/received_events",
                "repos_url": "https://api.github.com/users/tfardet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tfardet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tfardet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tfardet"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-06-23T13:48:00Z",
            "event": "closed",
            "id": 13255747373,
            "node_id": "CE_lADOABDGAc6NH0s_zwAAAAMWGqct",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13255747373"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6257/events",
    "html_url": "https://github.com/cython/cython/issues/6257",
    "id": 2367638335,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6257/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6NH0s_",
    "number": 6257,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6257/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6257/timeline",
    "title": "[BUG] Undeclared variables with numpy < 2 and cython >= 3.0.9 on Ubuntu Jammy (LTS)",
    "updated_at": "2024-06-23T13:48:00Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6257",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/79037344?v=4",
        "events_url": "https://api.github.com/users/tfardet/events{/privacy}",
        "followers_url": "https://api.github.com/users/tfardet/followers",
        "following_url": "https://api.github.com/users/tfardet/following{/other_user}",
        "gists_url": "https://api.github.com/users/tfardet/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tfardet",
        "id": 79037344,
        "login": "tfardet",
        "node_id": "MDQ6VXNlcjc5MDM3MzQ0",
        "organizations_url": "https://api.github.com/users/tfardet/orgs",
        "received_events_url": "https://api.github.com/users/tfardet/received_events",
        "repos_url": "https://api.github.com/users/tfardet/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tfardet/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tfardet/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tfardet"
    }
}