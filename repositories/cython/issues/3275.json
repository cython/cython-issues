{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Normally, you write a single Cython extension and compile it and everything works fine.\r\nHowever, combining multiple extensions into one library works well with a teleporter.\r\nHowever, each of these extension modules, to my knowledge, share many of the same code fragments and functions, which makes it really hard or impossible to include them all in one file.\r\nWhat I am suggesting, is to add an additional argument to Cython.Build.cythonize, called include_name.\r\nThis tells the Cython compiler that all functions that could be shared and used by multiple modules should be put in this include file.\r\nThen each module imcludes this file.\r\nThis would:\r\n1. Decrease the size, since there are no coppies of functions and the Python headers are only included once.\r\n2: Make it easier to call these modules\r\nI'm hoping for an end result that will allow me to include the generated C files of multiple Cython modules in from another module.\r\nHopefully this wouldn't require too much work.\r\nThanks!\r\n\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Sounds interesting, but could be more work than it seems. When you say \"include\", you mean C pre-processor `#include` statements and shared header files, right? Not a separate Python module with shared code?\r\n\r\nNote that it's already quite easy for users to write common shared modules and have other Cython modules cimport from them through `.pxd` file declarations. This has the additional advantage of actually removing the duplicated code from the modules, both in the user code and in the generated C code and extension modules.\r\n\r\nCould you clarify a bit what advantages you see in your proposal?",
            "created_at": "2019-12-23T11:45:06Z",
            "html_url": "https://github.com/cython/cython/issues/3275#issuecomment-568453268",
            "id": 568453268,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3275",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU2ODQ1MzI2OA==",
            "updated_at": "2019-12-23T11:45:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/568453268",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hi,\r\nI don't mean code that is defined in other Cython modules.\r\nWhen generating C code for a module, Cython seems to generate the same raw C functions for each module. I'm guessing these allow converting C ints to Python ints, for example.\r\nHowever, this makes it impossible to #include one Cython module in another from C, because these __pyx__* functions are now defined in 2 places.\r\nThe reason I want to do this is because I'm working on allowing multiple Cython modules to be stored and loaded from a single DLL.\r\nTo that end, I made this tool:\r\nhttps://github.com/keithcat1/multimodule\r\nWhich lets you do this. However, the way it does that, which is by statically linking the compiled object files, is inefficient for 2 reasons.\r\nFirst, there is unnecessary code that could be stored in one location but isn't. Each object file is a separately compiled Cython module, so each file has its own copy of the Python functions, and the helper Cython functions.\r\nSecond, all PyInit_* symbols must be exported from the resulting DLL. If I use CYTHON_NO_PYINIT_EXPORT, then I need custom code to handle calling the correct PyInit_* symbol. While I can do that, it doesn't work on C++ modules. I made an issue about that (3250), and this seemed to work with Mingw64, but not MSVC.\r\nPackaging multiple modules in one shared object is handy because it allows you to call into a statically linked C library from different modules, without shipping a DLL or compiling each extension with it's own version of the library.\r\nOf course, you could always just implement compiling multiple modules into one binary yourself.\r\nHope I made sense!",
            "created_at": "2020-01-24T20:48:36Z",
            "html_url": "https://github.com/cython/cython/issues/3275#issuecomment-578295701",
            "id": 578295701,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3275",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODI5NTcwMQ==",
            "updated_at": "2020-01-24T20:54:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/578295701",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/47483928?v=4",
                "events_url": "https://api.github.com/users/Keithcat1/events{/privacy}",
                "followers_url": "https://api.github.com/users/Keithcat1/followers",
                "following_url": "https://api.github.com/users/Keithcat1/following{/other_user}",
                "gists_url": "https://api.github.com/users/Keithcat1/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Keithcat1",
                "id": 47483928,
                "login": "Keithcat1",
                "node_id": "MDQ6VXNlcjQ3NDgzOTI4",
                "organizations_url": "https://api.github.com/users/Keithcat1/orgs",
                "received_events_url": "https://api.github.com/users/Keithcat1/received_events",
                "repos_url": "https://api.github.com/users/Keithcat1/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Keithcat1/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Keithcat1/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Keithcat1"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3275/comments",
    "created_at": "2019-12-19T18:54:35Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3275/events",
    "html_url": "https://github.com/cython/cython/issues/3275",
    "id": 540498323,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3275/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1NDA0OTgzMjM=",
    "number": 3275,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Allow generation of include file that contains all common functions used by a set of Cython modules.",
    "updated_at": "2020-01-24T20:54:30Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3275",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/47483928?v=4",
        "events_url": "https://api.github.com/users/Keithcat1/events{/privacy}",
        "followers_url": "https://api.github.com/users/Keithcat1/followers",
        "following_url": "https://api.github.com/users/Keithcat1/following{/other_user}",
        "gists_url": "https://api.github.com/users/Keithcat1/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Keithcat1",
        "id": 47483928,
        "login": "Keithcat1",
        "node_id": "MDQ6VXNlcjQ3NDgzOTI4",
        "organizations_url": "https://api.github.com/users/Keithcat1/orgs",
        "received_events_url": "https://api.github.com/users/Keithcat1/received_events",
        "repos_url": "https://api.github.com/users/Keithcat1/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Keithcat1/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Keithcat1/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Keithcat1"
    }
}