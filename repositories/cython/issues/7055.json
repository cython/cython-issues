{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nWe're having a hard time replicating this on local build machines (but efforts are underway).  What we're seeing is failures to build a wheel for https://github.com/yt-project/yt when Cython 3.1+ higher is used.  The error shows up as:\n\n```\n  Traceback (most recent call last):\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 389, in <module>\n      main()\n      ~~~~^^\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 373, in main\n      json_out[\"return_val\"] = hook(**hook_input[\"kwargs\"])\n                               ~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 175, in prepare_metadata_for_build_wheel\n      return hook(metadata_directory, config_settings)\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/setuptools/build_meta.py\", line 374, in prepare_metadata_for_build_wheel\n      self.run_setup()\n      ~~~~~~~~~~~~~~^^\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/setuptools/build_meta.py\", line 317, in run_setup\n      exec(code, locals())\n      ~~~~^^^^^^^^^^^^^^^^\n    File \"<string>\", line 14, in <module>\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/work/setupext.py\", line 18, in <module>\n      from setuptools.command.build_ext import build_ext as _build_ext\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/setuptools/command/build_ext.py\", line 31, in <module>\n      __import__('Cython.Compiler.Main')\n      ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/Cython/Compiler/Main.py\", line 30, in <module>\n      from .Symtab import ModuleScope\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/Cython/Compiler/Symtab.py\", line 20, in <module>\n      from . import PyrexTypes\n    File \"/Users/runner/miniforge3/conda-bld/yt_1752575285642/_build_env/venv/lib/python3.13/site-packages/Cython/Compiler/PyrexTypes.py\", line 19, in <module>\n      from .Code import UtilityCode, LazyUtilityCode, TempitaUtilityCode\n    File \"Cython/Compiler/Code.py\", line 3171, in init Cython.Compiler.Code\n    File \"Cython/Compiler/Code.py\", line 521, in Cython.Compiler.Code.UtilityCodeBase.load\n  KeyError: 'DefaultPlacementNew'\n  error: subprocess-exited-with-error\n```\n\nWe are able to reliably see this on azure build pipelines for osx_arm64_python3.13.  Other architectures work just fine.  Unfortunately, because it seems to show up during import of `Compiler/Code.py:3170`:\n\n```python\n    def put_cpp_placement_new(self, target,\n                              _utility_code=UtilityCode.load(\"DefaultPlacementNew\", \"CppSupport.cpp\")):\n```\n\nit's hard to track down if there is a specific file that causes it, if it happens whenever Cython is imported, etc.\n\nMore details can be found [at this](https://github.com/conda-forge/yt-feedstock/pull/95/checks?check_run_id=46000556228) location, but they may expire; I've put a copy of the build logs [in this gist](https://gist.github.com/matthewturk/b5b6055c711a3b6ef4cc6aede4a398b9).\n\nIt's taken a while for me to get around to reporting this, because it *seems* to me that this is an error that should be showing up absolutely everywhere if it's what it looks like (an error that shows up all the time on these architecture).  But it doesn't show up everywhere, and I can't find any other reports.  So I'm left with the assumption that we're doing something wrong, but try our best we can't figure out what that wrong-thing is.\n\n### Code to reproduce the behaviour:\n\nWe were not able to replicate this on an arm64 osx python build -- in fact, the only place we're seeing it is on azure pipelines.\n\n### Expected behaviour\n\n_No response_\n\n### OS\n\nmacOS\n\n### Python version\n\npython 3.13\n\n### Cython version\n\n3.12\n\n### Additional context\n\nI am really hesitant to report this, since we cannot seem to replicate it outside the Azure pipelines.  It does not replicate on a clean arm64 osx laptop that we have tested it on.  But, we have tried a number of things to get azure to build it, and they all look like errors with something related to the Cython access of `CppSupport.cpp`.\n\nAny ideas would be very welcome, and I hope that even if this turns out to be something unrelated to Cython that this report may serve as a reference if someone else stumbles across it.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "So I'm pretty puzzled what's going on on first look.\n\nIt looks like you're probably building with Cython 3.0.12 (that's the version reported as installed last in your logs just before the errors).  However you do also have Cython 3.1.2 reported as installed earlier.\n\n`DefaultPlacementNew` shouldn't be in Cython 3.0.12 - it first appeared in Cython 3.1.0. So I'd say you're probably somehow ended up with multiple versions of Cython installed and that they're somehow finding each others files. That's a bit of a guess though and I have no idea how it would be happening.",
            "created_at": "2025-08-01T19:45:07Z",
            "html_url": "https://github.com/cython/cython/issues/7055#issuecomment-3145597981",
            "id": 3145597981,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7055",
            "node_id": "IC_kwDOABDGAc67fgQd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3145597981/reactions"
            },
            "updated_at": "2025-08-01T19:45:07Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3145597981",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@da-woods You know, that is absolutely helpful.  (And it would explain why we can't replicate it.)  There must be something going on with the Azure Pipelines environment, related to those specific package+architecture combinations.  If you think of anything else I'm all ears, but for now I'm going to see if I can use that hint to dig deeper.  Thank you!",
            "created_at": "2025-08-01T19:49:19Z",
            "html_url": "https://github.com/cython/cython/issues/7055#issuecomment-3145610497",
            "id": 3145610497,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7055",
            "node_id": "IC_kwDOABDGAc67fjUB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3145610497/reactions"
            },
            "updated_at": "2025-08-01T19:49:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3145610497",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/89019?v=4",
                "events_url": "https://api.github.com/users/matthewturk/events{/privacy}",
                "followers_url": "https://api.github.com/users/matthewturk/followers",
                "following_url": "https://api.github.com/users/matthewturk/following{/other_user}",
                "gists_url": "https://api.github.com/users/matthewturk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/matthewturk",
                "id": 89019,
                "login": "matthewturk",
                "node_id": "MDQ6VXNlcjg5MDE5",
                "organizations_url": "https://api.github.com/users/matthewturk/orgs",
                "received_events_url": "https://api.github.com/users/matthewturk/received_events",
                "repos_url": "https://api.github.com/users/matthewturk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/matthewturk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/matthewturk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/matthewturk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think it might be wrong though... I think the list I'm looking at might be the \"host\" list, so probably not relevant to what's in the venv.",
            "created_at": "2025-08-01T19:50:35Z",
            "html_url": "https://github.com/cython/cython/issues/7055#issuecomment-3145613480",
            "id": 3145613480,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7055",
            "node_id": "IC_kwDOABDGAc67fkCo",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3145613480/reactions"
            },
            "updated_at": "2025-08-01T19:50:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3145613480",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The other thing I was going to suggest (probably a better line of investigation): can you arrange for it to be installed from the pure-Python non-compiled wheel? (e.g. https://files.pythonhosted.org/packages/25/d6/ef8557d5e75cc57d55df579af4976935ee111a85bbee4a5b72354e257066/cython-3.1.2-py3-none-any.whl on PyPI)?  That would remove the possibility that Cython is mis-compiling itself.\n\nI don't know quite how you'd do that on Azure though.",
            "created_at": "2025-08-01T19:53:47Z",
            "html_url": "https://github.com/cython/cython/issues/7055#issuecomment-3145619357",
            "id": 3145619357,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7055",
            "node_id": "IC_kwDOABDGAc67fled",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3145619357/reactions"
            },
            "updated_at": "2025-08-01T19:53:47Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3145619357",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "FWIW I agree with your assessment - it looks like the sort of bug that should be affecting Cython on any arm64 platform. We do test it ourselves on at least one Linux+arm64 build, and obviously OSX and arm64 is pretty common now.\n\nMy immediate thoughts are\n* Try getting Cython from a different source (i.e. the non-compiled wheels as I suggested earlier, or pip instead of Anaconda, something like that).\n* It might be a concurrency thing so try setting `nthreads` to 1. I can't really see how though.",
            "created_at": "2025-08-01T21:23:36Z",
            "html_url": "https://github.com/cython/cython/issues/7055#issuecomment-3145807284",
            "id": 3145807284,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7055",
            "node_id": "IC_kwDOABDGAc67gTW0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3145807284/reactions"
            },
            "updated_at": "2025-08-01T21:23:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3145807284",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/7055/comments",
    "created_at": "2025-08-01T19:13:01Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-08-01T19:49:20Z",
            "event": "mentioned",
            "id": 18946029379,
            "node_id": "MEE_lADOABDGAc7Dy3K9zwAAAARpRXdD",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/18946029379"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-08-01T19:49:20Z",
            "event": "subscribed",
            "id": 18946029589,
            "node_id": "SE_lADOABDGAc7Dy3K9zwAAAARpRXgV",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/18946029589"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/14075922?v=4",
                "events_url": "https://api.github.com/users/neutrinoceros/events{/privacy}",
                "followers_url": "https://api.github.com/users/neutrinoceros/followers",
                "following_url": "https://api.github.com/users/neutrinoceros/following{/other_user}",
                "gists_url": "https://api.github.com/users/neutrinoceros/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neutrinoceros",
                "id": 14075922,
                "login": "neutrinoceros",
                "node_id": "MDQ6VXNlcjE0MDc1OTIy",
                "organizations_url": "https://api.github.com/users/neutrinoceros/orgs",
                "received_events_url": "https://api.github.com/users/neutrinoceros/received_events",
                "repos_url": "https://api.github.com/users/neutrinoceros/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neutrinoceros/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neutrinoceros/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/neutrinoceros",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-08-01T20:22:32Z",
            "event": "subscribed",
            "id": 18946425936,
            "node_id": "SE_lADOABDGAc7Dy3K9zwAAAARpS4RQ",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/18946425936"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/7055/events",
    "html_url": "https://github.com/cython/cython/issues/7055",
    "id": 3284890301,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/7055/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc7Dy3K9",
    "number": 7055,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/7055/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/7055/timeline",
    "title": "[BUG] DefaultPlacementNew issues on some architectures",
    "type": null,
    "updated_at": "2025-08-01T21:23:36Z",
    "url": "https://api.github.com/repos/cython/cython/issues/7055",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/89019?v=4",
        "events_url": "https://api.github.com/users/matthewturk/events{/privacy}",
        "followers_url": "https://api.github.com/users/matthewturk/followers",
        "following_url": "https://api.github.com/users/matthewturk/following{/other_user}",
        "gists_url": "https://api.github.com/users/matthewturk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/matthewturk",
        "id": 89019,
        "login": "matthewturk",
        "node_id": "MDQ6VXNlcjg5MDE5",
        "organizations_url": "https://api.github.com/users/matthewturk/orgs",
        "received_events_url": "https://api.github.com/users/matthewturk/received_events",
        "repos_url": "https://api.github.com/users/matthewturk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/matthewturk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/matthewturk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/matthewturk",
        "user_view_type": "public"
    }
}