{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\nThe following code:\r\n```cython\r\nctypedef fused char_types:\r\n    int\r\n    char\r\n\r\ncdef const char_types[:] example(object test):\r\n    pass\r\n```\r\ncauses a compiler crash (see below)\r\n\r\n**Expected behavior**\r\nA error message about the syntax error instead of a compiler crash is expected\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Linux\r\n - Python version: 3.9.1\r\n - Cython version: 0.29.21\r\n\r\n**Additional context**\r\nerror message:\r\n```\r\n   ERROR: Command errored out with exit status 1:\r\n     command: /usr/bin/python3 -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/tmp/pip-req-build-rov9565e/setup.py'\"'\"'; __file__='\"'\"'/tmp/pip-req-build-rov9565e/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' egg_info --egg-base /tmp/pip-pip-egg-info-ef1mkj79\r\n         cwd: /tmp/pip-req-build-rov9565e/\r\n    Complete output (52 lines):\r\n    /home/max/.local/lib/python3.9/site-packages/Cython/Compiler/Main.py:369: FutureWarning: Cython directive 'language_level' not set, using 2 for now (Py2). This will change in a later release! File: /tmp/pip-req-build-rov9565e/src/test.pyx\r\n      tree = Parsing.p_module(s, pxd, full_module_name)\r\n    \r\n    Error compiling Cython file:\r\n    ------------------------------------------------------------\r\n    ...\r\n    ctypedef fused char_types:\r\n        int\r\n        char\r\n    \r\n    cdef const char_types[:] example(object test):\r\n                         ^\r\n    ------------------------------------------------------------\r\n    \r\n    src/test.pyx:5:22: Compiler crash in AnalyseDeclarationsTransform\r\n    \r\n    File 'ModuleNode.py', line 124, in analyse_declarations: ModuleNode(test.pyx:1:0,\r\n        full_module_name = 'rapidfuzz.test')\r\n    File 'Nodes.py', line 431, in analyse_declarations: StatListNode(test.pyx:1:0)\r\n    File 'Nodes.py', line 2350, in analyse_declarations: CFuncDefNode(test.pyx:5:5,\r\n        modifiers = [...]/0,\r\n        visibility = 'private')\r\n    File 'Nodes.py', line 1091, in analyse: MemoryViewSliceTypeNode(test.pyx:5:22,\r\n        name = 'memoryview')\r\n    \r\n    Compiler crash traceback from this point on:\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/Nodes.py\", line 1091, in analyse\r\n        self.type = PyrexTypes.MemoryViewSliceType(base_type, axes_specs)\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 625, in __init__\r\n        self.dtype_name = Buffer.mangle_dtype_name(self.dtype)\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/Buffer.py\", line 631, in mangle_dtype_name\r\n        return prefix + dtype.specialization_name()\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 57, in specialization_name\r\n        common_subs = (self.empty_declaration_code()\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 51, in empty_declaration_code\r\n        self._empty_declaration = self.declaration_code('')\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 1582, in declaration_code\r\n        return self.const_base_type.declaration_code(\"const %s\" % entity_code, for_display, dll_linkage, pyrex)\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 1649, in declaration_code\r\n        raise Exception(\"This may never happen, please report a bug\")\r\n    Exception: This may never happen, please report a bug\r\n    Traceback (most recent call last):\r\n      File \"<string>\", line 1, in <module>\r\n      File \"/tmp/pip-req-build-rov9565e/setup.py\", line 55, in <module>\r\n        ext_modules = cythonize([\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Build/Dependencies.py\", line 1102, in cythonize\r\n        cythonize_one(*args)\r\n      File \"/home/max/.local/lib/python3.9/site-packages/Cython/Build/Dependencies.py\", line 1225, in cythonize_one\r\n        raise CompileError(None, pyx_file)\r\n    Cython.Compiler.Errors.CompileError: src/test.pyx\r\n    Compiling src/test.pyx because it changed.\r\n    [1/1] Cythonizing src/test.pyx\r\n    ----------------------------------------\r\nERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.\r\n```\r\n",
    "closed_at": "2021-02-20T11:46:20Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "This might be https://github.com/cython/cython/pull/3853 which is not in my release yet",
            "created_at": "2021-02-18T21:29:58Z",
            "html_url": "https://github.com/cython/cython/issues/4012#issuecomment-781647465",
            "id": 781647465,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4012",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc4MTY0NzQ2NQ==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-18T21:29:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/781647465",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/44199644?v=4",
                "events_url": "https://api.github.com/users/maxbachmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/maxbachmann/followers",
                "following_url": "https://api.github.com/users/maxbachmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/maxbachmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/maxbachmann",
                "id": 44199644,
                "login": "maxbachmann",
                "node_id": "MDQ6VXNlcjQ0MTk5NjQ0",
                "organizations_url": "https://api.github.com/users/maxbachmann/orgs",
                "received_events_url": "https://api.github.com/users/maxbachmann/received_events",
                "repos_url": "https://api.github.com/users/maxbachmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/maxbachmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/maxbachmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/maxbachmann"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "> This might be #3853 which is not in my release yet\r\n\r\nThis does look to be fixed in the most recent master (which correctly reports `Return type is not specified as argument type`) so I think you're right. I'll close this.",
            "created_at": "2021-02-20T11:46:20Z",
            "html_url": "https://github.com/cython/cython/issues/4012#issuecomment-782612703",
            "id": 782612703,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4012",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjYxMjcwMw==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-20T11:46:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/782612703",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4012/comments",
    "created_at": "2021-02-18T21:23:55Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-02-20T11:46:20Z",
            "event": "closed",
            "id": 4355217579,
            "node_id": "MDExOkNsb3NlZEV2ZW50NDM1NTIxNzU3OQ==",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4355217579"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4012/events",
    "html_url": "https://github.com/cython/cython/issues/4012",
    "id": 811471317,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4012/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4MTE0NzEzMTc=",
    "number": 4012,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "[BUG] Compiler crash in AnalyseDeclarationsTransform",
    "updated_at": "2021-02-20T11:46:20Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4012",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/44199644?v=4",
        "events_url": "https://api.github.com/users/maxbachmann/events{/privacy}",
        "followers_url": "https://api.github.com/users/maxbachmann/followers",
        "following_url": "https://api.github.com/users/maxbachmann/following{/other_user}",
        "gists_url": "https://api.github.com/users/maxbachmann/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/maxbachmann",
        "id": 44199644,
        "login": "maxbachmann",
        "node_id": "MDQ6VXNlcjQ0MTk5NjQ0",
        "organizations_url": "https://api.github.com/users/maxbachmann/orgs",
        "received_events_url": "https://api.github.com/users/maxbachmann/received_events",
        "repos_url": "https://api.github.com/users/maxbachmann/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/maxbachmann/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/maxbachmann/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/maxbachmann"
    }
}