{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "<!--\r\n**Note:**\r\n- Do not use the bug and feature tracker for support requests. Use the `cython-users` mailing list instead.\r\n- Did you search for similar issues already? Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release? It might already have what you want to report. Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\nPEP 634 defines a new \"switch-statement-like syntax\": https://www.python.org/dev/peps/pep-0634/ that will appear in Python 3.10. Being a Python language feature, Cython should aim to support this.\r\n\r\n**Additional context**\r\n\r\n* Probably not worth supporting until after the release of Python 3.10 (in principle it could change before then).\r\n* Probably a fairly complicated feature to implement (involves both parser and code generation changes)\r\n* If https://github.com/cython/cython/pull/3400 is merged by then, it'll need to generate `__match_args__` (this can be implemented separately from the language support though)\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Python 3.10 was released on 2021-10-04 so this is now required for upstream Python compatibility. \r\nFor SEO the current error on `cython -3 main.py` messages show\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n\r\n\r\ndef my_func(t: int) -> str:\r\n    match t:\r\n         ^\r\n------------------------------------------------------------\r\n\r\nmain.py:41:10: Syntax error in simple statement list\r\n```",
            "created_at": "2021-12-29T02:05:21Z",
            "html_url": "https://github.com/cython/cython/issues/4029#issuecomment-1002360571",
            "id": 1002360571,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4029",
            "node_id": "IC_kwDOABDGAc47vs77",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1002360571/reactions"
            },
            "updated_at": "2021-12-29T02:05:21Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1002360571",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33450373?v=4",
                "events_url": "https://api.github.com/users/Jaakkonen/events{/privacy}",
                "followers_url": "https://api.github.com/users/Jaakkonen/followers",
                "following_url": "https://api.github.com/users/Jaakkonen/following{/other_user}",
                "gists_url": "https://api.github.com/users/Jaakkonen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Jaakkonen",
                "id": 33450373,
                "login": "Jaakkonen",
                "node_id": "MDQ6VXNlcjMzNDUwMzcz",
                "organizations_url": "https://api.github.com/users/Jaakkonen/orgs",
                "received_events_url": "https://api.github.com/users/Jaakkonen/received_events",
                "repos_url": "https://api.github.com/users/Jaakkonen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Jaakkonen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Jaakkonen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Jaakkonen"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "PRs welcome, as usual.\r\n\r\nI would expect that at least larger parts of the C implementation in CPython can be adopted â€“ if that's what we want to use, as opposed to a (probably simpler) Cython implementation. The parser implementation is independent, though, and I would guess that there will be Cython specific issues along the way, possibly even cases where Cython's own syntax (such as C types) interferes with pattern syntax. But we'll see about that when we run into it.\r\n\r\nIn any case, this is a fairly large feature that will take time to implement, probably in several steps. So, again, PRs welcome.",
            "created_at": "2021-12-29T09:29:08Z",
            "html_url": "https://github.com/cython/cython/issues/4029#issuecomment-1002481127",
            "id": 1002481127,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4029",
            "node_id": "IC_kwDOABDGAc47wKXn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1002481127/reactions"
            },
            "updated_at": "2021-12-29T09:30:00Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1002481127",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> at least larger parts of the C implementation in CPython can be adopted\r\n\r\nI don't know that there's much C implementation to take. If you look at the byte-code for a function that uses pattern matching, it's mostly broken down into a set of comparisons. E.g. `case (a, b)` gets split into:\r\n\r\n```\r\n              8 GET_LEN\r\n             10 LOAD_CONST               1 (2)\r\n             12 COMPARE_OP               2 (==)\r\n             14 POP_JUMP_IF_FALSE       18 (to 36)\r\n             16 UNPACK_SEQUENCE          2\r\n             18 STORE_FAST               1 (a)\r\n             20 STORE_FAST               2 (b)\r\n```\r\n\r\nSo I think it's mostly a parsing then AST manipulation issue.\r\n\r\nIt can probably be split into a parsing PR, and then successive PRs to make individual types of patterns work successfully. (I wasn't planning to do any of this myself any time soon though).",
            "created_at": "2021-12-29T09:58:19Z",
            "html_url": "https://github.com/cython/cython/issues/4029#issuecomment-1002512399",
            "id": 1002512399,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4029",
            "node_id": "IC_kwDOABDGAc47wSAP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1002512399/reactions"
            },
            "updated_at": "2021-12-29T09:58:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1002512399",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ok, I was kinda expecting that this might be the case. Thanks for checking.\r\n\r\nThen I guess it's really just about generating Cython code (or syntax nodes directly) to implement the comparisons. That merits its own transform class, best also in its own module.",
            "created_at": "2021-12-30T15:01:00Z",
            "html_url": "https://github.com/cython/cython/issues/4029#issuecomment-1003065856",
            "id": 1003065856,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4029",
            "node_id": "IC_kwDOABDGAc47yZIA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1003065856/reactions"
            },
            "updated_at": "2021-12-30T15:01:00Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1003065856",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "FWIW I can currently parse the entire CPython test_patma file (https://github.com/python/cpython/blob/main/Lib/test/test_patma.py). It then fails at AnalyseExpressions (because I haven't tried to implement that yet).\r\n\r\nChanges are on https://github.com/da-woods/cython/tree/parse-match. I'll submit that as a PR at some point fairly soon (but it's dependent on https://github.com/cython/cython/pull/4813, so I'll wait until that's finalized) \r\n\r\n* Basic constant cases converted to `if ... elif ...` statement: https://github.com/da-woods/cython/tree/basic_match\r\n* Handle simple \"guards\" https://github.com/da-woods/cython/tree/guards\r\n* A few extra types of patterns that assign targets https://github.com/da-woods/cython/tree/match-targets\r\n* Handle sequence patterns https://github.com/da-woods/cython/tree/match-sequence\r\n* Handle mapping patterns https://github.com/da-woods/cython/tree/match-mapping\r\n* Handle class patterns https://github.com/da-woods/cython/tree/match-class\r\n* A quick benchmark https://github.com/da-woods/cython/tree/match-benchmark\r\n* Or patterns https://github.com/da-woods/cython/tree/match-or",
            "created_at": "2022-05-30T21:42:07Z",
            "html_url": "https://github.com/cython/cython/issues/4029#issuecomment-1141492760",
            "id": 1141492760,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4029",
            "node_id": "IC_kwDOABDGAc5ECcwY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1141492760/reactions"
            },
            "updated_at": "2022-06-15T21:15:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1141492760",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I have an implementation that passes the CPython test_patma.py tests (which I think is the extent of the testing in CPython). I'll submit it in chunks (with the parser changes already submitted being the first chunk) in the hope of making it a little more tractable to review.\r\n\r\nIf anyone wants to test/use it in advance then the \"Or pattern\" branch is the final one and covers basically everything.",
            "created_at": "2022-06-15T21:20:32Z",
            "html_url": "https://github.com/cython/cython/issues/4029#issuecomment-1156957999",
            "id": 1156957999,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4029",
            "node_id": "IC_kwDOABDGAc5E9ccv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1156957999/reactions"
            },
            "updated_at": "2022-06-15T21:20:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1156957999",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4029/comments",
    "created_at": "2021-03-08T20:42:43Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-03-08T20:43:19Z",
            "event": "labeled",
            "id": 4423487562,
            "label": {
                "color": "444444",
                "name": "Python Semantics"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDQ0MjM0ODc1NjI=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4423487562"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5534781?v=4",
                "events_url": "https://api.github.com/users/leofang/events{/privacy}",
                "followers_url": "https://api.github.com/users/leofang/followers",
                "following_url": "https://api.github.com/users/leofang/following{/other_user}",
                "gists_url": "https://api.github.com/users/leofang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/leofang",
                "id": 5534781,
                "login": "leofang",
                "node_id": "MDQ6VXNlcjU1MzQ3ODE=",
                "organizations_url": "https://api.github.com/users/leofang/orgs",
                "received_events_url": "https://api.github.com/users/leofang/received_events",
                "repos_url": "https://api.github.com/users/leofang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/leofang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/leofang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/leofang"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-03-13T02:48:01Z",
            "event": "subscribed",
            "id": 4453360600,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ0NTMzNjA2MDA=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4453360600"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-03-30T16:30:15Z",
            "event": "labeled",
            "id": 4528935928,
            "label": {
                "color": "c2e0c6",
                "name": "feature"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDQ1Mjg5MzU5Mjg=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4528935928"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4029/events",
    "html_url": "https://github.com/cython/cython/issues/4029",
    "id": 824935200,
    "labels": [
        {
            "color": "c2e0c6",
            "default": false,
            "description": null,
            "id": 414805463,
            "name": "feature",
            "node_id": "MDU6TGFiZWw0MTQ4MDU0NjM=",
            "url": "https://api.github.com/repos/cython/cython/labels/feature"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556315,
            "name": "Python Semantics",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMTU=",
            "url": "https://api.github.com/repos/cython/cython/labels/Python%20Semantics"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4029/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4MjQ5MzUyMDA=",
    "number": 4029,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/4029/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4029/timeline",
    "title": "[ENH] PEP 634 - Structural Pattern Matching",
    "updated_at": "2022-06-15T21:20:32Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4029",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
        "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
        "followers_url": "https://api.github.com/users/da-woods/followers",
        "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
        "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/da-woods",
        "id": 10536947,
        "login": "da-woods",
        "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
        "organizations_url": "https://api.github.com/users/da-woods/orgs",
        "received_events_url": "https://api.github.com/users/da-woods/received_events",
        "repos_url": "https://api.github.com/users/da-woods/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/da-woods"
    }
}