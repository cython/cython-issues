{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nOn s390x when cythonizing a simple `.pyx` with a function Cython segfaults when trying to import the module. I have also seen instances where it fails with the following but I cannot seem to create a simple reproducer for this right now\r\n\r\n> AttributeError: module '_cython_3_0_6' has no attribute 'cython_function_or_method'\r\n\r\nTo replicate this you can use docker/podman to run on s390x emulation using binfmt with the following:\r\n\r\n```bash\r\n# podman run --rm -it --arch=s390x ubuntu:22.04\r\n\r\napt-get update\r\napt-get install python3 python3-pip\r\n\r\npython3 -m pip install cython\r\nmkdir cython_test\r\ncd cython_test\r\n\r\ncat > cython_test.pyx << EOF\r\ndef func():\r\n    print(\"test\")\r\nEOF\r\n\r\nCFLAGS=\"-flto=auto -ffat-lto-objects -fno-PIE\" cythonize -b cython_test.pyx\r\npython3 -c \"import cython_test\"\r\n```\r\n\r\nThe `CFLAGS` used here are the default flags that Ubuntu runs with (technically `-specs=/usr/share/dpkg/no-pie-compile.specs` instead of `-fno-PIE` but I was trying to simplify things) when they build their packages at least on s390x. This caused the segfault failure on https://github.com/pythongssapi/python-gssapi/issues/333 when they built that package.\r\n\r\nUnfortunately I don't know much about these flags, why Ubuntu sets them and how to actually troubleshoot this issue but thought it best to share the issue in case it's something that can be fixed in the autogenerated C code.\n\n### Code to reproduce the behaviour:\n\n```cython\r\ndef func():\r\n    print(\"test\")\r\n```\r\n\n\n### Expected behaviour\n\nModule imports and works.\n\n### OS\n\nLinux - tested on Ubuntu 22.04\n\n### Python version\n\n3.9.2\n\n### Cython version\n\n3.0.6\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5893/comments",
    "created_at": "2023-12-04T20:44:25Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5893/events",
    "html_url": "https://github.com/cython/cython/issues/5893",
    "id": 2024699692,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5893/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc54rncs",
    "number": 5893,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5893/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5893/timeline",
    "title": "[BUG] Top level functions on s390x segfault fails when compiled with lto and no-pie",
    "updated_at": "2023-12-04T20:44:25Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5893",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
        "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
        "followers_url": "https://api.github.com/users/jborean93/followers",
        "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
        "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jborean93",
        "id": 8462645,
        "login": "jborean93",
        "node_id": "MDQ6VXNlcjg0NjI2NDU=",
        "organizations_url": "https://api.github.com/users/jborean93/orgs",
        "received_events_url": "https://api.github.com/users/jborean93/received_events",
        "repos_url": "https://api.github.com/users/jborean93/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jborean93"
    }
}