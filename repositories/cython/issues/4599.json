{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Problem:\r\nAssigning a variable or passing a variable from a pointer of an imcompatible type\r\n\r\nSystem:\r\nopenSUSE Leap 15.2 64 bit linux\r\nLinux localhost.localdomain 5.3.18-lp152.106-default #1 SMP Mon Nov 22 08:38:17 UTC 2021 (52078fe) x86_64 x86_64 x86_64 GNU/Linux\r\nPython 2.17.8\r\nCython version 3.0.0a10\r\n\r\nWarning Message:\r\n```\r\n63263:[sagelib-9.4] build/cythonized/sage/calculus/ode.c:6333:26: warning: assignment from incompatible pointer type [-Wincompatible-pointer-types]\r\n```\r\n\r\nSource code:\r\n```cython\r\n        cdef gsl_odeiv_system sys\r\n        if type:               # The user has passed a class with a compiled function, use that for the system\r\n            sys.function = c_f_compiled\r\n            sys.jacobian = c_jac_compiled\r\n#         (<ode_system>self.function).the_parameters = self.params\r\n            sys.params = <void *> self.function\r\n        else:                  # The user passed a python function.\r\n            sys.function = c_f\r\n            sys.jacobian = c_jac\r\n            sys.params = <void *> wrapper\r\n```\r\nObject code:\r\n```c\r\n    /* \"sage/calculus/ode.pyx\":519\r\n *         cdef gsl_odeiv_system sys\r\n *         if type:               # The user has passed a class with a compiled function, use that for the system\r\n *             sys.function = c_f_compiled             # <<<<<<<<<<<<<<\r\n *             sys.jacobian = c_jac_compiled\r\n * #         (<ode_system>self.function).the_parameters = self.params\r\n */\r\n    __pyx_v_sys.function = (void *) __pyx_f_4sage_8calculus_3ode_c_f_compiled;\r\n```\r\n\r\nProblem:\r\n\r\nThe problem is that the pointer for `c_f_compiled` is obviated and has been coerced to a void pointer type (`void*`) and a void pointer assigned to `__pyx_v_sys.function`\r\n\r\nThe class definition has\r\n```cython\r\n  ctypedef struct gsl_odeiv_system:\r\n    int (* function) (double t,  double y[], double dydt[], void * params)\r\n    int (* jacobian) (double t,  double y[], double * dfdy, double dfdt[], void * params)\r\n    size_t dimension\r\n    void * params\r\n```\r\n\r\nSo it appears that the use of (`void*`) is invalid and it should have read (`function*`) instead, matching the class definition.\r\n------------------------------------------------------------------------------------------------------------------------------\r\n\r\nWarning Message:\r\n```\r\n63456:[sagelib-9.4] build/cythonized/sage/combinat/designs/subhypergraph_search.c:2644:64: warning: passing argument 4 of ‘qsort’ from incompatible pointer type [-Wincompatible-pointer-types]\r\n```\r\n\r\nSource Code:\r\n\r\n```c\r\n    trace_hypergraph64(&h1,n,&tmp1)\r\n    qsort(tmp1.sets,h1.m,sizeof(uint64_t *),cmp_128_bits)\r\n```\r\n\r\nObject Code:\r\n\r\n```c\r\n /* \"sage/combinat/designs/subhypergraph_search.pyx\":281\r\n *     \"\"\"\r\n *     trace_hypergraph64(&h1,n,&tmp1)\r\n *     qsort(tmp1.sets,h1.m,sizeof(uint64_t *),cmp_128_bits)             # <<<<<<<<<<<<<<\r\n * \r\n *     cdef int i1,i2\r\n */\r\n  qsort(__pyx_v_tmp1.sets, __pyx_v_h1.m, (sizeof(uint64_t *)), (void *) __pyx_f_4sage_8combinat_7designs_20subhypergraph_search_cmp_128_bits);\r\n```\r\n\r\nProblem:\r\n        argument #4, which is cmp_128_bits is the wrong pointer type to the qsort routine. Looking in the C-std, we find that qsort wants an integer compare function signature.\r\n  function in arg #4, NOT a (`void*`) pointer. This is definitely wrong! It is expected to be an integer compare function.\r\n",
    "closed_at": "2022-01-27T22:08:20Z",
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "So in the ODE one:\r\n\r\n```\r\ncdef int c_f_compiled(double t, double *y, double *dydt, void *params):\r\n```\r\n\r\nis assigned to a function pointer of type\r\n\r\n```\r\nint (* function) (double t, const double y[], double dydt[], void * params) \r\n```\r\n\r\nSo essentially one of the argument types is losing a constant. This looks like something that could be fixed in Sage but not Cython (although it may be there for good reason - previous versions of Cython didn't handle constants too well).\r\n\r\nThe `qsort` example is similarly missing a const on the pointer types.\r\n\r\n-----------------------------------------------------------------\r\n\r\nI'm really not sure why Cython is generating the `(void*)` casts - it doesn't seem to be on any toy examples I can construct which leads me to think you may not actually be compiling with Cython 3.10",
            "created_at": "2022-01-27T21:32:38Z",
            "html_url": "https://github.com/cython/cython/issues/4599#issuecomment-1023658230",
            "id": 1023658230,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4599",
            "node_id": "IC_kwDOABDGAc49A8j2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1023658230/reactions"
            },
            "updated_at": "2022-01-27T21:32:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1023658230",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Cython 3.10\r\n\r\nWe're not there yet. ;-)",
            "created_at": "2022-01-27T21:36:13Z",
            "html_url": "https://github.com/cython/cython/issues/4599#issuecomment-1023660856",
            "id": 1023660856,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4599",
            "node_id": "IC_kwDOABDGAc49A9M4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1023660856/reactions"
            },
            "updated_at": "2022-01-27T21:36:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1023660856",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "But yeah, I would also suggest making sure that you are using the latest Cython 3 release, and then start cleaning up and modernising the code in Sage. I also suggest enabling `-Werror` in both Cython and the C compiler to make sure you are not missing warnings that should be errors. Then you can still disable certain warnings selectively, but with an allow list instead of having them pass silently be default.",
            "created_at": "2022-01-27T21:40:20Z",
            "html_url": "https://github.com/cython/cython/issues/4599#issuecomment-1023663396",
            "id": 1023663396,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4599",
            "node_id": "IC_kwDOABDGAc49A90k",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1023663396/reactions"
            },
            "updated_at": "2022-01-27T21:40:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1023663396",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Closing this, as I don't see anything obvious that we should change in Cython.",
            "created_at": "2022-01-27T22:08:20Z",
            "html_url": "https://github.com/cython/cython/issues/4599#issuecomment-1023682299",
            "id": 1023682299,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4599",
            "node_id": "IC_kwDOABDGAc49BCb7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1023682299/reactions"
            },
            "updated_at": "2022-01-27T22:08:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1023682299",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4599/comments",
    "created_at": "2022-01-27T20:43:04Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-01-27T21:32:01Z",
            "event": "labeled",
            "id": 5966849954,
            "label": {
                "color": "fef2c0",
                "name": "support question"
            },
            "node_id": "LE_lADOABDGAc5Cj8bmzwAAAAFjpuei",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5966849954"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-01-27T22:08:20Z",
            "event": "closed",
            "id": 5967017847,
            "node_id": "CE_lADOABDGAc5Cj8bmzwAAAAFjqXd3",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5967017847"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4599/events",
    "html_url": "https://github.com/cython/cython/issues/4599",
    "id": 1116718822,
    "labels": [
        {
            "color": "fef2c0",
            "default": false,
            "description": null,
            "id": 414800623,
            "name": "support question",
            "node_id": "MDU6TGFiZWw0MTQ4MDA2MjM=",
            "url": "https://api.github.com/repos/cython/cython/labels/support%20question"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4599/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5Cj8bm",
    "number": 4599,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4599/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4599/timeline",
    "title": "[BUG] Assigning an incorrect variable type from a pointer of a different type",
    "updated_at": "2022-01-27T22:08:20Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4599",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/73915626?v=4",
        "events_url": "https://api.github.com/users/website-reader/events{/privacy}",
        "followers_url": "https://api.github.com/users/website-reader/followers",
        "following_url": "https://api.github.com/users/website-reader/following{/other_user}",
        "gists_url": "https://api.github.com/users/website-reader/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/website-reader",
        "id": 73915626,
        "login": "website-reader",
        "node_id": "MDQ6VXNlcjczOTE1NjI2",
        "organizations_url": "https://api.github.com/users/website-reader/orgs",
        "received_events_url": "https://api.github.com/users/website-reader/received_events",
        "repos_url": "https://api.github.com/users/website-reader/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/website-reader/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/website-reader/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/website-reader"
    }
}