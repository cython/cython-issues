{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\n\r\nI encountered a bug when following [cython tutorial - Primes with C++](https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html#primes-with-c)\r\n\r\nI used the [code](https://github.com/cython/cython/blob/master/docs/examples/tutorial/cython_tutorial/primes_cpp.py) which is presented in the tutorial, and named it to `primes_vec.py`. I used the `setup.py` (shown below) to compile it, but it failed with error.\r\n\r\n```python\r\nfrom setuptools import setup\r\nfrom Cython.Build import cythonize\r\n\r\nsetup(\r\n    ext_modules = cythonize(\r\n        [\r\n            'primes_vec.py',\r\n        ],\r\n        annotate=True,\r\n    ),\r\n)\r\n```\r\n\r\n```shell\r\npython setup.py build_ext --inplace\r\nCompiling primes_vec.py because it changed.\r\n[1/1] Cythonizing primes_vec.py\r\n/home/user/anaconda3/envs/cython/lib/python3.10/site-packages/Cython/Compiler/Main.py:369: FutureWarning: Cython directive 'language_level' not set, using 2 for now (Py2). This will change in a later release! File: /path/CythonPractice/prime/primes_vec.py\r\n  tree = Parsing.p_module(s, pxd, full_module_name)\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nfrom cython.cimports.libcpp.vector import vector\r\n\r\ndef primes(nb_primes: cython.uint):\r\n    i: cython.int\r\n    p: vector[cython.int]\r\n    p.reserve(nb_primes)  # allocate memory for 'nb_primes' elements.\r\n   ^\r\n------------------------------------------------------------\r\n\r\nprimes_vec.py:9:4: local variable 'p' referenced before assignment\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    i: cython.int\r\n    p: vector[cython.int]\r\n    p.reserve(nb_primes)  # allocate memory for 'nb_primes' elements.\r\n\r\n    n: cython.int = 2\r\n    while p.size() < nb_primes:  # size() for vectors is similar to len()\r\n         ^\r\n------------------------------------------------------------\r\n\r\nprimes_vec.py:12:10: local variable 'p' referenced before assignment\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    p: vector[cython.int]\r\n    p.reserve(nb_primes)  # allocate memory for 'nb_primes' elements.\r\n\r\n    n: cython.int = 2\r\n    while p.size() < nb_primes:  # size() for vectors is similar to len()\r\n        for i in p:\r\n                ^\r\n------------------------------------------------------------\r\n\r\nprimes_vec.py:13:17: local variable 'p' referenced before assignment\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    while p.size() < nb_primes:  # size() for vectors is similar to len()\r\n        for i in p:\r\n            if n % i == 0:\r\n                break\r\n        else:\r\n            p.push_back(n)  # push_back is similar to append()\r\n           ^\r\n------------------------------------------------------------\r\n\r\nprimes_vec.py:17:12: local variable 'p' referenced before assignment\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n            p.push_back(n)  # push_back is similar to append()\r\n        n += 1\r\n\r\n    # If possible, C values and C++ objects are automatically\r\n    # converted to Python objects at need.\r\n    return p  # so here, the vector will be copied into a Python list.          ^\r\n------------------------------------------------------------\r\n\r\nprimes_vec.py:22:11: local variable 'p' referenced before assignment\r\nTraceback (most recent call last):\r\n  File \"/path/CythonPractice/prime/setup.py\", line 5, in <module>\r\n    ext_modules = cythonize(\r\n  File \"/home/user/anaconda3/envs/cython/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1103, in cythonize\r\n    cythonize_one(*args)\r\n  File \"/home/user/anaconda3/envs/cython/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1226, in cythonize_one\r\n    raise CompileError(None, pyx_file)\r\nCython.Compiler.Errors.CompileError: primes_vec.py\r\n```\r\n\r\n**Environment (please complete the following information):**\r\n - OS: macOS\r\n - Python version: 3.10.0\r\n - Cython version 0.29.26\r\n",
    "closed_at": "2022-02-04T12:56:21Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "You probably have to use Cython 3.0 for this to work.",
            "created_at": "2022-01-17T13:37:30Z",
            "html_url": "https://github.com/cython/cython/issues/4577#issuecomment-1014557406",
            "id": 1014557406,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4577",
            "node_id": "IC_kwDOABDGAc48eOre",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1014557406/reactions"
            },
            "updated_at": "2022-01-17T13:37:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1014557406",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "I'm not completely convinced that the pure Python syntax is a good default - it requires Cython 3.0 (and I suspect most people are on 0.29.x) and the docs don't make it that obvious which version they refer to. Using the \"classic\" syntax for the moment would probably avoid this confusion.",
            "created_at": "2022-01-17T18:07:42Z",
            "html_url": "https://github.com/cython/cython/issues/4577#issuecomment-1014787741",
            "id": 1014787741,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4577",
            "node_id": "IC_kwDOABDGAc48fG6d",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1014787741/reactions"
            },
            "updated_at": "2022-01-17T18:07:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1014787741",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "I tried again with `cython==3.0.0a10` and it worked fine.\r\n\r\nSo I guess we can add a comment to this code about the version it requires to avoid confusion?",
            "created_at": "2022-01-18T01:19:03Z",
            "html_url": "https://github.com/cython/cython/issues/4577#issuecomment-1014989735",
            "id": 1014989735,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4577",
            "node_id": "IC_kwDOABDGAc48f4On",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1014989735/reactions"
            },
            "updated_at": "2022-01-18T01:19:03Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1014989735",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/17642707?v=4",
                "events_url": "https://api.github.com/users/Co1lin/events{/privacy}",
                "followers_url": "https://api.github.com/users/Co1lin/followers",
                "following_url": "https://api.github.com/users/Co1lin/following{/other_user}",
                "gists_url": "https://api.github.com/users/Co1lin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Co1lin",
                "id": 17642707,
                "login": "Co1lin",
                "node_id": "MDQ6VXNlcjE3NjQyNzA3",
                "organizations_url": "https://api.github.com/users/Co1lin/orgs",
                "received_events_url": "https://api.github.com/users/Co1lin/received_events",
                "repos_url": "https://api.github.com/users/Co1lin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Co1lin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Co1lin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Co1lin"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I'm not completely convinced that the pure Python syntax is a good default - it requires Cython 3.0 (and I suspect most people are on 0.29.x) and the docs don't make it that obvious which version they refer to. Using the \"classic\" syntax for the moment would probably avoid this confusion.\r\n\r\nI am not 100% convinced that the main problem is default syntax. The problem can raise also when we introduce other changes in documentation - e.g. migration default version of `build_ext` - #4498. I think we should do 2 thinks:\r\n1. by default documentation of stable version should be showed: https://cython.readthedocs.io/en/stable/ instead of https://cython.readthedocs.io/en/latest/\r\n2. version of documentation should be clearly displayed. (maybe we can use https://sphinx-version-warning.readthedocs.io/en/latest/index.html)",
            "created_at": "2022-01-18T07:29:13Z",
            "html_url": "https://github.com/cython/cython/issues/4577#issuecomment-1015138462",
            "id": 1015138462,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4577",
            "node_id": "IC_kwDOABDGAc48gcie",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1015138462/reactions"
            },
            "updated_at": "2022-01-18T08:13:54Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1015138462",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/827060?v=4",
                "events_url": "https://api.github.com/users/matusvalo/events{/privacy}",
                "followers_url": "https://api.github.com/users/matusvalo/followers",
                "following_url": "https://api.github.com/users/matusvalo/following{/other_user}",
                "gists_url": "https://api.github.com/users/matusvalo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/matusvalo",
                "id": 827060,
                "login": "matusvalo",
                "node_id": "MDQ6VXNlcjgyNzA2MA==",
                "organizations_url": "https://api.github.com/users/matusvalo/orgs",
                "received_events_url": "https://api.github.com/users/matusvalo/received_events",
                "repos_url": "https://api.github.com/users/matusvalo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/matusvalo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/matusvalo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/matusvalo"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4577/comments",
    "created_at": "2022-01-17T11:02:51Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-02-04T12:56:21Z",
            "event": "closed",
            "id": 6009336889,
            "node_id": "CE_lADOABDGAc5B57rBzwAAAAFmLzQ5",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6009336889"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4577/events",
    "html_url": "https://github.com/cython/cython/issues/4577",
    "id": 1105705665,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4577/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5B57rB",
    "number": 4577,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4577/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4577/timeline",
    "title": "[BUG] Example code has compilation error in cython tutorial - Primes with C++",
    "updated_at": "2022-02-04T12:56:21Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4577",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/17642707?v=4",
        "events_url": "https://api.github.com/users/Co1lin/events{/privacy}",
        "followers_url": "https://api.github.com/users/Co1lin/followers",
        "following_url": "https://api.github.com/users/Co1lin/following{/other_user}",
        "gists_url": "https://api.github.com/users/Co1lin/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Co1lin",
        "id": 17642707,
        "login": "Co1lin",
        "node_id": "MDQ6VXNlcjE3NjQyNzA3",
        "organizations_url": "https://api.github.com/users/Co1lin/orgs",
        "received_events_url": "https://api.github.com/users/Co1lin/received_events",
        "repos_url": "https://api.github.com/users/Co1lin/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Co1lin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Co1lin/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Co1lin"
    }
}