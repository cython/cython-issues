{
    "assignee": null,
    "assignees": [],
    "body": "Hi,\r\nWe are using Cython in some parts of our projects. And we also use the type annotation feature of Python for our Python projects. To unblock type checking over the boundary between Python code and Cython code, we created pyi files for our Cython code so that the type checkers like mypy could find the names defined in the Cython code. We also created pyi files for cython.py and would like to contribute it back to the typeshed upstream. Are you guys good with us adding the stubs for Cython to typeshed? https://github.com/python/typeshed/pull/1554",
    "closed_at": "2017-08-22T06:26:02Z",
    "comment_data": [
        {
            "body": "Thanks for doing that!\r\n\r\nAs far as I understand typeshed, they are just a repository for keeping third party stubs. I guess the reason why we would want to store those stubs externally, rather than shipping them with Cython, is that people who use your code uncompiled then wouldn't need to install Cython as a dependency just for the annotations. That would mostly solve the problem of packages trying to concurrently install a version of cython.py (a.k.a. Cython/Shadow.py) in order to use Cython type declarations in their Python code.\r\n\r\nOne drawback is that we'd have to reach out to typeshed in order to update the list of types (which tends to be rare and certainly hasn't happened in a while).\r\n\r\nI'm also not sure about the impact on issue #1672. It might actually just work ;) - would you have an example of actual code that uses these annotations? Are you writing your code in Python syntax to allow optional compilation with Cython?",
            "created_at": "2017-08-18T04:30:43Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323256439",
            "id": 323256439,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-18T04:30:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323256439",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "body": "@scoder Facebook has an internal tool that we want to open source (the cython stubs are the first part of this effort). The tool is generating Python .pyi files from Cython sources. This enables type checking of code that uses .so files produced by Cython without mypy having to understand Cython syntax. This doesn't solve type checking of Cython files themselves, that will come later.\r\n\r\nWe're not really using the pure Python syntax anywhere outside of the generated .pyi files, maybe we're missing some parts of the Cython API in the proposed pull request to typeshed.\r\n\r\nAnyway, I'll keep you and @robertwb in the loop for open-sourcing of this tool, it's off topic for this issue.",
            "created_at": "2017-08-21T20:36:43Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323846354",
            "id": 323846354,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-21T20:36:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323846354",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/55281?v=4",
                "events_url": "https://api.github.com/users/ambv/events{/privacy}",
                "followers_url": "https://api.github.com/users/ambv/followers",
                "following_url": "https://api.github.com/users/ambv/following{/other_user}",
                "gists_url": "https://api.github.com/users/ambv/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ambv",
                "id": 55281,
                "login": "ambv",
                "organizations_url": "https://api.github.com/users/ambv/orgs",
                "received_events_url": "https://api.github.com/users/ambv/received_events",
                "repos_url": "https://api.github.com/users/ambv/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ambv/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ambv/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ambv"
            }
        },
        {
            "body": "In fact, the idea of our work is similar to shalabhc's suggestion in #1672. Here's an example-\r\nLet's say that in foo.pyx, we have\r\n```Cython\r\ncpdef int str2int(str s):\r\n    return int(s)\r\n```\r\nthen in the stub file foo.pyi for foo.pyx, we'll have\r\n```Python\r\ndef str2int(s: cython.str) -> cython.int: ...\r\n```",
            "created_at": "2017-08-21T21:14:16Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323854842",
            "id": 323854842,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-21T21:16:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323854842",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/2681363?v=4",
                "events_url": "https://api.github.com/users/OswinC/events{/privacy}",
                "followers_url": "https://api.github.com/users/OswinC/followers",
                "following_url": "https://api.github.com/users/OswinC/following{/other_user}",
                "gists_url": "https://api.github.com/users/OswinC/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/OswinC",
                "id": 2681363,
                "login": "OswinC",
                "organizations_url": "https://api.github.com/users/OswinC/orgs",
                "received_events_url": "https://api.github.com/users/OswinC/received_events",
                "repos_url": "https://api.github.com/users/OswinC/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/OswinC/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/OswinC/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/OswinC"
            }
        },
        {
            "body": "Just for completeness, here's what Cython currently accepts as annotation typing:\r\nhttps://github.com/cython/cython/blob/0.26/tests/run/annotation_typing.pyx\r\nNow that there's an actual way to represent its types in a PEP 484 conforming way, I think we should strip that down to what `typing` actually allows.\r\n\r\nI think it's a good idea to generate .pyi files to avoid source code parsing. Does that tool generate them from the available runtime signature information or from source code? (If the latter, it feels like Cython should be doing that itself.)",
            "created_at": "2017-08-21T21:42:47Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323860874",
            "id": 323860874,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-21T21:42:47Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323860874",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "body": "> Does that tool generate them from the available runtime signature information or from source code? (If the latter, it feels like Cython should be doing that itself.)\r\n\r\nFrom source code. We thought about integrating that with Cython itself but the current parsing model was hard for a new comer to grasp.\r\n\r\nWe can discuss that project in a separate issue, for now we need an \"A-OK\" from you for including your stubs in typeshed so we can merge that pull request :)",
            "created_at": "2017-08-21T21:45:46Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323861435",
            "id": 323861435,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-21T21:45:46Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323861435",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/55281?v=4",
                "events_url": "https://api.github.com/users/ambv/events{/privacy}",
                "followers_url": "https://api.github.com/users/ambv/followers",
                "following_url": "https://api.github.com/users/ambv/following{/other_user}",
                "gists_url": "https://api.github.com/users/ambv/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ambv",
                "id": 55281,
                "login": "ambv",
                "organizations_url": "https://api.github.com/users/ambv/orgs",
                "received_events_url": "https://api.github.com/users/ambv/received_events",
                "repos_url": "https://api.github.com/users/ambv/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ambv/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ambv/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ambv"
            }
        },
        {
            "body": "> We thought about integrating that with Cython itself but the current parsing model was hard for a new comer to grasp.\r\n\r\nYou could have asked. ;)\r\nIt wouldn't integrate with the parser directly, but treated as a fourth output format of the compiler (c/c++, HTML, API pxd/h, plus then API pyi). And there should probably also be an option to automatically copy the argument types into the runtime accessible `__annotations__`. But yes, let's keep that out of this ticket.",
            "created_at": "2017-08-22T06:25:25Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323931316",
            "id": 323931316,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-22T06:25:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323931316",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "body": "> including your stubs in typeshed\r\n\r\nAs I said, I'm very happy that this was done. I'm just trying to understand the implications, especially for maintenance. All I could find on the github page regarding an ownership policy was \"if something disagrees with the implementation, fix it and file a pull request\".\r\n\r\nThe type system of Cython is pretty stable, but there have been additions every once in a while. The description on [stub versioning](https://github.com/python/typeshed/blob/master/CONTRIBUTING.md#stub-versioning) says \"in its current implementation, typeshed cannot contain stubs for multiple versions of the same third-party library\".\r\n\r\nAdditions to the Cython type system tend to be backwards compatible (especially at the high level of a Python representation), which means that we'd normally just have to add them to the stubs and wait for type checkers to update their typeshed version. Sounds acceptable.\r\n\r\nI'm fine with adding the stubs to typeshed.",
            "created_at": "2017-08-22T06:26:02Z",
            "html_url": "https://github.com/cython/cython/issues/1826#issuecomment-323931409",
            "id": 323931409,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1826",
            "updated_at": "2017-08-22T06:26:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/323931409",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1826/comments",
    "created_at": "2017-08-17T21:37:02Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-08-21T20:36:43Z",
            "event": "mentioned",
            "id": 1214796932,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1214796932"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-08-21T20:36:43Z",
            "event": "subscribed",
            "id": 1214796934,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1214796934"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-08-21T20:36:44Z",
            "event": "mentioned",
            "id": 1214796936,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1214796936"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-08-21T20:36:44Z",
            "event": "subscribed",
            "id": 1214796938,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1214796938"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-08-22T06:26:03Z",
            "event": "closed",
            "id": 1215290890,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1215290890"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1826/events",
    "html_url": "https://github.com/cython/cython/issues/1826",
    "id": 251079631,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1826/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1826,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Add stubs for cython to typeshed",
    "updated_at": "2017-08-22T06:26:03Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1826",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/2681363?v=4",
        "events_url": "https://api.github.com/users/OswinC/events{/privacy}",
        "followers_url": "https://api.github.com/users/OswinC/followers",
        "following_url": "https://api.github.com/users/OswinC/following{/other_user}",
        "gists_url": "https://api.github.com/users/OswinC/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/OswinC",
        "id": 2681363,
        "login": "OswinC",
        "organizations_url": "https://api.github.com/users/OswinC/orgs",
        "received_events_url": "https://api.github.com/users/OswinC/received_events",
        "repos_url": "https://api.github.com/users/OswinC/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/OswinC/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/OswinC/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/OswinC"
    }
}