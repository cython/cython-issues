{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nWhen assigning to a class variable with the same name as a constant value imported from an external header file, I get a runtime error: `NameError: name 'XXX' is not defined`.\r\nInterestingly enough, this only happens if the names are equal. If I change the name of the imported constant, the code works as expected.\r\n\r\n### Code to reproduce the behaviour:\r\n\r\n```h\r\n// class_test.h\r\n#define XXX 1\r\n```\r\n\r\n```cython\r\n# class_test.pyx\r\ncdef extern from \"class_test.h\":\r\n    cdef int XXX\r\n\r\nclass Test:\r\n    XXX = XXX\r\n```\r\n\r\nOn the other hand, this modified version works just fine:\r\n\r\n```cython\r\n# class_test.pyx\r\ncdef extern from \"class_test.h\":\r\n    cdef int _XXX \"XXX\"\r\n\r\nclass Test:\r\n    XXX = _XXX\r\n```\r\n\r\n\r\n### Expected behaviour\r\n\r\nI should be able to import the compiled module and access `Test.XXX`\r\n\r\n### OS\r\n\r\nUbuntu 20.04\r\n\r\n### Python version\r\n\r\n3.9.5\r\n\r\n### Cython version\r\n\r\n3.0.0b2\r\n\r\n### Additional context\r\n\r\n_No response_",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Ideally this would be fixed since it's what Python does with regular classes. Practically I think this might be unlikely to be fixed - cdef classes are a lot more \"static\" than regular classes so Cython needs to be able to reason about names at compile time (which isn't always easy for this type of code)",
            "created_at": "2023-03-29T16:49:18Z",
            "html_url": "https://github.com/cython/cython/issues/5344#issuecomment-1488953333",
            "id": 1488953333,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5344",
            "node_id": "IC_kwDOABDGAc5Yv5_1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1488953333/reactions"
            },
            "updated_at": "2023-03-29T16:49:18Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1488953333",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks for the quick reply! Could you explain how is the first example different in terms of compile time information (or lack thereof)? From my point of view, Cython should know about the existence of the variable from the `cdef extern ..` block so everything should be known at compile time regardless of the name, or am I missing something? Thanks!",
            "created_at": "2023-03-29T17:42:36Z",
            "html_url": "https://github.com/cython/cython/issues/5344#issuecomment-1489035621",
            "id": 1489035621,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5344",
            "node_id": "IC_kwDOABDGAc5YwOFl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1489035621/reactions"
            },
            "updated_at": "2023-03-29T17:42:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1489035621",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8739637?v=4",
                "events_url": "https://api.github.com/users/tomasr8/events{/privacy}",
                "followers_url": "https://api.github.com/users/tomasr8/followers",
                "following_url": "https://api.github.com/users/tomasr8/following{/other_user}",
                "gists_url": "https://api.github.com/users/tomasr8/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tomasr8",
                "id": 8739637,
                "login": "tomasr8",
                "node_id": "MDQ6VXNlcjg3Mzk2Mzc=",
                "organizations_url": "https://api.github.com/users/tomasr8/orgs",
                "received_events_url": "https://api.github.com/users/tomasr8/received_events",
                "repos_url": "https://api.github.com/users/tomasr8/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tomasr8/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tomasr8/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tomasr8"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It's more that it resolves `XXX` to `Test.XXX` and doesn't do the lookup to the global scope. It clearly isn't unsolvable, but you can imagine more complicated cases with `if ...` blocks inside the `cdef class` scope where the order isn't obvious.\r\n\r\nOne thing to point out is that not everything in the `cdef class` scope is executed strictly in order (unlike for a regular class). Functions and properties are defined at compile time so never really \"executed\". That doesn't apply to your example, but explains why replicating all the nuances of Python behaviour is hard for cdef classes.",
            "created_at": "2023-03-29T18:40:52Z",
            "html_url": "https://github.com/cython/cython/issues/5344#issuecomment-1489115534",
            "id": 1489115534,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5344",
            "node_id": "IC_kwDOABDGAc5YwhmO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1489115534/reactions"
            },
            "updated_at": "2023-03-29T18:41:07Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1489115534",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "OK, understood. Thanks!",
            "created_at": "2023-03-29T20:47:35Z",
            "html_url": "https://github.com/cython/cython/issues/5344#issuecomment-1489290379",
            "id": 1489290379,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5344",
            "node_id": "IC_kwDOABDGAc5YxMSL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1489290379/reactions"
            },
            "updated_at": "2023-03-29T20:47:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1489290379",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8739637?v=4",
                "events_url": "https://api.github.com/users/tomasr8/events{/privacy}",
                "followers_url": "https://api.github.com/users/tomasr8/followers",
                "following_url": "https://api.github.com/users/tomasr8/following{/other_user}",
                "gists_url": "https://api.github.com/users/tomasr8/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tomasr8",
                "id": 8739637,
                "login": "tomasr8",
                "node_id": "MDQ6VXNlcjg3Mzk2Mzc=",
                "organizations_url": "https://api.github.com/users/tomasr8/orgs",
                "received_events_url": "https://api.github.com/users/tomasr8/received_events",
                "repos_url": "https://api.github.com/users/tomasr8/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tomasr8/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tomasr8/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tomasr8"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5344/comments",
    "created_at": "2023-03-29T14:30:47Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5344/events",
    "html_url": "https://github.com/cython/cython/issues/5344",
    "id": 1645941566,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5344/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5iGxM-",
    "number": 5344,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5344/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5344/timeline",
    "title": "[BUG] Cannot assign to a class variable with the same name as the value being assigned",
    "updated_at": "2023-03-29T20:47:55Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5344",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8739637?v=4",
        "events_url": "https://api.github.com/users/tomasr8/events{/privacy}",
        "followers_url": "https://api.github.com/users/tomasr8/followers",
        "following_url": "https://api.github.com/users/tomasr8/following{/other_user}",
        "gists_url": "https://api.github.com/users/tomasr8/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tomasr8",
        "id": 8739637,
        "login": "tomasr8",
        "node_id": "MDQ6VXNlcjg3Mzk2Mzc=",
        "organizations_url": "https://api.github.com/users/tomasr8/orgs",
        "received_events_url": "https://api.github.com/users/tomasr8/received_events",
        "repos_url": "https://api.github.com/users/tomasr8/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tomasr8/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tomasr8/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tomasr8"
    }
}