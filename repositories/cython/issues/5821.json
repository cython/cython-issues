{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nI'm working on upgrading to Cython 3.x in pandas (https://github.com/pandas-dev/pandas/pull/55179), looking into an ASV regression `series_methods.Fillna.time_ffill('Float64')`. Compiling locally using Cython 3.0.5 I am able to reproduce the timing reported in the OP there (~2.7ms). So I go to profile it by adding `# cython: profile=True` to the top of `algos.pyx`, recompile, and now the same code takes ~1.2ms.\r\n\r\nI'm guessing this isn't expected?\r\n\r\n### Code to reproduce the behaviour:\r\n\r\n```python\r\nimport numpy as np\r\nimport pandas as pd\r\n\r\nser = Series(np.random.randn(10**6), dtype='Float64')\r\nser[::2] = np.nan\r\n%timeit ser.ffill()\r\n```\r\n\r\n\r\n### Expected behaviour\r\n\r\n_No response_\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Python version\r\n\r\n3.10.12\r\n\r\n### Cython version\r\n\r\n3.0.5\r\n\r\n### Additional context\r\n\r\nCython method:\r\n\r\nhttps://github.com/pandas-dev/pandas/blob/55d78caa38925e8cf94623adcd0721cc15a56bdd/pandas/_libs/algos.pyx#L628",
    "closed_at": "2023-12-11T09:19:58Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Does the timing change if you use a seed? Maybe the timing changes are value dependent?",
            "created_at": "2023-11-15T13:29:41Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1812540180",
            "id": 1812540180,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5sCSsU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1812540180/reactions"
            },
            "updated_at": "2023-11-15T13:29:41Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1812540180",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/609873?v=4",
                "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
                "followers_url": "https://api.github.com/users/WillAyd/followers",
                "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
                "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/WillAyd",
                "id": 609873,
                "login": "WillAyd",
                "node_id": "MDQ6VXNlcjYwOTg3Mw==",
                "organizations_url": "https://api.github.com/users/WillAyd/orgs",
                "received_events_url": "https://api.github.com/users/WillAyd/received_events",
                "repos_url": "https://api.github.com/users/WillAyd/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/WillAyd"
            }
        },
        {
            "author_association": "NONE",
            "body": "No - I must have run this a dozen times because I didn't believe the results. The timings are stable. Here it is without any randomness. This was run on the main branch of pandas with Cython 3.0.5 to compile.\r\n\r\n```\r\nser = Series(np.zeros(10**6), dtype='Float64')\r\nser[::2] = np.nan\r\nfor _ in range(5):\r\n    %timeit ser.ffill()\r\n\r\n# Without profiling\r\n# 2.5 ms ± 37.1 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n# 2.49 ms ± 23 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n# 2.48 ms ± 20.9 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n# 2.48 ms ± 22 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n# 2.5 ms ± 55.3 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n\r\n# With profiling\r\n# 1.2 ms ± 5.77 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)\r\n# 1.19 ms ± 7.12 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)\r\n# 1.2 ms ± 8.97 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)\r\n# 1.2 ms ± 7.41 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)\r\n# 1.19 ms ± 5.85 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)\r\n```",
            "created_at": "2023-11-15T22:06:51Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1813338062",
            "id": 1813338062,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5sFVfO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1813338062/reactions"
            },
            "updated_at": "2023-11-15T22:07:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1813338062",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/45562402?v=4",
                "events_url": "https://api.github.com/users/rhshadrach/events{/privacy}",
                "followers_url": "https://api.github.com/users/rhshadrach/followers",
                "following_url": "https://api.github.com/users/rhshadrach/following{/other_user}",
                "gists_url": "https://api.github.com/users/rhshadrach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rhshadrach",
                "id": 45562402,
                "login": "rhshadrach",
                "node_id": "MDQ6VXNlcjQ1NTYyNDAy",
                "organizations_url": "https://api.github.com/users/rhshadrach/orgs",
                "received_events_url": "https://api.github.com/users/rhshadrach/received_events",
                "repos_url": "https://api.github.com/users/rhshadrach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rhshadrach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rhshadrach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rhshadrach"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Hmm OK. And these are all built with the same optimization level right? If using conda I've been bitten too many times to count by how it makes changes to CFLAGS which can impact performance. ",
            "created_at": "2023-11-15T22:12:17Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1813345156",
            "id": 1813345156,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5sFXOE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1813345156/reactions"
            },
            "updated_at": "2023-11-15T22:12:17Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1813345156",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/609873?v=4",
                "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
                "followers_url": "https://api.github.com/users/WillAyd/followers",
                "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
                "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/WillAyd",
                "id": 609873,
                "login": "WillAyd",
                "node_id": "MDQ6VXNlcjYwOTg3Mw==",
                "organizations_url": "https://api.github.com/users/WillAyd/orgs",
                "received_events_url": "https://api.github.com/users/WillAyd/received_events",
                "repos_url": "https://api.github.com/users/WillAyd/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/WillAyd"
            }
        },
        {
            "author_association": "NONE",
            "body": "> And these are all built with the same optimization level right?\r\n\r\nYes.",
            "created_at": "2023-11-15T22:20:48Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1813354084",
            "id": 1813354084,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5sFZZk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1813354084/reactions"
            },
            "updated_at": "2023-11-15T22:20:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1813354084",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/45562402?v=4",
                "events_url": "https://api.github.com/users/rhshadrach/events{/privacy}",
                "followers_url": "https://api.github.com/users/rhshadrach/followers",
                "following_url": "https://api.github.com/users/rhshadrach/following{/other_user}",
                "gists_url": "https://api.github.com/users/rhshadrach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rhshadrach",
                "id": 45562402,
                "login": "rhshadrach",
                "node_id": "MDQ6VXNlcjQ1NTYyNDAy",
                "organizations_url": "https://api.github.com/users/rhshadrach/orgs",
                "received_events_url": "https://api.github.com/users/rhshadrach/received_events",
                "repos_url": "https://api.github.com/users/rhshadrach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rhshadrach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rhshadrach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rhshadrach"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I get a smaller effect (~10% speedup) but I can reproduce this I think.\r\n\r\nIt's not completely implausible to me -  it'll likely be to do with acquiring the GIL either conditionally or unconditionally at the start of functions.",
            "created_at": "2023-12-09T16:20:36Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848453511",
            "id": 1848453511,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uLSmH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848453511/reactions"
            },
            "updated_at": "2023-12-09T16:20:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848453511",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks @da-woods \r\n\r\n> it'll likely be to do with acquiring the GIL either conditionally or unconditionally at the start of functions.\r\n\r\nIn the case of `pad_inplace`, we don't release the GIL at all. I assume that means we're acquiring the GIL unconditionally, and I'd assume the same happens when profiling. So I'm not sure I understand how the performance differs.",
            "created_at": "2023-12-09T16:26:52Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848457253",
            "id": 1848457253,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uLTgl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848457253/reactions"
            },
            "updated_at": "2023-12-09T16:26:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848457253",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/45562402?v=4",
                "events_url": "https://api.github.com/users/rhshadrach/events{/privacy}",
                "followers_url": "https://api.github.com/users/rhshadrach/followers",
                "following_url": "https://api.github.com/users/rhshadrach/following{/other_user}",
                "gists_url": "https://api.github.com/users/rhshadrach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rhshadrach",
                "id": 45562402,
                "login": "rhshadrach",
                "node_id": "MDQ6VXNlcjQ1NTYyNDAy",
                "organizations_url": "https://api.github.com/users/rhshadrach/orgs",
                "received_events_url": "https://api.github.com/users/rhshadrach/received_events",
                "repos_url": "https://api.github.com/users/rhshadrach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rhshadrach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rhshadrach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rhshadrach"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Hmmm - I'm definitely puzzled.\r\n\r\nConclusions:\r\n\r\n* Using `perf` tells me that the almost all the time is in `pad_inplace` (and the rest is just in `__memmove_avx_unaligned_erms`). Certainly the difference between the runs is is `pad_inplace`.  (you'd probably already verified this).\r\n* Nothing to do with the GIL - as you say, you're not releasing it\r\n* There's nothing odd in the code generation. Profiling adds:\r\n\r\n    ```\r\n    __Pyx_TraceDeclarations\r\n    [...]\r\n    __Pyx_TraceCall(\"__pyx_fuse_9pad_inplace\", __pyx_f[0], 628, 0, __PYX_ERR(0, 628, __pyx_L1_error));\r\n    [...]\r\n    __Pyx_TraceReturn(__pyx_r, 0);\r\n    ```\r\n\r\n    and all of those should just add a small amount of work.\r\n* Something about the Pandas build system means I can't get `perf` to give me C source output\r\n* I seem to get similar results (~10% speed-up with profiling) on both Python 3.10 and 3.11, so nothing interesting there.\r\n* I can't reproduce it when I extract `pad_inplace` out of Pandas (together with the two other functions it uses) - the timings then end up basically the same. However I can get annotated C source.\r\n* Almost all the time is spent in the\r\n\r\n    ```\r\n    for i in range(N):\r\n        if mask[i]:\r\n    ```\r\n\r\n    loop (as you would expect). This appears to be the case for both the profiling/non-profiling versions in Pandas.\r\n* In Pandas the assembly generated for these loops is slightly different (although the C source is identical):\r\n\r\n    ```\r\n    #### with profiling ###################\r\n    Percent│870:┌─→cmp        %r8d,%ecx\r\n           │    │↓ jge        87f\r\n      3.79 │    │  movsd      %xmm0,(%rdx)\r\n      1.63 │    │  add        $0x1,%ecx\r\n     10.59 │    │  mov        %sil,(%rax)\r\n           │87f:│  add        $0x1,%rax\r\n      2.09 │    │  add        %r14,%rdx\r\n      1.86 │    │  cmp        %rax,%rbp\r\n           │    │↓ je         8a4\r\n     21.74 │88b:├──cmpb       $0x0,(%rax)\r\n     21.97 │    └──jne        870\r\n      0.15 │       add        $0x1,%rax\r\n     21.17 │       movsd      (%rdx),%xmm0\r\n      1.94 │       xor        %esi,%esi\r\n      9.91 │       xor        %ecx,%ecx\r\n           │       add        %r14,%rdx\r\n           │       cmp        %rax,%rbp\r\n      3.02 │     ↑ jne        88b\r\n    \r\n    #### without profiling ###############\r\n      0.12 │830:   cmp        %r8d,%ecx                                                                                                                          \r\n           │     ↓ jge        83f                                                                                                                                \r\n     11.75 │       movsd      %xmm0,(%rdx)                                                                                                                      \r\n      0.21 │       add        $0x1,%ecx                                                                                                                         \r\n      8.78 │       mov        %sil,(%rax)                                                                                                                       \r\n      0.79 │83f:   add        $0x1,%rax                                                                                                                         \r\n      3.64 │       add        %r14,%rdx                                                                                                                         \r\n      1.48 │       cmp        %rax,%rbp                                                                                                                         \r\n           │     ↑ je         680                                                                                                                               \r\n     35.71 │84f:   cmpb       $0x0,(%rax)                                                                                                                       \r\n     11.27 │     ↑ jne        830                                                                                                                               \r\n     15.94 │       movsd      (%rdx),%xmm0                                                                                                                      \r\n      0.19 │       xor        %esi,%esi                                                                                                                          \r\n      0.64 │       xor        %ecx,%ecx                                                                                                                          \r\n      9.31 │     ↑ jmp        83f                                                                                                                                \r\n           │       xchg       %ax,%ax                                                                                                                            \r\n           │860:   mov        %rdx,%rdi      \r\n    ```\r\n    basically just a couple of extra `add`s have appeared.\r\n\r\n* For the version I've taken out of Pandas the assembly is the same with/without profiling (but isn't an exact match for either of the versions above).\r\n\r\nSo basically, I think this is the C compiler doing something odd. There's no relevant changes in the generated c code.",
            "created_at": "2023-12-09T20:34:42Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848675117",
            "id": 1848675117,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uMIst",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848675117/reactions"
            },
            "updated_at": "2023-12-09T20:35:56Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848675117",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> * Something about the Pandas build system means I can't get `perf` to give me C source output\r\n\r\nI assume you need a debug build to do this but our build system generates a release build by default. You might want to try:\r\n\r\n```\r\npip install -ve . --no-build-isolation --config-settings=builddir=\"debug\" --config-settings=setup-args=\"-Dbuildtype=debug\"\r\n```\r\n\r\nhttps://pandas.pydata.org/docs/development/debugging_extensions.html",
            "created_at": "2023-12-10T08:43:12Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848897201",
            "id": 1848897201,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uM-6x",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848897201/reactions"
            },
            "updated_at": "2023-12-10T08:43:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848897201",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/609873?v=4",
                "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
                "followers_url": "https://api.github.com/users/WillAyd/followers",
                "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
                "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/WillAyd",
                "id": 609873,
                "login": "WillAyd",
                "node_id": "MDQ6VXNlcjYwOTg3Mw==",
                "organizations_url": "https://api.github.com/users/WillAyd/orgs",
                "received_events_url": "https://api.github.com/users/WillAyd/received_events",
                "repos_url": "https://api.github.com/users/WillAyd/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/WillAyd"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I assume you need a debug build to do this but our build system generates a release build by default.\r\n\r\nI think really I'd want \"release with debug symbols\", rather than a pure debug build. I did try adding `-g` to the compile flags in setup.py, but that possibly wasn't enough.\r\n\r\nFor now I think I've reached the end of what I can usefully learn here anyway.",
            "created_at": "2023-12-10T09:21:58Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848906236",
            "id": 1848906236,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uNBH8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848906236/reactions"
            },
            "updated_at": "2023-12-10T09:21:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848906236",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks for investigating this so deeply, @da-woods.\r\n\r\n> I think this is the C compiler doing something odd\r\n\r\nIt might end up applying different optimisation heuristics when it sees the additional profiling calls. This code might just hit an unlucky tipping point where the default heuristics don't work well any more but slight modifications trigger a switch in heuristics that work visibly better.\r\n\r\nTo me, this suggests that enabling PGO might help the C compiler take better decisions also in the non-profiling case.",
            "created_at": "2023-12-10T10:22:45Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848921345",
            "id": 1848921345,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uNE0B",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848921345/reactions"
            },
            "updated_at": "2023-12-10T10:23:53Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848921345",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@da-woods makes sense. If you still cared you could also try \"debugoptimized\" as the build type argument in the above command. The default build system in pandas is meson so setup.py is not used by default, just there for legacy reasons\n\nNoted that still may not matter just sharing as an FYI. Thank you for the wonderful investigative work!",
            "created_at": "2023-12-10T11:11:47Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1848933539",
            "id": 1848933539,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uNHyj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1848933539/reactions"
            },
            "updated_at": "2023-12-10T11:11:47Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1848933539",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/609873?v=4",
                "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
                "followers_url": "https://api.github.com/users/WillAyd/followers",
                "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
                "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/WillAyd",
                "id": 609873,
                "login": "WillAyd",
                "node_id": "MDQ6VXNlcjYwOTg3Mw==",
                "organizations_url": "https://api.github.com/users/WillAyd/orgs",
                "received_events_url": "https://api.github.com/users/WillAyd/received_events",
                "repos_url": "https://api.github.com/users/WillAyd/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/WillAyd"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I'm closing this ticket since I don't see Cython doing anything wrong here. It seems to be an issue with C compiler optimisation. PGO, i.e. a better informed C compiler optimiser, would likely help.",
            "created_at": "2023-12-11T09:19:58Z",
            "html_url": "https://github.com/cython/cython/issues/5821#issuecomment-1849629917",
            "id": 1849629917,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5821",
            "node_id": "IC_kwDOABDGAc5uPxzd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1849629917/reactions"
            },
            "updated_at": "2023-12-11T09:19:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1849629917",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 12,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5821/comments",
    "created_at": "2023-11-15T12:46:04Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-09T16:26:52Z",
            "event": "mentioned",
            "id": 11200879053,
            "node_id": "MEE_lADOABDGAc525N2NzwAAAAKbn9nN",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11200879053"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-09T16:26:52Z",
            "event": "subscribed",
            "id": 11200879061,
            "node_id": "SE_lADOABDGAc525N2NzwAAAAKbn9nV",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11200879061"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-10T10:22:45Z",
            "event": "mentioned",
            "id": 11202555180,
            "node_id": "MEE_lADOABDGAc525N2NzwAAAAKbuW0s",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11202555180"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-10T10:22:45Z",
            "event": "subscribed",
            "id": 11202555183,
            "node_id": "SE_lADOABDGAc525N2NzwAAAAKbuW0v",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11202555183"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-10T11:11:47Z",
            "event": "mentioned",
            "id": 11202645525,
            "node_id": "MEE_lADOABDGAc525N2NzwAAAAKbus4V",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11202645525"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-10T11:11:47Z",
            "event": "subscribed",
            "id": 11202645527,
            "node_id": "SE_lADOABDGAc525N2NzwAAAAKbus4X",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11202645527"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-11T09:18:10Z",
            "event": "labeled",
            "id": 11207489758,
            "label": {
                "color": "000000",
                "name": "R: third party"
            },
            "node_id": "LE_lADOABDGAc525N2NzwAAAAKcBLje",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11207489758"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-12-11T09:19:58Z",
            "event": "closed",
            "id": 11207515991,
            "node_id": "CE_lADOABDGAc525N2NzwAAAAKcBR9X",
            "performed_via_github_app": null,
            "state_reason": "not_planned",
            "url": "https://api.github.com/repos/cython/cython/issues/events/11207515991"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5821/events",
    "html_url": "https://github.com/cython/cython/issues/5821",
    "id": 1994710413,
    "labels": [
        {
            "color": "000000",
            "default": false,
            "description": "",
            "id": 1840758668,
            "name": "R: third party",
            "node_id": "MDU6TGFiZWwxODQwNzU4NjY4",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20third%20party"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5821/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc525N2N",
    "number": 5821,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5821/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5821/timeline",
    "title": "[BUG] Profiling code increases performance",
    "updated_at": "2023-12-11T09:19:58Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5821",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/45562402?v=4",
        "events_url": "https://api.github.com/users/rhshadrach/events{/privacy}",
        "followers_url": "https://api.github.com/users/rhshadrach/followers",
        "following_url": "https://api.github.com/users/rhshadrach/following{/other_user}",
        "gists_url": "https://api.github.com/users/rhshadrach/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rhshadrach",
        "id": 45562402,
        "login": "rhshadrach",
        "node_id": "MDQ6VXNlcjQ1NTYyNDAy",
        "organizations_url": "https://api.github.com/users/rhshadrach/orgs",
        "received_events_url": "https://api.github.com/users/rhshadrach/received_events",
        "repos_url": "https://api.github.com/users/rhshadrach/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rhshadrach/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rhshadrach/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rhshadrach"
    }
}