{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nCython generates code that uses CPython's internal headers and doesn't provide an option to avoid this.\n\nRecently, CPython started using C11 features (and maybe shouldn't have), some of which force the user to enable C++20 mode, and some which simply don't compile.\n\n### Code to reproduce the behaviour:\n\n```cython\n# cython: language_level=3, language=c++\n\ndef fn():\n    print(\"hello\")\n```\n\n```\n> python -m cython --cplus test.pyx\n> cl /c test.cpp /IC:\\Python-3.14\\include\\\nMicrosoft (R) C/C++ Optimizing Compiler Version 19.44.34918.1 for x64\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\ntest.cpp\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(389): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(389): error C2737: 'PyStackRef_NULL': const object must be initialized\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(463): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(463): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(473): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(473): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(489): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(489): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(492): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(492): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(503): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(503): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(514): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(514): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal/pycore_frame.h(379): error C7555: use of designated initializers requires at least '/std:c++20'\nC:\\Python-3.14\\include\\internal/pycore_frame.h(379): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\n```\n\nRunning again with `/std:c++20` (which isn't always appropriate for all users - we shouldn't force people to update their entire codebase for this).\n\n```\n> cl /c test.cpp /IC:\\Python-3.14\\include\\ /std:c++20\nMicrosoft (R) C/C++ Optimizing Compiler Version 19.44.34918.1 for x64\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\ntest.cpp\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(463): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(473): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(489): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(492): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(503): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal\\pycore_stackref.h(514): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\nC:\\Python-3.14\\include\\internal/pycore_frame.h(379): error C4576: a parenthesized type followed by an initializer list is a non-standard explicit type conversion syntax\n```\n\nThese apparently can't be fixed with build options.\n\n### Expected behaviour\n\nGenerated code can compile in C or C++ mode without warnings, errors, or forcing users to change the language mode. Adding more preprocessor variables to disable Cython features is okay.\n\n### OS\n\nWindows\n\n### Python version\n\n3.14.0a6\n\n### Cython version\n\n3.0.12\n\n### Additional context\n\nI've already spent a lot of time arguing with CPython that none of the header files should include restrictive features like this, but only managed to get agreement for the non-internal headers (\"internal means we can do whatever we want\" was the basic argument against it). At this point, practicality says I just need to ask consumers of the headers to avoid the internal ones to avoid impacting their users. But if you'd like to send this back to CPython to fix upstream, please tag me in any issue you open.",
    "closed_at": "2025-04-09T21:54:30Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1693688?v=4",
        "events_url": "https://api.github.com/users/zooba/events{/privacy}",
        "followers_url": "https://api.github.com/users/zooba/followers",
        "following_url": "https://api.github.com/users/zooba/following{/other_user}",
        "gists_url": "https://api.github.com/users/zooba/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zooba",
        "id": 1693688,
        "login": "zooba",
        "node_id": "MDQ6VXNlcjE2OTM2ODg=",
        "organizations_url": "https://api.github.com/users/zooba/orgs",
        "received_events_url": "https://api.github.com/users/zooba/received_events",
        "repos_url": "https://api.github.com/users/zooba/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zooba/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zooba/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zooba",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Just adding the generated file as well: [test.cpp.txt](https://github.com/user-attachments/files/19639767/test.cpp.txt)",
            "created_at": "2025-04-07T22:10:23Z",
            "html_url": "https://github.com/cython/cython/issues/6783#issuecomment-2784744296",
            "id": 2784744296,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6783",
            "node_id": "IC_kwDOABDGAc6l-9No",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2784744296/reactions"
            },
            "updated_at": "2025-04-07T22:10:23Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2784744296",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1693688?v=4",
                "events_url": "https://api.github.com/users/zooba/events{/privacy}",
                "followers_url": "https://api.github.com/users/zooba/followers",
                "following_url": "https://api.github.com/users/zooba/following{/other_user}",
                "gists_url": "https://api.github.com/users/zooba/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zooba",
                "id": 1693688,
                "login": "zooba",
                "node_id": "MDQ6VXNlcjE2OTM2ODg=",
                "organizations_url": "https://api.github.com/users/zooba/orgs",
                "received_events_url": "https://api.github.com/users/zooba/received_events",
                "repos_url": "https://api.github.com/users/zooba/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zooba/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zooba/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zooba",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Latest discussion is in\nhttps://github.com/python/cpython/issues/130931\n",
            "created_at": "2025-04-08T04:55:48Z",
            "html_url": "https://github.com/cython/cython/issues/6783#issuecomment-2785221764",
            "id": 2785221764,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6783",
            "node_id": "IC_kwDOABDGAc6mAxyE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2785221764/reactions"
            },
            "updated_at": "2025-04-08T04:55:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2785221764",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Ah good, so Victor's fix will handle these errors and should be out today. Perfect.",
            "created_at": "2025-04-08T12:28:16Z",
            "html_url": "https://github.com/cython/cython/issues/6783#issuecomment-2786275759",
            "id": 2786275759,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6783",
            "node_id": "IC_kwDOABDGAc6mEzGv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2786275759/reactions"
            },
            "updated_at": "2025-04-08T12:28:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2786275759",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1693688?v=4",
                "events_url": "https://api.github.com/users/zooba/events{/privacy}",
                "followers_url": "https://api.github.com/users/zooba/followers",
                "following_url": "https://api.github.com/users/zooba/following{/other_user}",
                "gists_url": "https://api.github.com/users/zooba/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zooba",
                "id": 1693688,
                "login": "zooba",
                "node_id": "MDQ6VXNlcjE2OTM2ODg=",
                "organizations_url": "https://api.github.com/users/zooba/orgs",
                "received_events_url": "https://api.github.com/users/zooba/received_events",
                "repos_url": "https://api.github.com/users/zooba/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zooba/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zooba/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zooba",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Confirmed, the upstream change has fixed this.",
            "created_at": "2025-04-09T21:54:30Z",
            "html_url": "https://github.com/cython/cython/issues/6783#issuecomment-2791074535",
            "id": 2791074535,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6783",
            "node_id": "IC_kwDOABDGAc6mXGrn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2791074535/reactions"
            },
            "updated_at": "2025-04-09T21:54:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2791074535",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1693688?v=4",
                "events_url": "https://api.github.com/users/zooba/events{/privacy}",
                "followers_url": "https://api.github.com/users/zooba/followers",
                "following_url": "https://api.github.com/users/zooba/following{/other_user}",
                "gists_url": "https://api.github.com/users/zooba/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zooba",
                "id": 1693688,
                "login": "zooba",
                "node_id": "MDQ6VXNlcjE2OTM2ODg=",
                "organizations_url": "https://api.github.com/users/zooba/orgs",
                "received_events_url": "https://api.github.com/users/zooba/received_events",
                "repos_url": "https://api.github.com/users/zooba/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zooba/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zooba/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zooba",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6783/comments",
    "created_at": "2025-04-07T22:07:26Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13780613?v=4",
                "events_url": "https://api.github.com/users/erlend-aasland/events{/privacy}",
                "followers_url": "https://api.github.com/users/erlend-aasland/followers",
                "following_url": "https://api.github.com/users/erlend-aasland/following{/other_user}",
                "gists_url": "https://api.github.com/users/erlend-aasland/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/erlend-aasland",
                "id": 13780613,
                "login": "erlend-aasland",
                "node_id": "MDQ6VXNlcjEzNzgwNjEz",
                "organizations_url": "https://api.github.com/users/erlend-aasland/orgs",
                "received_events_url": "https://api.github.com/users/erlend-aasland/received_events",
                "repos_url": "https://api.github.com/users/erlend-aasland/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/erlend-aasland/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/erlend-aasland/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/erlend-aasland",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-04-07T23:33:27Z",
            "event": "subscribed",
            "id": 17161769545,
            "node_id": "SE_lADOABDGAc6xgjcQzwAAAAP-69JJ",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17161769545"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33685575?v=4",
                "events_url": "https://api.github.com/users/h-vetinari/events{/privacy}",
                "followers_url": "https://api.github.com/users/h-vetinari/followers",
                "following_url": "https://api.github.com/users/h-vetinari/following{/other_user}",
                "gists_url": "https://api.github.com/users/h-vetinari/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/h-vetinari",
                "id": 33685575,
                "login": "h-vetinari",
                "node_id": "MDQ6VXNlcjMzNjg1NTc1",
                "organizations_url": "https://api.github.com/users/h-vetinari/orgs",
                "received_events_url": "https://api.github.com/users/h-vetinari/received_events",
                "repos_url": "https://api.github.com/users/h-vetinari/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/h-vetinari/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/h-vetinari/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/h-vetinari",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-04-09T00:54:28Z",
            "event": "subscribed",
            "id": 17179748950,
            "node_id": "SE_lADOABDGAc6xgjcQzwAAAAP__ipW",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17179748950"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1693688?v=4",
                "events_url": "https://api.github.com/users/zooba/events{/privacy}",
                "followers_url": "https://api.github.com/users/zooba/followers",
                "following_url": "https://api.github.com/users/zooba/following{/other_user}",
                "gists_url": "https://api.github.com/users/zooba/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zooba",
                "id": 1693688,
                "login": "zooba",
                "node_id": "MDQ6VXNlcjE2OTM2ODg=",
                "organizations_url": "https://api.github.com/users/zooba/orgs",
                "received_events_url": "https://api.github.com/users/zooba/received_events",
                "repos_url": "https://api.github.com/users/zooba/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zooba/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zooba/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zooba",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-04-09T21:54:30Z",
            "event": "closed",
            "id": 17196530442,
            "node_id": "CE_lADOABDGAc6xgjcQzwAAAAQA_jsK",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17196530442"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6783/events",
    "html_url": "https://github.com/cython/cython/issues/6783",
    "id": 2978101008,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6783/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6xgjcQ",
    "number": 6783,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6783/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6783/timeline",
    "title": "[BUG] Python 3.14 internal headers won't compile in MSVC C++",
    "type": null,
    "updated_at": "2025-04-09T21:54:31Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6783",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1693688?v=4",
        "events_url": "https://api.github.com/users/zooba/events{/privacy}",
        "followers_url": "https://api.github.com/users/zooba/followers",
        "following_url": "https://api.github.com/users/zooba/following{/other_user}",
        "gists_url": "https://api.github.com/users/zooba/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zooba",
        "id": 1693688,
        "login": "zooba",
        "node_id": "MDQ6VXNlcjE2OTM2ODg=",
        "organizations_url": "https://api.github.com/users/zooba/orgs",
        "received_events_url": "https://api.github.com/users/zooba/received_events",
        "repos_url": "https://api.github.com/users/zooba/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zooba/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zooba/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zooba",
        "user_view_type": "public"
    }
}