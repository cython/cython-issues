{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\nUsing --embed=\"main\" or Options.embed = 'main' does not seem to actually do anything for me.\r\n**To Reproduce**\r\nCode to reproduce the behaviour:\r\ncompiled.pyx:\r\n```\r\nif __name__ == \"__main__\":\r\n    print(\"I'm a binary.\")\r\n\r\n```\r\n\r\nsetup.py:\r\n```python\r\nfrom setuptools import setup, Extension\r\nfrom Cython.Build import cythonize\r\nfrom Cython.Compiler import Options\r\nOptions.embed = \"main\"\r\n\r\nexts = [\r\nExtension(\r\n         'examples.compiled', \r\n         ['examples/compiled.pyx'],\r\n         include_dirs=[],\r\n         libraries=[], \r\n         extra_compile_args=['-Wall'],\r\n         library_dirs=[]\r\n    ),\r\n]\r\n\r\nsetup(\r\n    name='examples.compiled',\r\n    ext_modules=cythonize(exts))\r\n\r\n```\r\n\r\nMakefile:\r\n```makefile\r\nPYTHON := python\r\nPYVERSION := $(shell $(PYTHON) -c \"import sys; print(sys.version[:3])\")\r\nPYPREFIX := $(shell $(PYTHON) -c \"import sys; print(sys.prefix)\")\r\n\r\nINCDIR := $(shell $(PYTHON) -c \"from distutils import sysconfig; print(sysconfig.get_python_inc())\")\r\nPLATINCDIR := $(shell $(PYTHON) -c \"from distutils import sysconfig; print(sysconfig.get_python_inc(plat_specific=True))\")\r\nLIBDIR1 := $(shell $(PYTHON) -c \"from distutils import sysconfig; print(sysconfig.get_config_var('LIBDIR'))\")\r\nLIBDIR2 := $(shell $(PYTHON) -c \"from distutils import sysconfig; print(sysconfig.get_config_var('LIBPL'))\")\r\nPYLIB := $(shell $(PYTHON) -c \"from distutils import sysconfig; print(sysconfig.get_config_var('LIBRARY')[3:-2])\")\r\n\r\nCC := $(shell $(PYTHON) -c \"import distutils.sysconfig; print(distutils.sysconfig.get_config_var('CC'))\")\r\nLINKCC := $(shell $(PYTHON) -c \"import distutils.sysconfig; print(distutils.sysconfig.get_config_var('LINKCC'))\")\r\nLINKFORSHARED := $(shell $(PYTHON) -c \"import distutils.sysconfig; print(distutils.sysconfig.get_config_var('LINKFORSHARED'))\")\r\nLIBS := $(shell $(PYTHON) -c \"import distutils.sysconfig; print(distutils.sysconfig.get_config_var('LIBS'))\")\r\nSYSLIBS :=  $(shell $(PYTHON) -c \"import distutils.sysconfig; print(distutils.sysconfig.get_config_var('SYSLIBS'))\")\r\n\r\n\r\ncompiled: compiled.o\r\n\t$(LINKCC) -o $@ $^ -L$(LIBDIR1) -L$(LIBDIR2) -l$(PYLIB) $(LIBS) $(SYSLIBS) $(LINKFORSHARED)\r\n\r\ncompiled.o: compiled.c\r\n\t$(CC) -c $^ -I$(INCDIR) -I$(PLATINCDIR)\r\n\r\n```\r\n#### Compilation:\r\n```bash\r\nmake compiled\r\n```\r\n#### Output:\r\n\r\n```bash\r\nUndefined symbols for architecture x86_64:\r\n  \"_main\", referenced from:\r\n     implicit entry/start for main executable\r\n     (maybe you meant: ___pyx_module_is_main_examples__compiled)\r\nld: symbol(s) not found for architecture x86_64\r\n\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Darwin Kernel Version 20.6.0: Wed Jun 23 00:26:31 PDT 2021; root:xnu-7195.141.2~5/RELEASE_X86_64\r\n - Python version: 3.9.6\r\n - Cython version: 0.29.24\r\n\r\n**Additional context**\r\nEven when I skip my setup file and try to copy the embedded example from the repo verbatim I'm having this problem.\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "So I found a workaround, \r\n\r\nI changed\r\n```python\r\nfrom Cython.Build import cythonize\r\n```\r\nto\r\n```python\r\nfrom Cython.Build import cythonize, BuildExecutable\r\n```\r\n\r\nThen I added this to the end of my setup.py:\r\n```python\r\nif Options.embed:\r\n    BuildExecutable.build('examples/compiled.pyx')\r\n```\r\n",
            "created_at": "2021-09-03T01:18:23Z",
            "html_url": "https://github.com/cython/cython/issues/4362#issuecomment-912177688",
            "id": 912177688,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4362",
            "node_id": "IC_kwDOABDGAc42XroY",
            "performed_via_github_app": null,
            "updated_at": "2021-09-03T01:18:23Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/912177688",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42073607?v=4",
                "events_url": "https://api.github.com/users/rjdbcm/events{/privacy}",
                "followers_url": "https://api.github.com/users/rjdbcm/followers",
                "following_url": "https://api.github.com/users/rjdbcm/following{/other_user}",
                "gists_url": "https://api.github.com/users/rjdbcm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rjdbcm",
                "id": 42073607,
                "login": "rjdbcm",
                "node_id": "MDQ6VXNlcjQyMDczNjA3",
                "organizations_url": "https://api.github.com/users/rjdbcm/orgs",
                "received_events_url": "https://api.github.com/users/rjdbcm/received_events",
                "repos_url": "https://api.github.com/users/rjdbcm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rjdbcm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rjdbcm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rjdbcm"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4362/comments",
    "created_at": "2021-09-02T20:41:47Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42073607?v=4",
                "events_url": "https://api.github.com/users/rjdbcm/events{/privacy}",
                "followers_url": "https://api.github.com/users/rjdbcm/followers",
                "following_url": "https://api.github.com/users/rjdbcm/following{/other_user}",
                "gists_url": "https://api.github.com/users/rjdbcm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rjdbcm",
                "id": 42073607,
                "login": "rjdbcm",
                "node_id": "MDQ6VXNlcjQyMDczNjA3",
                "organizations_url": "https://api.github.com/users/rjdbcm/orgs",
                "received_events_url": "https://api.github.com/users/rjdbcm/received_events",
                "repos_url": "https://api.github.com/users/rjdbcm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rjdbcm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rjdbcm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rjdbcm"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-09-03T01:13:08Z",
            "event": "renamed",
            "id": 5250768533,
            "node_id": "RTE_lADOABDGAc461qBSzwAAAAE4-F6V",
            "performed_via_github_app": null,
            "rename": {
                "from": "--embed does not seem to work.",
                "to": "[BUG] --embed does not seem to work."
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/5250768533"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4362/events",
    "html_url": "https://github.com/cython/cython/issues/4362",
    "id": 987144274,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4362/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU5ODcxNDQyNzQ=",
    "number": 4362,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[BUG] --embed does not seem to work.",
    "updated_at": "2021-09-03T01:18:24Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4362",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/42073607?v=4",
        "events_url": "https://api.github.com/users/rjdbcm/events{/privacy}",
        "followers_url": "https://api.github.com/users/rjdbcm/followers",
        "following_url": "https://api.github.com/users/rjdbcm/following{/other_user}",
        "gists_url": "https://api.github.com/users/rjdbcm/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rjdbcm",
        "id": 42073607,
        "login": "rjdbcm",
        "node_id": "MDQ6VXNlcjQyMDczNjA3",
        "organizations_url": "https://api.github.com/users/rjdbcm/orgs",
        "received_events_url": "https://api.github.com/users/rjdbcm/received_events",
        "repos_url": "https://api.github.com/users/rjdbcm/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rjdbcm/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rjdbcm/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rjdbcm"
    }
}