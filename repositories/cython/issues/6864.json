{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nHi, \n\n(Coming from [here](https://github.com/sknetwork-team/scikit-network/pull/584) )\n\nWe got a report from a user trying our library which fails to compile with Cython 3.1 when it worked with 3.0 - Looking at the generated cpp code: \n\n```cpp\n  __pyx_t_9sknetwork_8topology_22weisfeiler_lehman_core_ctuple const __pyx_t_11;\n//[...]\n    for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\n//[...]\n      __pyx_t_11.f0 = (*((int *) ( /* dim=0 */ (__pyx_v_labels.data + __pyx_t_6 * __pyx_v_labels.strides[0]) )));\n      __pyx_t_11.f1 = __pyx_v_hash_ref;\n      __pyx_t_11.f2 = __pyx_v_i;\n//[...]\n    }\n```\n\nit does look like incorrect C++\n\nI could not find any duplicates, sorry if I missed any\n\nThanks!\n\n### Code to reproduce the behaviour:\n\n```cython\n# example code\n```\n\n\n### Expected behaviour\n\n_No response_\n\n### OS\n\n_No response_\n\n### Python version\n\n3.13\n\n### Cython version\n\n3.1\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Do you know roughly where this is coming from in sknetwork? (the source code that causes the issue is likely embedded in comments near the offending C code).",
            "created_at": "2025-05-12T16:42:42Z",
            "html_url": "https://github.com/cython/cython/issues/6864#issuecomment-2873265064",
            "id": 2873265064,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6864",
            "node_id": "IC_kwDOABDGAc6rQouo",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2873265064/reactions"
            },
            "updated_at": "2025-05-12T16:42:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2873265064",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "the [pyx file](https://github.com/sknetwork-team/scikit-network/blob/master/sknetwork/topology/weisfeiler_lehman_core.pyx) is not huge, but I could not find weird stuff in the function: \n\nHilighted with `<<<<` the line where the const is used :\n\n```cython\ndef weisfeiler_lehman_coloring(int[:] indptr, int[:] indices, int[:] labels, double [:] powers, int max_iter):\n    cdef int n = indptr.shape[0] -1\n    cdef int iteration = 0\n    cdef int i, j, j1, j2, jj, label\n\n    cdef double epsilon = pow(10, -10)\n\n    cdef vector[ctuple] new_labels\n    cdef ctuple tuple_ref, tuple_new\n    cdef double hash_ref, hash_new\n    cdef int label_ref, label_new\n\n    cdef bint has_changed = True\n\n    while iteration < max_iter and has_changed:\n        new_labels.clear()\n        has_changed = False\n\n        for i in range(n):\n            hash_ref = 0\n            j1 = indptr[i]\n            j2 = indptr[i + 1]\n\n            for jj in range(j1, j2):\n                j = indices[jj]\n                hash_ref += powers[labels[j]]\n\n            new_labels.push_back((labels[i], hash_ref, i))             # <<<<<<<<<<<<<<\n        csort(new_labels.begin(), new_labels.end(), is_lower)\n        label = 0\n        tuple_new = new_labels[0]\n        labels[tuple_new[2]] = label\n        for j in range(1, n):\n            tuple_ref = tuple_new\n            tuple_new = new_labels[j]\n            label_ref, hash_ref, _ = tuple_ref\n            label_new, hash_new, i = tuple_new\n\n            if abs(hash_new - hash_ref) > epsilon or label_new != label_ref :\n                label += 1\n\n            if labels[i] != label:\n                has_changed = True\n\n            labels[i] = label\n        iteration += 1\n\n    return labels, has_changed\n\n```\n\n\n```c++\n      /* \"sknetwork/topology/weisfeiler_lehman_core.pyx\":94\n *                 hash_ref += powers[labels[j]]\n * \n *             new_labels.push_back((labels[i], hash_ref, i))             # <<<<<<<<<<<<<<\n *         csort(new_labels.begin(), new_labels.end(), is_lower)\n *         label = 0\n*/\n      __pyx_t_6 = __pyx_v_i;\n      __pyx_t_11.f0 = (*((int *) ( /* dim=0 */ (__pyx_v_labels.data + __pyx_t_6 * __pyx_v_labels.strides[0]) )));\n      __pyx_t_11.f1 = __pyx_v_hash_ref;\n      __pyx_t_11.f2 = __pyx_v_i;\n      try {\n        __pyx_v_new_labels.push_back(__pyx_t_11);\n      } catch(...) {\n        __Pyx_CppExn2PyErr();\n        __PYX_ERR(0, 94, __pyx_L1_error)\n      }\n    }\n\n```",
            "created_at": "2025-05-12T16:52:37Z",
            "html_url": "https://github.com/cython/cython/issues/6864#issuecomment-2873291971",
            "id": 2873291971,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6864",
            "node_id": "IC_kwDOABDGAc6rQvTD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2873291971/reactions"
            },
            "updated_at": "2025-05-12T16:52:37Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2873291971",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11445360?v=4",
                "events_url": "https://api.github.com/users/mclegrand/events{/privacy}",
                "followers_url": "https://api.github.com/users/mclegrand/followers",
                "following_url": "https://api.github.com/users/mclegrand/following{/other_user}",
                "gists_url": "https://api.github.com/users/mclegrand/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mclegrand",
                "id": 11445360,
                "login": "mclegrand",
                "node_id": "MDQ6VXNlcjExNDQ1MzYw",
                "organizations_url": "https://api.github.com/users/mclegrand/orgs",
                "received_events_url": "https://api.github.com/users/mclegrand/received_events",
                "repos_url": "https://api.github.com/users/mclegrand/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mclegrand/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mclegrand/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mclegrand",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6864/comments",
    "created_at": "2025-05-12T09:19:40Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1200287?v=4",
                "events_url": "https://api.github.com/users/smoy/events{/privacy}",
                "followers_url": "https://api.github.com/users/smoy/followers",
                "following_url": "https://api.github.com/users/smoy/following{/other_user}",
                "gists_url": "https://api.github.com/users/smoy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/smoy",
                "id": 1200287,
                "login": "smoy",
                "node_id": "MDQ6VXNlcjEyMDAyODc=",
                "organizations_url": "https://api.github.com/users/smoy/orgs",
                "received_events_url": "https://api.github.com/users/smoy/received_events",
                "repos_url": "https://api.github.com/users/smoy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/smoy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/smoy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/smoy",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-13T17:39:18Z",
            "event": "subscribed",
            "id": 17640037698,
            "node_id": "SE_lADOABDGAc62KxFdzwAAAAQbbZ1C",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17640037698"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-14T14:31:21Z",
            "event": "milestoned",
            "id": 17655059930,
            "milestone": {
                "title": "3.1.1"
            },
            "node_id": "MIE_lADOABDGAc62KxFdzwAAAAQcUtXa",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17655059930"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6864/events",
    "html_url": "https://github.com/cython/cython/issues/6864",
    "id": 3056275805,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6864/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 6,
        "created_at": "2025-05-10T19:18:52Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/113",
        "id": 12872735,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/113/labels",
        "node_id": "MI_kwDOABDGAc4AxGwf",
        "number": 113,
        "open_issues": 3,
        "state": "open",
        "title": "3.1.1",
        "updated_at": "2025-05-14T14:31:21Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/113"
    },
    "node_id": "I_kwDOABDGAc62KxFd",
    "number": 6864,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6864/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6864/timeline",
    "title": "[BUG] Cython  3.1 generates (uninitialized) const variables that should not be const",
    "type": null,
    "updated_at": "2025-05-14T14:31:21Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6864",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11445360?v=4",
        "events_url": "https://api.github.com/users/mclegrand/events{/privacy}",
        "followers_url": "https://api.github.com/users/mclegrand/followers",
        "following_url": "https://api.github.com/users/mclegrand/following{/other_user}",
        "gists_url": "https://api.github.com/users/mclegrand/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mclegrand",
        "id": 11445360,
        "login": "mclegrand",
        "node_id": "MDQ6VXNlcjExNDQ1MzYw",
        "organizations_url": "https://api.github.com/users/mclegrand/orgs",
        "received_events_url": "https://api.github.com/users/mclegrand/received_events",
        "repos_url": "https://api.github.com/users/mclegrand/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mclegrand/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mclegrand/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mclegrand",
        "user_view_type": "public"
    }
}