{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nSince `gevent` doesn't have pre-built arm64 wheels we build them at install time in our application image. We started running into errors starting a few hours ago looking like this:\r\n```\r\nCollecting gevent==22.10.2\r\n  Downloading https://[REDACTED]/gevent/22.10.2/gevent-22.10.2.tar.gz (6.6 MB)\r\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.6/6.6 MB 356.1 MB/s eta 0:00:00\r\n  Installing build dependencies: started\r\n  Installing build dependencies: finished with status 'done'\r\n  Getting requirements to build wheel: started\r\n  Getting requirements to build wheel: finished with status 'error'\r\n  error: subprocess-exited-with-error\r\n  \r\n  × Getting requirements to build wheel did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [43 lines of output]\r\n      Compiling src/gevent/resolver/cares.pyx because it changed.\r\n      [1/1] Cythonizing src/gevent/resolver/cares.pyx\r\n      performance hint: src/gevent/libev/corecext.pyx:1339:0: Exception check on '_syserr_cb' will always require the GIL to be acquired.\r\n      Possible solutions:\r\n          1. Declare '_syserr_cb' as 'noexcept' if you control the definition and you're sure you don't want the function to raise exceptions.\r\n          2. Use an 'int' return type on '_syserr_cb' to allow an error code to be returned.\r\n      \r\n      Error compiling Cython file:\r\n      ------------------------------------------------------------\r\n      ...\r\n      cdef tuple integer_types\r\n      \r\n      if sys.version_info[0] >= 3:\r\n          integer_types = int,\r\n      else:\r\n          integer_types = (int, long)\r\n                                ^\r\n      ------------------------------------------------------------\r\n      \r\n      src/gevent/libev/corecext.pyx:60:26: undeclared name not builtin: long\r\n      Compiling src/gevent/libev/corecext.pyx because it changed.\r\n      [1/1] Cythonizing src/gevent/libev/corecext.pyx\r\n      Traceback (most recent call last):\r\n        File \"/code/venvs/venv/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 363, in <module>\r\n          main()\r\n        File \"/code/venvs/venv/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 345, in main\r\n          json_out['return_val'] = hook(**hook_input['kwargs'])\r\n        File \"/code/venvs/venv/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 130, in get_requires_for_build_wheel\r\n          return hook(config_settings)\r\n        File \"/tmp/pip-build-env-cmtabhyu/overlay/lib/python3.10/site-packages/setuptools/build_meta.py\", line 333, in get_requires_for_build_wheel\r\n          return self._get_build_requires(config_settings, requirements=[])\r\n        File \"/tmp/pip-build-env-cmtabhyu/overlay/lib/python3.10/site-packages/setuptools/build_meta.py\", line 303, in _get_build_requires\r\n          self.run_setup()\r\n        File \"/tmp/pip-build-env-cmtabhyu/overlay/lib/python3.10/site-packages/setuptools/build_meta.py\", line 319, in run_setup\r\n          exec(code, locals())\r\n        File \"<string>\", line 61, in <module>\r\n        File \"/tmp/pip-install-3x4wflup/gevent_b05306ac6dd147a990f5c37cc6e4ce76/_setuputils.py\", line 237, in cythonize1\r\n          new_ext = cythonize(\r\n        File \"/tmp/pip-build-env-cmtabhyu/overlay/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1109, in cythonize\r\n          cythonize_one(*args)\r\n        File \"/tmp/pip-build-env-cmtabhyu/overlay/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1256, in cythonize_one\r\n          raise CompileError(None, pyx_file)\r\n      Cython.Compiler.Errors.CompileError: src/gevent/libev/corecext.pyx\r\n      [end of output]\r\n  \r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\r\n\r\n× Getting requirements to build wheel did not run successfully.\r\n│ exit code: 1\r\n╰─> See above for output.\r\n\r\nnote: This error originates from a subprocess, and is likely not a problem with pip.\r\npip install failed!\r\n```\r\n\r\nThe above output is from a Python 3.10 venv so I'm not sure how we're ending up in else case of the branch for `sys.version_info[0] >= 3`, but we pulled the `3.1.0a1` release from our internal pypi mirror and builds started succeeding again. We also observed the same behavior on `gevent==23.7.0`.\r\n\r\n### Code to reproduce the behaviour:\r\n\r\n```shell\r\npip install 'gevent==22.10.2'\r\n# or\r\npip install 'gevent==23.7.0'\r\n```\r\n\r\n\r\n### Expected behaviour\r\n\r\nThe wheel builds and I'm able to install `gevent`\r\n\r\n### OS\r\n\r\nUbuntu Jammy (arm64)\r\n\r\n### Python version\r\n\r\n3.10.12\r\n\r\n### Cython version\r\n\r\n3.1.0a1\r\n\r\n### Additional context\r\n\r\n_No response_",
    "closed_at": "2024-11-09T07:07:12Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
        "events_url": "https://api.github.com/users/scoder/events{/privacy}",
        "followers_url": "https://api.github.com/users/scoder/followers",
        "following_url": "https://api.github.com/users/scoder/following{/other_user}",
        "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/scoder",
        "id": 491659,
        "login": "scoder",
        "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
        "organizations_url": "https://api.github.com/users/scoder/orgs",
        "received_events_url": "https://api.github.com/users/scoder/received_events",
        "repos_url": "https://api.github.com/users/scoder/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/scoder",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "This is expected. Cython 3.1 removes all Python 2.x cruft and thus doesn't know the Python 2 long type any more. Code using that type probably doesn't need it any more and should be cleaned up.\n\nHowever, Cython 3.1.0a1 is a pre-release. Pip shouldn't normally install it. Apparently, yours does by default. Might be due to your use of a PyPI mirror, as you noted.\n",
            "created_at": "2024-11-09T05:53:05Z",
            "html_url": "https://github.com/cython/cython/issues/6490#issuecomment-2466066518",
            "id": 2466066518,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6490",
            "node_id": "IC_kwDOABDGAc6S_TBW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2466066518/reactions"
            },
            "updated_at": "2024-11-09T05:53:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2466066518",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "1. It's a bit of a shame that this fails at compile-time, thus forcing everyone to get rid of their Python 2 cruft.  It could probably be left to a runtime \"failure\" (in the event that it actually does get run)\r\n2. I also get this issue (without using a PyPI mirror). I think gevent is pinned to `\"Cython >= 3.0a6\"`, so that presumably expresses that they're happy with any pre-release. That's on them rather than us though.",
            "created_at": "2024-11-09T08:47:40Z",
            "html_url": "https://github.com/cython/cython/issues/6490#issuecomment-2466122750",
            "id": 2466122750,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6490",
            "node_id": "IC_kwDOABDGAc6S_gv-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2466122750/reactions"
            },
            "updated_at": "2024-11-09T08:47:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2466122750",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> 1. It's a bit of a shame that this fails at compile-time, thus forcing everyone to get rid of their Python 2 cruft.\r\n\r\nMy expectation is that users of Cython 3.1 will *want* to get rid of the Python 2 zombies in their code, so a compile time failure would rather help in finding left-overs.\r\n\r\nI agree that it's annoying if Cython 3.1 comes in unintentionally, thus failing builds as described above. But we've openly communicated for a very long time (for years) that Cython 3.1 will remove Python 2 support, so I really think it's up to users to not blindly specify a broad dependency like \"Cython >= 3.0\" if they want to continue supporting Python 2 in their code base.",
            "created_at": "2024-11-09T09:12:08Z",
            "html_url": "https://github.com/cython/cython/issues/6490#issuecomment-2466139852",
            "id": 2466139852,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6490",
            "node_id": "IC_kwDOABDGAc6S_k7M",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2466139852/reactions"
            },
            "updated_at": "2024-11-09T09:12:08Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2466139852",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I've opened ticket https://github.com/gevent/gevent/issues/2076 for gevent.",
            "created_at": "2024-11-09T10:29:05Z",
            "html_url": "https://github.com/cython/cython/issues/6490#issuecomment-2466163291",
            "id": 2466163291,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6490",
            "node_id": "IC_kwDOABDGAc6S_qpb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2466163291/reactions"
            },
            "updated_at": "2024-11-09T10:29:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2466163291",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Makes perfect sense, I didn't realize `gevent` had advertised a pre-release version in the build deps but that definitely explains how the pre-release cython 3.1 version snuck in. Thanks for looking into it!",
            "created_at": "2024-11-12T18:09:17Z",
            "html_url": "https://github.com/cython/cython/issues/6490#issuecomment-2471236737",
            "id": 2471236737,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6490",
            "node_id": "IC_kwDOABDGAc6TTBSB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2471236737/reactions"
            },
            "updated_at": "2024-11-12T18:09:17Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2471236737",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/716896?v=4",
                "events_url": "https://api.github.com/users/e-nomem/events{/privacy}",
                "followers_url": "https://api.github.com/users/e-nomem/followers",
                "following_url": "https://api.github.com/users/e-nomem/following{/other_user}",
                "gists_url": "https://api.github.com/users/e-nomem/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/e-nomem",
                "id": 716896,
                "login": "e-nomem",
                "node_id": "MDQ6VXNlcjcxNjg5Ng==",
                "organizations_url": "https://api.github.com/users/e-nomem/orgs",
                "received_events_url": "https://api.github.com/users/e-nomem/received_events",
                "repos_url": "https://api.github.com/users/e-nomem/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/e-nomem/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/e-nomem/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/e-nomem",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6490/comments",
    "created_at": "2024-11-08T23:12:21Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-11-09T07:06:59Z",
            "event": "labeled",
            "id": 15237462009,
            "label": {
                "color": "000000",
                "name": "R: third party"
            },
            "node_id": "LE_lADOABDGAc6drL06zwAAAAOMOTf5",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/15237462009"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-11-09T07:07:13Z",
            "event": "closed",
            "id": 15237462335,
            "node_id": "CE_lADOABDGAc6drL06zwAAAAOMOTk_",
            "performed_via_github_app": null,
            "state_reason": "not_planned",
            "url": "https://api.github.com/repos/cython/cython/issues/events/15237462335"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6490/events",
    "html_url": "https://github.com/cython/cython/issues/6490",
    "id": 2645343546,
    "labels": [
        {
            "color": "000000",
            "default": false,
            "description": "",
            "id": 1840758668,
            "name": "R: third party",
            "node_id": "MDU6TGFiZWwxODQwNzU4NjY4",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20third%20party"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6490/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6drL06",
    "number": 6490,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/6490/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6490/timeline",
    "title": "[BUG] Unable to install gevent using Cython 3.1.0a1",
    "updated_at": "2024-11-12T18:09:18Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6490",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/716896?v=4",
        "events_url": "https://api.github.com/users/e-nomem/events{/privacy}",
        "followers_url": "https://api.github.com/users/e-nomem/followers",
        "following_url": "https://api.github.com/users/e-nomem/following{/other_user}",
        "gists_url": "https://api.github.com/users/e-nomem/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/e-nomem",
        "id": 716896,
        "login": "e-nomem",
        "node_id": "MDQ6VXNlcjcxNjg5Ng==",
        "organizations_url": "https://api.github.com/users/e-nomem/orgs",
        "received_events_url": "https://api.github.com/users/e-nomem/received_events",
        "repos_url": "https://api.github.com/users/e-nomem/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/e-nomem/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/e-nomem/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/e-nomem",
        "user_view_type": "public"
    }
}