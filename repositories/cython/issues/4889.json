{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "**Is your feature request related to a problem? Please describe.**\r\n\r\nOne of the places where Python and C don't quite match is that Python has (almost) unlimited-sized ints while in C ints are restricted to a fixed number of bits. This means that when reading an `int` annotation, Cython always uses a Python int even though most of the time it'd be possible to use a C int.\r\n\r\nMyPyC solves this by using a tagged pointer representation https://github.com/python/mypy/blob/master/mypyc/doc/dev-intro.md#value-representation where the same number is either used as a pointer or an (bit shifted) C int) depending on whether the rightmost bit is set.\r\nThat presumably gets a reasonable fraction of the speed of a C int, with the ability to fall back to a Python int where needed.\r\n\r\nThe implementation is in https://github.com/python/mypy/blob/master/mypyc/lib-rt/int_ops.c\r\n\r\n**Describe the solution you'd like**\r\n\r\nCython could add something similar. However, It is not completely obvious what circumstances it should be used in.\r\n* Initially it should probably be \"opt-in\" with a `cython.tagged_int` type.\r\n* We'd definitely want it to be possible for users to force a C int, or force a Python int (i.e. they shouldn't be forced into the tagged int representation)\r\n* Presumably it couldn't easily be used in `cdef public` functions\r\n* Not sure that this is completely cross-platform compatible, however it'd be easy enough to fall back to PyObjects-only on any platform where it doesn't work\r\n\r\n**Additional context**\r\nI have no immediate plans to do this",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Based on a quick factorial benchmark (with numbers picked not to overflow the tagged representation)\r\n\r\n```\r\nPure Python 3.10 1.270937615990988\r\nUntyped Cython (with Py ints) 0.8966004999965662\r\nTyped Cython with ints 0.05196648999117315\r\nMyPyC 0.6210111379914451\r\n```\r\n\r\nIt looks like the tagged representation only gets a 30% win on \"just use Cython with PyObjects\" case. So it isn't necessarily a *huge* win.",
            "created_at": "2022-07-14T09:02:54Z",
            "html_url": "https://github.com/cython/cython/issues/4889#issuecomment-1184189056",
            "id": 1184189056,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4889",
            "node_id": "IC_kwDOABDGAc5GlUqA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1184189056/reactions"
            },
            "updated_at": "2022-07-14T09:02:54Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1184189056",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4889/comments",
    "created_at": "2022-07-14T08:14:02Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4889/events",
    "html_url": "https://github.com/cython/cython/issues/4889",
    "id": 1304426719,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4889/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5Nv_jf",
    "number": 4889,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4889/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4889/timeline",
    "title": "[ENH] int tagged pointer representation",
    "updated_at": "2022-07-14T09:02:54Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4889",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
        "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
        "followers_url": "https://api.github.com/users/da-woods/followers",
        "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
        "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/da-woods",
        "id": 10536947,
        "login": "da-woods",
        "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
        "organizations_url": "https://api.github.com/users/da-woods/orgs",
        "received_events_url": "https://api.github.com/users/da-woods/received_events",
        "repos_url": "https://api.github.com/users/da-woods/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/da-woods"
    }
}