{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I have problems compiling code with the conditional `with nogil()` block. After some trial and error with the code in the [Conditional GIL Acquiring / Releasing](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html#conditional-gil-acquiring-releasing) description, I tried to imitate two cases of the test suite (`tests/run/nogil.pyx` and `tests/run/nogil_conditional.pyx`).\r\n\r\nI'm not sure about the guidelines for minimal examples here, but in order to keep the code here simple, I just put the code in a jupyter notebook.\r\n\r\n``` py\r\n%load_ext Cython\r\n\r\nimport Cython\r\nCython.__version__\r\n# '0.29.14'\r\n```\r\n\r\nFollowing function using just `notgil` compiles:\r\n``` py\r\n%%cython\r\ndef test(int x):\r\n    \"\"\"\r\n    >>> test(5)\r\n    47\r\n    >>> test(11)\r\n    53\r\n    \"\"\"\r\n    with nogil:\r\n        f(x)\r\n        x = g(x)\r\n    return x\r\n\r\n\r\ncdef void f(int x) nogil:\r\n        cdef int y\r\n        y = x + 42\r\n        g(y)\r\n\r\ncdef int g(int x) nogil:\r\n        cdef int y\r\n        y = x + 42\r\n        return y\r\n```\r\n\r\nHowever, the next test with `nogil()` does not:\r\n\r\n``` py\r\n%%cython\r\n\r\ndef test(int x):\r\n    \"\"\"\r\n    >>> test(0)\r\n    110\r\n    \"\"\"\r\n    with nogil(True):\r\n        x = f_nogil(x)\r\n        with gil(True):\r\n            x = f_gil(x)\r\n    return x\r\n```\r\nIt returns\r\n```\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\ndef test(int x):\r\n    \"\"\"\r\n    >>> test(0)\r\n    110\r\n    \"\"\"\r\n    with nogil(True):\r\n             ^\r\n------------------------------------------------------------\r\n\r\n/home/fabiobz/.cache/ipython/cython/_cython_magic_85c518a8fd9e570a122eb1e684613c64.pyx:7:14: Expected ':', found '('\r\n \r\n```\r\n\r\nAny ideas on what's going on?\r\n",
    "closed_at": "2020-01-17T14:03:49Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Looking at [changes.rst](https://github.com/cython/cython/blob/master/CHANGES.rst), this is a new feature coming in the Cython 3.0 release. I assume the online documentation is generated from the most recent git master, so is ahead of what's actually been released.\r\n\r\nIf this feature is important to you then you probably should get the absolute latest version from git. Otherwise you should wait for it to make it into a real release",
            "created_at": "2020-01-17T12:20:22Z",
            "html_url": "https://github.com/cython/cython/issues/3313#issuecomment-575604669",
            "id": 575604669,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU3NTYwNDY2OQ==",
            "updated_at": "2020-01-17T12:20:22Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/575604669",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Sorry, that should have been obvious! I should have selected \"stable\" in the menu of readthedocs, not the default \"latest\" Thanks!",
            "created_at": "2020-01-17T14:03:49Z",
            "html_url": "https://github.com/cython/cython/issues/3313#issuecomment-575638164",
            "id": 575638164,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU3NTYzODE2NA==",
            "updated_at": "2020-01-17T14:03:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/575638164",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/15156776?v=4",
                "events_url": "https://api.github.com/users/fzeiser/events{/privacy}",
                "followers_url": "https://api.github.com/users/fzeiser/followers",
                "following_url": "https://api.github.com/users/fzeiser/following{/other_user}",
                "gists_url": "https://api.github.com/users/fzeiser/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/fzeiser",
                "id": 15156776,
                "login": "fzeiser",
                "node_id": "MDQ6VXNlcjE1MTU2Nzc2",
                "organizations_url": "https://api.github.com/users/fzeiser/orgs",
                "received_events_url": "https://api.github.com/users/fzeiser/received_events",
                "repos_url": "https://api.github.com/users/fzeiser/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/fzeiser/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/fzeiser/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/fzeiser"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3313/comments",
    "created_at": "2020-01-16T17:14:03Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/15156776?v=4",
                "events_url": "https://api.github.com/users/fzeiser/events{/privacy}",
                "followers_url": "https://api.github.com/users/fzeiser/followers",
                "following_url": "https://api.github.com/users/fzeiser/following{/other_user}",
                "gists_url": "https://api.github.com/users/fzeiser/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/fzeiser",
                "id": 15156776,
                "login": "fzeiser",
                "node_id": "MDQ6VXNlcjE1MTU2Nzc2",
                "organizations_url": "https://api.github.com/users/fzeiser/orgs",
                "received_events_url": "https://api.github.com/users/fzeiser/received_events",
                "repos_url": "https://api.github.com/users/fzeiser/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/fzeiser/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/fzeiser/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/fzeiser"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-01-17T14:03:49Z",
            "event": "closed",
            "id": 2958252943,
            "node_id": "MDExOkNsb3NlZEV2ZW50Mjk1ODI1Mjk0Mw==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2958252943"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3313/events",
    "html_url": "https://github.com/cython/cython/issues/3313",
    "id": 550943887,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3313/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1NTA5NDM4ODc=",
    "number": 3313,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Conditional `with nogil` does not compile",
    "updated_at": "2020-01-17T14:03:49Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3313",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/15156776?v=4",
        "events_url": "https://api.github.com/users/fzeiser/events{/privacy}",
        "followers_url": "https://api.github.com/users/fzeiser/followers",
        "following_url": "https://api.github.com/users/fzeiser/following{/other_user}",
        "gists_url": "https://api.github.com/users/fzeiser/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/fzeiser",
        "id": 15156776,
        "login": "fzeiser",
        "node_id": "MDQ6VXNlcjE1MTU2Nzc2",
        "organizations_url": "https://api.github.com/users/fzeiser/orgs",
        "received_events_url": "https://api.github.com/users/fzeiser/received_events",
        "repos_url": "https://api.github.com/users/fzeiser/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/fzeiser/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fzeiser/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/fzeiser"
    }
}