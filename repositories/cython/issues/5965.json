{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Is your feature request related to a problem? Please describe.\n\nHello, I really liked your library and I would like to contribute something I made that could greatly assist in seeing if you are making improvements in code optimization or not. I didn't make a PR since I'm not as familiar with your code to modify it directly.\r\n\r\nWhile optimizing my pyx code, I used the html file generated by \"annotate=True\" to see the yellow lines that needed improvement. My code is long, so there were many lines to review, and for that, I compared the current result against the previous one.\r\n\r\n![q](https://github.com/cython/cython/assets/79867073/c3149676-c678-424d-b02f-51f00ca62eef)\r\n\r\nI found it cumbersome to compare line by line; I simply wanted to know if there was an improvement or not. Therefore, I added the following code snippet to help track the progress, which would tell me how much improvement was needed.\r\n\r\n![2](https://github.com/cython/cython/assets/79867073/a191ff12-7bb0-4e5b-8eb2-eb167021b991)\r\n\r\nAnd when expanded, it can give you more detail.\r\n\r\n![3](https://github.com/cython/cython/assets/79867073/98a6cca4-6758-4bca-a80f-251db5fa176c)\n\n### Describe the solution you'd like.\n\n\"I implemented the solution as follows, requiring the addition of two sections of code to the HTML file generated by \"annotate=True\":\r\n\r\nThe first change:\r\n\r\n```html\r\n<body` class=\"cython\">\r\n<p><span style=\"border-bottom: solid 1px grey;\">Generated by Cython 3.0.8</span></p>\r\n<p>\r\n    <span style=\"background-color: #FFFF00\">Yellow lines</span> hint at Python interaction.<br />\r\n    Click on a line that starts with a \"<code>+</code>\" to see the C code that Cython generated for it.\r\n</p>\r\n<details>\r\n  <!-- added lines -->\r\n  <summary id=\"total\"></summary>\r\n  <p id=\"detalle\"></p>\r\n  <!-- end of added lines -->\r\n</details>\r\n<p>Raw output: <a href=\"motores.c\">motores.c</a></p>\r\n```\r\nThe second change:\r\n\r\n```html\r\n</div>\r\n</body>\r\n  <!-- added lines -->\r\n<script>\r\n  // I need to get the classes of the <pre> elements\r\n  \r\n  var pre = document.getElementsByTagName('pre');\r\n  var score = 0;\r\n  var total = document.getElementById('total');\r\n  var detalle = document.getElementById('detalle');\r\n  // store the array in a frequency object\r\n  var frecuencia = {};\r\n\r\n  // for each element in the pre list do something\r\n  for (var i = 0; i < pre.length; i++) {\r\n    // get the class of each element\r\n    var clase = pre[i].classList[2];\r\n    // if the class does not exist in the object, create it and assign 1\r\n    if (!frecuencia[clase]) {\r\n      frecuencia[clase] = 1;\r\n    } else {\r\n      // if the class exists, add 1\r\n      frecuencia[clase] += 1;\r\n    }\r\n  }\r\n\r\n\r\n\r\n  // Convert the object into an array of [key, value] pairs\r\n  var pares = Object.entries(frecuencia);\r\n\r\n  // Sort the array by the key (ignoring the 'score-' prefix)\r\n  pares.sort((a, b) => parseInt(a[0].split('-')[1]) - parseInt(b[0].split('-')[1]));\r\n\r\n  // Create the output string\r\n  var salida = '';\r\n  for (var i = 0; i < pares.length; i++) {\r\n    salida += pares[i][0] + ': ' + pares[i][1] + '<br>';\r\n  }\r\n\r\n  // Display the output string in the paragraph\r\n  detalle.innerHTML = salida;\r\n\r\n\r\n\r\n  // I need to multiply the value of each class by its frequency\r\n  // and sum them to get the total score\r\n  for (var i = 0; i < pares.length; i++) {\r\n    score += parseInt(pares[i][0].split('-')[1]) * pares[i][1];\r\n  }\r\n  total.innerHTML = 'Lines to improve: ' + score;\r\n  </script>\r\n  <!-- added lines -->\r\n</html>\r\n```\r\n\n\n### Describe alternatives you've considered.\n\nAn additional contribution that can be made is to append the number of yellow lines at the end of the name, something like this, to see the progress one is making.\r\n\r\n![4](https://github.com/cython/cython/assets/79867073/78e81ef8-2f23-4d3c-8655-2c98948801da)\r\n\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "If we did that we'd want to be very careful with the wording: \"lines to improve\" implies that every line can or should be improved.\r\n\r\nWhat makes me uncomfortable is that it reduces things to a single metric but that metric is only a very rough proxy for execution time (which is what people actually care about). The same criticism could be levelled at the whole annotated HTML feature of course, but it isn't quite as crude as number of lines.",
            "created_at": "2024-01-30T21:52:10Z",
            "html_url": "https://github.com/cython/cython/issues/5965#issuecomment-1917956789",
            "id": 1917956789,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5965",
            "node_id": "IC_kwDOABDGAc5yUbK1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1917956789/reactions"
            },
            "updated_at": "2024-01-30T21:52:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1917956789",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "An issue with this is that the \"score\" is really just \"a number\". It's not exactly the number of C-API calls, for example. And the total number of Python (object) operations for the whole file might actually be discouraging or misleading. In your case, it's over 6000 â€“ what should a user make of that number? Most of the time, improvements are local, not global. A change of a few lines might make your code 100x faster, but might let that number decrease by just 5. Another change might make your code 20x slower (e.g. due to repeated type conversions in a loop) but then also decreases the number by 5 (due to unrelated code improvements outside of loops, for example).\r\n\r\nThere is no guarantee that a decrease in the total number of Python C-API interactions also improves the performance of your code. The yellowness of the lines is just a bunch of hints. That's why we're fairly careful to avoid high expectations with this feature. It's definitely helpful and often very helpful, but it's not as simple as \"remove yellow, be happy\". It's still an optimisation task, where the annotated HTML should be one of several tools (including profiling and benchmarking).",
            "created_at": "2024-02-11T13:55:13Z",
            "html_url": "https://github.com/cython/cython/issues/5965#issuecomment-1937761491",
            "id": 1937761491,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5965",
            "node_id": "IC_kwDOABDGAc5zf-TT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1937761491/reactions"
            },
            "updated_at": "2024-02-11T13:55:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1937761491",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5965/comments",
    "created_at": "2024-01-30T20:39:05Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-02-11T13:29:07Z",
            "event": "renamed",
            "id": 11767010041,
            "node_id": "RTE_lADOABDGAc59sJipzwAAAAK9XlL5",
            "performed_via_github_app": null,
            "rename": {
                "from": "[ENH] ",
                "to": "[ENH] Report number of Python interactions in annotated HTML"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/11767010041"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5965/events",
    "html_url": "https://github.com/cython/cython/issues/5965",
    "id": 2108725417,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5965/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc59sJip",
    "number": 5965,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5965/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5965/timeline",
    "title": "[ENH] Report number of Python interactions in annotated HTML",
    "updated_at": "2024-02-11T13:55:14Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5965",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/79867073?v=4",
        "events_url": "https://api.github.com/users/SuKuShaing/events{/privacy}",
        "followers_url": "https://api.github.com/users/SuKuShaing/followers",
        "following_url": "https://api.github.com/users/SuKuShaing/following{/other_user}",
        "gists_url": "https://api.github.com/users/SuKuShaing/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/SuKuShaing",
        "id": 79867073,
        "login": "SuKuShaing",
        "node_id": "MDQ6VXNlcjc5ODY3MDcz",
        "organizations_url": "https://api.github.com/users/SuKuShaing/orgs",
        "received_events_url": "https://api.github.com/users/SuKuShaing/received_events",
        "repos_url": "https://api.github.com/users/SuKuShaing/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/SuKuShaing/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SuKuShaing/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/SuKuShaing"
    }
}