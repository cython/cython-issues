{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nI define a python-accessible routine in a `.pyx` file that takes as input a `memoryview` of `long`.\r\n\r\nCompilation goes ok\r\n\r\nThen calling it from python with a `numpy` array of `int` raises an `Exception`\r\n\r\n\r\nThis is burried into my library, but has always worked fine till very recently.\r\nI have tests running on Github on `Linux`, `MacOS` and `Windows` for `python` `3.8`, `3.9` and `3.10`.\r\nThey have all been passing for years on this.\r\n\r\nBut this error started showing up a few weeks ago I think, so I'm assuming it's because of a new `cython` version.\r\n\r\nInterestingly, it only fails for one combination: `Windows` with `python 3.10`.\r\nPlease not that I have checked that with `python 3.11` the same pattern arises: only `windows` fails\r\n\r\n![image](https://github.com/user-attachments/assets/2bccf87c-02b2-4f57-a24f-9dfdf6def9f5)\r\n\r\nFocusing on windows only, with python 3.10, here is a comparison between the last successful run (a few weeks ago) and tis failed run, showing that only `numpy` and `Cython` have changed versions:\r\n\r\nTest environment:\r\n\r\n|       | Failed run                                                                             |  Last successful run           |\r\n| --- | --------------------------------------------------------------- |-----------------------------|\r\n|Runner | Runner version: 2.319.1                                                  | identical |\r\n| OS |  Microsoft Windows Server 2022 `10.0.20348`  Datacenter | identical |\r\n|Python| CPython (3.10.11)                                                            | identical |\r\n| numpy | numpy-2.1.1-cp310-cp310-win_amd64.whl  | numpy-2.0.1-cp310-cp310-win_amd64.whl |\r\n| Cython | Cython-3.0.11-cp310-cp310-win_amd64.whl |  Cython-3.0.10-cp310-cp310-win_amd64.whl |\r\n\r\n\r\n### Code to reproduce the behaviour:\r\n\r\nDefine a python-accesible routine with a `long` memoryview\r\n\r\n```cython\r\n\r\ndef routine(long[::1] foo=None):\r\n    return\r\n```\r\n\r\nCompile and call it with a numpy array of `int`\r\n```python\r\nimport numpy as np\r\nroutine(foo=np.asarray([1, 2, 3], dtype=int))\r\n```\r\n\r\ngives the same error with a different `dtype`\r\n```python\r\nroutine(foo=np.asarray([1, 2, 3], dtype=np.int_))\r\n```\r\n\r\n\r\n\r\n### Expected behaviour\r\n\r\nShould work without throwing exception\r\n\r\n### OS\r\n\r\nMicrosoft Windows Server 2022 10.0.20348 Datacenter\r\n\r\n### Python version\r\n\r\n3.10.11\r\n\r\n### Cython version\r\n\r\n3.0.11\r\n\r\n### Additional context\r\n\r\nMore context / details can be found [here](https://github.com/ToFuProject/tofu/issues/960)",
    "closed_at": "2024-09-05T17:59:11Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I don't think this is a Cython bug.\r\n\r\nA memoryview of type `long` is asking to view an array with the C type `long`. Exactly what `long` means is determined by your C compiler. You can query (one aspect) of this with `print(sizeof(long))`.\r\n\r\n`np.asarray(..., dtype=int)` is asking Numpy to create an array with whatever it considers an \"int\". You can query this by printing the `.dtype` attribute of the array.\r\n\r\nSince you're asking Cython to create a *view*, it can't do any type conversion here because that would create a new copy. If the types don't match then all it can do is raise an error.\r\n\r\nSo somewhere along the line either Numpy has changed or your C compiler has changed. If you want reliable types then you need to use types that specify the size (i.e. `np.int64` and `libc.stdint.int64_t`)",
            "created_at": "2024-09-05T17:59:12Z",
            "html_url": "https://github.com/cython/cython/issues/6384#issuecomment-2332332394",
            "id": 2332332394,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6384",
            "node_id": "IC_kwDOABDGAc6LBJFq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2332332394/reactions"
            },
            "updated_at": "2024-09-05T17:59:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2332332394",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6384/comments",
    "created_at": "2024-09-05T14:55:37Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/112180133?v=4",
                "events_url": "https://api.github.com/users/dvezinet/events{/privacy}",
                "followers_url": "https://api.github.com/users/dvezinet/followers",
                "following_url": "https://api.github.com/users/dvezinet/following{/other_user}",
                "gists_url": "https://api.github.com/users/dvezinet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dvezinet",
                "id": 112180133,
                "login": "dvezinet",
                "node_id": "U_kgDOBq-7pQ",
                "organizations_url": "https://api.github.com/users/dvezinet/orgs",
                "received_events_url": "https://api.github.com/users/dvezinet/received_events",
                "repos_url": "https://api.github.com/users/dvezinet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dvezinet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dvezinet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dvezinet"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-09-05T15:12:43Z",
            "event": "renamed",
            "id": 14149096278,
            "node_id": "RTE_lADOABDGAc6VfaHKzwAAAANLWhNW",
            "performed_via_github_app": null,
            "rename": {
                "from": "[BUG] numpy int dtype vs long type raising Exception",
                "to": "[BUG] numpy `int` dtype vs `long` type raises Exception"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/14149096278"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-09-05T17:59:12Z",
            "event": "closed",
            "id": 14151166291,
            "node_id": "CE_lADOABDGAc6VfaHKzwAAAANLealT",
            "performed_via_github_app": null,
            "state_reason": "not_planned",
            "url": "https://api.github.com/repos/cython/cython/issues/events/14151166291"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-09-05T18:37:21Z",
            "event": "labeled",
            "id": 14151570908,
            "label": {
                "color": "000000",
                "name": "R: third party"
            },
            "node_id": "LE_lADOABDGAc6VfaHKzwAAAANLf9Xc",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/14151570908"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6384/events",
    "html_url": "https://github.com/cython/cython/issues/6384",
    "id": 2508038602,
    "labels": [
        {
            "color": "000000",
            "default": false,
            "description": "",
            "id": 1840758668,
            "name": "R: third party",
            "node_id": "MDU6TGFiZWwxODQwNzU4NjY4",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20third%20party"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6384/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6VfaHK",
    "number": 6384,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 1,
        "total_count": 1,
        "url": "https://api.github.com/repos/cython/cython/issues/6384/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6384/timeline",
    "title": "[BUG] numpy `int` dtype vs `long` type raises Exception",
    "updated_at": "2024-09-05T18:37:21Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6384",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/112180133?v=4",
        "events_url": "https://api.github.com/users/dvezinet/events{/privacy}",
        "followers_url": "https://api.github.com/users/dvezinet/followers",
        "following_url": "https://api.github.com/users/dvezinet/following{/other_user}",
        "gists_url": "https://api.github.com/users/dvezinet/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/dvezinet",
        "id": 112180133,
        "login": "dvezinet",
        "node_id": "U_kgDOBq-7pQ",
        "organizations_url": "https://api.github.com/users/dvezinet/orgs",
        "received_events_url": "https://api.github.com/users/dvezinet/received_events",
        "repos_url": "https://api.github.com/users/dvezinet/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/dvezinet/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dvezinet/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/dvezinet"
    }
}