{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\n\nYou can declare a memory view from a fused type in cython syntax, but not in the pure python syntax.\r\n\r\nThis happens only in 0.29.x, not in 3.0.x, but since 3.0 is still in alpha our project depends on 0.29 and we find this issue.\n\n### Code to reproduce the behaviour:\n\n```cython\r\nimport cython\r\n    \r\ndef test_cython_syntax(cython.floating[:] a):\r\n    return a\r\n\r\ndef test_python_syntax(a: cython.floating[:]):\r\n    return a\r\n```\r\n\r\nThe `test_cython_syntax` function compiles without problems, while the `test_python_syntax` returns:\r\n\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nimport cython\r\n    \r\ndef test_cython_syntax(cython.floating[:] a):\r\n    return a\r\n\r\ndef test_python_syntax(a: cython.floating[:]):\r\n^\r\n------------------------------------------------------------\r\n\r\n/home/pfebrer/.cache/ipython/cython/_cython_magic_9d885c7c7007c8fdab3ab0aee360f02f.pyx:6:0: Compiler crash in AnalyseExpressionsTransform\r\n\r\nFile 'Nodes.py', line 435, in analyse_expressions: StatListNode(_cython_magic_9d885c7c7007c8fdab3ab0aee360f02f.pyx:1:0)\r\nFile 'Nodes.py', line 435, in analyse_expressions: StatListNode(_cython_magic_9d885c7c7007c8fdab3ab0aee360f02f.pyx:6:0)\r\nFile 'Nodes.py', line 3145, in analyse_expressions: DefNode(_cython_magic_9d885c7c7007c8fdab3ab0aee360f02f.pyx:6:0,\r\n    modifiers = [...]/0,\r\n    name = 'test_python_syntax',\r\n    np_args_idx = [...]/0,\r\n    num_required_args = 1,\r\n    outer_attrs = [...]/2,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0',\r\n    used = True)\r\nFile 'Nodes.py', line 3291, in prepare_argument_coercion: DefNodeWrapper(_cython_magic_9d885c7c7007c8fdab3ab0aee360f02f.pyx:6:0,\r\n    args = [...]/1,\r\n    modifiers = [...]/0,\r\n    name = 'test_python_syntax',\r\n    np_args_idx = [...]/0,\r\n    num_required_args = 1)\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"/home/pfebrer/miniconda3/envs/simulations/lib/python3.8/site-packages/Cython/Compiler/Nodes.py\", line 3291, in prepare_argument_coercion\r\n    if not arg.type.create_from_py_utility_code(env):\r\n  File \"/home/pfebrer/miniconda3/envs/simulations/lib/python3.8/site-packages/Cython/Compiler/PyrexTypes.py\", line 903, in create_from_py_utility_code\r\n    suffix = self.specialization_suffix()\r\n  File \"/home/pfebrer/miniconda3/envs/simulations/lib/python3.8/site-packages/Cython/Compiler/PyrexTypes.py\", line 873, in specialization_suffix\r\n    return \"%s_%s\" % (self.axes_to_name(), self.dtype_name)\r\nAttributeError: 'MemoryViewSliceType' object has no attribute 'dtype_name'\r\n```\r\n\n\n### Expected behaviour\n\nBoth should compile the same.\n\n### Environment\n\nOS: Linux\r\nPython version [e.g. 3.8.12]\r\nCython version [e.g. 0.29.32]\r\n\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I think we're unlikely to backport this. Quite a bit has changed with annotations between 0.29.x and 3.0alpha so it's increasingly hard to backport anything cleanly, and I can't even find where this was fixed based on a quick search github search (I'm sure git bisect would reveal it though).\r\n\r\nWe're generally reluctant to backport too much from Cython 3 alpha unless we're very confident of it (or unless it fixes something very serious). If we backport too much then it effectively becomes 0.29.x alpha...\r\n\r\n",
            "created_at": "2022-10-13T17:03:35Z",
            "html_url": "https://github.com/cython/cython/issues/5085#issuecomment-1277920200",
            "id": 1277920200,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5085",
            "node_id": "IC_kwDOABDGAc5MK4PI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1277920200/reactions"
            },
            "updated_at": "2022-10-13T17:03:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1277920200",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Oh ok, I understand. Thanks for the answer!",
            "created_at": "2022-10-13T18:36:57Z",
            "html_url": "https://github.com/cython/cython/issues/5085#issuecomment-1278026508",
            "id": 1278026508,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5085",
            "node_id": "IC_kwDOABDGAc5MLSMM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1278026508/reactions"
            },
            "updated_at": "2022-10-13T18:36:57Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1278026508",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42074085?v=4",
                "events_url": "https://api.github.com/users/pfebrer/events{/privacy}",
                "followers_url": "https://api.github.com/users/pfebrer/followers",
                "following_url": "https://api.github.com/users/pfebrer/following{/other_user}",
                "gists_url": "https://api.github.com/users/pfebrer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/pfebrer",
                "id": 42074085,
                "login": "pfebrer",
                "node_id": "MDQ6VXNlcjQyMDc0MDg1",
                "organizations_url": "https://api.github.com/users/pfebrer/orgs",
                "received_events_url": "https://api.github.com/users/pfebrer/received_events",
                "repos_url": "https://api.github.com/users/pfebrer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/pfebrer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pfebrer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/pfebrer"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5085/comments",
    "created_at": "2022-10-13T09:04:53Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5085/events",
    "html_url": "https://github.com/cython/cython/issues/5085",
    "id": 1407422739,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5085/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5T45ET",
    "number": 5085,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5085/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5085/timeline",
    "title": "[BUG] Fused type memory views don't work in pure python syntax for 0.29.x",
    "updated_at": "2022-10-13T18:36:58Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5085",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/42074085?v=4",
        "events_url": "https://api.github.com/users/pfebrer/events{/privacy}",
        "followers_url": "https://api.github.com/users/pfebrer/followers",
        "following_url": "https://api.github.com/users/pfebrer/following{/other_user}",
        "gists_url": "https://api.github.com/users/pfebrer/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/pfebrer",
        "id": 42074085,
        "login": "pfebrer",
        "node_id": "MDQ6VXNlcjQyMDc0MDg1",
        "organizations_url": "https://api.github.com/users/pfebrer/orgs",
        "received_events_url": "https://api.github.com/users/pfebrer/received_events",
        "repos_url": "https://api.github.com/users/pfebrer/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/pfebrer/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pfebrer/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/pfebrer"
    }
}