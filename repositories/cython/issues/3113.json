{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "Trying to install scipy master with the current cython master (00c1dc96a) results in errors that look like:\r\n\r\n```\r\n(syspy) ✔  ~/source/other_source/scipy [master {origin/master}|✚ 1]\r\njupiter@00:01  ➤  pip install -v .\r\nCreated temporary directory: /tmp/pip-ephem-wheel-cache-v8igo31t\r\nCreated temporary directory: /tmp/pip-req-tracker-sdh92sme\r\nCreated requirements tracker '/tmp/pip-req-tracker-sdh92sme'\r\nCreated temporary directory: /tmp/pip-install-znwt6o5y\r\nProcessing /home/tcaswell/source/other_source/scipy\r\n  Created temporary directory: /tmp/pip-req-build-p5nr1lu0\r\n  Added file:///home/tcaswell/source/other_source/scipy to build tracker '/tmp/pip-req-tracker-sdh92sme'\r\n    Running setup.py (path:/tmp/pip-req-build-p5nr1lu0/setup.py) egg_info for package from file:///home/tcaswell/source/other_source/scipy\r\n    Running command python setup.py egg_info\r\n    running egg_info\r\n    creating pip-egg-info/scipy.egg-info\r\n    writing pip-egg-info/scipy.egg-info/PKG-INFO\r\n    writing dependency_links to pip-egg-info/scipy.egg-info/dependency_links.txt\r\n    writing top-level names to pip-egg-info/scipy.egg-info/top_level.txt\r\n    writing manifest file 'pip-egg-info/scipy.egg-info/SOURCES.txt'\r\n    reading manifest file 'pip-egg-info/scipy.egg-info/SOURCES.txt'\r\n    reading manifest template 'MANIFEST.in'\r\n    warning: no files found matching 'pyproject.toml'\r\n    warning: no files found matching 'cythonize.dat'\r\n    warning: no previously-included files matching '*_subr_*.f' found under directory 'scipy/linalg/src/id_dist/src'\r\n    no previously-included directories found matching 'benchmarks/env'\r\n    no previously-included directories found matching 'benchmarks/results'\r\n    no previously-included directories found matching 'benchmarks/html'\r\n    no previously-included directories found matching 'benchmarks/scipy'\r\n    no previously-included directories found matching 'doc/build'\r\n    no previously-included directories found matching 'doc/source/generated'\r\n    no previously-included directories found matching '*/__pycache__'\r\n    warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n    warning: no previously-included files matching '*~' found anywhere in distribution\r\n    warning: no previously-included files matching '*.bak' found anywhere in distribution\r\n    warning: no previously-included files matching '*.swp' found anywhere in distribution\r\n    warning: no previously-included files matching '*.pyo' found anywhere in distribution\r\n    writing manifest file 'pip-egg-info/scipy.egg-info/SOURCES.txt'\r\n  Source in /tmp/pip-req-build-p5nr1lu0 has version 1.4.0.dev0+d3fb55c, which satisfies requirement scipy==1.4.0.dev0+d3fb55c from file:///home/tcaswell/source/other_source/scipy\r\n  Removed scipy==1.4.0.dev0+d3fb55c from file:///home/tcaswell/source/other_source/scipy from build tracker '/tmp/pip-req-tracker-sdh92sme'\r\nInstalling collected packages: scipy\r\n  Created temporary directory: /tmp/pip-record-d0stn8dj\r\n  Running setup.py install for scipy ...     Running command /tmp/syspy/bin/python -u -c \"import setuptools, tokenize;__file__='/tmp/pip-req-build-p5nr1lu0/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /tmp/pip-record-d0stn8dj/install-record.txt --single-version-externally-managed --compile --install-headers /tmp/syspy/include/site/python3.7/scipy\r\n\r\n    Note: if you need reliable uninstall behavior, then install\r\n    with pip instead of using `setup.py install`:\r\n\r\n      - `pip install .`       (from a git repo or downloaded source\r\n                               release)\r\n      - `pip install scipy`   (last SciPy release on PyPI)\r\n\r\n\r\n    Cythonizing sources\r\n    Running scipy/special/_generate_pyx.py\r\n    Running scipy/linalg/_generate_pyx.py\r\n    Processing scipy/ndimage/src/_ni_label.pyx\r\n    Processing scipy/ndimage/src/_cytest.pyx\r\n    Processing scipy/signal/_max_len_seq_inner.pyx\r\n    Processing scipy/signal/_upfirdn_apply.pyx\r\n    Processing scipy/signal/_peak_finding_utils.pyx\r\n    Processing scipy/signal/_spectral.pyx\r\n    Processing scipy/optimize/_group_columns.pyx\r\n    Processing scipy/optimize/_bglu_dense.pyx\r\n    Processing scipy/optimize/_lsq/givens_elimination.pyx\r\n    Processing scipy/optimize/_trlib/_trlib.pyx\r\n\r\n    Error compiling Cython file:\r\n    ------------------------------------------------------------\r\n    ...\r\n        iti = <PyArrayIterObject *> _iti\r\n        itstruct = <PyArrayIterObject *> _itstruct\r\n\r\n        # we only process this many neighbors from the itstruct iterator before\r\n        # reaching the center, where we stop\r\n        num_neighbors = (structure.size / 3) // 2\r\n                                       ^\r\n    ------------------------------------------------------------\r\n\r\n    _ni_label.pyx:274:36: Compiler crash in AnalyseExpressionsTransform\r\n\r\n    ModuleNode.body = StatListNode(_ni_label.pyx:6:0)\r\n    StatListNode.stats[21] = StatListNode(_ni_label.pyx:204:6)\r\n    StatListNode.stats[0] = CFuncDefNode(_ni_label.pyx:204:6,\r\n        args = [...]/3,\r\n        modifiers = [...]/0,\r\n        outer_attrs = [...]/1,\r\n        overridable = 1,\r\n        visibility = 'private')\r\n    File 'Nodes.py', line 437, in analyse_expressions: StatListNode(_ni_label.pyx:210:4,\r\n        is_terminator = True)\r\n    File 'Nodes.py', line 437, in analyse_expressions: StatListNode(_ni_label.pyx:274:41)\r\n    File 'Nodes.py', line 5319, in analyse_expressions: SingleAssignmentNode(_ni_label.pyx:274:41)\r\n    File 'Nodes.py', line 5439, in analyse_types: SingleAssignmentNode(_ni_label.pyx:274:41)\r\n    File 'ExprNodes.py', line 10992, in analyse_types: DivNode(_ni_label.pyx:274:41,\r\n        infix = True,\r\n        operator = '//',\r\n        result_is_used = True,\r\n        use_managed_ref = True)\r\n    File 'ExprNodes.py', line 10994, in analyse_types: DivNode(_ni_label.pyx:274:36,\r\n        ctruedivision = True,\r\n        infix = True,\r\n        operator = '/',\r\n        result_is_used = True,\r\n        truedivision = True,\r\n        use_managed_ref = True)\r\n    File 'ExprNodes.py', line 11485, in analyse_operation: DivNode(_ni_label.pyx:274:36,\r\n        ctruedivision = True,\r\n        infix = True,\r\n        operator = '/',\r\n        result_is_used = True,\r\n        truedivision = True,\r\n        use_managed_ref = True)\r\n    File 'ExprNodes.py', line 11012, in analyse_operation: DivNode(_ni_label.pyx:274:36,\r\n        ctruedivision = True,\r\n        infix = True,\r\n        operator = '/',\r\n        result_is_used = True,\r\n        truedivision = True,\r\n        use_managed_ref = True)\r\n    File 'ExprNodes.py', line 11193, in analyse_c_operation: DivNode(_ni_label.pyx:274:36,\r\n        ctruedivision = True,\r\n        infix = True,\r\n        operator = '/',\r\n        result_is_used = True,\r\n        truedivision = True,\r\n        use_managed_ref = True)\r\n    File 'ExprNodes.py', line 11501, in compute_c_result_type: DivNode(_ni_label.pyx:274:36,\r\n        ctruedivision = True,\r\n        infix = True,\r\n        operator = '/',\r\n        result_is_used = True,\r\n        truedivision = True,\r\n        use_managed_ref = True)\r\n\r\n    Compiler crash traceback from this point on:\r\n      File \"/tmp/syspy/lib/python3.7/site-packages/Cython/Compiler/ExprNodes.py\", line 11501, in compute_c_result_type\r\n        widest_type = PyrexTypes.widest_numeric_type(type1, PyrexTypes.c_double_type)\r\n      File \"/tmp/syspy/lib/python3.7/site-packages/Cython/Compiler/PyrexTypes.py\", line 4500, in widest_numeric_type\r\n        elif type1.rank < type2.rank:\r\n    AttributeError: 'CFuncType' object has no attribute 'rank'\r\n    Processing scipy/optimize/cython_optimize/_zeros.pyx.in\r\n    Traceback (most recent call last):\r\n      File \"/tmp/pip-req-build-p5nr1lu0/tools/cythonize.py\", line 307, in <module>\r\n        main()\r\n      File \"/tmp/pip-req-build-p5nr1lu0/tools/cythonize.py\", line 303, in main\r\n        find_process_files(root_dir)\r\n      File \"/tmp/pip-req-build-p5nr1lu0/tools/cythonize.py\", line 292, in find_process_files\r\n        for result in pool.imap_unordered(lambda args: process(*args), jobs):\r\n      File \"/usr/lib/python3.7/multiprocessing/pool.py\", line 748, in next\r\n        raise value\r\n      File \"/usr/lib/python3.7/multiprocessing/pool.py\", line 121, in worker\r\n        result = (True, func(*args, **kwds))\r\n      File \"/tmp/pip-req-build-p5nr1lu0/tools/cythonize.py\", line 292, in <lambda>\r\n        for result in pool.imap_unordered(lambda args: process(*args), jobs):\r\n      File \"/tmp/pip-req-build-p5nr1lu0/tools/cythonize.py\", line 231, in process\r\n        processor_function(fromfile, tofile, cwd=path)\r\n      File \"/tmp/pip-req-build-p5nr1lu0/tools/cythonize.py\", line 96, in process_pyx\r\n        raise Exception('Cython failed')\r\n    Exception: Cython failed\r\n    Traceback (most recent call last):\r\n      File \"<string>\", line 1, in <module>\r\n      File \"/tmp/pip-req-build-p5nr1lu0/setup.py\", line 540, in <module>\r\n        setup_package()\r\n      File \"/tmp/pip-req-build-p5nr1lu0/setup.py\", line 524, in setup_package\r\n        generate_cython()\r\n      File \"/tmp/pip-req-build-p5nr1lu0/setup.py\", line 292, in generate_cython\r\n        raise RuntimeError(\"Running cythonize failed!\")\r\n    RuntimeError: Running cythonize failed!\r\nerror\r\nCleaning up...\r\n  Removing source in /tmp/pip-req-build-p5nr1lu0\r\nRemoved build tracker '/tmp/pip-req-tracker-sdh92sme'\r\nCommand \"/tmp/syspy/bin/python -u -c \"import setuptools, tokenize;__file__='/tmp/pip-req-build-p5nr1lu0/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /tmp/pip-record-d0stn8dj/install-record.txt --single-version-externally-managed --compile --install-headers /tmp/syspy/include/site/python3.7/scipy\" failed with error code 1 in /tmp/pip-req-build-p5nr1lu0/\r\nException information:\r\nTraceback (most recent call last):\r\n  File \"/tmp/syspy/lib/python3.7/site-packages/pip/_internal/cli/base_command.py\", line 179, in main\r\n    status = self.run(options, args)\r\n  File \"/tmp/syspy/lib/python3.7/site-packages/pip/_internal/commands/install.py\", line 393, in run\r\n    use_user_site=options.use_user_site,\r\n  File \"/tmp/syspy/lib/python3.7/site-packages/pip/_internal/req/__init__.py\", line 57, in install_given_reqs\r\n    **kwargs\r\n  File \"/tmp/syspy/lib/python3.7/site-packages/pip/_internal/req/req_install.py\", line 945, in install\r\n    spinner=spinner,\r\n  File \"/tmp/syspy/lib/python3.7/site-packages/pip/_internal/utils/misc.py\", line 761, in call_subprocess\r\n    % (command_desc, proc.returncode, cwd))\r\npip._internal.exceptions.InstallationError: Command \"/tmp/syspy/bin/python -u -c \"import setuptools, tokenize;__file__='/tmp/pip-req-build-p5nr1lu0/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /tmp/pip-record-d0stn8dj/install-record.txt --single-version-externally-managed --compile --install-headers /tmp/syspy/include/site/python3.7/scipy\" failed with error code 1 in /tmp/pip-req-build-p5nr1lu0/\r\n\r\n\r\n```\r\n\r\nThis bisects back to 306285235 which is the merge commit in #3095 \r\n\r\n<details>\r\n\r\n## Bisect log\r\n\r\n```\r\n# bad: [00c1dc96af0e44741dc777f96a2eb5769f572bb3] Utility/CppConvert: fix Cython warning (GH-3108)\r\n# good: [d4610f39a43a658cee1862c899a9696d8a9c9f5f] Prepare release of 0.29.13.\r\ngit bisect start 'master' '0.29.13'\r\n# good: [e3252209a60733850557cd22c46b96f1aa8574c4] Remove unused import.\r\ngit bisect good e3252209a60733850557cd22c46b96f1aa8574c4\r\n# good: [b330b6854bcfdd02f95ea21ece430d348b665aa4] Call \".tp_repr()\" instead of \".tp_str()\" when formatting builtin types, since it avoids an indirection in Py3.8.\r\ngit bisect good b330b6854bcfdd02f95ea21ece430d348b665aa4\r\n# good: [82a0ed43b31f0ad263256d2725d762ee82cd2179] Include: cpython.pystate: Make PyGILState_STATE definition usable (GH-2997)\r\ngit bisect good 82a0ed43b31f0ad263256d2725d762ee82cd2179\r\n# good: [8cf109c0f19ad8c36b8a5368d138912495963387] Fix PY_HEX_VERSION -> PY_VERSION_HEX (GH-3071)\r\ngit bisect good 8cf109c0f19ad8c36b8a5368d138912495963387\r\n# good: [2001612cfe4ac4f89c071da41839b2e2d0ac1a41] Update lexicon from latest CPython 3.8.\r\ngit bisect good 2001612cfe4ac4f89c071da41839b2e2d0ac1a41\r\n# bad: [5cfa3bd4d68d0b0e7451ca513eec90f64528af18] Use METH_FASTCALL on CPython >= 3.7 (GH-3021)\r\ngit bisect bad 5cfa3bd4d68d0b0e7451ca513eec90f64528af18\r\n# good: [4e02338e8c282b30d42564c52c4fba6de69ed984] Add an assertion for the assumption that all identifier start characters are also valid continuation characters, so that we notice it if that ever changes.\r\ngit bisect good 4e02338e8c282b30d42564c52c4fba6de69ed984\r\n# good: [3ac72f5ff9388bbd952e8764ecaad230fcd03991] Always enable C line in traceback for tests (GH-3098)\r\ngit bisect good 3ac72f5ff9388bbd952e8764ecaad230fcd03991\r\n# bad: [306285235bdc8a17ed291104e96ba7b3ceb54806] Support wider use of @property decorator on CClassDef AttributeNodes (GH-3095)\r\ngit bisect bad 306285235bdc8a17ed291104e96ba7b3ceb54806\r\n# good: [2ffd5060f5a008684728dfc0574f57e422fda42d] __Pyx_GetNameInClass() should get raw attribute from __dict__ (GH-3100)\r\ngit bisect good 2ffd5060f5a008684728dfc0574f57e422fda42d\r\n# first bad commit: [306285235bdc8a17ed291104e96ba7b3ceb54806] Support wider use of @property decorator on CClassDef AttributeNodes (GH-3095)\r\n```\r\n\r\n## bisect script\r\n\r\n```sh\r\npip uninstall cython --yes\r\ngit clean -xfd\r\npip install .\r\nretVal=$?\r\nif [ $retVal -ne 0 ]; then\r\n    exit 125\r\nfi\r\npushd ../scipy\r\ngit clean -xfd\r\npython tools/cythonize.py scipy\r\n\r\n```\r\n</details>\r\n\r\n[edit, sorry for the terrible first version, hit ctl-enter by accident]",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the heads-up, sorry for the breakage. I am working on a fix. \r\n\r\nThe root problem is that `structure.size` is currently converted to `PyLong_FromLong(getattr(structure, 'size')` using equivalent C-API calls, when it should become `PyArray_SIZE(structure)` in pure C, never needing to call the C-API. \r\n\r\nBottom line: when it is fixed, the new code should use fewer C-API calls than the old.",
            "created_at": "2019-08-29T12:30:36Z",
            "html_url": "https://github.com/cython/cython/issues/3113#issuecomment-526163200",
            "id": 526163200,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3113",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjE2MzIwMA==",
            "updated_at": "2019-08-29T12:30:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/526163200",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/823911?v=4",
                "events_url": "https://api.github.com/users/mattip/events{/privacy}",
                "followers_url": "https://api.github.com/users/mattip/followers",
                "following_url": "https://api.github.com/users/mattip/following{/other_user}",
                "gists_url": "https://api.github.com/users/mattip/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mattip",
                "id": 823911,
                "login": "mattip",
                "node_id": "MDQ6VXNlcjgyMzkxMQ==",
                "organizations_url": "https://api.github.com/users/mattip/orgs",
                "received_events_url": "https://api.github.com/users/mattip/received_events",
                "repos_url": "https://api.github.com/users/mattip/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mattip/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mattip/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mattip"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3113/comments",
    "created_at": "2019-08-29T03:57:45Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/41183423?v=4",
                "events_url": "https://api.github.com/users/Property/events{/privacy}",
                "followers_url": "https://api.github.com/users/Property/followers",
                "following_url": "https://api.github.com/users/Property/following{/other_user}",
                "gists_url": "https://api.github.com/users/Property/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Property",
                "id": 41183423,
                "login": "Property",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjQxMTgzNDIz",
                "organizations_url": "https://api.github.com/users/Property/orgs",
                "received_events_url": "https://api.github.com/users/Property/received_events",
                "repos_url": "https://api.github.com/users/Property/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Property/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Property/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/Property"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-29T03:57:45Z",
            "event": "mentioned",
            "id": 2592579521,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjU5MjU3OTUyMQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2592579521"
        },
        {
            "actor": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/41183423?v=4",
                "events_url": "https://api.github.com/users/Property/events{/privacy}",
                "followers_url": "https://api.github.com/users/Property/followers",
                "following_url": "https://api.github.com/users/Property/following{/other_user}",
                "gists_url": "https://api.github.com/users/Property/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Property",
                "id": 41183423,
                "login": "Property",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjQxMTgzNDIz",
                "organizations_url": "https://api.github.com/users/Property/orgs",
                "received_events_url": "https://api.github.com/users/Property/received_events",
                "repos_url": "https://api.github.com/users/Property/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Property/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Property/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/Property"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-29T04:04:04Z",
            "event": "unsubscribed",
            "id": 2592587943,
            "node_id": "MDE3OlVuc3Vic2NyaWJlZEV2ZW50MjU5MjU4Nzk0Mw==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2592587943"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3113/events",
    "html_url": "https://github.com/cython/cython/issues/3113",
    "id": 486722786,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3113/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0ODY3MjI3ODY=",
    "number": 3113,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "cythonizing scipy master broken on cython master",
    "updated_at": "2019-08-29T12:30:36Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3113",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/199813?v=4",
        "events_url": "https://api.github.com/users/tacaswell/events{/privacy}",
        "followers_url": "https://api.github.com/users/tacaswell/followers",
        "following_url": "https://api.github.com/users/tacaswell/following{/other_user}",
        "gists_url": "https://api.github.com/users/tacaswell/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tacaswell",
        "id": 199813,
        "login": "tacaswell",
        "node_id": "MDQ6VXNlcjE5OTgxMw==",
        "organizations_url": "https://api.github.com/users/tacaswell/orgs",
        "received_events_url": "https://api.github.com/users/tacaswell/received_events",
        "repos_url": "https://api.github.com/users/tacaswell/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tacaswell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tacaswell/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tacaswell"
    }
}