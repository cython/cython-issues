{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "When trying to compile the following code with Cython, I get the error message below.\r\n\r\n```cython\r\ncdef void func() nogil: \r\n    cdef int[4] a = [0, 1, 2, 3]\r\n```\r\n\r\n```cython\r\n/Users/jkirkham/miniconda/envs/cython/lib/python3.7/site-packages/Cython/Compiler/Main.py:369: FutureWarning: Cython directive 'language_level' not set, using 2 for now (Py2). This will change in a later release! File: /Users/jkirkham/test.pyx\r\n  tree = Parsing.p_module(s, pxd, full_module_name)\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\ncdef void func() nogil: \r\n    cdef int[4] a = [0, 1, 2, 3]\r\n        ^\r\n------------------------------------------------------------\r\n\r\ntest.pyx:2:9: Slicing Python object not allowed without gil\r\n```\r\n\r\nDropping the `nogil` makes the error go away. However the C code generated looks something like this and as such doesn't appear to be using the GIL.\r\n\r\n```c\r\nstatic void __pyx_f_4test_func(void) {\r\n  ...\r\n\r\n  int __pyx_t_1[4];\r\n\r\n  __pyx_t_1[0] = 0;\r\n  __pyx_t_1[1] = 1;\r\n  __pyx_t_1[2] = 2;\r\n  __pyx_t_1[3] = 3;\r\n\r\n  ...\r\n}\r\n```",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Also if I write the code like so, it appears I've run into issue ( https://github.com/cython/cython/issues/1662 ).\r\n\r\n```cython\r\ncdef void func() nogil: \r\n    cdef int[4] a\r\n    a[:] = [0, 1, 2, 3]\r\n```",
            "created_at": "2019-10-01T17:03:33Z",
            "html_url": "https://github.com/cython/cython/issues/3160#issuecomment-537131223",
            "id": 537131223,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3160",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzEzMTIyMw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/537131223/reactions"
            },
            "updated_at": "2019-10-01T17:03:33Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/537131223",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
                "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
                "followers_url": "https://api.github.com/users/jakirkham/followers",
                "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
                "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jakirkham",
                "id": 3019665,
                "login": "jakirkham",
                "node_id": "MDQ6VXNlcjMwMTk2NjU=",
                "organizations_url": "https://api.github.com/users/jakirkham/orgs",
                "received_events_url": "https://api.github.com/users/jakirkham/received_events",
                "repos_url": "https://api.github.com/users/jakirkham/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jakirkham"
            }
        },
        {
            "author_association": "NONE",
            "body": "Same issue I encounter right now.",
            "created_at": "2021-11-26T13:02:06Z",
            "html_url": "https://github.com/cython/cython/issues/3160#issuecomment-979962626",
            "id": 979962626,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3160",
            "node_id": "IC_kwDOABDGAc46aQsC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/979962626/reactions"
            },
            "updated_at": "2021-11-26T13:02:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/979962626",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/83074678?v=4",
                "events_url": "https://api.github.com/users/krawq/events{/privacy}",
                "followers_url": "https://api.github.com/users/krawq/followers",
                "following_url": "https://api.github.com/users/krawq/following{/other_user}",
                "gists_url": "https://api.github.com/users/krawq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krawq",
                "id": 83074678,
                "login": "krawq",
                "node_id": "MDQ6VXNlcjgzMDc0Njc4",
                "organizations_url": "https://api.github.com/users/krawq/orgs",
                "received_events_url": "https://api.github.com/users/krawq/received_events",
                "repos_url": "https://api.github.com/users/krawq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krawq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krawq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krawq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Looks like the GIL check in `SliceIndexNode` is too broad and does not detect the \"simple\" cases that work without GIL.\r\nPR welcome.",
            "created_at": "2021-11-26T13:24:08Z",
            "html_url": "https://github.com/cython/cython/issues/3160#issuecomment-979976131",
            "id": 979976131,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3160",
            "node_id": "IC_kwDOABDGAc46aT_D",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/979976131/reactions"
            },
            "updated_at": "2021-11-26T13:24:08Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/979976131",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I had quick look at ExprNode.py but I wouldn't know where to start, Im not familiar at all with the Cython code base.",
            "created_at": "2021-11-27T14:14:53Z",
            "html_url": "https://github.com/cython/cython/issues/3160#issuecomment-980634648",
            "id": 980634648,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3160",
            "node_id": "IC_kwDOABDGAc46c0wY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/980634648/reactions"
            },
            "updated_at": "2021-11-27T14:14:53Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/980634648",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/83074678?v=4",
                "events_url": "https://api.github.com/users/krawq/events{/privacy}",
                "followers_url": "https://api.github.com/users/krawq/followers",
                "following_url": "https://api.github.com/users/krawq/following{/other_user}",
                "gists_url": "https://api.github.com/users/krawq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krawq",
                "id": 83074678,
                "login": "krawq",
                "node_id": "MDQ6VXNlcjgzMDc0Njc4",
                "organizations_url": "https://api.github.com/users/krawq/orgs",
                "received_events_url": "https://api.github.com/users/krawq/received_events",
                "repos_url": "https://api.github.com/users/krawq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krawq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krawq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krawq"
            }
        },
        {
            "author_association": "NONE",
            "body": "any fix to this? ",
            "created_at": "2022-11-19T22:19:19Z",
            "html_url": "https://github.com/cython/cython/issues/3160#issuecomment-1320981593",
            "id": 1320981593,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3160",
            "node_id": "IC_kwDOABDGAc5OvJRZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1320981593/reactions"
            },
            "updated_at": "2022-11-19T22:19:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1320981593",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/60490377?v=4",
                "events_url": "https://api.github.com/users/HeeebsInc/events{/privacy}",
                "followers_url": "https://api.github.com/users/HeeebsInc/followers",
                "following_url": "https://api.github.com/users/HeeebsInc/following{/other_user}",
                "gists_url": "https://api.github.com/users/HeeebsInc/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/HeeebsInc",
                "id": 60490377,
                "login": "HeeebsInc",
                "node_id": "MDQ6VXNlcjYwNDkwMzc3",
                "organizations_url": "https://api.github.com/users/HeeebsInc/orgs",
                "received_events_url": "https://api.github.com/users/HeeebsInc/received_events",
                "repos_url": "https://api.github.com/users/HeeebsInc/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/HeeebsInc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/HeeebsInc/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/HeeebsInc"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I suppose that the problem is that `SliceIndexNode` has disallowed GIL:\r\n\r\nhttps://github.com/cython/cython/blob/d085015f5afcdfa246f8af61d0f77b9734ac69f6/Cython/Compiler/ExprNodes.py#L5420\r\n\r\n`nogil_check()` method should be implemented for `SliceIndexNode` to decide when GIL is allowed and when not - e.g. as here:\r\n\r\nhttps://github.com/cython/cython/blob/d085015f5afcdfa246f8af61d0f77b9734ac69f6/Cython/Compiler/ExprNodes.py#L731-L736",
            "created_at": "2022-11-20T13:09:31Z",
            "html_url": "https://github.com/cython/cython/issues/3160#issuecomment-1321129138",
            "id": 1321129138,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3160",
            "node_id": "IC_kwDOABDGAc5OvtSy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1321129138/reactions"
            },
            "updated_at": "2022-11-20T13:09:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1321129138",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/827060?v=4",
                "events_url": "https://api.github.com/users/matusvalo/events{/privacy}",
                "followers_url": "https://api.github.com/users/matusvalo/followers",
                "following_url": "https://api.github.com/users/matusvalo/following{/other_user}",
                "gists_url": "https://api.github.com/users/matusvalo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/matusvalo",
                "id": 827060,
                "login": "matusvalo",
                "node_id": "MDQ6VXNlcjgyNzA2MA==",
                "organizations_url": "https://api.github.com/users/matusvalo/orgs",
                "received_events_url": "https://api.github.com/users/matusvalo/received_events",
                "repos_url": "https://api.github.com/users/matusvalo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/matusvalo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/matusvalo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/matusvalo"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3160/comments",
    "created_at": "2019-10-01T17:01:51Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-11-26T13:22:51Z",
            "event": "labeled",
            "id": 5677672437,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "LE_lADOABDGAc4d3QtKzwAAAAFSamf1",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5677672437"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-11-26T13:22:51Z",
            "event": "labeled",
            "id": 5677672440,
            "label": {
                "color": "444444",
                "name": "Type Analysis"
            },
            "node_id": "LE_lADOABDGAc4d3QtKzwAAAAFSamf4",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5677672440"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3160/events",
    "html_url": "https://github.com/cython/cython/issues/3160",
    "id": 501025610,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425558824,
            "name": "Type Analysis",
            "node_id": "MDU6TGFiZWw0MjU1NTg4MjQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/Type%20Analysis"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3160/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1MDEwMjU2MTA=",
    "number": 3160,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 2,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/cython/cython/issues/3160/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/3160/timeline",
    "title": "Initializing array with values requires GIL?",
    "updated_at": "2022-11-20T13:09:31Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3160",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jakirkham",
        "id": 3019665,
        "login": "jakirkham",
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jakirkham"
    }
}