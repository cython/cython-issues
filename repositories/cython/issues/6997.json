{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Is your feature request related to a problem? Please describe.\n\nBy definition of `collections.abc.Sequence` and `collections.abc.Sequence` list of builtin sequences is:\n1. `tuple`\n2. `list`\n3. `bytearray`\n4. `bytes`\n5. `str`\n6. `memoryview`\n\nIt seems that item access of most of them was optimized.\nHowever, my testing indicates that it is not so for `bytes` and `memoryview`.\n\n```python\ncy_seq = cy.fused_type(object, list, tuple, bytearray, bytes, str, memoryview)\n\n# def seq_overloading(seq):\n# Or:\ndef seq_overloading(seq: cy_seq):\n    if seq is not None:\n        c: cy_pst = 0\n        i: cy_pst = 0\n        n: cy_pst = len(seq)\n        while i < n:\n            if seq[i]:\n                c += 1\n            i += 1\n        return c\n```\n\nFunction is a bit more complex than minimal, but that is just so that I could make sure it does all the loops for each of them.\n\nResults are as follows.\nFirst number is timing of first signature - i.e. without annotation.\nThe second is with `cy_seq` annotation.\n\n```python\n%timeit seq_overloading(None)     #   400 ns\n\nseq1 = [1] * 100_000\n%timeit seq_overloading(seq1)     #   750 |  550 µs\nseq2 = (1,) * 100_000\n%timeit seq_overloading(seq2)     #   750 |  550 µs\nseq3 = bytearray([1]) * 100_000\n%timeit seq_overloading(seq3)     #  4000 |   35 µs\nseq4 = b'1' * 100_000\n%timeit seq_overloading(seq4)     #  4000 | 3800 µs\nseq5 = 'a' * 100_000\n%timeit seq_overloading(seq5)     #  4000 |   34 µs\nseq6 = memoryview(seq3)\n%timeit seq_overloading(seq6)     #  4000 | 4800 µs\n```\n\nIt would be great if `bytes` and `memoryview` were also optimized.\nOr are they optimized, but I am missing something?\nIt is a bit surprising that `str` and `bytearray` are optimized, but `bytes` is not.\n\n### Describe the solution you'd like.\n\n_No response_\n\n### Describe alternatives you've considered.\n\n_No response_\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "In general `bytes` is definitely optimized. However it seems to be missing the optimization on `if seq[i]:` in that specific case.\n\nIf you do\n\n```\ntmp = seq[i]`\nif tmp:\n```\n\nthen it does the right thing. So that's a bug that's probably worth fixing.\n\n`memoryview` isn't optimized (much). I had a brief look not too long ago and decided there wasn't much to be done because you don't really know the return type. Really the only thing you can do is shortcut the indexing to `PySequence_GetItem`. If you know the return type then that's what Cython's own typed memoryviews are for.",
            "created_at": "2025-06-30T21:14:43Z",
            "html_url": "https://github.com/cython/cython/issues/6997#issuecomment-3020773619",
            "id": 3020773619,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6997",
            "node_id": "IC_kwDOABDGAc60DVjz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3020773619/reactions"
            },
            "updated_at": "2025-06-30T21:14:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3020773619",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> If you do\n> \n> ```\n> tmp = seq[i]`\n> if tmp:\n> ```\n\nThat didn't help.\nI removed conditional and just left plain `seq[i]` without any assignment and still same timing.\nAlso, explicitly did `bytes` annotation without using `fused_type` - this did not fix it either...\n\n> because you don't really know the return type.\n\nYeah, thought about this after posting. I never actually use `memoryview` like that.\n\nSo I suppose this is only about `bytes`.",
            "created_at": "2025-06-30T21:31:39Z",
            "html_url": "https://github.com/cython/cython/issues/6997#issuecomment-3020846151",
            "id": 3020846151,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6997",
            "node_id": "IC_kwDOABDGAc60DnRH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3020846151/reactions"
            },
            "updated_at": "2025-06-30T21:31:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3020846151",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3577712?v=4",
                "events_url": "https://api.github.com/users/dg-pb/events{/privacy}",
                "followers_url": "https://api.github.com/users/dg-pb/followers",
                "following_url": "https://api.github.com/users/dg-pb/following{/other_user}",
                "gists_url": "https://api.github.com/users/dg-pb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dg-pb",
                "id": 3577712,
                "login": "dg-pb",
                "node_id": "MDQ6VXNlcjM1Nzc3MTI=",
                "organizations_url": "https://api.github.com/users/dg-pb/orgs",
                "received_events_url": "https://api.github.com/users/dg-pb/received_events",
                "repos_url": "https://api.github.com/users/dg-pb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dg-pb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dg-pb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dg-pb",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "You didn't say which Cython version you were trying. The `master` branch? That might be relevant.\n\nIt's unexpected to see `bytearray` perform better than `bytes`. Might be a left-over of the times when `bytes` was ambiguous between Py2/3 and wasn't always optimisable.",
            "created_at": "2025-07-01T04:30:10Z",
            "html_url": "https://github.com/cython/cython/issues/6997#issuecomment-3021715902",
            "id": 3021715902,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6997",
            "node_id": "IC_kwDOABDGAc60G7m-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3021715902/reactions"
            },
            "updated_at": "2025-07-01T04:30:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3021715902",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Mac\nPython 3.13.4\nCython 3.1.1",
            "created_at": "2025-07-01T12:17:47Z",
            "html_url": "https://github.com/cython/cython/issues/6997#issuecomment-3023768633",
            "id": 3023768633,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6997",
            "node_id": "IC_kwDOABDGAc60Oww5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3023768633/reactions"
            },
            "updated_at": "2025-07-01T12:58:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3023768633",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3577712?v=4",
                "events_url": "https://api.github.com/users/dg-pb/events{/privacy}",
                "followers_url": "https://api.github.com/users/dg-pb/followers",
                "following_url": "https://api.github.com/users/dg-pb/following{/other_user}",
                "gists_url": "https://api.github.com/users/dg-pb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dg-pb",
                "id": 3577712,
                "login": "dg-pb",
                "node_id": "MDQ6VXNlcjM1Nzc3MTI=",
                "organizations_url": "https://api.github.com/users/dg-pb/orgs",
                "received_events_url": "https://api.github.com/users/dg-pb/received_events",
                "repos_url": "https://api.github.com/users/dg-pb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dg-pb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dg-pb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dg-pb",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> > If you do\n> > ```\n> > tmp = seq[i]`\n> > if tmp:\n> > ```\n> \n> That didn't help.\n\nThat works on master but not 3.1.x. Not sure why, but that's probably worth looking into because there's definitely missed optimizations that I think we genuinely intend to do there.",
            "created_at": "2025-07-01T18:07:37Z",
            "html_url": "https://github.com/cython/cython/issues/6997#issuecomment-3025039725",
            "id": 3025039725,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6997",
            "node_id": "IC_kwDOABDGAc60TnFt",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3025039725/reactions"
            },
            "updated_at": "2025-07-01T18:07:37Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3025039725",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6997/comments",
    "created_at": "2025-06-30T19:08:48Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6997/events",
    "html_url": "https://github.com/cython/cython/issues/6997",
    "id": 3189572360,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6997/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6-HQMI",
    "number": 6997,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6997/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6997/timeline",
    "title": "[ENH] performance of `bytes` and `memoryview`",
    "type": null,
    "updated_at": "2025-07-01T18:07:37Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6997",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3577712?v=4",
        "events_url": "https://api.github.com/users/dg-pb/events{/privacy}",
        "followers_url": "https://api.github.com/users/dg-pb/followers",
        "following_url": "https://api.github.com/users/dg-pb/following{/other_user}",
        "gists_url": "https://api.github.com/users/dg-pb/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/dg-pb",
        "id": 3577712,
        "login": "dg-pb",
        "node_id": "MDQ6VXNlcjM1Nzc3MTI=",
        "organizations_url": "https://api.github.com/users/dg-pb/orgs",
        "received_events_url": "https://api.github.com/users/dg-pb/received_events",
        "repos_url": "https://api.github.com/users/dg-pb/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/dg-pb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dg-pb/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/dg-pb",
        "user_view_type": "public"
    }
}