{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "**Describe the bug**\r\nI came across two compiler crashes while implementing https://github.com/cython/cython/pull/4528.\r\nThe following template is a minimal example causing cython to crash:\r\n```cython\r\ncdef extern from \"*\" nogil:\r\n    cdef cppclass vector[T]:\r\n        cppclass base_class:\r\n            pass\r\n        cppclass example1(base_class):\r\n            pass\r\n        cppclass example2(base_class):\r\n            example2()\r\n\r\n        example1 get()\r\n        example1 insert[U](example1, U)\r\n\r\ndef test():\r\n    cdef vector[int] vec\r\n    vec.insert(vec.get(), vec.get())\r\n    #vec.insert(vector[int].example1(), vec.get())\r\n```\r\n`vec.insert(vec.get(), vec.get())` causes the compiler crash:\r\n```\r\nCompiler crash in AnalyseExpressionsTransform\r\n\r\nModuleNode.body = StatListNode(test2.pyx:3:0)\r\nStatListNode.stats[1] = DefNode(test2.pyx:16:0,\r\n    is_cyfunction = True,\r\n    modifiers = [...]/0,\r\n    name = 'test',\r\n    np_args_idx = [...]/0,\r\n    outer_attrs = [...]/2,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0',\r\n    used = True)\r\nFile 'Nodes.py', line 396, in analyse_expressions: StatListNode(test2.pyx:17:4)\r\nFile 'Nodes.py', line 5686, in analyse_expressions: ExprStatNode(test2.pyx:18:14)\r\nFile 'ExprNodes.py', line 633, in analyse_expressions: SimpleCallNode(test2.pyx:18:14,\r\n    analysed = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 5779, in analyse_types: SimpleCallNode(test2.pyx:18:14,\r\n    analysed = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 5834, in analyse_c_function_call: SimpleCallNode(test2.pyx:18:14,\r\n    analysed = True,\r\n    use_managed_ref = True)\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/ExprNodes.py\", line 5834, in analyse_c_function_call\r\n    entry = PyrexTypes.best_match([arg.type for arg in args],\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 4659, in best_match\r\n    type = func_type.specialize(deductions),\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 3148, in specialize\r\n    result = CFuncType(self.return_type.specialize(values),\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 3923, in specialize\r\n    specialized.base_classes = [b.specialize(values) for b in self.base_classes]\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 3923, in <listcomp>\r\n    specialized.base_classes = [b.specialize(values) for b in self.base_classes]\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 3925, in specialize\r\n    specialized.namespace = self.namespace.specialize(values)\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 3926, in specialize\r\n    specialized.scope = self.scope.specialize(values, specialized)\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/Symtab.py\", line 2646, in specialize\r\n    entry.type.specialize(values),\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/PyrexTypes.py\", line 3926, in specialize\r\n    specialized.scope = self.scope.specialize(values, specialized)\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/Symtab.py\", line 2652, in specialize\r\n    scope.declare_cfunction(e.name,\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/Symtab.py\", line 2588, in declare_cfunction\r\n    base_entry = base.scope.lookup(name)\r\nAttributeError: 'NoneType' object has no attribute 'lookup'\r\n```\r\n\r\nwhile `vec.insert(vector[int].example1(), vec.get())` causes the crash:\r\n```\r\nCompiler crash in AnalyseExpressionsTransform\r\n\r\nModuleNode.body = StatListNode(test2.pyx:1:0)\r\nStatListNode.stats[1] = DefNode(test2.pyx:13:0,\r\n    is_cyfunction = True,\r\n    modifiers = [...]/0,\r\n    name = 'test',\r\n    np_args_idx = [...]/0,\r\n    outer_attrs = [...]/2,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0',\r\n    used = True)\r\nFile 'Nodes.py', line 396, in analyse_expressions: StatListNode(test2.pyx:14:4)\r\nFile 'Nodes.py', line 5686, in analyse_expressions: ExprStatNode(test2.pyx:16:14)\r\nFile 'ExprNodes.py', line 633, in analyse_expressions: SimpleCallNode(test2.pyx:16:14,\r\n    analysed = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 5778, in analyse_types: SimpleCallNode(test2.pyx:16:14,\r\n    analysed = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 5738, in analyse_types: SimpleCallNode(test2.pyx:16:35,\r\n    result_is_used = True,\r\n    use_managed_ref = True)\r\nFile 'ExprNodes.py', line 5653, in analyse_as_type_constructor: SimpleCallNode(test2.pyx:16:35,\r\n    result_is_used = True,\r\n    use_managed_ref = True)\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"/home/max/.local/lib/python3.9/site-packages/Cython/Compiler/ExprNodes.py\", line 5653, in analyse_as_type_constructor\r\n    error(self.function.pos, \"no constructor found for C++  type '%s'\" % self.function.name)\r\nAttributeError: 'AttributeNode' object has no attribute 'name'\r\n```\r\n\r\n**Expected behavior**\r\nThis should either compile correctly or return a proper error message.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Linux\r\n - Python version 3.9\r\n - Cython version 3.0.0a9\r\n\r\n\r\n",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4529/comments",
    "created_at": "2021-12-25T22:26:20Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4529/events",
    "html_url": "https://github.com/cython/cython/issues/4529",
    "id": 1088663505,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4529/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5A46_R",
    "number": 4529,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4529/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4529/timeline",
    "title": "[BUG] Compiler crash with template",
    "updated_at": "2021-12-26T19:32:33Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4529",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/44199644?v=4",
        "events_url": "https://api.github.com/users/maxbachmann/events{/privacy}",
        "followers_url": "https://api.github.com/users/maxbachmann/followers",
        "following_url": "https://api.github.com/users/maxbachmann/following{/other_user}",
        "gists_url": "https://api.github.com/users/maxbachmann/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/maxbachmann",
        "id": 44199644,
        "login": "maxbachmann",
        "node_id": "MDQ6VXNlcjQ0MTk5NjQ0",
        "organizations_url": "https://api.github.com/users/maxbachmann/orgs",
        "received_events_url": "https://api.github.com/users/maxbachmann/received_events",
        "repos_url": "https://api.github.com/users/maxbachmann/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/maxbachmann/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/maxbachmann/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/maxbachmann"
    }
}