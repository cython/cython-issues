{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\nI have a C++ file with some code that I want to call from an extension type. This C++ file contains a function accepts an object as an argument that is a public extension type from another Cython module. This same module is also cimported in the pyx/pxd file. On compilation, an error that the struct corresponding to the public extension type has been redefined, once from the .hpp file and again from the .cpp file from Cython. \r\n\r\n**To Reproduce**\r\nExample repo at [https://github.com/zachlowry/cython_bug](url)\r\n\r\nCode to reproduce the behavior:\r\n\r\nshared.pxd:\r\n```\r\ncimport cython\r\n\r\n@cython.final\r\ncdef public class Shared [object c_PyShared, type c_PyShared_t]:\r\n    cdef int value\r\n```\r\n\r\nshared.pyx:\r\n```\r\ncimport cython\r\n\r\n@cython.final\r\ncdef public class Shared [object c_PyShared, type c_PyShared_t]:\r\n    pass\r\n```\r\n\r\nuser.hpp:\r\n```\r\n#ifndef SHARED_H\r\n#define SHARED_H\r\n#include \"shared.h\"\r\n\r\nvoid do_something(Shared s) {}\r\n#endif\r\n```\r\n\r\nuser.pxd:\r\n```\r\nfrom shared cimport Shared\r\n\r\ncdef extern from \"user.hpp\":\r\n    void do_something(Shared s)\r\n```\r\n\r\nuser.pyx:\r\n```\r\ndef main():\r\n    s = Shared()\r\n    do_something(s)\r\n    return s\r\n```\r\n\r\n**Expected behavior**\r\nThe struct should only be defined a single time and no error should occur. This can potentially be accomplished by removing the #include directive from the .hpp file and moving the #include of the hpp file in the generated .cpp file to below where the struct is defined. \r\n\r\n**Environment (please complete the following information):**\r\n - OS: Linux\r\n - Python version 3.8.3\r\n - Cython version 0.29.26\r\n\r\n",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4512/comments",
    "created_at": "2021-12-21T17:58:16Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4512/events",
    "html_url": "https://github.com/cython/cython/issues/4512",
    "id": 1086080806,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4512/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5AvEcm",
    "number": 4512,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4512/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4512/timeline",
    "title": "[BUG] redefinition of struct with extern from file that includes public extension type header",
    "updated_at": "2021-12-21T18:02:39Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4512",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2203948?v=4",
        "events_url": "https://api.github.com/users/zachlowry/events{/privacy}",
        "followers_url": "https://api.github.com/users/zachlowry/followers",
        "following_url": "https://api.github.com/users/zachlowry/following{/other_user}",
        "gists_url": "https://api.github.com/users/zachlowry/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zachlowry",
        "id": 2203948,
        "login": "zachlowry",
        "node_id": "MDQ6VXNlcjIyMDM5NDg=",
        "organizations_url": "https://api.github.com/users/zachlowry/orgs",
        "received_events_url": "https://api.github.com/users/zachlowry/received_events",
        "repos_url": "https://api.github.com/users/zachlowry/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zachlowry/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zachlowry/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zachlowry"
    }
}