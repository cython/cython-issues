{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "If I have a `setup.py` that looks like:\r\n\r\n```python\r\nfrom distutils.core import setup\r\nfrom distutils.extension import Extension\r\n\r\nfrom Cython.Build import cythonize\r\n\r\nimport numpy\r\n\r\nextensions = [\r\n    Extension('mod1.ftest', ['mod1/ftest.pyx'],\r\n              depends=['mod1/ftypes.pxd'],\r\n              include_dirs=[numpy.get_include()])\r\n]\r\n\r\nsetup(name='', ext_modules=cythonize(extensions, language_level='3'))\r\n```\r\n\r\nwhere `mod1/ftest.pyx` looks like:\r\n\r\n```cython\r\nfrom . ftypes cimport a_type\r\n\r\n\r\ncpdef double test_func(a_type[::1] x):\r\n    cdef:\r\n        int i\r\n        double res\r\n\r\n    res = 0.0\r\n\r\n    for i in range(x.shape[0]):\r\n        res += x[i].a1 * x[i].a3\r\n\r\n    return res\r\n```\r\n\r\nand `mod1/ftypes.pxd` looks like:\r\n\r\n```cython\r\nimport numpy as np\r\ncimport numpy as np\r\n\r\ncdef packed struct a_type:\r\n    np.float64 ax\r\n    np.int32_t a1\r\n    np.int16_t a2\r\n    np.int32_t a3\r\n```\r\n\r\nwhen I modify the contents of `mod1/ftypes.pxd`, the `cythonize` call in `setup.py` does not trigger a compilation of `ftest.pyx`. If that change involved uncommenting the first line in the `struct a_type` definition, this gives an error like:\r\n\r\n```python\r\nValueError: Buffer dtype mismatch, expected 'int32_t' but got 'double' in 'a_type.a1'\r\n```\r\n\r\nwhen passing in a numpy recarray that assumes that the `ax` field is now defined. \r\n\r\nThis might be related to https://github.com/cython/cython/issues/1428. As `mod1/ftypes.pxd` is a dependency of `mod1/ftest.pyx`, it seems like perhaps the dependency tree is not complete in terms of the recompilation decision process. ",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3208/comments",
    "created_at": "2019-10-25T19:38:47Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3208/events",
    "html_url": "https://github.com/cython/cython/issues/3208",
    "id": 512686135,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3208/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1MTI2ODYxMzU=",
    "number": 3208,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "cythonize does not trigger a recompile when .pxd dependency has changed",
    "updated_at": "2019-10-25T19:39:27Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3208",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/589279?v=4",
        "events_url": "https://api.github.com/users/synapticarbors/events{/privacy}",
        "followers_url": "https://api.github.com/users/synapticarbors/followers",
        "following_url": "https://api.github.com/users/synapticarbors/following{/other_user}",
        "gists_url": "https://api.github.com/users/synapticarbors/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/synapticarbors",
        "id": 589279,
        "login": "synapticarbors",
        "node_id": "MDQ6VXNlcjU4OTI3OQ==",
        "organizations_url": "https://api.github.com/users/synapticarbors/orgs",
        "received_events_url": "https://api.github.com/users/synapticarbors/received_events",
        "repos_url": "https://api.github.com/users/synapticarbors/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/synapticarbors/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/synapticarbors/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/synapticarbors"
    }
}