{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\n\nWhile building pyarrow [15.0.0](https://github.com/conda-forge/arrow-cpp-feedstock/pull/1335) resp. [14.0.2](https://github.com/conda-forge/arrow-cpp-feedstock/pull/1336) in conda-forge, we got a regression going from cython 3.0.8 to 3.0.9\r\n\r\n```\r\n[5/141] Compiling Cython CXX source for lib...\r\nFAILED: CMakeFiles/lib_pyx $SRC_DIR/python/build/temp.linux-x86_64-cpython-310/CMakeFiles/lib_pyx \r\ncd $SRC_DIR/python/build/temp.linux-x86_64-cpython-310 && $PREFIX/bin/python -m cython --cplus --warning-errors --directive embedsignature=True --working /home/conda/feedstock_root/build_artifacts/apache-arrow_1709883667824/work/python --output-file $SRC_DIR/python/build/temp.linux-x86_64-cpython-310/lib.cpp $SRC_DIR/python/pyarrow/lib.pyx\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    if schema.release != NULL:\r\n        schema.release(schema)\r\n\r\n    free(schema)\r\n\r\ncdef object alloc_c_schema(ArrowSchema** c_schema) noexcept:\r\n                          ^\r\n------------------------------------------------------------\r\n\r\npyarrow/types.pxi:5248:26: noexcept clause is ignored for function returning Python object\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    if array.release != NULL:\r\n        array.release(array)\r\n\r\n    free(array)\r\n\r\ncdef object alloc_c_array(ArrowArray** c_array) noexcept:\r\n                         ^\r\n------------------------------------------------------------\r\n\r\npyarrow/types.pxi:5267:25: noexcept clause is ignored for function returning Python object\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    if stream.release != NULL:\r\n        stream.release(stream)\r\n\r\n    free(stream)\r\n\r\ncdef object alloc_c_stream(ArrowArrayStream** c_stream) noexcept:\r\n                          ^\r\n------------------------------------------------------------\r\n\r\npyarrow/types.pxi:5286:26: noexcept clause is ignored for function returning Python object\r\n```\r\n\r\nThis happens across all platforms & arches. Going back to 3.0.8 fixes the build again.\n\n### Code to reproduce the behaviour:\n\nBuild [pyarrow](https://github.com/apache/arrow) with cython 3.0.9\r\n\n\n### Expected behaviour\n\nBuild passes\n\n### OS\n\nLinux, macOS, Windows\n\n### Python version\n\n3.8-3.12\n\n### Cython version\n\n3.0.9\n\n### Additional context\n\n_No response_",
    "closed_at": "2024-03-10T08:22:14Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "This is not a regression. It's a new warning that we added, and I think you treat warnings as errors?\n\nJust remove the noexcept. Function calls returning Python objects *always* check for exceptions, so the noexcept is wrongly used here.\n",
            "created_at": "2024-03-10T08:08:26Z",
            "html_url": "https://github.com/cython/cython/issues/6066#issuecomment-1987138286",
            "id": 1987138286,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6066",
            "node_id": "IC_kwDOABDGAc52cVLu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1987138286/reactions"
            },
            "updated_at": "2024-03-10T08:08:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1987138286",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "OK. I called it a regression because it's the first 3.0.x patch release to break anything (that I'm aware of, at least in arrow). It's definitely a breaking change relative to what passed compilation before, which is unexpected to me in a patch version, so I don't exactly know what to call it if not a regression.\r\n\r\nBut if this is something to be fixed in arrow, feel free to close this issue. That just means we'll stay on cython 3.0.8 until this has been fixed upstream.",
            "created_at": "2024-03-10T08:14:58Z",
            "html_url": "https://github.com/cython/cython/issues/6066#issuecomment-1987139783",
            "id": 1987139783,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6066",
            "node_id": "IC_kwDOABDGAc52cVjH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1987139783/reactions"
            },
            "updated_at": "2024-03-10T08:15:55Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1987139783",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33685575?v=4",
                "events_url": "https://api.github.com/users/h-vetinari/events{/privacy}",
                "followers_url": "https://api.github.com/users/h-vetinari/followers",
                "following_url": "https://api.github.com/users/h-vetinari/following{/other_user}",
                "gists_url": "https://api.github.com/users/h-vetinari/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/h-vetinari",
                "id": 33685575,
                "login": "h-vetinari",
                "node_id": "MDQ6VXNlcjMzNjg1NTc1",
                "organizations_url": "https://api.github.com/users/h-vetinari/orgs",
                "received_events_url": "https://api.github.com/users/h-vetinari/received_events",
                "repos_url": "https://api.github.com/users/h-vetinari/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/h-vetinari/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/h-vetinari/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/h-vetinari"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I think you treat warnings as errors?\r\n\r\nYeah, you're right, this uses `--warning-errors`; this comes from upstream, though I agree that breakage due to treating-warnings-as-errors is not a regression. If you cannot change warning behaviour in patch releases, it's really too much of a constraint to move forward. I'll raise this on the arrow side. Sorry for the noise.",
            "created_at": "2024-03-10T08:22:11Z",
            "html_url": "https://github.com/cython/cython/issues/6066#issuecomment-1987141380",
            "id": 1987141380,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6066",
            "node_id": "IC_kwDOABDGAc52cV8E",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1987141380/reactions"
            },
            "updated_at": "2024-03-10T08:22:11Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1987141380",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33685575?v=4",
                "events_url": "https://api.github.com/users/h-vetinari/events{/privacy}",
                "followers_url": "https://api.github.com/users/h-vetinari/followers",
                "following_url": "https://api.github.com/users/h-vetinari/following{/other_user}",
                "gists_url": "https://api.github.com/users/h-vetinari/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/h-vetinari",
                "id": 33685575,
                "login": "h-vetinari",
                "node_id": "MDQ6VXNlcjMzNjg1NTc1",
                "organizations_url": "https://api.github.com/users/h-vetinari/orgs",
                "received_events_url": "https://api.github.com/users/h-vetinari/received_events",
                "repos_url": "https://api.github.com/users/h-vetinari/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/h-vetinari/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/h-vetinari/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/h-vetinari"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6066/comments",
    "created_at": "2024-03-10T05:50:18Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33685575?v=4",
                "events_url": "https://api.github.com/users/h-vetinari/events{/privacy}",
                "followers_url": "https://api.github.com/users/h-vetinari/followers",
                "following_url": "https://api.github.com/users/h-vetinari/following{/other_user}",
                "gists_url": "https://api.github.com/users/h-vetinari/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/h-vetinari",
                "id": 33685575,
                "login": "h-vetinari",
                "node_id": "MDQ6VXNlcjMzNjg1NTc1",
                "organizations_url": "https://api.github.com/users/h-vetinari/orgs",
                "received_events_url": "https://api.github.com/users/h-vetinari/received_events",
                "repos_url": "https://api.github.com/users/h-vetinari/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/h-vetinari/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/h-vetinari/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/h-vetinari"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-03-10T08:22:14Z",
            "event": "closed",
            "id": 12064848056,
            "node_id": "CE_lADOABDGAc6BypqWzwAAAALPHvi4",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/12064848056"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6066/events",
    "html_url": "https://github.com/cython/cython/issues/6066",
    "id": 2177538710,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6066/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6BypqW",
    "number": 6066,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6066/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6066/timeline",
    "title": "[BUG] Regression in cython 3.0.9",
    "updated_at": "2024-03-10T08:22:14Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6066",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/33685575?v=4",
        "events_url": "https://api.github.com/users/h-vetinari/events{/privacy}",
        "followers_url": "https://api.github.com/users/h-vetinari/followers",
        "following_url": "https://api.github.com/users/h-vetinari/following{/other_user}",
        "gists_url": "https://api.github.com/users/h-vetinari/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/h-vetinari",
        "id": 33685575,
        "login": "h-vetinari",
        "node_id": "MDQ6VXNlcjMzNjg1NTc1",
        "organizations_url": "https://api.github.com/users/h-vetinari/orgs",
        "received_events_url": "https://api.github.com/users/h-vetinari/received_events",
        "repos_url": "https://api.github.com/users/h-vetinari/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/h-vetinari/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/h-vetinari/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/h-vetinari"
    }
}