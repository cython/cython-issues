{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "We have\r\n```\r\n#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS\r\n#define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)\r\n#else\r\n#define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)\r\n#endif\r\n```\r\n\r\nThe problem is that the two variants have different semantics when an exceptions occurs during `__eq__`: the first variant sets an exception while the second clears it. So there are probably subtle bugs possible because of this difference.\r\n\r\nSo far, I'm just noting this issue, not fixing it. I do plan to add a new function `__Pyx_PyDict_GetItemStrWithError` which always keeps the exception.",
    "closed_at": "2019-08-27T20:52:33Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I'll have to check, but I think it should only be used in cases where exceptions should get propagated. Swallowing exceptions is not a good idea for a general hash lookup. Sounds like we should use the PyObject_â€¦ variant as fallback instead.\n",
            "created_at": "2019-08-22T19:54:43Z",
            "html_url": "https://github.com/cython/cython/issues/3091#issuecomment-524052969",
            "id": 524052969,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3091",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDA1Mjk2OQ==",
            "updated_at": "2019-08-22T19:54:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524052969",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Some code is certainly written with the assumption that `__Pyx_PyDict_GetItemStr` won't raise an exception. For example, the old kwargs-parsing code (that's how I noticed the problem).",
            "created_at": "2019-08-22T19:56:58Z",
            "html_url": "https://github.com/cython/cython/issues/3091#issuecomment-524053799",
            "id": 524053799,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3091",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDA1Mzc5OQ==",
            "updated_at": "2019-08-22T19:56:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524053799",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Hmm, right, I guess the usage follows the behaviour of `PyDict_GetItem()`. We should propagate the exception where we can, preferably without too much overhead for the \"normal\" cases (found or not, maybe also for `KeyError`).",
            "created_at": "2019-08-23T06:29:58Z",
            "html_url": "https://github.com/cython/cython/issues/3091#issuecomment-524190316",
            "id": 524190316,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3091",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDE5MDMxNg==",
            "updated_at": "2019-08-23T06:29:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524190316",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "If you agree with the newly added function `__Pyx_PyDict_GetItemStrWithError` in #3021, this can be closed. Eventually, we should probably use `__Pyx_PyDict_GetItemStrWithError` everywhere (but that's certainly out of scope for #3021).",
            "created_at": "2019-08-26T13:16:13Z",
            "html_url": "https://github.com/cython/cython/issues/3091#issuecomment-524856068",
            "id": 524856068,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3091",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDg1NjA2OA==",
            "updated_at": "2019-08-26T13:16:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524856068",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "A reference leak due to calling `PyObject_GetItem()` was resolved in #3593.",
            "created_at": "2020-05-09T09:27:59Z",
            "html_url": "https://github.com/cython/cython/issues/3091#issuecomment-626136484",
            "id": 626136484,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3091",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjEzNjQ4NA==",
            "updated_at": "2020-05-09T09:27:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/626136484",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3091/comments",
    "created_at": "2019-08-22T13:35:12Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-27T20:52:33Z",
            "event": "closed",
            "id": 2588457299,
            "node_id": "MDExOkNsb3NlZEV2ZW50MjU4ODQ1NzI5OQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2588457299"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3091/events",
    "html_url": "https://github.com/cython/cython/issues/3091",
    "id": 483998768,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3091/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0ODM5OTg3Njg=",
    "number": 3091,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Unclear whether __Pyx_PyDict_GetItemStr should clear exceptions",
    "updated_at": "2020-05-09T09:28:00Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3091",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
        "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
        "followers_url": "https://api.github.com/users/jdemeyer/followers",
        "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
        "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jdemeyer",
        "id": 3625785,
        "login": "jdemeyer",
        "node_id": "MDQ6VXNlcjM2MjU3ODU=",
        "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
        "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
        "repos_url": "https://api.github.com/users/jdemeyer/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jdemeyer"
    }
}