{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nThe following code produces these conversion errors\r\n```\r\nerror C2440: 'function': cannot convert from '__pyx_t_double_complex' to '_Dcomplex'\r\nwarning C4024: 'csqrt': different types for formal and actual parameter 1      \r\nerror C2440: '=': cannot convert from '_Dcomplex' to '__pyx_t_double_complex' \r\n```\r\n\r\nThe reason, I believe, is that `__Pyx_c_prod_double` returns `__pyx_t_double_complex` but `sqrt` expects `_Dcomplex` on Windows MSVC since for some reason it is not subject to cython's magic handling of `double complex`.\n\n### Code to reproduce the behaviour:\n\n```cython\r\nfrom libc.complex cimport csqrt\r\ncdef double complex a = 3\r\ncdef double complex b = 4\r\ncdef double complex s = csqrt(a*b)\r\n```\r\n\n\n### Expected behaviour\n\nNo error\n\n### OS\n\nWindows\n\n### Python version\n\n_No response_\n\n### Cython version\n\n3.0.11\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> since for some reason it is not subject to cython's magic handling of `double complex`.\r\n\r\nIt's because MSVC's handling of C standard library complex is broken to non-existent.\r\n\r\nIf you can, compile it in C++ mode since MSVC's C++ standard library is a lot better.\r\n\r\nI do have a vague plan to try to improve this at some point, since there are a whole bunch of complex types which all have the same memory layout so could all be used pretty interchangeably so long as Cython understood that they're all the same. It remains a vague plan though. And getting it to play nice with MSVC may be the hardest bit.",
            "created_at": "2024-11-27T19:01:50Z",
            "html_url": "https://github.com/cython/cython/issues/6524#issuecomment-2504599989",
            "id": 2504599989,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6524",
            "node_id": "IC_kwDOABDGAc6VSSm1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2504599989/reactions"
            },
            "updated_at": "2024-11-27T19:01:50Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2504599989",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks! Compiling as c++ worked.",
            "created_at": "2024-11-28T09:05:26Z",
            "html_url": "https://github.com/cython/cython/issues/6524#issuecomment-2505598170",
            "id": 2505598170,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6524",
            "node_id": "IC_kwDOABDGAc6VWGTa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2505598170/reactions"
            },
            "updated_at": "2024-11-28T09:05:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2505598170",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5037600?v=4",
                "events_url": "https://api.github.com/users/tobiasdiez/events{/privacy}",
                "followers_url": "https://api.github.com/users/tobiasdiez/followers",
                "following_url": "https://api.github.com/users/tobiasdiez/following{/other_user}",
                "gists_url": "https://api.github.com/users/tobiasdiez/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tobiasdiez",
                "id": 5037600,
                "login": "tobiasdiez",
                "node_id": "MDQ6VXNlcjUwMzc2MDA=",
                "organizations_url": "https://api.github.com/users/tobiasdiez/orgs",
                "received_events_url": "https://api.github.com/users/tobiasdiez/received_events",
                "repos_url": "https://api.github.com/users/tobiasdiez/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tobiasdiez/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tobiasdiez/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tobiasdiez",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6524/comments",
    "created_at": "2024-11-27T09:59:25Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6524/events",
    "html_url": "https://github.com/cython/cython/issues/6524",
    "id": 2697939764,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6524/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6gz0s0",
    "number": 6524,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6524/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6524/timeline",
    "title": "[BUG] C2440 error for complex square root on Windows",
    "updated_at": "2024-11-28T09:05:28Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6524",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5037600?v=4",
        "events_url": "https://api.github.com/users/tobiasdiez/events{/privacy}",
        "followers_url": "https://api.github.com/users/tobiasdiez/followers",
        "following_url": "https://api.github.com/users/tobiasdiez/following{/other_user}",
        "gists_url": "https://api.github.com/users/tobiasdiez/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tobiasdiez",
        "id": 5037600,
        "login": "tobiasdiez",
        "node_id": "MDQ6VXNlcjUwMzc2MDA=",
        "organizations_url": "https://api.github.com/users/tobiasdiez/orgs",
        "received_events_url": "https://api.github.com/users/tobiasdiez/received_events",
        "repos_url": "https://api.github.com/users/tobiasdiez/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tobiasdiez/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tobiasdiez/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tobiasdiez",
        "user_view_type": "public"
    }
}