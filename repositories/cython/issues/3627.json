{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Hi, I am using Python 3.7 with cython 0.29.14.\r\n\r\nI am confused about the error in the title for long time.\r\n\r\nSpecifically, I have directories like this:\r\n```\r\nmy_pkg/\r\n  __init__.py\r\n  a/\r\n    __init__.py\r\n    __init__.pxd\r\n    setup.py\r\n    cython_ext/\r\n      __init__.py\r\n      __init__.pxd\r\n      basics.pyx\r\n      basics.pxd\r\n  b/\r\n    __init__.py\r\n    __init__.pxd\r\n    setup.py\r\n    cython_ext/\r\n      __init__.py\r\n      basics.pyx\r\n```\r\n\r\nThere is function defined in `a/cython_ext/basics.pyx`:\r\n```\r\ncpdef void f() nogil\r\n```\r\nand is also declared in `a/cython_ext/basics.pxd`.\r\n\r\n`a/setup.py` has an Extention entry like this:\r\n```\r\nExtension(\r\n  \"basics\",\r\n  sources=[\"cython_ext/basics.pyx\"],\r\n  language=\"c++\",\r\n  extra_compile_args=[\"-std=c++17\"],\r\n  include_dirs=[numpy.get_include()],\r\n)\r\n```\r\nI also have `options={\"build\": {\"build_lib\": \"cython_ext\"}}` so that the `.so` file is generated under `cython_ext`.\r\n\r\nI then cimport the function `f` in `b/cython_ext/basics.pyx`:\r\n```\r\nfrom my_pkg.a.cython_ext.basics cimport f\r\n```\r\n\r\nHowever, when importing the module `b.cython_ext/basics`, it always complains\r\n`AttributeError: module 'my_pkg.a.cython_ext.basics' has no attribute '__pyx_capi__'`\r\n\r\nAny idea what goes wrong? I used to have `basics.pyx` and `basics.pxd` directly under `a/` rather than an extra `cython_ext` and they used to work. Really confused.",
    "closed_at": "2020-05-25T06:43:00Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I spent the whole weekend trying to figure out this issue, and finally got it ...\r\n\r\nFirst, the setup.py has to be changed to\r\n```\r\nExtension(\r\n  \"cython_ext.basics\",\r\n  sources=[\"cython_ext/basics.pyx\"],\r\n  language=\"c++\",\r\n  extra_compile_args=[\"-std=c++17\"],\r\n  include_dirs=[numpy.get_include()],\r\n)\r\n```\r\n\r\nHowever, doing this alone won't work, and this is what made me fail again and again... After changing setup.py, one also needs to delete all `__pycahe__` and `build` in all relevant folders before running `python setup.py build_ext` (simply adding `--force` without deleting those intermediate files won't work).",
            "created_at": "2020-05-25T06:41:49Z",
            "html_url": "https://github.com/cython/cython/issues/3627#issuecomment-633406235",
            "id": 633406235,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3627",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYzMzQwNjIzNQ==",
            "updated_at": "2020-05-25T06:41:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/633406235",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/6195346?v=4",
                "events_url": "https://api.github.com/users/xin-jin/events{/privacy}",
                "followers_url": "https://api.github.com/users/xin-jin/followers",
                "following_url": "https://api.github.com/users/xin-jin/following{/other_user}",
                "gists_url": "https://api.github.com/users/xin-jin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/xin-jin",
                "id": 6195346,
                "login": "xin-jin",
                "node_id": "MDQ6VXNlcjYxOTUzNDY=",
                "organizations_url": "https://api.github.com/users/xin-jin/orgs",
                "received_events_url": "https://api.github.com/users/xin-jin/received_events",
                "repos_url": "https://api.github.com/users/xin-jin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/xin-jin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xin-jin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/xin-jin"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ah, yes. This is wrong:\r\n> I also have options={\"build\": {\"build_lib\": \"cython_ext\"}} so that the .so file is generated under cython_ext.\r\n\r\nThis does not make \"cython_ext\" a package. If you want the extension to be in a package, you have to name it that way. If you have a specific place in the documentation where you looked and did not find that information, I'd be happy to receive a PR that clarifies it.",
            "created_at": "2020-05-25T07:27:57Z",
            "html_url": "https://github.com/cython/cython/issues/3627#issuecomment-633423517",
            "id": 633423517,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3627",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYzMzQyMzUxNw==",
            "updated_at": "2020-05-25T07:27:57Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/633423517",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Ah, yes. This is wrong:\r\n> \r\n> > I also have options={\"build\": {\"build_lib\": \"cython_ext\"}} so that the .so file is generated under cython_ext.\r\n> \r\n> This does not make \"cython_ext\" a package. If you want the extension to be in a package, you have to name it that way. If you have a specific place in the documentation where you looked and did not find that information, I'd be happy to receive a PR that clarifies it.\r\n\r\nThanks! \r\n\r\nIt would be nice if you could add a simple example illustrating building extensions in subdirectories in https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html",
            "created_at": "2020-05-25T15:08:15Z",
            "html_url": "https://github.com/cython/cython/issues/3627#issuecomment-633614884",
            "id": 633614884,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3627",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYzMzYxNDg4NA==",
            "updated_at": "2020-05-25T15:08:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/633614884",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/6195346?v=4",
                "events_url": "https://api.github.com/users/xin-jin/events{/privacy}",
                "followers_url": "https://api.github.com/users/xin-jin/followers",
                "following_url": "https://api.github.com/users/xin-jin/following{/other_user}",
                "gists_url": "https://api.github.com/users/xin-jin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/xin-jin",
                "id": 6195346,
                "login": "xin-jin",
                "node_id": "MDQ6VXNlcjYxOTUzNDY=",
                "organizations_url": "https://api.github.com/users/xin-jin/orgs",
                "received_events_url": "https://api.github.com/users/xin-jin/received_events",
                "repos_url": "https://api.github.com/users/xin-jin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/xin-jin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xin-jin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/xin-jin"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3627/comments",
    "created_at": "2020-05-21T18:30:51Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/6195346?v=4",
                "events_url": "https://api.github.com/users/xin-jin/events{/privacy}",
                "followers_url": "https://api.github.com/users/xin-jin/followers",
                "following_url": "https://api.github.com/users/xin-jin/following{/other_user}",
                "gists_url": "https://api.github.com/users/xin-jin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/xin-jin",
                "id": 6195346,
                "login": "xin-jin",
                "node_id": "MDQ6VXNlcjYxOTUzNDY=",
                "organizations_url": "https://api.github.com/users/xin-jin/orgs",
                "received_events_url": "https://api.github.com/users/xin-jin/received_events",
                "repos_url": "https://api.github.com/users/xin-jin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/xin-jin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xin-jin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/xin-jin"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-05-25T06:43:00Z",
            "event": "closed",
            "id": 3369013459,
            "node_id": "MDExOkNsb3NlZEV2ZW50MzM2OTAxMzQ1OQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3369013459"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3627/events",
    "html_url": "https://github.com/cython/cython/issues/3627",
    "id": 622694046,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3627/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU2MjI2OTQwNDY=",
    "number": 3627,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Module has no attribute '__pyx_capi__'",
    "updated_at": "2020-05-25T15:08:16Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3627",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/6195346?v=4",
        "events_url": "https://api.github.com/users/xin-jin/events{/privacy}",
        "followers_url": "https://api.github.com/users/xin-jin/followers",
        "following_url": "https://api.github.com/users/xin-jin/following{/other_user}",
        "gists_url": "https://api.github.com/users/xin-jin/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/xin-jin",
        "id": 6195346,
        "login": "xin-jin",
        "node_id": "MDQ6VXNlcjYxOTUzNDY=",
        "organizations_url": "https://api.github.com/users/xin-jin/orgs",
        "received_events_url": "https://api.github.com/users/xin-jin/received_events",
        "repos_url": "https://api.github.com/users/xin-jin/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/xin-jin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/xin-jin/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/xin-jin"
    }
}