{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I'm new to cython but this seems like incorrect behavior.\r\n\r\nPython code put in cytest/test.py:\r\n```\r\ndef test_func_no_tuples(a, b):\r\n  print((a.__class__, b.__class__))\r\n  print((a, b))\r\n  s = 'string being formatted=%d' % a\r\n  print(s)\r\n\r\n\r\ndef test_func_with_tuple(a,b):\r\n  print((a.__class__, b.__class__))\r\n  print((a, b))\r\n  s = 'string being formatted=%d-%d' % (a,b)\r\n  print(s)\r\n\r\ntest_func_no_tuples(50.,50.)\r\n\r\ntest_func_with_tuple(50.,50.)\r\n```\r\n\r\nBefore compilation the output of `python3 -c \"from cytest import test\"` is:\r\n```\r\npython3 -c \"from cytest import test\"\r\n(<class 'float'>, <class 'float'>)\r\n(50.0, 50.0)\r\nstring being formatted=50\r\n(<class 'float'>, <class 'float'>)\r\n(50.0, 50.0)\r\nstring being formatted=50-50\r\n```\r\n\r\nAfter a pip install of cython==0.29.13 I compile with:\r\n```\r\nPYTHONLIB=/usr/include/python3.5\r\nCFLAGS=\"-shared -pthread -fPIC -fwrapv -O2 -Wall -fno-strict-aliasing -I${PYTHONLIB}\"\r\ncython --no-docstrings -3 cytest/test.py -o cytest/test.c\r\ngcc $CFLAGS -o cytest/test.so cytest/test.c\r\n```\r\n\r\nNow the output is:\r\n```\r\n(<class 'float'>, <class 'float'>)\r\n(50.0, 50.0)\r\nstring being formatted=50\r\n(<class 'float'>, <class 'float'>)\r\n(50.0, 50.0)\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"cytest/test.py\", line 16, in init cytest.test\r\n    test_func_with_tuple(50.,50.)\r\n  File \"cytest/test.py\", line 11, in cytest.test.test_func_with_tuple\r\n    s = 'string being formatted=%d-%d' % (a,b)\r\nValueError: Unknown format code 'd' for object of type 'float'\r\n```\r\nThis is the error I would get if did `1.2.__format__('d')`, but it appears that in the other case cython isn't using that function.\r\n\r\nThe relevant c code output by cython is:\r\n```\r\n  /* \"cytest/test.py\":4\r\n *   print((a.__class__, b.__class__))\r\n *   print((a, b))\r\n *   s = 'string being formatted=%d' % a             # <<<<<<<<<<<<<<\r\n *   print(s)\r\n * \r\n */\r\n  __pyx_t_3 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_string_being_formatted_d, __pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_3);\r\n  __pyx_v_s = ((PyObject*)__pyx_t_3);\r\n  __pyx_t_3 = 0;\r\n\r\n```\r\n\r\n\r\n```\r\n  /* \"cytest/test.py\":11\r\n *   print((a.__class__, b.__class__))\r\n *   print((a, b))\r\n *   s = 'string being formatted=%d-%d' % (a,b)             # <<<<<<<<<<<<<<\r\n *   print(s)\r\n * \r\n */\r\n  __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 11, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_3);\r\n  __pyx_t_4 = 0;\r\n  __pyx_t_5 = 127;\r\n  __Pyx_INCREF(__pyx_kp_u_string_being_formatted);\r\n  __pyx_t_4 += 23;\r\n  __Pyx_GIVEREF(__pyx_kp_u_string_being_formatted);\r\n  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_string_being_formatted);\r\n  __pyx_t_2 = __Pyx_PyObject_Format(__pyx_v_a, __pyx_n_u_d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_2);\r\n  __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_2) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_2) : __pyx_t_5;\r\n  __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_2);\r\n  __Pyx_GIVEREF(__pyx_t_2);\r\n  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);\r\n  __pyx_t_2 = 0;\r\n  __Pyx_INCREF(__pyx_kp_u_);\r\n  __pyx_t_4 += 1;\r\n  __Pyx_GIVEREF(__pyx_kp_u_);\r\n  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_kp_u_);\r\n  __pyx_t_2 = __Pyx_PyObject_Format(__pyx_v_b, __pyx_n_u_d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_2);\r\n  __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_2) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_2) : __pyx_t_5;\r\n  __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_2);\r\n  __Pyx_GIVEREF(__pyx_t_2);\r\n  PyTuple_SET_ITEM(__pyx_t_3, 3, __pyx_t_2);\r\n  __pyx_t_2 = 0;\r\n  __pyx_t_2 = __Pyx_PyUnicode_Join(__pyx_t_3, 4, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_2);\r\n  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;\r\n  __pyx_v_s = ((PyObject*)__pyx_t_2);\r\n  __pyx_t_2 = 0;\r\n```\r\n\r\nIt looks like the __Pyx_PyUnicode_FormatSafe function is being used only in the first case and not in the second, which may or may not be relevant. I am using Python 3.5.2. \r\n\r\nIf there is any other information needed let me know",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I should also mention I'm compiling on ubuntu 16.04",
            "created_at": "2019-08-22T22:51:38Z",
            "html_url": "https://github.com/cython/cython/issues/3092#issuecomment-524107140",
            "id": 524107140,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3092",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDEwNzE0MA==",
            "updated_at": "2019-08-22T22:51:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524107140",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3360097?v=4",
                "events_url": "https://api.github.com/users/dannyjeck/events{/privacy}",
                "followers_url": "https://api.github.com/users/dannyjeck/followers",
                "following_url": "https://api.github.com/users/dannyjeck/following{/other_user}",
                "gists_url": "https://api.github.com/users/dannyjeck/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dannyjeck",
                "id": 3360097,
                "login": "dannyjeck",
                "node_id": "MDQ6VXNlcjMzNjAwOTc=",
                "organizations_url": "https://api.github.com/users/dannyjeck/orgs",
                "received_events_url": "https://api.github.com/users/dannyjeck/received_events",
                "repos_url": "https://api.github.com/users/dannyjeck/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dannyjeck/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dannyjeck/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dannyjeck"
            }
        },
        {
            "author_association": "NONE",
            "body": "Does this apply to brace-formatted strings too? (With type specified, that is)",
            "created_at": "2019-08-22T23:13:29Z",
            "html_url": "https://github.com/cython/cython/issues/3092#issuecomment-524112279",
            "id": 524112279,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3092",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDExMjI3OQ==",
            "updated_at": "2019-08-22T23:13:46Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524112279",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/52675669?v=4",
                "events_url": "https://api.github.com/users/brendan-matroid/events{/privacy}",
                "followers_url": "https://api.github.com/users/brendan-matroid/followers",
                "following_url": "https://api.github.com/users/brendan-matroid/following{/other_user}",
                "gists_url": "https://api.github.com/users/brendan-matroid/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brendan-matroid",
                "id": 52675669,
                "login": "brendan-matroid",
                "node_id": "MDQ6VXNlcjUyNjc1NjY5",
                "organizations_url": "https://api.github.com/users/brendan-matroid/orgs",
                "received_events_url": "https://api.github.com/users/brendan-matroid/received_events",
                "repos_url": "https://api.github.com/users/brendan-matroid/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brendan-matroid/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brendan-matroid/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brendan-matroid"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Looks like this is a difference between `%`-formatting and `format()`/f-strings. Cython optimises some `%`-formatting cases into f-strings, that's why this occurs.\r\n\r\nI think the right fix would be to generate a bit of additional code that checks if the format value is an integer, and if not, passes it through `PyNumber_Int()`. Tests will show if the behaviour is the same in Py2 and Py3, and if both need this adaptation.",
            "created_at": "2019-08-23T06:26:03Z",
            "html_url": "https://github.com/cython/cython/issues/3092#issuecomment-524189433",
            "id": 524189433,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3092",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDE4OTQzMw==",
            "updated_at": "2019-08-23T06:26:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/524189433",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3092/comments",
    "created_at": "2019-08-22T21:34:40Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-23T06:21:28Z",
            "event": "labeled",
            "id": 2578649793,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDI1Nzg2NDk3OTM=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2578649793"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-23T06:21:29Z",
            "event": "labeled",
            "id": 2578649795,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDI1Nzg2NDk3OTU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2578649795"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-23T06:21:29Z",
            "event": "labeled",
            "id": 2578649796,
            "label": {
                "color": "1d76db",
                "name": "good first issue"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDI1Nzg2NDk3OTY=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2578649796"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-23T06:21:29Z",
            "event": "labeled",
            "id": 2578649797,
            "label": {
                "color": "444444",
                "name": "Optimization"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDI1Nzg2NDk3OTc=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2578649797"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-23T06:21:36Z",
            "event": "milestoned",
            "id": 2578650015,
            "milestone": {
                "title": "0.29.14"
            },
            "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDI1Nzg2NTAwMTU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2578650015"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-08-23T06:21:42Z",
            "event": "demilestoned",
            "id": 2578650180,
            "milestone": {
                "title": "0.29.14"
            },
            "node_id": "MDE3OkRlbWlsZXN0b25lZEV2ZW50MjU3ODY1MDE4MA==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2578650180"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3092/events",
    "html_url": "https://github.com/cython/cython/issues/3092",
    "id": 484228139,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425556272,
            "name": "Optimization",
            "node_id": "MDU6TGFiZWw0MjU1NTYyNzI=",
            "url": "https://api.github.com/repos/cython/cython/labels/Optimization"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "1d76db",
            "default": true,
            "id": 414805682,
            "name": "good first issue",
            "node_id": "MDU6TGFiZWw0MTQ4MDU2ODI=",
            "url": "https://api.github.com/repos/cython/cython/labels/good%20first%20issue"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3092/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0ODQyMjgxMzk=",
    "number": 3092,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "% string formatting with multiple inputs via of tuples doesn't match python3.5 behavior",
    "updated_at": "2019-08-23T06:26:40Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3092",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/3360097?v=4",
        "events_url": "https://api.github.com/users/dannyjeck/events{/privacy}",
        "followers_url": "https://api.github.com/users/dannyjeck/followers",
        "following_url": "https://api.github.com/users/dannyjeck/following{/other_user}",
        "gists_url": "https://api.github.com/users/dannyjeck/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/dannyjeck",
        "id": 3360097,
        "login": "dannyjeck",
        "node_id": "MDQ6VXNlcjMzNjAwOTc=",
        "organizations_url": "https://api.github.com/users/dannyjeck/orgs",
        "received_events_url": "https://api.github.com/users/dannyjeck/received_events",
        "repos_url": "https://api.github.com/users/dannyjeck/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/dannyjeck/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dannyjeck/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/dannyjeck"
    }
}