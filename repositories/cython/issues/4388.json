{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "<!--\r\n**PLEASE READ THIS FIRST:**\r\n- Do not use the bug and feature tracker for support requests. Use the `cython-users` mailing list instead.\r\n- Did you search for similar issues already? Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release? It might already have what you want to report. Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Describe the bug**\r\nValid pure python mode code stops compiling if `pxd` file with declarations from the code is added.\r\n\r\n**To Reproduce**\r\n`py` file:\r\n```python\r\nimport cython\r\n\r\n@cython.cfunc\r\ndef foo() -> cython.void:\r\n    pass\r\n```\r\n\r\n`pxd` file:\r\n```cython\r\ncdef void foo()\r\n```\r\n\r\noutput:\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nimport cython\r\n\r\n@cython.cfunc\r\n^\r\n------------------------------------------------------------\r\n\r\nex.py:3:0: Function signature does not match previous declaration\r\nTraceback (most recent call last):\r\n    ...\r\n    raise CompileError(None, pyx_file)\r\nCython.Compiler.Errors.CompileError: ex.py\r\n```\r\n\r\nbut if we will remove type declarations (specifically `cython.cfunc`, but let's remove all of them) then everything will compile:\r\n\r\n`py`:\r\n```python\r\ndef foo():\r\n    pass\r\n```\r\n\r\n(same `pxd`)\r\n\r\nI would say that if we can compile that without type declarations then we should be able to do the same with them.\r\nAnd clearly, the problem is not in the type declarations, that do not match.\r\n\r\n**Environment:**\r\n - OS: Windows\r\n - Python version 3.9.0\r\n - Cython version 3.0.0a8\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I can see the advantage of mixing annotations and pxd files because the annotations are useful to someone reading the code, and the pxd file exports it to other Cython modules. So those should work.\r\n\r\nI don't really see the point of mixing pxd files and `@cython.cfunc` decorators - since you've already provided the information in the pxd the decorator is kind of pointless. Personally I'm not too worried if that doesn't end up working.",
            "created_at": "2021-09-30T19:18:51Z",
            "html_url": "https://github.com/cython/cython/issues/4388#issuecomment-931596997",
            "id": 931596997,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4388",
            "node_id": "IC_kwDOABDGAc43hwrF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/931596997/reactions"
            },
            "updated_at": "2021-09-30T19:18:51Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/931596997",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I don't really see the point of mixing pxd files and `@cython.cfunc` decorators - since you've already provided the information in the pxd the decorator is kind of pointless.\r\n\r\nThe same logic can be applied to `pyx` and `pxd`: \"Why should we repeat ourselves in them if there is no point in doing the same for `py` and `pxd`?\"\r\n",
            "created_at": "2021-09-30T19:50:33Z",
            "html_url": "https://github.com/cython/cython/issues/4388#issuecomment-931616274",
            "id": 931616274,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4388",
            "node_id": "IC_kwDOABDGAc43h1YS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/931616274/reactions"
            },
            "updated_at": "2021-09-30T19:51:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/931616274",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I think it actually works now. But I am not sure that any tests capture this behavior and it can be relied upon.\r\n",
            "created_at": "2024-02-02T17:56:12Z",
            "html_url": "https://github.com/cython/cython/issues/4388#issuecomment-1924411587",
            "id": 1924411587,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4388",
            "node_id": "IC_kwDOABDGAc5ytDDD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1924411587/reactions"
            },
            "updated_at": "2024-02-02T17:56:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1924411587",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I've added a test in #5974 - does look to work to me too.",
            "created_at": "2024-02-03T15:11:57Z",
            "html_url": "https://github.com/cython/cython/issues/4388#issuecomment-1925353955",
            "id": 1925353955,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4388",
            "node_id": "IC_kwDOABDGAc5ywpHj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1925353955/reactions"
            },
            "updated_at": "2024-02-03T15:11:57Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1925353955",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4388/comments",
    "created_at": "2021-09-30T18:45:32Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4388/events",
    "html_url": "https://github.com/cython/cython/issues/4388",
    "id": 1012504685,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4388/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc48WZht",
    "number": 4388,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4388/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4388/timeline",
    "title": "[BUG] addition of the `pxd` breaks pure mode",
    "updated_at": "2024-02-03T15:11:58Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4388",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
        "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
        "followers_url": "https://api.github.com/users/0dminnimda/followers",
        "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
        "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/0dminnimda",
        "id": 52697657,
        "login": "0dminnimda",
        "node_id": "MDQ6VXNlcjUyNjk3NjU3",
        "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
        "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
        "repos_url": "https://api.github.com/users/0dminnimda/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/0dminnimda"
    }
}