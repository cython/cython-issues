{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "**Describe the bug**\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n\r\n  if False:  # pylint: disable=using-constant-test\r\n    # This clause is interpreted by the compiler.\r\n    from cython import compiled as is_compiled\r\n  else:\r\n    is_compiled = False\r\n   ^\r\n------------------------------------------------------------\r\n\r\napache_beam/coders/coder_impl.py:96:4: Cannot assign to or delete this\r\n```\r\n**Expected behavior**\r\nThe code is valid Python, but cython refuses to compile it. \r\n\r\n**Environment (please complete the following information):**\r\n - OS: Linux\r\n - Python version [ 3.8.4]\r\n - Cython version [ 3.0a6 ]\r\n\r\n**Additional context**\r\n\r\nEven thought the problematic code is almost pointless, redefining an imported name based on runtime condition is likely a useful pattern. Also surprising -- I thought a python script is always compilable by cython (or this used to be the case?).\r\n\r\nA workaround is\r\n```\r\nif False:\r\n from cython improt compiled as _is_compiled\r\n is_compiled = _is_compiled\r\nelse:\r\n is_compiled = False\r\n```\r\n\r\nSo maybe we just need to add some documentation about this workaround.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "> I thought a python script is always compilable by cython \r\n\r\nI think that's an ambition more than a fact anyway... When it comes to directives from the Cython module I think that can't be true - they're special-cased to override normal Python behaviour so you can definitely use them to make things that don't work.\r\n\r\nhttps://github.com/cython/cython/pull/3507 seems related but not quite the same.\r\n\r\nI'm not convinced this issue is actually fixable though - `import cython` is treated as `cimport cython` and thus variables that come from it have a ctype",
            "created_at": "2021-05-19T21:48:33Z",
            "html_url": "https://github.com/cython/cython/issues/4179#issuecomment-844498022",
            "id": 844498022,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4179",
            "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDQ5ODAyMg==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-19T21:48:33Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/844498022",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the explanation. Let me close this issue for 'wont fix' then.\r\n\r\nInterested party will land on this thread if they search for \"Cannot assign to or delete this\". I count this as good enough as documentation of workaround. \r\n",
            "created_at": "2021-05-20T17:28:34Z",
            "html_url": "https://github.com/cython/cython/issues/4179#issuecomment-845315350",
            "id": 845315350,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4179",
            "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTMxNTM1MA==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-20T17:28:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/845315350",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "node_id": "MDQ6VXNlcjEzODA2MA==",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "I didn't realise that this was a regression and it used to work. I'll reopen it for now because it may be something that we should revert. Not completely sure, but I think it at least needs a proper look to work out why it's changed",
            "created_at": "2021-05-20T17:55:53Z",
            "html_url": "https://github.com/cython/cython/issues/4179#issuecomment-845342102",
            "id": 845342102,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4179",
            "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTM0MjEwMg==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-20T17:55:53Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/845342102",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "Right so the commit to blame is 66e47e8daeb38877b7d3a137fd574f3326e067b9 (which is coincidently the \"related\" PR that I linked earlier). Unfortunately it's the worst kind of blame - the kind that points at me...",
            "created_at": "2021-05-20T18:36:07Z",
            "html_url": "https://github.com/cython/cython/issues/4179#issuecomment-845368410",
            "id": 845368410,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4179",
            "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTM2ODQxMA==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-20T18:36:07Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/845368410",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "I think the fix would probably be to not look at the lhs of `AssignmentNode` in `InterpretCompilerDirectives`. I'm not convinced whether it's a worthwhile fix or not (so I won't do it myself at the moment), but if this is a frequently occurring pattern then I think that's the way to solve it.",
            "created_at": "2021-05-20T19:17:48Z",
            "html_url": "https://github.com/cython/cython/issues/4179#issuecomment-845408838",
            "id": 845408838,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4179",
            "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTQwODgzOA==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-20T19:17:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/845408838",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4179/comments",
    "created_at": "2021-05-19T21:36:12Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5534781?v=4",
                "events_url": "https://api.github.com/users/leofang/events{/privacy}",
                "followers_url": "https://api.github.com/users/leofang/followers",
                "following_url": "https://api.github.com/users/leofang/following{/other_user}",
                "gists_url": "https://api.github.com/users/leofang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/leofang",
                "id": 5534781,
                "login": "leofang",
                "node_id": "MDQ6VXNlcjU1MzQ3ODE=",
                "organizations_url": "https://api.github.com/users/leofang/orgs",
                "received_events_url": "https://api.github.com/users/leofang/received_events",
                "repos_url": "https://api.github.com/users/leofang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/leofang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/leofang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/leofang"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-05-20T06:06:04Z",
            "event": "subscribed",
            "id": 4770796934,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ3NzA3OTY5MzQ=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4770796934"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "node_id": "MDQ6VXNlcjEzODA2MA==",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-05-20T17:28:34Z",
            "event": "closed",
            "id": 4774908274,
            "node_id": "MDExOkNsb3NlZEV2ZW50NDc3NDkwODI3NA==",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4774908274"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-05-20T17:55:53Z",
            "event": "reopened",
            "id": 4775049291,
            "node_id": "MDEzOlJlb3BlbmVkRXZlbnQ0Nzc1MDQ5Mjkx",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4775049291"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4179/events",
    "html_url": "https://github.com/cython/cython/issues/4179",
    "id": 895938250,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4179/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4OTU5MzgyNTA=",
    "number": 4179,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[BUG] Cannot assign to or delete this when compiling a python script.",
    "updated_at": "2021-05-20T19:17:48Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4179",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/138060?v=4",
        "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
        "followers_url": "https://api.github.com/users/rainwoodman/followers",
        "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
        "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rainwoodman",
        "id": 138060,
        "login": "rainwoodman",
        "node_id": "MDQ6VXNlcjEzODA2MA==",
        "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
        "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
        "repos_url": "https://api.github.com/users/rainwoodman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rainwoodman"
    }
}