{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I'm trying to call cdef function from C. If the cdef function contains python statements, such as print(), python (def) function, a segmentation fault would be raised.\r\n\r\nThe pyx file:\r\n# cython: language_level=3\r\n\r\ncdef public double PI = 3.1415926\r\n\r\ncdef public double get_e():\r\n    print(\"calling get_e()\")\r\n    return 2.718281828\r\n\r\nThe C file:\r\n#include \"Python.h\"\r\n#include \"transcendentals.h\"\r\n#include <math.h>\r\n#include <stdio.h>\r\n\r\nint main(int argc, char **argv) {\r\n  Py_Initialize();\r\n  PyInit_transcendentals();\r\n  printf(\"pi**e: %f\\n\", pow(PI, get_e()));\r\n  Py_Finalize();\r\n  return 0;\r\n}\r\n\r\nThe compile commands are:\r\ncython transcendentals.pyx\r\ngcc -I. -I/usr/include/python3.5m -I/usr/include/python3.5m  -Wno-unused-result -Wsign-compare -g -fstack-protector-strong -Wformat -Werror=format-security  -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -L/usr/lib/python3.5/config-3.5m-x86_64-linux-gnu -L/usr/lib transcendentals.c main.c -lpython3.5m -lpthread -ldl  -lutil -lm  -Xlinker -export-dynamic -Wl,-O1 -Wl,-Bsymbolic-functions\r\n\r\nIf I remove the print statement, no segmentation fault will be raised, but value of PI is 0.\r\n\r\nI'm trying to locate the problem, and I found in the generated code of get_e\r\n__pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6, __pyx_L1_error)\r\n__pyx_builtin_print is NULL",
    "closed_at": "2019-04-12T11:53:20Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I tested on python2.7 and problems solved.\r\nIs there some bug when cython work with python3 or I did something wrong?",
            "created_at": "2019-04-12T11:39:37Z",
            "html_url": "https://github.com/cython/cython/issues/2921#issuecomment-482542686",
            "id": 482542686,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2921",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MjU0MjY4Ng==",
            "updated_at": "2019-04-12T11:39:37Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/482542686",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/10632052?v=4",
                "events_url": "https://api.github.com/users/luoxiaojian/events{/privacy}",
                "followers_url": "https://api.github.com/users/luoxiaojian/followers",
                "following_url": "https://api.github.com/users/luoxiaojian/following{/other_user}",
                "gists_url": "https://api.github.com/users/luoxiaojian/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luoxiaojian",
                "id": 10632052,
                "login": "luoxiaojian",
                "node_id": "MDQ6VXNlcjEwNjMyMDUy",
                "organizations_url": "https://api.github.com/users/luoxiaojian/orgs",
                "received_events_url": "https://api.github.com/users/luoxiaojian/received_events",
                "repos_url": "https://api.github.com/users/luoxiaojian/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luoxiaojian/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luoxiaojian/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luoxiaojian"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The latter. Calling the module init function (and throwing away the module reference that it returns) is not the right thing to do in Python 3. Leave that to CPython. You can use the inittab mechanism to integrate with a statically linked extension module.",
            "created_at": "2019-04-12T11:53:20Z",
            "html_url": "https://github.com/cython/cython/issues/2921#issuecomment-482546187",
            "id": 482546187,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2921",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MjU0NjE4Nw==",
            "updated_at": "2019-04-12T11:53:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/482546187",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2921/comments",
    "created_at": "2019-04-12T07:52:00Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-04-12T11:53:20Z",
            "event": "closed",
            "id": 2272213578,
            "node_id": "MDExOkNsb3NlZEV2ZW50MjI3MjIxMzU3OA==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2272213578"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-04-12T11:53:42Z",
            "event": "labeled",
            "id": 2272214556,
            "label": {
                "color": "444444",
                "name": "R: invalid"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDIyNzIyMTQ1NTY=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2272214556"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2921/events",
    "html_url": "https://github.com/cython/cython/issues/2921",
    "id": 432433964,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425557122,
            "name": "R: invalid",
            "node_id": "MDU6TGFiZWw0MjU1NTcxMjI=",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20invalid"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2921/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0MzI0MzM5NjQ=",
    "number": 2921,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Segmentation fault when call wrapped python function in C",
    "updated_at": "2019-04-12T11:53:42Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2921",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/10632052?v=4",
        "events_url": "https://api.github.com/users/luoxiaojian/events{/privacy}",
        "followers_url": "https://api.github.com/users/luoxiaojian/followers",
        "following_url": "https://api.github.com/users/luoxiaojian/following{/other_user}",
        "gists_url": "https://api.github.com/users/luoxiaojian/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/luoxiaojian",
        "id": 10632052,
        "login": "luoxiaojian",
        "node_id": "MDQ6VXNlcjEwNjMyMDUy",
        "organizations_url": "https://api.github.com/users/luoxiaojian/orgs",
        "received_events_url": "https://api.github.com/users/luoxiaojian/received_events",
        "repos_url": "https://api.github.com/users/luoxiaojian/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/luoxiaojian/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/luoxiaojian/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/luoxiaojian"
    }
}