{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "**Describe the bug**\r\n\r\nWhen using pure Python mode's `declare` to specify variables with types, it set the `visibility` of these variables doesn't work.\r\n\r\n**To Reproduce**\r\n\r\n```cython\r\nfrom cython import cclass, declare\r\n\r\n@cclass\r\nclass A:\r\n    declare(i=int, v=float, visibility=\"readonly\")\r\n\r\n    def __init__(self, i: int = 0, v: float = 0.0):\r\n        self.i = i\r\n        self.v = v\r\n```\r\n\r\n**Expected behavior**\r\n\r\nWould expect `visibility` to be handled not as a variable as seem to be the case, but as visibility in terms of Python accessibility of the attributes.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: macOS\r\n - Python version: 3.8.6\r\n - Cython version: 0.29.21\r\n\r\n**Additional context**\r\n\r\nNA",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "My first (now deleted) comment wasn't helpful - your usage is allowed. I don't think there's an obvious right answer here - to me treating visibility as a variable makes more sense than special-casing it.\r\n\r\nI'd think it should probably be left as is, especially given that there is a syntax that works. I'll reopen and leave it for someone else to decide though. But whatever we do it'll be inconsistent with something.",
            "created_at": "2020-12-01T21:52:04Z",
            "html_url": "https://github.com/cython/cython/issues/3926#issuecomment-736843338",
            "id": 736843338,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3926",
            "node_id": "MDEyOklzc3VlQ29tbWVudDczNjg0MzMzOA==",
            "performed_via_github_app": null,
            "updated_at": "2020-12-01T21:55:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/736843338",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Yeah that makes sense.\r\n\r\nFor context, was trying to insert this in some pure Python code where Cython may not available. Using `declare` in this case was handy as one can do something like this for a fallback...\r\n\r\n```cython\r\ntry:\r\n    from cython import declare\r\nexcept ImportError:\r\n    def declare(*a, **k):\r\n        pass\r\n```\r\n\r\nThus having no impact on the `class` in the non-Cython case.\r\n\r\nThe assignment based `declare` could work in some cases, but gets a bit messy as we are now setting class variables that shadow attributes. This turns into an error if those attributes are in the `class`' `__slots__`.\r\n\r\nWound up doing `if compiled` to hold the `declare` assignments, which solves the issue.",
            "created_at": "2020-12-01T22:05:25Z",
            "html_url": "https://github.com/cython/cython/issues/3926#issuecomment-736849761",
            "id": 736849761,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3926",
            "node_id": "MDEyOklzc3VlQ29tbWVudDczNjg0OTc2MQ==",
            "performed_via_github_app": null,
            "updated_at": "2020-12-01T22:05:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/736849761",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/3019665?v=4",
                "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
                "followers_url": "https://api.github.com/users/jakirkham/followers",
                "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
                "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jakirkham",
                "id": 3019665,
                "login": "jakirkham",
                "node_id": "MDQ6VXNlcjMwMTk2NjU=",
                "organizations_url": "https://api.github.com/users/jakirkham/orgs",
                "received_events_url": "https://api.github.com/users/jakirkham/received_events",
                "repos_url": "https://api.github.com/users/jakirkham/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jakirkham"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I wonder if syntax like this might make sense. Though maybe this is just overcomplicating things.\r\n\r\n```cython\r\ndeclare(i={\"type\": int, visibility=\"readonly\"), v={\"type\": float, \"visibility\": \"readonly\"))\r\n```",
            "created_at": "2020-12-01T22:09:39Z",
            "html_url": "https://github.com/cython/cython/issues/3926#issuecomment-736851702",
            "id": 736851702,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3926",
            "node_id": "MDEyOklzc3VlQ29tbWVudDczNjg1MTcwMg==",
            "performed_via_github_app": null,
            "updated_at": "2020-12-01T22:09:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/736851702",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/3019665?v=4",
                "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
                "followers_url": "https://api.github.com/users/jakirkham/followers",
                "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
                "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jakirkham",
                "id": 3019665,
                "login": "jakirkham",
                "node_id": "MDQ6VXNlcjMwMTk2NjU=",
                "organizations_url": "https://api.github.com/users/jakirkham/orgs",
                "received_events_url": "https://api.github.com/users/jakirkham/received_events",
                "repos_url": "https://api.github.com/users/jakirkham/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jakirkham"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3926/comments",
    "created_at": "2020-12-01T21:33:46Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-12-01T21:48:09Z",
            "event": "closed",
            "id": 4059382819,
            "node_id": "MDExOkNsb3NlZEV2ZW50NDA1OTM4MjgxOQ==",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4059382819"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-12-01T21:55:32Z",
            "event": "reopened",
            "id": 4059407286,
            "node_id": "MDEzOlJlb3BlbmVkRXZlbnQ0MDU5NDA3Mjg2",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4059407286"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3926/events",
    "html_url": "https://github.com/cython/cython/issues/3926",
    "id": 754742984,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3926/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU3NTQ3NDI5ODQ=",
    "number": 3926,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[BUG] Trouble setting `visibility` in `declare` with multiple variables",
    "updated_at": "2020-12-01T22:09:39Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3926",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/3019665?v=4",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jakirkham",
        "id": 3019665,
        "login": "jakirkham",
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jakirkham"
    }
}