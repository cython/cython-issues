{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nI guess it is not really a Cython bug but the releases of  Cython 3.1 and Cython 3.1.1 break something that was working fine before.\n\nCurrently, `pip install mpi4py` builds a wheel and uses Cython.\n\nUnfortunately, with Cython 3.1, this leads on Debian 12 Bookworm (i.e. currently Debian stable and also used by default for Python docker image) and Fedora 37 to a huge memory consumption leading to OOM. This has been reported in https://github.com/mpi4py/mpi4py/issues/651 and https://github.com/mpi4py/mpi4py/issues/652.\n\nI think that it is related to an issue with gcc 12 with code generated by Cython 3.1 with flags `-g -02` (https://github.com/mpi4py/mpi4py/issues/652#issuecomment-2936030256).\n\nUnfortunately, it is not simple for users to avoid this problem since it is quite common to not be able to control the versions of the build dependencies of mpi4py (to compile it with Cython 3.0).\n\nGiven that Debian 12 is still important, such incompatibility with the most recent stable version of Cython is an issue. Fortunately, this is mostly a problem for mpi4py since most other projects upload wheels on PyPI so users do not need to compile them.\n\nI guess a reasonable answer from the point of view of Cython could be \"This is not our business. Cython 3.1 generates correct code and we are not responsible for bugs in gcc 12 used by Debian 12.\" However, it could be nice to understand which changes in Cython generated code lead to this issue and maybe to avoid this as long as it impacts Debian stable users.\n\nThere are different ways to deal with such problem of incompatibility:\n\n1. provide a workaround usable by users (not nice for users)\n2. fix gcc 12 and patch the Debian package (I guess very difficult and )\n3. change cython 3.1 to avoid the issue with gcc 12 (might be doable and nice)\n4. change mpi4py to pin a build dependency to Cython 3.0 (seems quite simple and reasonable)\n\nI tend to think that the fourth solution is the best. I would be interested to have the points of view of Cython maintainers.\n\n### Code to reproduce the behaviour:\n\n```sh\npip install mpi4py\n```\n### Expected behaviour\n\nBuild and install mpi4py\n\n### OS\n\nDebian 12\n\n### Python version\n\n3.11\n\n### Cython version\n\n3.1.1\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "My uninformed guess would be that it's probably just a single thing that's tripping GCC up (and not many cumulative things). If that's the case we could try to fix it.\n\nThere's definitely [a bunch of GCC options](https://gcc.gnu.org/onlinedocs/gcc/Developer-Options.html) that print diagnostic info which might help to work out where it is. But I've never seriously used any of those (and when I've non-seriously used them, I haven't got much out of them).\n\nThe other useful thing might be a bisect to a specific Cython change (assuming it's a single refactoring that triggered it).",
            "created_at": "2025-06-04T10:54:16Z",
            "html_url": "https://github.com/cython/cython/issues/6940#issuecomment-2939559413",
            "id": 2939559413,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6940",
            "node_id": "IC_kwDOABDGAc6vNh31",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2939559413/reactions"
            },
            "updated_at": "2025-06-04T11:10:17Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2939559413",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6940/comments",
    "created_at": "2025-06-04T09:46:00Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5534781?v=4",
                "events_url": "https://api.github.com/users/leofang/events{/privacy}",
                "followers_url": "https://api.github.com/users/leofang/followers",
                "following_url": "https://api.github.com/users/leofang/following{/other_user}",
                "gists_url": "https://api.github.com/users/leofang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/leofang",
                "id": 5534781,
                "login": "leofang",
                "node_id": "MDQ6VXNlcjU1MzQ3ODE=",
                "organizations_url": "https://api.github.com/users/leofang/orgs",
                "received_events_url": "https://api.github.com/users/leofang/received_events",
                "repos_url": "https://api.github.com/users/leofang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/leofang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/leofang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/leofang",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-06-04T12:39:49Z",
            "event": "subscribed",
            "id": 17980977727,
            "node_id": "SE_lADOABDGAc65zKqHzwAAAAQvv_I_",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17980977727"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6940/events",
    "html_url": "https://github.com/cython/cython/issues/6940",
    "id": 3117197959,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6940/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc65zKqH",
    "number": 6940,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6940/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6940/timeline",
    "title": "[BUG] huge memory consumption for mpi4py builds on Debian 12 (stable) with Cython 3.1",
    "type": null,
    "updated_at": "2025-06-04T11:10:18Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6940",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8842662?v=4",
        "events_url": "https://api.github.com/users/paugier/events{/privacy}",
        "followers_url": "https://api.github.com/users/paugier/followers",
        "following_url": "https://api.github.com/users/paugier/following{/other_user}",
        "gists_url": "https://api.github.com/users/paugier/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/paugier",
        "id": 8842662,
        "login": "paugier",
        "node_id": "MDQ6VXNlcjg4NDI2NjI=",
        "organizations_url": "https://api.github.com/users/paugier/orgs",
        "received_events_url": "https://api.github.com/users/paugier/received_events",
        "repos_url": "https://api.github.com/users/paugier/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/paugier/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/paugier/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/paugier",
        "user_view_type": "public"
    }
}