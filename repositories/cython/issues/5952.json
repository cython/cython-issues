{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Hello Cython Team,\r\n\r\nI am writing to propose a modification in the `prange` function's handling of the `num_threads` parameter. Currently, `prange` uses `None` as the default value for `num_threads` to indicate the usage of all available cores. While this approach works, it introduces a Python type (`NoneType`) into what is otherwise an integer parameter field. This mix of types could potentially lead to confusion and type inconsistency issues, particularly in strongly typed contexts or when interfacing with other languages.\r\n\r\nI suggest changing this default value to `-1`, a common convention in numerous libraries and frameworks to indicate \"all\" or \"automatic\" choices (e.g., scikit-learn, NumPy). This change would ensure that `num_threads` remains strictly an integer type, enhancing type safety and consistency in the API.\r\n\r\nHere are the key benefits of this proposed change:\r\n\r\n1. **Type Consistency**: Ensuring `num_threads` is always an integer simplifies type handling and reduces the risk of type-related errors.\r\n2. **Alignment with Established Practices**: Using `-1` as a default for such cases is a well-established pattern in the programming community, making it more intuitive for new users.\r\n3. **Simplified Interfacing**: When interfacing Cython with other languages or systems where type strictness is important, having a consistent type for all values of `num_threads` can simplify integration and reduce errors.\r\n\r\nI understand that this change would require a shift in the current API and might need a deprecation period for the current default value (`None`). I believe, however, that the long-term benefits in terms of API clarity and consistency would be significant.\r\n\r\nLooking forward to hearing your thoughts on this proposal.\r\n\r\nBest regards,\r\nSebastian",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "The bit I'm reluctant about:\r\n\r\nCurrently it doesn't look like it's valid to pass `-1` to OpenMP so your idea would work. However, if OpenMP decides in future that `-1` should mean something then we're somewhat stuck.  The advantage of using the separate type `None` as a flag is that we know it'll never conflict with any useful parameter for OpenMP.\r\n\r\nI suspect practically it's OK and this won't happen, but it makes me slightly nervous.",
            "created_at": "2024-01-18T21:32:29Z",
            "html_url": "https://github.com/cython/cython/issues/5952#issuecomment-1899235549",
            "id": 1899235549,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5952",
            "node_id": "IC_kwDOABDGAc5xNAjd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1899235549/reactions"
            },
            "updated_at": "2024-01-18T21:32:29Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1899235549",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I have ran into this and my workaround is an awkward construct like the following.\n\n```python\nif num_threads == -1:\n    with nogil, parallel():\n        # body\n        ...\nelse:\n    with nogil, parallel(num_threads=num_threads):\n        # same body, duplicated\n        ...\n```\n\nThis code is in a `nogil` function itself (so I can't assign `None` to `num_threads`) and if I try to abstract the body of the `parallel` block into a separate function, there's a significant performance penalty (because the parallel block no longer sees the `prange`'s, I guess).  The choice of `None` for the default value seems to be syntactic in a way that interacts poorly when programmatically adjusting the number of threads. ",
            "created_at": "2025-11-10T05:23:26Z",
            "html_url": "https://github.com/cython/cython/issues/5952#issuecomment-3509467980",
            "id": 3509467980,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5952",
            "node_id": "IC_kwDOABDGAc7RLjtM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3509467980/reactions"
            },
            "updated_at": "2025-11-10T05:23:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3509467980",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/20411956?v=4",
                "events_url": "https://api.github.com/users/stephen-huan/events{/privacy}",
                "followers_url": "https://api.github.com/users/stephen-huan/followers",
                "following_url": "https://api.github.com/users/stephen-huan/following{/other_user}",
                "gists_url": "https://api.github.com/users/stephen-huan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/stephen-huan",
                "id": 20411956,
                "login": "stephen-huan",
                "node_id": "MDQ6VXNlcjIwNDExOTU2",
                "organizations_url": "https://api.github.com/users/stephen-huan/orgs",
                "received_events_url": "https://api.github.com/users/stephen-huan/received_events",
                "repos_url": "https://api.github.com/users/stephen-huan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/stephen-huan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/stephen-huan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/stephen-huan",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Unfortunately I don't think allowing `-1` would actually solve the problem. It'd have to be a compile-time constant `-1` so you wouldn't be able to pass it as a run-time value as you propose to do.\n\nUltimately we have to generate an OpenMP parallel block that has `num_threads(value)` or doesn't. If we generate `num_threads(value)` then OpenMP dictates that `value` must be a positive constant.  There's no way for us to pass anything meaning \"automatic\" OpenMP dynamically.\n\nTo me that's actually a very strong reason for not allowing `-1` - it would be very inconsistent to treat it differently at runtime and at compile time.",
            "created_at": "2025-11-10T08:37:10Z",
            "html_url": "https://github.com/cython/cython/issues/5952#issuecomment-3510173909",
            "id": 3510173909,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5952",
            "node_id": "IC_kwDOABDGAc7ROQDV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3510173909/reactions"
            },
            "updated_at": "2025-11-10T08:38:03Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3510173909",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Admittedly we could move the code duplication into Cython, but that puts a (compile-time/size/code complexity) cost onto everyone that is using the feature as it is now. So I'm not hugely keen on that. But it would be possible",
            "created_at": "2025-11-10T08:47:23Z",
            "html_url": "https://github.com/cython/cython/issues/5952#issuecomment-3510229427",
            "id": 3510229427,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5952",
            "node_id": "IC_kwDOABDGAc7ROdmz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3510229427/reactions"
            },
            "updated_at": "2025-11-10T08:47:23Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3510229427",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5952/comments",
    "created_at": "2024-01-18T13:11:10Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5952/events",
    "html_url": "https://github.com/cython/cython/issues/5952",
    "id": 2088260235,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5952/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc58eFKL",
    "number": 5952,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5952/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5952/timeline",
    "title": "Proposal to allow `num_threads` in `prange` to be `-1` for Consistency and Type Safety",
    "type": null,
    "updated_at": "2025-11-10T08:47:23Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5952",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/19690642?v=4",
        "events_url": "https://api.github.com/users/MuellerSeb/events{/privacy}",
        "followers_url": "https://api.github.com/users/MuellerSeb/followers",
        "following_url": "https://api.github.com/users/MuellerSeb/following{/other_user}",
        "gists_url": "https://api.github.com/users/MuellerSeb/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/MuellerSeb",
        "id": 19690642,
        "login": "MuellerSeb",
        "node_id": "MDQ6VXNlcjE5NjkwNjQy",
        "organizations_url": "https://api.github.com/users/MuellerSeb/orgs",
        "received_events_url": "https://api.github.com/users/MuellerSeb/received_events",
        "repos_url": "https://api.github.com/users/MuellerSeb/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/MuellerSeb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/MuellerSeb/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/MuellerSeb",
        "user_view_type": "public"
    }
}