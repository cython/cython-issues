{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\nThis may be working as intended if so I will have to find a workaround for it but I just wanted to confirm first.\r\nThe `__eq__` method of a class in cython is given the cython version of the class even if called from python.\r\nI would expect this behaviour to apply to all dunder methods but it does not apply to the `__add__` and `__radd__` methods.\r\nThese two methods are given the python object from which the internal attributes cannot be accessed.\r\nThis may apply to more methods but the add methods are the only ones I have currently tested.\r\n\r\n**To Reproduce**\r\nCode to reproduce the behaviour:\r\n```cython\r\nfrom cython import typeof\r\n\r\ncdef class Test:\r\n    def __eq__(self, other):\r\n        print(\"eq\", typeof(self), repr(self))\r\n        return [] == other\r\n\r\n    def __add__(self, other):\r\n        print(\"add\", typeof(self), repr(self))\r\n        return [] + other\r\n\r\n    def __radd__(self, other):\r\n        print(\"radd\", typeof(self), repr(self))\r\n        return other + []\r\n\r\ncdef Test test = Test()\r\na = test == []  # eq Test <test.Test object at 0x000001267FF376C0>\r\nb = test + []  # add Python object <test.Test object at 0x000001F97E77C6C0>\r\nc = [] + test  # radd Python object <test.Test object at 0x000001C24B3966C0>\r\n```\r\n\r\n**Expected behavior**\r\nI would expect the add methods to be given the cython version of Test so that the internal attributes can be accessed.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Windows\r\n - Python version 3.9.1\r\n - Cython version 3.0.0a9",
    "closed_at": "2021-11-18T17:34:45Z",
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "Thanks - I think this is something we know about but it probably does need fixing. It applies to all of the binary operators.\r\n\r\nIn the past this was deliberate and [documented](https://cython.readthedocs.io/en/latest/src/userguide/special_methods.html#arithmetic-methods) because add could be called with either `self` or `other` being `Test`.\r\n\r\nNow that we implement `__radd__` correctly it should be possible to type `self` (see https://github.com/cython/cython/issues/2056). It's slightly complicated though because we do still try to support the old behaviour by default. We've [discussed this before](https://github.com/cython/cython/pull/4204#discussion_r648043848) and I think we decided it was best to add the typing even if it might cause issues.\r\n\r\nIt's easily worked around though - you just assign `self` to something typed:\r\n\r\n```\r\ndef __add__(self, other):\r\n        cdef Test selft = self\r\n        print(\"add\", typeof(selft), repr(self))\r\n        return [] + other\r\n```\r\n\r\nI'll make this a blocker for Cython 3 I think because it's a potentially incompatible change so we want to do it there. I don't think it'll be large change.",
            "created_at": "2021-10-31T07:59:39Z",
            "html_url": "https://github.com/cython/cython/issues/4434#issuecomment-955654437",
            "id": 955654437,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4434",
            "node_id": "IC_kwDOABDGAc449iEl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/955654437/reactions"
            },
            "updated_at": "2021-10-31T07:59:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/955654437",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "It looks like the same behaviour can be achieved by adding the typing to the method declaration. Is there any disadvantage of doing this? (other than loosing the python object)\r\n```cython\r\ndef __add__(Test self, other):\r\n        print(\"add\", typeof(self), repr(self))\r\n        return [] + other\r\n```",
            "created_at": "2021-11-02T15:16:30Z",
            "html_url": "https://github.com/cython/cython/issues/4434#issuecomment-957798550",
            "id": 957798550,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4434",
            "node_id": "IC_kwDOABDGAc45FtiW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/957798550/reactions"
            },
            "updated_at": "2021-11-02T15:16:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/957798550",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11940194?v=4",
                "events_url": "https://api.github.com/users/gentlegiantJGC/events{/privacy}",
                "followers_url": "https://api.github.com/users/gentlegiantJGC/followers",
                "following_url": "https://api.github.com/users/gentlegiantJGC/following{/other_user}",
                "gists_url": "https://api.github.com/users/gentlegiantJGC/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gentlegiantJGC",
                "id": 11940194,
                "login": "gentlegiantJGC",
                "node_id": "MDQ6VXNlcjExOTQwMTk0",
                "organizations_url": "https://api.github.com/users/gentlegiantJGC/orgs",
                "received_events_url": "https://api.github.com/users/gentlegiantJGC/received_events",
                "repos_url": "https://api.github.com/users/gentlegiantJGC/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gentlegiantJGC/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gentlegiantJGC/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gentlegiantJGC"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "I didn't think that was supported. I have a PR that proposes to support overriding the type of `self`(https://github.com/cython/cython/pull/3961), since there's some occasional cases where it's useful. but I'm surprised that this works currently.\r\n\r\nHowever, it it works then there's no problem with you doing that.",
            "created_at": "2021-11-02T15:49:41Z",
            "html_url": "https://github.com/cython/cython/issues/4434#issuecomment-957868508",
            "id": 957868508,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4434",
            "node_id": "IC_kwDOABDGAc45F-nc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/957868508/reactions"
            },
            "updated_at": "2021-11-02T15:49:41Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/957868508",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4434/comments",
    "created_at": "2021-10-30T12:12:52Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-10-31T07:59:54Z",
            "event": "labeled",
            "id": 5544880854,
            "label": {
                "color": "444444",
                "name": "P: blocker"
            },
            "node_id": "LE_lADOABDGAc49_yN3zwAAAAFKgCrW",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5544880854"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-10-31T08:00:02Z",
            "event": "milestoned",
            "id": 5544880946,
            "milestone": {
                "title": "3.0"
            },
            "node_id": "MIE_lADOABDGAc49_yN3zwAAAAFKgCsy",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5544880946"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": "ca6c1d20c946f7af0d4f988e0a46462cd7ce6676",
            "commit_url": "https://api.github.com/repos/da-woods/cython/commits/ca6c1d20c946f7af0d4f988e0a46462cd7ce6676",
            "created_at": "2021-10-31T15:24:38Z",
            "event": "referenced",
            "id": 5545346040,
            "node_id": "REFE_lADOABDGAc49_yN3zwAAAAFKh0P4",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5545346040"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-11-18T17:34:46Z",
            "event": "closed",
            "id": 5640410541,
            "node_id": "CE_lADOABDGAc49_yN3zwAAAAFQMdWt",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5640410541"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": "1f0f5f360f8835728c2b24f17e1c3434ca81c352",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/1f0f5f360f8835728c2b24f17e1c3434ca81c352",
            "created_at": "2021-11-18T17:34:47Z",
            "event": "referenced",
            "id": 5640410680,
            "node_id": "REFE_lADOABDGAc49_yN3zwAAAAFQMdY4",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5640410680"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4434/events",
    "html_url": "https://github.com/cython/cython/issues/4434",
    "id": 1040130935,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425557145,
            "name": "P: blocker",
            "node_id": "MDU6TGFiZWw0MjU1NTcxNDU=",
            "url": "https://api.github.com/repos/cython/cython/labels/P:%20blocker"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4434/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 488,
        "created_at": "2018-08-18T06:33:08Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": "Goals:\r\n– New version scheme: 3.x instead of 0.x.\r\n– Change default `language_level` from `2` to `3`.\r\n– Change default for `binding` directive from `False` to `True`.\r\n– Fix some Python compatibility issues (if possible, allowing for breaking changes).\r\n",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/58",
        "id": 3580387,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/58/labels",
        "node_id": "MDk6TWlsZXN0b25lMzU4MDM4Nw==",
        "number": 58,
        "open_issues": 33,
        "state": "open",
        "title": "3.0",
        "updated_at": "2021-11-18T17:35:05Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/58"
    },
    "node_id": "I_kwDOABDGAc49_yN3",
    "number": 4434,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4434/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4434/timeline",
    "title": "[BUG] __add__ method gets Python object not cython object as self.",
    "updated_at": "2021-11-18T17:34:46Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4434",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11940194?v=4",
        "events_url": "https://api.github.com/users/gentlegiantJGC/events{/privacy}",
        "followers_url": "https://api.github.com/users/gentlegiantJGC/followers",
        "following_url": "https://api.github.com/users/gentlegiantJGC/following{/other_user}",
        "gists_url": "https://api.github.com/users/gentlegiantJGC/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gentlegiantJGC",
        "id": 11940194,
        "login": "gentlegiantJGC",
        "node_id": "MDQ6VXNlcjExOTQwMTk0",
        "organizations_url": "https://api.github.com/users/gentlegiantJGC/orgs",
        "received_events_url": "https://api.github.com/users/gentlegiantJGC/received_events",
        "repos_url": "https://api.github.com/users/gentlegiantJGC/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gentlegiantJGC/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gentlegiantJGC/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gentlegiantJGC"
    }
}