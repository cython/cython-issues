{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\r\n\r\nWhen a type for a variable is not specified, it is deduced from the right hand side of an assignment. This deduction generally works except if the right hand side is a pointer to an element of a vector member of a const object, in which case the constness is lost. The error can be masked if another deduction for the same variable precedes the potentially erroneous one, as only the first deduction sets the type within a scope.\r\n\r\n### Code to reproduce the behaviour:\r\n\r\n```cython\r\n# distutils: language=c++\r\n\r\nfrom libcpp.vector cimport vector\r\n\r\ncdef struct S:\r\n    vector[int] v\r\n    int a\r\n\r\ncdef void f1(const S &s):\r\n    cref = &s.v[0]  # error: assigning to 'int *' from 'const value_type *' (aka 'const int *') discards\r\n\r\ncdef void f2(const S &s):\r\n    cref = &s.v[0]  # error: assigning to 'int *' from 'const value_type *' (aka 'const int *') discards\r\n    cref = &s.a     # error: assigning to 'int *' from 'const int *' discards qualifiers\r\n\r\ncdef void f3(const S &s):\r\n    cref = &s.a     # OK\r\n    cref = &s.v[0]  # OK\r\n\r\ncdef S s\r\ns.v.push_back(1)\r\nf1(s)\r\nf2(s)\r\nf3(s)\r\n```\r\n\r\n\r\n### Expected behaviour\r\n\r\nNo compile errors.\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Python version\r\n\r\n3.12.3\r\n\r\n### Cython version\r\n\r\n3.0.10\r\n\r\n### Additional context\r\n\r\nC++ standard gives both options for square bracket access:\r\nreference operator[]( size_type pos );\r\nconst_reference operator[]( size_type pos ) const;",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6271/comments",
    "created_at": "2024-06-25T21:16:12Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5720904?v=4",
                "events_url": "https://api.github.com/users/CypherGrue/events{/privacy}",
                "followers_url": "https://api.github.com/users/CypherGrue/followers",
                "following_url": "https://api.github.com/users/CypherGrue/following{/other_user}",
                "gists_url": "https://api.github.com/users/CypherGrue/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/CypherGrue",
                "id": 5720904,
                "login": "CypherGrue",
                "node_id": "MDQ6VXNlcjU3MjA5MDQ=",
                "organizations_url": "https://api.github.com/users/CypherGrue/orgs",
                "received_events_url": "https://api.github.com/users/CypherGrue/received_events",
                "repos_url": "https://api.github.com/users/CypherGrue/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/CypherGrue/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/CypherGrue/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/CypherGrue"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-06-25T21:41:29Z",
            "event": "renamed",
            "id": 13288200801,
            "node_id": "RTE_lADOABDGAc6Ne2hWzwAAAAMYCdph",
            "performed_via_github_app": null,
            "rename": {
                "from": "[BUG] type deduction sometimes ignores constness of parent and fails to compile",
                "to": "[BUG] type deduction ignores constness for stl square bracket operator and fails to compile"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/13288200801"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6271/events",
    "html_url": "https://github.com/cython/cython/issues/6271",
    "id": 2373675094,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6271/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6Ne2hW",
    "number": 6271,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6271/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6271/timeline",
    "title": "[BUG] type deduction ignores constness for stl square bracket operator and fails to compile",
    "updated_at": "2024-06-25T21:41:29Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6271",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5720904?v=4",
        "events_url": "https://api.github.com/users/CypherGrue/events{/privacy}",
        "followers_url": "https://api.github.com/users/CypherGrue/followers",
        "following_url": "https://api.github.com/users/CypherGrue/following{/other_user}",
        "gists_url": "https://api.github.com/users/CypherGrue/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/CypherGrue",
        "id": 5720904,
        "login": "CypherGrue",
        "node_id": "MDQ6VXNlcjU3MjA5MDQ=",
        "organizations_url": "https://api.github.com/users/CypherGrue/orgs",
        "received_events_url": "https://api.github.com/users/CypherGrue/received_events",
        "repos_url": "https://api.github.com/users/CypherGrue/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/CypherGrue/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/CypherGrue/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/CypherGrue"
    }
}