{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Can you provide me with the best documenation on how to work with datetimes purely on the C-side for sake of speed?\r\n\r\nI'm having trouble parsing timestamp strings.  Ultimately I want to take a timestamp and convert it into absolute milliseconds.  Can this be done in Cython without super-hacker skills?\r\n\r\nHere, the screenshot shows that I cannot event link to `strptime` from `libc.time`:\r\n\r\n![image](https://user-images.githubusercontent.com/1606391/117640436-e3523580-b139-11eb-9c6b-5fba02e1b38f.png)\r\n",
    "closed_at": "2021-05-10T11:02:49Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "This code simply will not compile because of something in Cython:\r\n\r\n```\r\ncdef time_t parse_seconds(char *timestr):\r\n   \"\"\"\r\n   Expected format: \r\n      20210416 13:58:26:573\r\n      \r\n   Recipe:  https://stackoverflow.com/a/3137634/7076615\r\n   1. parse the date using sscanf\r\n   2. then copy the integers into a struct tm (subtract 1 from month and 1900 from year -- months are 0-11 and years start in 1900)\r\n   3. finally, use mktime to get a UTC epoch integer\r\n   4. Just remember to set the isdst member of the struct tm to -1, or else you'll have daylight savings issues.\r\n   \r\n   tm struct details:\r\n      tm_sec\tint\tseconds after the minute\t0-61*\r\n      tm_min\tint\tminutes after the hour\t0-59\r\n      tm_hour\tint\thours since midnight\t0-23\r\n      tm_mday\tint\tday of the month\t1-31\r\n      tm_mon\tint\tmonths since January\t0-11\r\n      tm_year\tint\tyears since 1900\t\r\n      tm_wday\tint\tdays since Sunday\t0-6\r\n      tm_yday\tint\tdays since January 1\t0-365\r\n      tm_isdst\tint\tDaylight Saving Time flag\t\r\n   \"\"\"\r\n   cdef tm dt\r\n   cdef char year[4 + 1]\r\n   cdef char month[2 + 1]\r\n   cdef char day[2 + 1]\r\n   cdef int ms\r\n   year[0] = timestr[0]\r\n   year[1] = timestr[1]\r\n   year[2] = timestr[2]\r\n   year[3] = timestr[3]\r\n   year[4] = b'\\0'\r\n   month[0] = timestr[4]\r\n   month[1] = timestr[5]\r\n   month[2] = b'\\0'\r\n   day[0] = timestr[6]\r\n   day[1] = timestr[7]\r\n   day[2] = b'\\0'\r\n   memset(&dt, 0, sizeof(tm))\r\n   \r\n   dt.tm_year = atoi(year) - 1900\r\n   print(\"Year:\", dt.tm_year, \"from\", year)\r\n   dt.tm_mon = atoi(month) - 1\r\n   print(\"Month:\", dt.tm_mon, \"from\", month)\r\n   dt.tm_mday = atoi(day)\r\n   print(\"Day:\", dt.tm_day, \"from\", day)\r\n   #dt.tm_isdst = -1\r\n   \r\n   timestr = strtok(timestr, b' ')   # Remove the milliseconds part\r\n   # format: 13:58:26:573\r\n   sscanf(timestr, \"%d:%d:%d:%d\", &dt.tm_hour, &dt.tm_min, &dt.tm_sec, &ms)\r\n   \r\n   print(\"Hours:\", dt.tm_hour)\r\n   print(\"Minutes:\", dt.tm_min)\r\n   print(\"Seconds:\", dt.tm_sec)\r\n   \r\n   return mktime(&dt)\r\n```\r\n\r\nErrors:\r\n\r\n```\r\ntools.cpp(5669): error C2039: 'tm_zone': is not a member of 'tm'\r\nC:\\Program Files (x86)\\Windows Kits\\10\\include\\10.0.17134.0\\ucrt\\locale.h(60): note: see declaration of 'tm'\r\ntools.cpp(5672): error C2039: 'tm_gmtoff': is not a member of 'tm'\r\nC:\\Program Files (x86)\\Windows Kits\\10\\include\\10.0.17134.0\\ucrt\\locale.h(60): note: see declaration of 'tm'\r\nerror: command 'C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2019\\\\Preview\\\\VC\\\\Tools\\\\MSVC\\\\14.29.30031\\\\bin\\\\HostX86\\\\x64\\\\cl.exe' failed with exit code 2\r\nProcess terminated with an exit code of 1\r\n```\r\n\r\nI do not address `tm_zone` nor `tm_gtmoff` in my code.  Therfore, the library is broken in its `libc.time` code.",
            "created_at": "2021-05-10T10:40:02Z",
            "html_url": "https://github.com/cython/cython/issues/4150#issuecomment-836536469",
            "id": 836536469,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4150",
            "node_id": "MDEyOklzc3VlQ29tbWVudDgzNjUzNjQ2OQ==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-10T10:40:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/836536469",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1606391?v=4",
                "events_url": "https://api.github.com/users/enjoysmath/events{/privacy}",
                "followers_url": "https://api.github.com/users/enjoysmath/followers",
                "following_url": "https://api.github.com/users/enjoysmath/following{/other_user}",
                "gists_url": "https://api.github.com/users/enjoysmath/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enjoysmath",
                "id": 1606391,
                "login": "enjoysmath",
                "node_id": "MDQ6VXNlcjE2MDYzOTE=",
                "organizations_url": "https://api.github.com/users/enjoysmath/orgs",
                "received_events_url": "https://api.github.com/users/enjoysmath/received_events",
                "repos_url": "https://api.github.com/users/enjoysmath/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enjoysmath/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enjoysmath/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enjoysmath"
            }
        },
        {
            "author_association": "NONE",
            "body": "Okay, here's the fixed code:\r\n\r\n```\r\ncdef time_t parse_seconds(char *timestr):\r\n   \"\"\"\r\n   Expected format: \r\n      20210416 13:58:26:573\r\n      \r\n   Recipe:  https://stackoverflow.com/a/3137634/7076615\r\n   1. parse the date using sscanf\r\n   2. then copy the integers into a struct tm (subtract 1 from month and 1900 from year -- months are 0-11 and years start in 1900)\r\n   3. finally, use mktime to get a UTC epoch integer\r\n   4. Just remember to set the isdst member of the struct tm to -1, or else you'll have daylight savings issues.\r\n   \r\n   tm struct details:\r\n      tm_sec\tint\tseconds after the minute\t0-61*\r\n      tm_min\tint\tminutes after the hour\t0-59\r\n      tm_hour\tint\thours since midnight\t0-23\r\n      tm_mday\tint\tday of the month\t1-31\r\n      tm_mon\tint\tmonths since January\t0-11\r\n      tm_year\tint\tyears since 1900\t\r\n      tm_wday\tint\tdays since Sunday\t0-6\r\n      tm_yday\tint\tdays since January 1\t0-365\r\n      tm_isdst\tint\tDaylight Saving Time flag\t\r\n   \"\"\"\r\n   cdef tm dt\r\n   cdef char year[4 + 1]\r\n   cdef char month[2 + 1]\r\n   cdef char day[2 + 1]\r\n   cdef int ms\r\n   year[0] = timestr[0]\r\n   year[1] = timestr[1]\r\n   year[2] = timestr[2]\r\n   year[3] = timestr[3]\r\n   year[4] = b'\\0'\r\n   month[0] = timestr[4]\r\n   month[1] = timestr[5]\r\n   month[2] = b'\\0'\r\n   day[0] = timestr[6]\r\n   day[1] = timestr[7]\r\n   day[2] = b'\\0'\r\n   memset(&dt, 0, sizeof(tm))\r\n   \r\n   dt.tm_year = atoi(year) - 1900\r\n   print(\"Year:\", dt.tm_year, \"from\", year)\r\n   dt.tm_mon = atoi(month) - 1\r\n   print(\"Month:\", dt.tm_mon, \"from\", month)\r\n   dt.tm_mday = atoi(day)\r\n   print(\"Day:\", dt.tm_mday, \"from\", day)\r\n   dt.tm_isdst = -1\r\n   \r\n   timestr = strtok(timestr, b' ')   # Remove the milliseconds part\r\n   timestr += 9\r\n   # format: 13:58:26:573\r\n   sscanf(timestr, \"%d:%d:%d:%d\", &dt.tm_hour, &dt.tm_min, &dt.tm_sec, &ms)\r\n   \r\n   print(\"Hours:\", dt.tm_hour)\r\n   print(\"Minutes:\", dt.tm_min)\r\n   print(\"Seconds:\", dt.tm_sec)\r\n   \r\n   return mktime(&dt)\r\n```\r\n\r\nI did however comment these two lines out in `time.pxd`:\r\n\r\n```\r\n        char *tm_zone\r\n        long tm_gmtoff\r\n```\r\n\r\nUncommenting them and it compiles.  But I'm wondering whether it's still using the commented out version.  Anyway, it's working, so I'm happy with that.",
            "created_at": "2021-05-10T11:02:49Z",
            "html_url": "https://github.com/cython/cython/issues/4150#issuecomment-836556912",
            "id": 836556912,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4150",
            "node_id": "MDEyOklzc3VlQ29tbWVudDgzNjU1NjkxMg==",
            "performed_via_github_app": null,
            "updated_at": "2021-05-10T11:02:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/836556912",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1606391?v=4",
                "events_url": "https://api.github.com/users/enjoysmath/events{/privacy}",
                "followers_url": "https://api.github.com/users/enjoysmath/followers",
                "following_url": "https://api.github.com/users/enjoysmath/following{/other_user}",
                "gists_url": "https://api.github.com/users/enjoysmath/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enjoysmath",
                "id": 1606391,
                "login": "enjoysmath",
                "node_id": "MDQ6VXNlcjE2MDYzOTE=",
                "organizations_url": "https://api.github.com/users/enjoysmath/orgs",
                "received_events_url": "https://api.github.com/users/enjoysmath/received_events",
                "repos_url": "https://api.github.com/users/enjoysmath/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enjoysmath/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enjoysmath/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enjoysmath"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4150/comments",
    "created_at": "2021-05-10T09:03:23Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1606391?v=4",
                "events_url": "https://api.github.com/users/enjoysmath/events{/privacy}",
                "followers_url": "https://api.github.com/users/enjoysmath/followers",
                "following_url": "https://api.github.com/users/enjoysmath/following{/other_user}",
                "gists_url": "https://api.github.com/users/enjoysmath/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enjoysmath",
                "id": 1606391,
                "login": "enjoysmath",
                "node_id": "MDQ6VXNlcjE2MDYzOTE=",
                "organizations_url": "https://api.github.com/users/enjoysmath/orgs",
                "received_events_url": "https://api.github.com/users/enjoysmath/received_events",
                "repos_url": "https://api.github.com/users/enjoysmath/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enjoysmath/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enjoysmath/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enjoysmath"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-05-10T11:02:49Z",
            "event": "closed",
            "id": 4716104319,
            "node_id": "MDExOkNsb3NlZEV2ZW50NDcxNjEwNDMxOQ==",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4716104319"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4150/events",
    "html_url": "https://github.com/cython/cython/issues/4150",
    "id": 883776612,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4150/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4ODM3NzY2MTI=",
    "number": 4150,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Documentation request:  datetime, timestamps, datetime strings, total milliseconds",
    "updated_at": "2021-05-10T11:02:49Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4150",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1606391?v=4",
        "events_url": "https://api.github.com/users/enjoysmath/events{/privacy}",
        "followers_url": "https://api.github.com/users/enjoysmath/followers",
        "following_url": "https://api.github.com/users/enjoysmath/following{/other_user}",
        "gists_url": "https://api.github.com/users/enjoysmath/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/enjoysmath",
        "id": 1606391,
        "login": "enjoysmath",
        "node_id": "MDQ6VXNlcjE2MDYzOTE=",
        "organizations_url": "https://api.github.com/users/enjoysmath/orgs",
        "received_events_url": "https://api.github.com/users/enjoysmath/received_events",
        "repos_url": "https://api.github.com/users/enjoysmath/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/enjoysmath/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/enjoysmath/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/enjoysmath"
    }
}