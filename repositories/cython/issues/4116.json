{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Here is a simplified example.\r\n\r\n```\r\nimport multiprocessing\r\ndef f(): print(\"ok\")\r\n\r\ncpdef void main() except *:\r\n    multiprocessing.freeze_support()\r\n    multiprocessing.Process(target=f).start()\r\n    print(\"done\")\r\n```\r\n\r\nHere is the script I am using to run this.\r\n\r\n```\r\nimport numpy as np\r\nimport pyximport\r\npyximport.install(language_level=3,setup_args={\"include_dirs\":np.get_include()})\r\nfrom ui_train_test import main\r\nprint(main())\r\n```\r\n\r\nHere is the error message I am getting. I am using Windows 10.\r\n\r\n```\r\nRuntimeError:\r\n        An attempt has been made to start a new process before the\r\n        current process has finished its bootstrapping phase.\r\n\r\n        This probably means that you are not using fork to start your\r\n        child processes and you have forgotten to use the proper idiom\r\n        in the main module:\r\n\r\n            if __name__ == '__main__':\r\n                freeze_support()\r\n                ...\r\n\r\n        The \"freeze_support()\" line can be omitted if the program\r\n        is not going to be frozen to produce an executable.\r\n```\r\n\r\nI am not sure where to put that `freeze_support` call. I am compiling [Spiral](https://github.com/mrakgr/The-Spiral-Language) code to Cython, so I generate the main code inside a `cpdef void main()` function. I tried modifying the example so the main code is in `if __name__ == '__main__':`, but that does not do anything.\r\n\r\nWhat should I do here?",
    "closed_at": "2021-04-20T14:50:44Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "```py\r\nimport numpy as np\r\nimport pyximport\r\nimport multiprocessing\r\npyximport.install(language_level=3,setup_args={\"include_dirs\":np.get_include()})\r\nfrom ui_train_test import main\r\nif __name__ == '__main__':\r\n    print(main())\r\n```\r\n\r\nIt seems that multiprocessing requires the `if __name__ == '__main__':` block. Once I do this the simplified example works, but I am still having trouble with an UI example. That is beyond the scope of this question though.",
            "created_at": "2021-04-20T14:50:44Z",
            "html_url": "https://github.com/cython/cython/issues/4116#issuecomment-823338109",
            "id": 823338109,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4116",
            "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzMzODEwOQ==",
            "performed_via_github_app": null,
            "updated_at": "2021-04-20T14:51:09Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/823338109",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
                "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrakgr/followers",
                "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrakgr",
                "id": 6266635,
                "login": "mrakgr",
                "node_id": "MDQ6VXNlcjYyNjY2MzU=",
                "organizations_url": "https://api.github.com/users/mrakgr/orgs",
                "received_events_url": "https://api.github.com/users/mrakgr/received_events",
                "repos_url": "https://api.github.com/users/mrakgr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrakgr"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4116/comments",
    "created_at": "2021-04-14T10:40:52Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
                "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrakgr/followers",
                "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrakgr",
                "id": 6266635,
                "login": "mrakgr",
                "node_id": "MDQ6VXNlcjYyNjY2MzU=",
                "organizations_url": "https://api.github.com/users/mrakgr/orgs",
                "received_events_url": "https://api.github.com/users/mrakgr/received_events",
                "repos_url": "https://api.github.com/users/mrakgr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrakgr"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-04-20T14:50:45Z",
            "event": "closed",
            "id": 4619746958,
            "node_id": "MDExOkNsb3NlZEV2ZW50NDYxOTc0Njk1OA==",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4619746958"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4116/events",
    "html_url": "https://github.com/cython/cython/issues/4116",
    "id": 857767408,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4116/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4NTc3Njc0MDg=",
    "number": 4116,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "How should `multiprocessing.freeze_support()` be used?",
    "updated_at": "2021-04-20T14:51:09Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4116",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
        "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
        "followers_url": "https://api.github.com/users/mrakgr/followers",
        "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
        "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mrakgr",
        "id": 6266635,
        "login": "mrakgr",
        "node_id": "MDQ6VXNlcjYyNjY2MzU=",
        "organizations_url": "https://api.github.com/users/mrakgr/orgs",
        "received_events_url": "https://api.github.com/users/mrakgr/received_events",
        "repos_url": "https://api.github.com/users/mrakgr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mrakgr"
    }
}