{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Let's say `test.py` has many constant definitions (use case: coming from an API):\r\n\r\n```\r\nCONSTANT0 = 0\r\nCONSTANT1 = 1\r\nCONSTANT2 = 2\r\n...\r\nCONSTANT3998 = 3998\r\nCONSTANT3999 = 3999\r\n```\r\n\r\nNow building this with Cython 0.29.30 on Windows with Python 3.8.10 64 bit:\r\n\r\n```\r\nimport setuptools\r\nfrom distutils.core import setup     # will use my default compiler MSVC++\r\nfrom Cython.Build import cythonize\r\nsetup(ext_modules=cythonize(\"test.py\", language_level=\"3\"), script_args=['build'])\r\n```\r\n\r\n**takes many minutes, and never finishes.**\r\n\r\nI see in task manager that `link.exe` takes 25% of my CPU during minutes, and the memory usage increases: 800 MB at the time I'm writing this!\r\n\r\nHave you already seen this little bug?\r\n\r\n___\r\n\r\nYou can generate a dummy module `test.py` with 4000 constants with this code:\r\n\r\n```\r\nwith open('test.py', 'w') as f:\r\n    for i in range(1000):\r\n        f.write(f'CONSTANT{i} = {i}\\n')\r\n```",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> that link.exe takes 25% of my CPU \r\n\r\nthis'll be MSVC rather than Cython that isn't finishing.\r\n\r\nI have a slight suspicion that this is the \"all Python constants should be pre-cached\" mechanism working against us and making it more complex than it needs to be.\r\n\r\nYou could set the C compiler flags to reduce the optimization level, and that'd probably finish quicker.\r\n\r\nBeyond that I don't know: it'll always be possible to produce a C file that's sufficiently complex that it breaks the C compiler or linker.",
            "created_at": "2022-07-27T04:55:13Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196265600",
            "id": 1196265600,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTZCA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196265600/reactions"
            },
            "updated_at": "2022-07-27T04:55:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196265600",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I have a slight suspicion that this is the \"all Python constants should be pre-cached\" mechanism working against us and making it more complex than it needs to be.\r\n\r\nA couple of untested suggestions that *might* work around this mechanism:\r\n\r\n1. Initialize your constants via floats `CONSTANT0 = int(0.0)`\r\n2. Initialize your constants via single character strings `CONSTANT100 = int(\"1\"+\"0\"+\"0\")`",
            "created_at": "2022-07-27T05:09:17Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196272034",
            "id": 1196272034,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTami",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196272034/reactions"
            },
            "updated_at": "2022-07-27T05:09:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196272034",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks. It could work indeed, but I'd like to avoid these hacks if possible ;)\r\n\r\nOut of curiosity, how does one reduce the optimization level in `setup(...)` ?\r\n\r\n```\r\nimport setuptools\r\nfrom distutils.core import setup\r\nfrom Cython.Build import cythonize\r\nsetup(ext_modules=cythonize(\"test.py\", language_level=\"3\"), script_args=['build'])\r\n```\r\n\r\nI'm not sure it's possible directly from `setup`: https://stackoverflow.com/questions/61096511/python-how-to-specify-optimization-level-for-entry-points-usng-setuptools",
            "created_at": "2022-07-27T05:17:28Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196275931",
            "id": 1196275931,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTbjb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196275931/reactions"
            },
            "updated_at": "2022-07-27T05:18:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196275931",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6168083?v=4",
                "events_url": "https://api.github.com/users/josephernest/events{/privacy}",
                "followers_url": "https://api.github.com/users/josephernest/followers",
                "following_url": "https://api.github.com/users/josephernest/following{/other_user}",
                "gists_url": "https://api.github.com/users/josephernest/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/josephernest",
                "id": 6168083,
                "login": "josephernest",
                "node_id": "MDQ6VXNlcjYxNjgwODM=",
                "organizations_url": "https://api.github.com/users/josephernest/orgs",
                "received_events_url": "https://api.github.com/users/josephernest/received_events",
                "repos_url": "https://api.github.com/users/josephernest/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/josephernest/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/josephernest/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/josephernest"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#configuring-the-c-build\r\n\r\nThe argument to pass to distutils/setuptools will be `extra_compile_args`\r\n",
            "created_at": "2022-07-27T05:25:02Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196279570",
            "id": 1196279570,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTccS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196279570/reactions"
            },
            "updated_at": "2022-07-27T05:25:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196279570",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "It now works with\r\n\r\n```\r\nfrom distutils.core import setup\r\nfrom Cython.Build import cythonize\r\nfrom distutils.extension import Extension\r\nsetup(ext_modules=cythonize(Extension('test', sources=['test.py'], extra_compile_args=['/Od'])), script_args=['build'])\r\n```\r\n\r\nbut the resulting .pyd file is 867 KB for only 4000 constant definitions, oops :)\r\n\r\n___\r\n\r\nIt fails with both `/O1` and `/O2` optimizations. See [/O options (Optimize code)\r\n](https://docs.microsoft.com/en-us/cpp/build/reference/o-options-optimize-code?view=msvc-170).\r\n\r\n",
            "created_at": "2022-07-27T05:38:24Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196286383",
            "id": 1196286383,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTeGv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196286383/reactions"
            },
            "updated_at": "2022-07-27T05:38:24Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196286383",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6168083?v=4",
                "events_url": "https://api.github.com/users/josephernest/events{/privacy}",
                "followers_url": "https://api.github.com/users/josephernest/followers",
                "following_url": "https://api.github.com/users/josephernest/following{/other_user}",
                "gists_url": "https://api.github.com/users/josephernest/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/josephernest",
                "id": 6168083,
                "login": "josephernest",
                "node_id": "MDQ6VXNlcjYxNjgwODM=",
                "organizations_url": "https://api.github.com/users/josephernest/orgs",
                "received_events_url": "https://api.github.com/users/josephernest/received_events",
                "repos_url": "https://api.github.com/users/josephernest/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/josephernest/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/josephernest/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/josephernest"
            }
        },
        {
            "author_association": "NONE",
            "body": "It works but it introduces more complexity in the build process:\r\n\r\n    setup(ext_modules=cythonize(Extension('test', sources=['test.py'], extra_compile_args=['/Od'])) ...\r\n\r\ndoes not produce output .pyd file in the same folder as\r\n\r\n    setup(ext_modules=cythonize('test.py', ...\r\n\r\neven if I use `options={'build': {'build_lib': 'build'}}` in both cases.\r\n\r\nAlso it requires to manually check every `.pyx` file if they have many constants or not.\r\n\r\nIs there a way for Cython to automatically handle this?",
            "created_at": "2022-07-27T06:06:49Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196302370",
            "id": 1196302370,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTiAi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196302370/reactions"
            },
            "updated_at": "2022-07-27T06:07:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196302370",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6168083?v=4",
                "events_url": "https://api.github.com/users/josephernest/events{/privacy}",
                "followers_url": "https://api.github.com/users/josephernest/followers",
                "following_url": "https://api.github.com/users/josephernest/following{/other_user}",
                "gists_url": "https://api.github.com/users/josephernest/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/josephernest",
                "id": 6168083,
                "login": "josephernest",
                "node_id": "MDQ6VXNlcjYxNjgwODM=",
                "organizations_url": "https://api.github.com/users/josephernest/orgs",
                "received_events_url": "https://api.github.com/users/josephernest/received_events",
                "repos_url": "https://api.github.com/users/josephernest/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/josephernest/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/josephernest/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/josephernest"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Is there a way for Cython to automatically handle this?\r\n\r\nNo",
            "created_at": "2022-07-27T06:43:03Z",
            "html_url": "https://github.com/cython/cython/issues/4924#issuecomment-1196326309",
            "id": 1196326309,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4924",
            "node_id": "IC_kwDOABDGAc5HTn2l",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1196326309/reactions"
            },
            "updated_at": "2022-07-27T06:43:03Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1196326309",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4924/comments",
    "created_at": "2022-07-26T23:06:38Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4924/events",
    "html_url": "https://github.com/cython/cython/issues/4924",
    "id": 1318834718,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4924/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5Om9Ie",
    "number": 4924,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4924/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4924/timeline",
    "title": "[BUG] Compiling Cython code with more than 1000 global constants fails and never finishes",
    "updated_at": "2022-07-27T06:43:03Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4924",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6168083?v=4",
        "events_url": "https://api.github.com/users/josephernest/events{/privacy}",
        "followers_url": "https://api.github.com/users/josephernest/followers",
        "following_url": "https://api.github.com/users/josephernest/following{/other_user}",
        "gists_url": "https://api.github.com/users/josephernest/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/josephernest",
        "id": 6168083,
        "login": "josephernest",
        "node_id": "MDQ6VXNlcjYxNjgwODM=",
        "organizations_url": "https://api.github.com/users/josephernest/orgs",
        "received_events_url": "https://api.github.com/users/josephernest/received_events",
        "repos_url": "https://api.github.com/users/josephernest/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/josephernest/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/josephernest/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/josephernest"
    }
}