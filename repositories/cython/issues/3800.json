{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "<!--\r\n**Note:**\r\n- Do not use the bug and feature tracker for support requests. Use the `cython-users` mailing list instead.\r\n- Did you search for similar issues already? Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release? It might already have what you want to report. Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Describe the bug**\r\n\r\nWhen trying to specify a variadic typed `tuple`, analogous to how one might with `typing`, compilation works. However assigning the value with a `tuple` fails with the following error. Am guessing this is a user error (some other syntax is needed), but haven't figured out what that would be. Pointers in the right direction would be welcome\r\n\r\n```python\r\n      1 cpdef Py_ssize_t nbytes(m) except *:\r\n      2     cdef Py_ssize_t i, n = m.ndim, r = m.itemsize\r\n----> 3     cdef tuple[Py_ssize_t] shape = m.shape\r\n      4     for i in range(n):\r\n      5         r *= shape[i]\r\n\r\nTypeError: a bytes-like object is required, not 'tuple'\r\n```\r\n\r\n**To Reproduce**\r\n\r\nSetup code for `m`:\r\n\r\n```python\r\nfrom functools import reduce\r\nfrom operator import mul\r\n\r\ns = (10, 11, 12, 13, 14)\r\nm = memoryview(bytearray(reduce(mul, s))).cast(\"B\", s)\r\n\r\nnbytes(m)\r\n```\r\n\r\nThis works:\r\n\r\n```cython\r\nfrom typing import Tuple\r\n\r\ncpdef Py_ssize_t nbytes(m) except *:\r\n    cdef Py_ssize_t i, n = m.ndim, r = m.itemsize\r\n    shape: Tuple[Py_ssize_t, ...] = m.shape\r\n    for i in range(n):\r\n        r *= shape[i]\r\n    return r\r\n```\r\n\r\nThis errors:\r\n\r\n```cython\r\ncpdef Py_ssize_t nbytes(m) except *:\r\n    cdef Py_ssize_t i, n = m.ndim, r = m.itemsize\r\n    cdef tuple[Py_ssize_t] shape = m.shape\r\n    for i in range(n):\r\n        r *= shape[i]\r\n    return r\r\n```\r\n\r\n**Expected behavior**\r\n\r\nAssignment of a `tuple` works with proper conversion of its contents when accessed.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: macOS\r\n - Python version 3.8.5\r\n - Cython version 0.29.21\r\n\r\n**Additional context**\r\nNA\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "From Cython's point of view a tuple filled with `Py_ssize_t` looks very much like a tuple of any other Python object so the extra detail isn't useful to it. That's probably unlikely to change. You'll get the maximum possible optimization if you specify `shape` as a `tuple` and `r` as `Py_ssize_t`. (We could arguably use the detail to infer the type of `r`, of course)\r\n\r\nIt's more flexible with ignoring confusing annotations since we know that annotations are written exclusively for Cython.",
            "created_at": "2020-08-30T08:22:54Z",
            "html_url": "https://github.com/cython/cython/issues/3800#issuecomment-683391766",
            "id": 683391766,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3800",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM5MTc2Ng==",
            "performed_via_github_app": null,
            "updated_at": "2020-08-30T08:22:54Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/683391766",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> This works:\r\n```\r\n    shape: Tuple[Py_ssize_t, ...] = m.shape\r\n```\r\nIt \"works\" in the sense that Cython ignores it. ;)\r\n\r\n```\r\n----> 3     cdef tuple[Py_ssize_t] shape = m.shape\r\nTypeError: a bytes-like object is required, not 'tuple'\r\n```\r\nNot sure what exactly this does, but it looks like it's getting misparsed as something else, probably some kind of memoryview. Feels more like something that we should reject, at least for now. The bracket syntax is so heavily overloaded that we should be really careful not to add to it. (We may allow this at some point, but as long as it doesn't do anything sensible, we should keep users from interpreting stuff into it and instead report appropriate errors.)",
            "created_at": "2020-08-30T09:56:16Z",
            "html_url": "https://github.com/cython/cython/issues/3800#issuecomment-683400386",
            "id": 683400386,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3800",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzQwMDM4Ng==",
            "performed_via_github_app": null,
            "updated_at": "2020-08-30T09:56:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/683400386",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3800/comments",
    "created_at": "2020-08-30T00:12:01Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-08-30T09:52:21Z",
            "event": "labeled",
            "id": 3707172681,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM3MDcxNzI2ODE=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3707172681"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-08-30T09:52:21Z",
            "event": "labeled",
            "id": 3707172682,
            "label": {
                "color": "444444",
                "name": "Error Reporting"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM3MDcxNzI2ODI=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3707172682"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3800/events",
    "html_url": "https://github.com/cython/cython/issues/3800",
    "id": 688624916,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425557478,
            "name": "Error Reporting",
            "node_id": "MDU6TGFiZWw0MjU1NTc0Nzg=",
            "url": "https://api.github.com/repos/cython/cython/labels/Error%20Reporting"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3800/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU2ODg2MjQ5MTY=",
    "number": 3800,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[BUG] Using variadic typed `tuple` errors",
    "updated_at": "2020-08-30T09:56:17Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3800",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/3019665?v=4",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jakirkham",
        "id": 3019665,
        "login": "jakirkham",
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jakirkham"
    }
}