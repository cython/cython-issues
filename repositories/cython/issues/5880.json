{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nbuild python cinder version with `nvcr.io/nvidia/pytorch:22.08-py3` container, then install insightface by pip in virtual environment. however, pip reports a error:\r\n```\r\n(cpython3.10-a3c6e07ed141-compat-2d3356be745c) root@SINIAN-01:/opt# pip install -U insightface\r\nLooking in indexes: https://pypi.org/simple, https://pypi.ngc.nvidia.com\r\nCollecting insightface\r\n  Downloading insightface-0.7.3.tar.gz (439 kB)\r\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 439.5/439.5 kB 8.4 MB/s eta 0:00:00\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  × Getting requirements to build wheel did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [30 lines of output]\r\n      WARNING: pandoc not enabled\r\n      Traceback (most recent call last):\r\n        File \"/opt/venv/cpython3.10-a3c6e07ed141-compat-2d3356be745c/lib/python3.10/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 353, in <module>\r\n          main()\r\n        File \"/opt/venv/cpython3.10-a3c6e07ed141-compat-2d3356be745c/lib/python3.10/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 335, in main\r\n          json_out['return_val'] = hook(**hook_input['kwargs'])\r\n        File \"/opt/venv/cpython3.10-a3c6e07ed141-compat-2d3356be745c/lib/python3.10/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 118, in get_requires_for_build_wheel\r\n          return hook(config_settings)\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/setuptools/build_meta.py\", line 325, in get_requires_for_build_wheel\r\n          return self._get_build_requires(config_settings, requirements=['wheel'])\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/setuptools/build_meta.py\", line 295, in _get_build_requires\r\n          self.run_setup()\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/setuptools/build_meta.py\", line 311, in run_setup\r\n          exec(code, locals())\r\n        File \"<string>\", line 75, in <module>\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1008, in cythonize\r\n          ctx = Context.from_options(c_options)\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Compiler/Main.py\", line 100, in from_options\r\n          return cls(options.include_path, options.compiler_directives,\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Compiler/Main.py\", line 80, in __init__\r\n          self.cython_scope = CythonScope.create_cython_scope(self)\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Compiler/CythonScope.py\", line 154, in create_cython_scope\r\n          return CythonScope(context)\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Compiler/CythonScope.py\", line 17, in __init__\r\n          ModuleScope.__init__(self, u'cython', None, None)\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Compiler/Symtab.py\", line 1324, in __init__\r\n          self.process_include(Code.IncludeCode(\"Python.h\", initial=True))\r\n        File \"/tmp/pip-build-env-z9mcptwz/overlay/lib/python3.10/site-packages/Cython/Compiler/Symtab.py\", line 1493, in process_include\r\n          key = inc.mainpiece()\r\n      TypeError: mainpiece() takes exactly one argument (1152921504606846977 given)\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\r\n\r\n× Getting requirements to build wheel did not run successfully.\r\n│ exit code: 1\r\n╰─> See above for output.\r\n```\r\n\r\nDue to insightface depend cython, and it will install latest cython-3.0.6, the error could reproduce. when downgrade cython version to 0.29.36, it run successfully.\r\nmaybe it's a bug after 0.29.36\n\n### Code to reproduce the behaviour:\n\n_No response_\n\n### Expected behaviour\n\nrun successfully\n\n### OS\n\nLinux\n\n### Python version\n\n3.10.5+cinder\n\n### Cython version\n\n>= 3.0.0\n\n### Additional context\n\n_No response_",
    "closed_at": "2023-11-28T08:22:02Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "My guess would be that this is a Cinder bug. Cinder isn't something we support (or even something that Meta say they support, according to their own readme).\r\n\r\nBased on this comment https://github.com/facebookincubator/cinder/issues/129#issuecomment-1821168928 I suspect it isn't handling vectorcall and `PY_VECTORCALL_ARGUMENTS_OFFSET` correctly. You could try defining the CFLAG `CYTHON_VECTORCALL` to 0, or you could try to use a try installing Cython with `--no-cython-compile` (I don't know how you do that when it's a dependency).\r\n\r\nI think unless you can reproduce this with a \"proper\" Python version then you're on your own.\r\n\r\nWe'd be happy to merge a PR to ModuleSetupCode.c that makes Cinder work, but someone else would have to work out what's required I think.",
            "created_at": "2023-11-28T08:22:02Z",
            "html_url": "https://github.com/cython/cython/issues/5880#issuecomment-1829318060",
            "id": 1829318060,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5880",
            "node_id": "IC_kwDOABDGAc5tCS2s",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1829318060/reactions"
            },
            "updated_at": "2023-11-28T08:26:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1829318060",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> CYTHON_VECTORCALL\r\n\r\nThank you for replying.",
            "created_at": "2023-11-28T09:00:29Z",
            "html_url": "https://github.com/cython/cython/issues/5880#issuecomment-1829375129",
            "id": 1829375129,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5880",
            "node_id": "IC_kwDOABDGAc5tCgyZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1829375129/reactions"
            },
            "updated_at": "2023-11-28T09:00:29Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1829375129",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/84837019?v=4",
                "events_url": "https://api.github.com/users/HShan886/events{/privacy}",
                "followers_url": "https://api.github.com/users/HShan886/followers",
                "following_url": "https://api.github.com/users/HShan886/following{/other_user}",
                "gists_url": "https://api.github.com/users/HShan886/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/HShan886",
                "id": 84837019,
                "login": "HShan886",
                "node_id": "MDQ6VXNlcjg0ODM3MDE5",
                "organizations_url": "https://api.github.com/users/HShan886/orgs",
                "received_events_url": "https://api.github.com/users/HShan886/received_events",
                "repos_url": "https://api.github.com/users/HShan886/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/HShan886/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/HShan886/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/HShan886"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5880/comments",
    "created_at": "2023-11-28T07:42:51Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/84837019?v=4",
                "events_url": "https://api.github.com/users/HShan886/events{/privacy}",
                "followers_url": "https://api.github.com/users/HShan886/followers",
                "following_url": "https://api.github.com/users/HShan886/following{/other_user}",
                "gists_url": "https://api.github.com/users/HShan886/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/HShan886",
                "id": 84837019,
                "login": "HShan886",
                "node_id": "MDQ6VXNlcjg0ODM3MDE5",
                "organizations_url": "https://api.github.com/users/HShan886/orgs",
                "received_events_url": "https://api.github.com/users/HShan886/received_events",
                "repos_url": "https://api.github.com/users/HShan886/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/HShan886/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/HShan886/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/HShan886"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-11-28T07:44:23Z",
            "event": "renamed",
            "id": 11079891110,
            "node_id": "RTE_lADOABDGAc54CMYNzwAAAAKUabim",
            "performed_via_github_app": null,
            "rename": {
                "from": "[BUG] ",
                "to": "[BUG] cannot install insightface which depend cython>=3.0.0"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/11079891110"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-11-28T08:22:02Z",
            "event": "closed",
            "id": 11080240612,
            "node_id": "CE_lADOABDGAc54CMYNzwAAAAKUbw3k",
            "performed_via_github_app": null,
            "state_reason": "not_planned",
            "url": "https://api.github.com/repos/cython/cython/issues/events/11080240612"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-11-28T08:22:12Z",
            "event": "labeled",
            "id": 11080242284,
            "label": {
                "color": "000000",
                "name": "R: third party"
            },
            "node_id": "LE_lADOABDGAc54CMYNzwAAAAKUbxRs",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11080242284"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5880/events",
    "html_url": "https://github.com/cython/cython/issues/5880",
    "id": 2013840909,
    "labels": [
        {
            "color": "000000",
            "default": false,
            "description": "",
            "id": 1840758668,
            "name": "R: third party",
            "node_id": "MDU6TGFiZWwxODQwNzU4NjY4",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20third%20party"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5880/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc54CMYN",
    "number": 5880,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5880/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5880/timeline",
    "title": "[BUG] cannot install insightface which depend cython>=3.0.0",
    "updated_at": "2023-11-28T09:00:31Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5880",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/84837019?v=4",
        "events_url": "https://api.github.com/users/HShan886/events{/privacy}",
        "followers_url": "https://api.github.com/users/HShan886/followers",
        "following_url": "https://api.github.com/users/HShan886/following{/other_user}",
        "gists_url": "https://api.github.com/users/HShan886/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/HShan886",
        "id": 84837019,
        "login": "HShan886",
        "node_id": "MDQ6VXNlcjg0ODM3MDE5",
        "organizations_url": "https://api.github.com/users/HShan886/orgs",
        "received_events_url": "https://api.github.com/users/HShan886/received_events",
        "repos_url": "https://api.github.com/users/HShan886/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/HShan886/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/HShan886/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/HShan886"
    }
}