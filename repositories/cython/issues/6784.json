{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nWhen cythonizing a module with [PEP 526](https://peps.python.org/pep-0526/) annotations, the corresponding lines are reported as not covered in coverage report.\n\n### Code to reproduce the behaviour:\n\n### Example module\n```py\n# cython: linetrace=True\n# distutils: define_macros=CYTHON_TRACE=1\n\n\nfrom dataclasses import dataclass\n\n\n@dataclass\nclass Spam:\n    eggs: int\n```\n\n### Example test\n```py\nfrom spam import Spam\n\n\ndef test_spam():\n    assert Spam(42).eggs == 42\n```\n\n### Expected behaviour\n\n_No response_\n\n### OS\n\nLinux\n\n### Python version\n\n3.11.9\n\n### Cython version\n\n3.0.12\n\n### Additional context\n\nJust for the sake of visualization, this is the coverage report as generated by `coverage==7.8.0`:\n\n![Image](https://github.com/user-attachments/assets/9b22ccb9-289d-4f21-aea4-770ecf85c11e)",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "It might be worth trying the new Cython beta release for this and your other issue. \n\nI don't know whether it's different or not, but tracing/profiling has been extensively reworked, so it's definitely possible that things have changed (and that version is likely to be the starting point if we do want to fix anything)",
            "created_at": "2025-04-09T06:01:27Z",
            "html_url": "https://github.com/cython/cython/issues/6784#issuecomment-2788364640",
            "id": 2788364640,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6784",
            "node_id": "IC_kwDOABDGAc6mMxFg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2788364640/reactions"
            },
            "updated_at": "2025-04-09T06:01:27Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2788364640",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@da-woods unfortunately, this is reproducible with `3.1.0b1` and the current master as well; sorry for omitting that from the initial report. I have prepared a small repository that reproduces the issue: [hoefling/cython-issue-6874](https://github.com/hoefling/cython-issue-6874) with a set of pipelines that runs against python 3.11 / 3.12 / 3.13 and cython 3.0.12 / 3.1.0b1 / snapshot from the master branch. Links: [CI](https://github.com/hoefling/cython-issue-6874/actions/runs/14419322925/), [resulting coverage report on codecov](https://app.codecov.io/gh/hoefling/cython-issue-6874).\n\nInterestingly, it seems that with the 3.1.0b1 and development snapshot versions, `coverage` fails to collect anything with python 3.13 at all - looks like there is some sort of regression happening there.",
            "created_at": "2025-04-12T11:58:01Z",
            "html_url": "https://github.com/cython/cython/issues/6784#issuecomment-2798802724",
            "id": 2798802724,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6784",
            "node_id": "IC_kwDOABDGAc6m0lck",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2798802724/reactions"
            },
            "updated_at": "2025-04-12T11:58:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2798802724",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4455652?v=4",
                "events_url": "https://api.github.com/users/hoefling/events{/privacy}",
                "followers_url": "https://api.github.com/users/hoefling/followers",
                "following_url": "https://api.github.com/users/hoefling/following{/other_user}",
                "gists_url": "https://api.github.com/users/hoefling/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hoefling",
                "id": 4455652,
                "login": "hoefling",
                "node_id": "MDQ6VXNlcjQ0NTU2NTI=",
                "organizations_url": "https://api.github.com/users/hoefling/orgs",
                "received_events_url": "https://api.github.com/users/hoefling/received_events",
                "repos_url": "https://api.github.com/users/hoefling/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hoefling/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hoefling/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hoefling",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> unfortunately, this is reproducible with `3.1.0b1` and the current master as well; sorry for omitting that from the initial report.\n\nThanks. That isn't a great surprise, but it was definitely possible that it'd be different.\n\nI suppose it's fairly likely that we don't actually meaningfully execute those lines: we convert the annotations to strings anyway right now (i.e. PEP563-style). We could probably mark them as executed when we generate the strings, but I don't know if that's actually useful or not - it gets everyone's coverage numbers higher, but if we haven't run any code, does it mean anything? (The same will likely apply for everyone for the newer PEP649 deferred annotations in Python 3.14 - I don't know how `coverage` plans to report those).\n\n> Interestingly, it seems that with the 3.1.0b1 and development snapshot versions, coverage fails to collect anything with python 3.13 at all - looks like there is some sort of regression happening there.\n\nThat's known I think and is mostly on `coverage`'s side. We switched from the old to the new way of doing tracing, and they don't yet support it. And there's no way for us to make the new way",
            "created_at": "2025-04-12T12:07:28Z",
            "html_url": "https://github.com/cython/cython/issues/6784#issuecomment-2798805935",
            "id": 2798805935,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6784",
            "node_id": "IC_kwDOABDGAc6m0mOv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2798805935/reactions"
            },
            "updated_at": "2025-04-12T12:07:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2798805935",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "TBH I don't consider missing coverage to be this much of an issue - if the lines can be skipped in the `coverage` config, e.g. via something like\n```toml\n[tool.coverage.report]\nexclude_also = [\n    ...,\n    \"\\\\s*[^\\\\W\\\\d]\\\\w*: [^\\\\W\\\\d][\\\\w.\\\\[\\\\]]*$\",\n]\n```\nThis was just something that hit my eye since I have a project with 100% coverage and by cythonizing a module, the coverage suddenly dropped with no change for the tests 😎 ",
            "created_at": "2025-04-12T12:14:17Z",
            "html_url": "https://github.com/cython/cython/issues/6784#issuecomment-2798808715",
            "id": 2798808715,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6784",
            "node_id": "IC_kwDOABDGAc6m0m6L",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2798808715/reactions"
            },
            "updated_at": "2025-04-12T12:14:17Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2798808715",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4455652?v=4",
                "events_url": "https://api.github.com/users/hoefling/events{/privacy}",
                "followers_url": "https://api.github.com/users/hoefling/followers",
                "following_url": "https://api.github.com/users/hoefling/following{/other_user}",
                "gists_url": "https://api.github.com/users/hoefling/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hoefling",
                "id": 4455652,
                "login": "hoefling",
                "node_id": "MDQ6VXNlcjQ0NTU2NTI=",
                "organizations_url": "https://api.github.com/users/hoefling/orgs",
                "received_events_url": "https://api.github.com/users/hoefling/received_events",
                "repos_url": "https://api.github.com/users/hoefling/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hoefling/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hoefling/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hoefling",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6784/comments",
    "created_at": "2025-04-08T21:33:22Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-04-12T11:58:02Z",
            "event": "mentioned",
            "id": 17234309630,
            "node_id": "MEE_lADOABDGAc6xrnOyzwAAAAQDPrH-",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17234309630"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-04-12T11:58:02Z",
            "event": "subscribed",
            "id": 17234309633,
            "node_id": "SE_lADOABDGAc6xrnOyzwAAAAQDPrIB",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17234309633"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6784/events",
    "html_url": "https://github.com/cython/cython/issues/6784",
    "id": 2981000114,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6784/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6xrnOy",
    "number": 6784,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6784/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6784/timeline",
    "title": "[BUG] Incomplete coverage for PEP 526 type annotations",
    "type": null,
    "updated_at": "2025-04-12T12:14:18Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6784",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/4455652?v=4",
        "events_url": "https://api.github.com/users/hoefling/events{/privacy}",
        "followers_url": "https://api.github.com/users/hoefling/followers",
        "following_url": "https://api.github.com/users/hoefling/following{/other_user}",
        "gists_url": "https://api.github.com/users/hoefling/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/hoefling",
        "id": 4455652,
        "login": "hoefling",
        "node_id": "MDQ6VXNlcjQ0NTU2NTI=",
        "organizations_url": "https://api.github.com/users/hoefling/orgs",
        "received_events_url": "https://api.github.com/users/hoefling/received_events",
        "repos_url": "https://api.github.com/users/hoefling/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/hoefling/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hoefling/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/hoefling",
        "user_view_type": "public"
    }
}