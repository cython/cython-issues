{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "When run via CPython the following function:\r\n\r\n```\r\ndef appendinline():\r\n    y = []\r\n    y += 'ab'\r\n    return y\r\n```\r\nreturns `['a', 'b']`, but when compiled with Cython (0.29.13) the result is\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"concat.py\", line 11, in concat.appendinline\r\n    y += 'ab'\r\nTypeError: must be str, not list\r\n```\r\nlist +=, like extend, ordinarily accepts any iterable, not just a list.\r\n\r\nThe following functions work correctly when compiled with Cython, however:\r\n```\r\ndef appendchars(x):\r\n    x += 'hello'\r\n\r\ndef appendto(x):\r\n    y = []\r\n    y += x\r\n    return y\r\n```\r\n\r\nThe overly restrictive check seems to trigger only if both the target list and the argument to += are local to the function.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "I'm struggling to reproduce this (on Cython 0.29.13 -> master). Are you using any compiler directives/options that might be relevant?",
            "created_at": "2020-03-13T07:52:12Z",
            "html_url": "https://github.com/cython/cython/issues/3426#issuecomment-598595218",
            "id": 598595218,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3426",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODU5NTIxOA==",
            "updated_at": "2020-03-13T07:52:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/598595218",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "I'm building a module with cythonize -i, using Cython 0.29.13 and then importing that module into CPython 3.7.6.\r\n\r\n```\r\nThu Mar 12 17:46:26 cunkel@cunkel:~/misc\r\n1017$ cat concat.py \r\ndef appendchars(x):\r\n    x += 'hello'\r\n\r\ndef appendto(x):\r\n    y = []\r\n    y += x\r\n    return y\r\n\r\ndef appendinline():\r\n    y = []\r\n    y += 'ab'\r\n    return y\r\nThu Mar 12 17:46:30 cunkel@cunkel:~/misc\r\n1018$ cythonize -3 -i concat.py\r\nCompiling /home/cunkel/misc/concat.py because it changed.\r\n[1/1] Cythonizing /home/cunkel/misc/concat.py\r\nrunning build_ext\r\nbuilding 'concat' extension\r\ncreating /home/cunkel/misc/tmpk25abxp1/home\r\ncreating /home/cunkel/misc/tmpk25abxp1/home/cunkel\r\ncreating /home/cunkel/misc/tmpk25abxp1/home/cunkel/misc\r\ngcc -pthread -Wno-unused-result -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong -grecord-gcc-switches -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -fPIC -I/usr/include/python3.7m -c /home/cunkel/misc/concat.c -o /home/cunkel/misc/tmpk25abxp1/home/cunkel/misc/concat.o\r\ngcc -pthread -shared -Wl,-z,relro -Wl,--as-needed -Wl,-z,now -g /home/cunkel/misc/tmpk25abxp1/home/cunkel/misc/concat.o -L/usr/lib64 -lpython3.7m -o /home/cunkel/misc/concat.cpython-37m-x86_64-linux-gnu.so\r\nThu Mar 12 17:46:36 cunkel@cunkel:~/misc\r\n1019$ python\r\nPython 3.7.6 (default, Jan 30 2020, 09:44:41) \r\n[GCC 9.2.1 20190827 (Red Hat 9.2.1-1)] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import concat\r\n>>> concat.__file__\r\n'/home/cunkel/misc/concat.cpython-37m-x86_64-linux-gnu.so'\r\n>>> concat.appendchars([])\r\n>>> concat.appendto('abc')\r\n['a', 'b', 'c']\r\n>>> concat.appendinline()\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"concat.py\", line 11, in concat.appendinline\r\n    y += 'ab'\r\nTypeError: must be str, not list\r\n>>> \r\n```\r\n\r\n```\r\n1024$ cython --version\r\nCython version 0.29.13\r\nFri Mar 13 11:39:48 cunkel@cunkel:~/misc\r\n1025$ python --version\r\nPython 3.7.6\r\n```\r\n\r\nI can try building Cython master from source and seeing if I can still reproduce.",
            "created_at": "2020-03-13T18:44:47Z",
            "html_url": "https://github.com/cython/cython/issues/3426#issuecomment-598863341",
            "id": 598863341,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3426",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODg2MzM0MQ==",
            "updated_at": "2020-03-13T18:44:47Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/598863341",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/9013432?v=4",
                "events_url": "https://api.github.com/users/dscunkel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dscunkel/followers",
                "following_url": "https://api.github.com/users/dscunkel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dscunkel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dscunkel",
                "id": 9013432,
                "login": "dscunkel",
                "node_id": "MDQ6VXNlcjkwMTM0MzI=",
                "organizations_url": "https://api.github.com/users/dscunkel/orgs",
                "received_events_url": "https://api.github.com/users/dscunkel/received_events",
                "repos_url": "https://api.github.com/users/dscunkel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dscunkel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dscunkel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dscunkel"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks - can now reproduce. It's the `-3` that makes the difference (i.e. it know what to do with bytes but not with unicode).\r\n\r\nWith `-3` the code gets translated to `__Pyx_PyUnicode_Concat` (which obviously expects unicode) while without it gets translated to `PyNumber_InPlaceAdd` which is pretty generic and can handle anything any type with suitable operators.",
            "created_at": "2020-03-13T18:49:41Z",
            "html_url": "https://github.com/cython/cython/issues/3426#issuecomment-598865148",
            "id": 598865148,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3426",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODg2NTE0OA==",
            "updated_at": "2020-03-13T18:52:21Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/598865148",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks for the report @dscunkel and the analysis @da-woods. I think adding an additional type check in a new specialised macro might fix this. Either that, or disabling the optimisation if the LHS isn't known to be a unicode string, since this is actually an incorrect optimisation in general.\r\n\r\nPR welcome.",
            "created_at": "2020-03-15T07:23:05Z",
            "html_url": "https://github.com/cython/cython/issues/3426#issuecomment-599177169",
            "id": 599177169,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3426",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTE3NzE2OQ==",
            "updated_at": "2020-03-15T07:23:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/599177169",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3426/comments",
    "created_at": "2020-03-13T01:00:42Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-15T07:19:29Z",
            "event": "labeled",
            "id": 3130216466,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDMxMzAyMTY0NjY=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3130216466"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-15T07:19:29Z",
            "event": "labeled",
            "id": 3130216468,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDMxMzAyMTY0Njg=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3130216468"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/9013432?v=4",
                "events_url": "https://api.github.com/users/dscunkel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dscunkel/followers",
                "following_url": "https://api.github.com/users/dscunkel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dscunkel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dscunkel",
                "id": 9013432,
                "login": "dscunkel",
                "node_id": "MDQ6VXNlcjkwMTM0MzI=",
                "organizations_url": "https://api.github.com/users/dscunkel/orgs",
                "received_events_url": "https://api.github.com/users/dscunkel/received_events",
                "repos_url": "https://api.github.com/users/dscunkel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dscunkel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dscunkel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dscunkel"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-15T07:23:05Z",
            "event": "mentioned",
            "id": 3130219149,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEzMDIxOTE0OQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3130219149"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/9013432?v=4",
                "events_url": "https://api.github.com/users/dscunkel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dscunkel/followers",
                "following_url": "https://api.github.com/users/dscunkel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dscunkel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dscunkel",
                "id": 9013432,
                "login": "dscunkel",
                "node_id": "MDQ6VXNlcjkwMTM0MzI=",
                "organizations_url": "https://api.github.com/users/dscunkel/orgs",
                "received_events_url": "https://api.github.com/users/dscunkel/received_events",
                "repos_url": "https://api.github.com/users/dscunkel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dscunkel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dscunkel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dscunkel"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-15T07:23:05Z",
            "event": "subscribed",
            "id": 3130219150,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMzAyMTkxNTA=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3130219150"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-15T07:23:05Z",
            "event": "mentioned",
            "id": 3130219153,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEzMDIxOTE1Mw==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3130219153"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-15T07:23:05Z",
            "event": "subscribed",
            "id": 3130219154,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMzAyMTkxNTQ=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3130219154"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3426/events",
    "html_url": "https://github.com/cython/cython/issues/3426",
    "id": 580307543,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3426/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1ODAzMDc1NDM=",
    "number": 3426,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "TypeError on list += str",
    "updated_at": "2020-03-15T07:23:05Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3426",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/9013432?v=4",
        "events_url": "https://api.github.com/users/dscunkel/events{/privacy}",
        "followers_url": "https://api.github.com/users/dscunkel/followers",
        "following_url": "https://api.github.com/users/dscunkel/following{/other_user}",
        "gists_url": "https://api.github.com/users/dscunkel/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/dscunkel",
        "id": 9013432,
        "login": "dscunkel",
        "node_id": "MDQ6VXNlcjkwMTM0MzI=",
        "organizations_url": "https://api.github.com/users/dscunkel/orgs",
        "received_events_url": "https://api.github.com/users/dscunkel/received_events",
        "repos_url": "https://api.github.com/users/dscunkel/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/dscunkel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dscunkel/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/dscunkel"
    }
}