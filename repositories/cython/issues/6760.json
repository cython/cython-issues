{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe your issue\n\nIn looking at `__Pyx_PyObject_AsStringAndSize` and discussing improvements to it, noticed that we handle the `bytearray` case in this code path (below)\n\nhttps://github.com/cython/cython/blob/fa59a6c0182e422a0c8f2bae05ab6bbb34822ca0/Cython/Utility/TypeConversion.c#L276\n\nhttps://github.com/cython/cython/blob/fa59a6c0182e422a0c8f2bae05ab6bbb34822ca0/Cython/Utility/TypeConversion.c#L283-L291\n\nHere the underlying memory of the `bytearray` is returned as a `char*`\n\nHowever `bytearray`s are resizable either [indirectly in Python via slice assignment]( https://docs.python.org/3/library/stdtypes.html#memoryview ) or [directly in C via `PyByteArray_Resize`]( https://docs.python.org/3/c-api/bytearray.html#c.PyByteArray_Resize ). This is important as [resizing a `bytearray` can result in a new allocation]( https://github.com/python/cpython/blob/a26a301f8b09c1825b288fc8649f8174576361f4/Objects/bytearrayobject.c#L247-L263 ), which invalidates pointers to the old allocation\n\nA `bytearray` will track [when views of it are taken (like `memoryview`s)]( https://github.com/python/cpython/blob/a26a301f8b09c1825b288fc8649f8174576361f4/Objects/bytearrayobject.c#L61 ) or [released]( https://github.com/python/cpython/blob/a26a301f8b09c1825b288fc8649f8174576361f4/Objects/bytearrayobject.c#L80 ) and [will fail resizing if existing views remain]( https://github.com/python/cpython/blob/a26a301f8b09c1825b288fc8649f8174576361f4/Objects/bytearrayobject.c#L88-L91 )\n\nThough in our case, we are not taking a view in the standard manner. So the underlying buffer could be resized invalidating the pointers we have. Given this should we take a different approach to handling `bytearray`s and if so what should that look like?",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "It's been there for 12 years, which probably makes it too late to change rapidly.\n\nI don't think there's an alternative approach that we could take automatically (i.e. we couldn't hold a memoryview for the lifetime of the `char*` because we don't know that).\n\nIt's \"kind of safe\" - in that you have to keep a reference alive to it (like bytes) but also not resize it from this or another thread. That's arguably not a huge extra requirement to add onto the user, and it's usually possible to reason about\n\nSo I think the options are:\n* leave it as is,\n* add a warning to encourage the user to go through a memoryview",
            "created_at": "2025-03-26T07:50:30Z",
            "html_url": "https://github.com/cython/cython/issues/6760#issuecomment-2753503983",
            "id": 2753503983,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6760",
            "node_id": "IC_kwDOABDGAc6kHyLv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2753503983/reactions"
            },
            "updated_at": "2025-03-26T07:50:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2753503983",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> It's \"kind of safe\" - in that you have to keep a reference alive to it (like bytes) but also not resize it from this or another thread.\n\nYes, that was pretty much the reasoning for adding it. It's a really rare thing to have input objects change under your feet and usually requires some work to happen.\n\nI'd be happy to see one or more warnings added to the relevant doc sections.",
            "created_at": "2025-03-26T08:22:14Z",
            "html_url": "https://github.com/cython/cython/issues/6760#issuecomment-2753568458",
            "id": 2753568458,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6760",
            "node_id": "IC_kwDOABDGAc6kIB7K",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2753568458/reactions"
            },
            "updated_at": "2025-03-26T08:22:14Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2753568458",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6760/comments",
    "created_at": "2025-03-26T00:56:44Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-03-26T08:22:24Z",
            "event": "labeled",
            "id": 16987880123,
            "label": {
                "color": "444444",
                "name": "Documentation"
            },
            "node_id": "LE_lADOABDGAc6vuFpazwAAAAP0jnq7",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/16987880123"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6760/events",
    "html_url": "https://github.com/cython/cython/issues/6760",
    "id": 2948094554,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425561345,
            "name": "Documentation",
            "node_id": "MDU6TGFiZWw0MjU1NjEzNDU=",
            "url": "https://api.github.com/repos/cython/cython/labels/Documentation"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6760/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6vuFpa",
    "number": 6760,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6760/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6760/timeline",
    "title": "`__Pyx_PyObject_AsStringAndSize` extracts `bytearray`'s `char*` without holding view",
    "type": null,
    "updated_at": "2025-03-26T08:22:24Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6760",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jakirkham",
        "id": 3019665,
        "login": "jakirkham",
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jakirkham",
        "user_view_type": "public"
    }
}