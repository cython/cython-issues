{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "**Describe the bug**\r\nCython raises a `ValueError` when trying to specify a file under 2 levels of directories.\r\n\r\n**To Reproduce**\r\nWith the following directory tree:\r\n```py\r\nprimes/\r\n├─ core/\r\n│  ├─ example.py\r\nsetup.py\r\n```\r\nAnd `example.py` having the following content from [Basic Tutorial](https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html).\r\n```py\r\nimport cython\r\n\r\n\r\ndef primes(nb_primes: cython.int):\r\n    i: cython.int\r\n    p: cython.int[1000]\r\n\r\n    if nb_primes > 1000:\r\n        nb_primes = 1000\r\n\r\n    if not cython.compiled:  # Only if regular Python is running\r\n        p = [0] * 1000       # Make p work almost like a C array\r\n\r\n    len_p: cython.int = 0  # The current number of elements in p.\r\n    n: cython.int = 2\r\n    while len_p < nb_primes:\r\n        # Is n prime?\r\n        for i in p[:len_p]:\r\n            if n % i == 0:\r\n                break\r\n\r\n        # If no break occurred in the loop, we have a prime.\r\n        else:\r\n            p[len_p] = n\r\n            len_p += 1\r\n        n += 1\r\n\r\n    # Let's copy the result into a Python list:\r\n    result_as_list = [prime for prime in p[:len_p]]\r\n    return result_as_list\r\n```\r\nAlong with this `setup.py`:\r\n```py\r\nfrom Cython.Build import cythonize\r\nfrom setuptools import setup\r\n\r\n\r\nsetup(\r\n    packages=['primes'],\r\n    ext_modules=cythonize(\r\n        ['primes/core/example.py'],\r\n        language_level=3\r\n    ),\r\n)\r\n```\r\n\r\nThe following traceback can be seen:\r\n```py\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\%username%\\Projects\\cython-bug\\venv\\lib\\site-packages\\pep517\\in_process\\_in_process.py\", line 349, in <module>\r\n    main()\r\n  File \"C:\\Users\\%username%\\Projects\\cython-bug\\venv\\lib\\site-packages\\pep517\\in_process\\_in_process.py\", line 331, in main\r\n    json_out['return_val'] = hook(**hook_input['kwargs'])\r\n  File \"C:\\Users\\%username%\\Projects\\cython-bug\\venv\\lib\\site-packages\\pep517\\in_process\\_in_process.py\", line 117, in get_requires_for_build_wheel\r\n    return hook(config_settings)\r\n  File \"C:\\Users\\%username%\\AppData\\Local\\Temp\\build-env-w894fpli\\lib\\site-packages\\setuptools\\build_meta.py\", line 154, in get_requires_for_build_wheel\r\n    return self._get_build_requires(\r\n  File \"C:\\Users\\%username%\\AppData\\Local\\Temp\\build-env-w894fpli\\lib\\site-packages\\setuptools\\build_meta.py\", line 135, in _get_build_requires\r\n    self.run_setup()\r\n  File \"C:\\Users\\%username%\\AppData\\Local\\Temp\\build-env-w894fpli\\lib\\site-packages\\setuptools\\build_meta.py\", line 150, in run_setup\r\n    exec(compile(code, __file__, 'exec'), locals())\r\n  File \"setup.py\", line 7, in <module>\r\n    ext_modules=cythonize(\r\n  File \"C:\\Users\\%username%\\AppData\\Local\\Temp\\build-env-w894fpli\\lib\\site-packages\\Cython\\Build\\Dependencies.py\", line 965, in cythonize\r\n    module_list, module_metadata = create_extension_list(\r\n  File \"C:\\Users\\%username%\\AppData\\Local\\Temp\\build-env-w894fpli\\lib\\site-packages\\Cython\\Build\\Dependencies.py\", line 815, in create_extension_list\r\n    for file in nonempty(sorted(extended_iglob(filepattern)), \"'%s' doesn't match any files\" % filepattern):\r\n  File \"C:\\Users\\%username%\\AppData\\Local\\Temp\\build-env-w894fpli\\lib\\site-packages\\Cython\\Build\\Dependencies.py\", line 114, in nonempty\r\n    raise ValueError(error_msg)\r\nValueError: 'primes/core/example.py' doesn't match any files\r\n\r\nERROR Backend subproccess exited when trying to invoke get_requires_for_build_wheel\r\n```\r\n**Expected behavior**\r\nI don't see any reason why this would not compile. I have tried both `python -m build` and `python setup.py build`.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Windows\r\n - Python version: Python 3.9.5\r\n - Cython version: Tested on most recent on PyPi as well as installed directly from GitHub",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "This is future me!\r\n\r\nI don't exactly know what I changed to get it working, but `python setup.py build_ext --inplace` as well as `python setup.py build` both work running the code again.\r\n\r\nI do have a hypothesis as to why `python -m build` is failing.. because of how it runs twice, and creates a file called `SOURCES.txt`, the second time Cython may not have the permission required. See the file for the above case becomes:\r\n```\r\npyproject.toml\r\nsetup.py\r\nUNKNOWN.egg-info/PKG-INFO\r\nUNKNOWN.egg-info/SOURCES.txt\r\nUNKNOWN.egg-info/dependency_links.txt\r\nUNKNOWN.egg-info/top_level.txt\r\nprimes/core/example.c\r\nprimes/core/example.c\r\n```\r\n`primes/core/example.py` isn't present in this file so Cython may not have permission to open it. I'll have to investigate more to see if this is the case, just throwing it out there.\r\n\r\nNote that my `pyproject.toml` looks like this:\r\n```toml\r\n[build-system]\r\nrequires = [\"setuptools\", \"wheel\", \"git+https://github.com/cython/cython.git\"]\r\n```",
            "created_at": "2021-12-22T18:18:01Z",
            "html_url": "https://github.com/cython/cython/issues/4330#issuecomment-999775017",
            "id": 999775017,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4330",
            "node_id": "IC_kwDOABDGAc47l1sp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/999775017/reactions"
            },
            "updated_at": "2021-12-22T18:18:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/999775017",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38372706?v=4",
                "events_url": "https://api.github.com/users/Bluenix2/events{/privacy}",
                "followers_url": "https://api.github.com/users/Bluenix2/followers",
                "following_url": "https://api.github.com/users/Bluenix2/following{/other_user}",
                "gists_url": "https://api.github.com/users/Bluenix2/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Bluenix2",
                "id": 38372706,
                "login": "Bluenix2",
                "node_id": "MDQ6VXNlcjM4MzcyNzA2",
                "organizations_url": "https://api.github.com/users/Bluenix2/orgs",
                "received_events_url": "https://api.github.com/users/Bluenix2/received_events",
                "repos_url": "https://api.github.com/users/Bluenix2/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Bluenix2/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Bluenix2/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Bluenix2",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I had a similar problem to this, but I have a workaround.\r\n\r\nI have a `.pyx` file (though only under 1 diretory), and I got a similar \"doesn't match any files\" error.\r\nI tried adding the `.pyx` file manually to `SOURCES.txt` like this:\r\n```\r\ndir/foo.cpp\r\ndir/foo.pyx\r\n```\r\nAnd after re-running `python -m build` it worked.\r\n\r\nI hope this workaround helps, or it can lead to a fix in the future.\r\nOr maybe I am missing something... Then please correct me.\r\n\r\nOS: Windows 10\r\nPython version: 3.11.0\r\nCython version: 3.0.11",
            "created_at": "2024-12-12T12:19:02Z",
            "html_url": "https://github.com/cython/cython/issues/4330#issuecomment-2538751480",
            "id": 2538751480,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4330",
            "node_id": "IC_kwDOABDGAc6XUkX4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2538751480/reactions"
            },
            "updated_at": "2024-12-12T12:19:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2538751480",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/177629930?v=4",
                "events_url": "https://api.github.com/users/mulkr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mulkr/followers",
                "following_url": "https://api.github.com/users/mulkr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mulkr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mulkr",
                "id": 177629930,
                "login": "mulkr",
                "node_id": "U_kgDOCpZq6g",
                "organizations_url": "https://api.github.com/users/mulkr/orgs",
                "received_events_url": "https://api.github.com/users/mulkr/received_events",
                "repos_url": "https://api.github.com/users/mulkr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mulkr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mulkr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mulkr",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4330/comments",
    "created_at": "2021-08-08T20:26:02Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4330/events",
    "html_url": "https://github.com/cython/cython/issues/4330",
    "id": 963508651,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4330/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU5NjM1MDg2NTE=",
    "number": 4330,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4330/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4330/timeline",
    "title": "[BUG] Cython cannot find files under 2 levels of directories",
    "updated_at": "2024-12-12T12:19:04Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4330",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/38372706?v=4",
        "events_url": "https://api.github.com/users/Bluenix2/events{/privacy}",
        "followers_url": "https://api.github.com/users/Bluenix2/followers",
        "following_url": "https://api.github.com/users/Bluenix2/following{/other_user}",
        "gists_url": "https://api.github.com/users/Bluenix2/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Bluenix2",
        "id": 38372706,
        "login": "Bluenix2",
        "node_id": "MDQ6VXNlcjM4MzcyNzA2",
        "organizations_url": "https://api.github.com/users/Bluenix2/orgs",
        "received_events_url": "https://api.github.com/users/Bluenix2/received_events",
        "repos_url": "https://api.github.com/users/Bluenix2/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Bluenix2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Bluenix2/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Bluenix2",
        "user_view_type": "public"
    }
}