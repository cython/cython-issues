{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!--\r\n**PLEASE READ THIS FIRST:**\r\n- Do not use the bug and feature tracker for support requests. Use the `cython-users` mailing list instead.\r\n- Did you search for similar issues already? Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release? It might already have what you want to report. Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Describe the bug**\r\nWith Cython 0.29.22, we see SIGSEGV when we try to Cythonize pretty much anything, will try to verify it is everything.\r\n\r\n**To Reproduce** try to cythonize NumPy with Python 3.10.0a6. It worked with 3.10.0a5.\r\n\r\n```\r\nProcessing numpy/random/_bounded_integers.pxd.in\r\nProcessing numpy/random/mtrand.pyx\r\nTraceback (most recent call last):\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/tools/cythonize.py\", line 235, in <module>\r\n    main()\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/tools/cythonize.py\", line 231, in main\r\n    find_process_files(root_dir)\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/tools/cythonize.py\", line 222, in find_process_files\r\n    process(root_dir, fromfile, tofile, function, hash_db)\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/tools/cythonize.py\", line 188, in process\r\n    processor_function(fromfile, tofile)\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/tools/cythonize.py\", line 77, in process_pyx\r\n    subprocess.check_call(\r\n  File \"/usr/lib64/python3.10/subprocess.py\", line 378, in check_call\r\n    raise CalledProcessError(retcode, cmd)\r\nsubprocess.CalledProcessError: Command '['/usr/bin/python3', '-m', 'cython', '-3', '--fast-fail', '-o', 'mtrand.c', 'mtrand.pyx']' died with <Signals.SIGSEGV: 11>.\r\nCythonizing sources\r\nTraceback (most recent call last):\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/setup.py\", line 513, in <module>\r\n    setup_package()\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/setup.py\", line 493, in setup_package\r\n    generate_cython()\r\n  File \"/builddir/build/BUILD/numpy-1.20.1/setup.py\", line 290, in generate_cython\r\n    raise RuntimeError(\"Running cythonize failed!\")\r\nRuntimeError: Running cythonize failed!\r\n```\r\n\r\n**Expected behavior**\r\nNumPy should cythonize fine.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Fedora Linux 35\r\n - Python version 3.10.0a6\r\n - Cython version 0.29.22\r\n\r\n**Additional context**\r\nWe are rebuilding all Fedora Python packages with the alpha releases of Python 3.10 to see what is broken.\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I cannot reproduce this from the py2.py3-none-any wheel.",
            "created_at": "2021-03-04T08:59:41Z",
            "html_url": "https://github.com/cython/cython/issues/4025#issuecomment-790449268",
            "id": 790449268,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4025",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDQ0OTI2OA==",
            "performed_via_github_app": null,
            "updated_at": "2021-03-04T08:59:41Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/790449268",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
                "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
                "followers_url": "https://api.github.com/users/hroncok/followers",
                "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
                "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hroncok",
                "id": 2401856,
                "login": "hroncok",
                "node_id": "MDQ6VXNlcjI0MDE4NTY=",
                "organizations_url": "https://api.github.com/users/hroncok/orgs",
                "received_events_url": "https://api.github.com/users/hroncok/received_events",
                "repos_url": "https://api.github.com/users/hroncok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hroncok"
            }
        },
        {
            "author_association": "NONE",
            "body": "Reproducer:\r\n\r\n```\r\n$ python3.10 -m venv __venv3.10_\r\n$ . __venv3.10_/bin/activate\r\n$ pip install https://files.pythonhosted.org/packages/d3/38/adc49a5aca4f644e6322237089fdcf194084f5fe41445e6e632f28b32bf7/Cython-0.29.22.tar.gz\r\n$ cythonize -3 _ruamel_yaml.pyx\r\n```\r\n\r\nI've got _ruamel_yaml.pyx from https://sourceforge.net/p/ruamel-yaml-clib/code/ci/default/tree/_ruamel_yaml.pyx\r\n\r\nWhen I remove parts of the file, I can sometimes reproduce it, but sometimes not. Trying to produce a minimal reproducer but is seems arbitrary. Remove one function and the SIGSEGV stays, remove another and it is gone.",
            "created_at": "2021-03-04T09:08:25Z",
            "html_url": "https://github.com/cython/cython/issues/4025#issuecomment-790455277",
            "id": 790455277,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4025",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDQ1NTI3Nw==",
            "performed_via_github_app": null,
            "updated_at": "2021-03-04T09:08:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/790455277",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
                "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
                "followers_url": "https://api.github.com/users/hroncok/followers",
                "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
                "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hroncok",
                "id": 2401856,
                "login": "hroncok",
                "node_id": "MDQ6VXNlcjI0MDE4NTY=",
                "organizations_url": "https://api.github.com/users/hroncok/orgs",
                "received_events_url": "https://api.github.com/users/hroncok/received_events",
                "repos_url": "https://api.github.com/users/hroncok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hroncok"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "> I cannot reproduce this from the py2.py3-none-any wheel.\r\n\r\nThat suggests that Cython has compiled _itself_ incorrectly - the \"none\" wheel will just run an uncompiled version of Cython.",
            "created_at": "2021-03-04T09:08:44Z",
            "html_url": "https://github.com/cython/cython/issues/4025#issuecomment-790455500",
            "id": 790455500,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4025",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDQ1NTUwMA==",
            "performed_via_github_app": null,
            "updated_at": "2021-03-04T09:08:44Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/790455500",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Yes, that is the idea. When Cython is compiled on 3.10.0a6, it SIGSEGVs.",
            "created_at": "2021-03-04T09:27:12Z",
            "html_url": "https://github.com/cython/cython/issues/4025#issuecomment-790468183",
            "id": 790468183,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4025",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDQ2ODE4Mw==",
            "performed_via_github_app": null,
            "updated_at": "2021-03-04T09:27:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/790468183",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
                "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
                "followers_url": "https://api.github.com/users/hroncok/followers",
                "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
                "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hroncok",
                "id": 2401856,
                "login": "hroncok",
                "node_id": "MDQ6VXNlcjI0MDE4NTY=",
                "organizations_url": "https://api.github.com/users/hroncok/orgs",
                "received_events_url": "https://api.github.com/users/hroncok/received_events",
                "repos_url": "https://api.github.com/users/hroncok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hroncok"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "At least when I try _ruamel_yaml.pyx, the segmentation fault comes from inside a fairly innocent looking line:\r\n\r\n`__Pyx_XDECREF(__pyx_v_childretval);` which is just in the cleanup for `TreeVisitor._visitchildren`\r\n\r\nUltimately the error inside Python is `_PyGCHead_SET_NEXT(prev, next);` with a `prev==NULL`.\r\n\r\nI don't know what that tells us though.",
            "created_at": "2021-03-04T09:46:07Z",
            "html_url": "https://github.com/cython/cython/issues/4025#issuecomment-790481798",
            "id": 790481798,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4025",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDQ4MTc5OA==",
            "performed_via_github_app": null,
            "updated_at": "2021-03-04T09:46:07Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/790481798",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "As far as I can tell all of the Cython 3.0alpha releases don't have this bug (at least for the _ruamel_yaml.pyx file). But I can't bisect to anything useful since too many of the past releases don't compile at all for Python 3.10 for unrelated reasons",
            "created_at": "2021-03-04T11:46:43Z",
            "html_url": "https://github.com/cython/cython/issues/4025#issuecomment-790555948",
            "id": 790555948,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4025",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDU1NTk0OA==",
            "performed_via_github_app": null,
            "updated_at": "2021-03-04T14:34:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/790555948",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4025/comments",
    "created_at": "2021-03-04T08:46:55Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4025/events",
    "html_url": "https://github.com/cython/cython/issues/4025",
    "id": 821907253,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4025/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4MjE5MDcyNTM=",
    "number": 4025,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[BUG] Cython 0.29.22 SIGSEGV with Python 3.10.0a6",
    "updated_at": "2021-03-04T14:34:31Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4025",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4",
        "events_url": "https://api.github.com/users/hroncok/events{/privacy}",
        "followers_url": "https://api.github.com/users/hroncok/followers",
        "following_url": "https://api.github.com/users/hroncok/following{/other_user}",
        "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/hroncok",
        "id": 2401856,
        "login": "hroncok",
        "node_id": "MDQ6VXNlcjI0MDE4NTY=",
        "organizations_url": "https://api.github.com/users/hroncok/orgs",
        "received_events_url": "https://api.github.com/users/hroncok/received_events",
        "repos_url": "https://api.github.com/users/hroncok/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/hroncok"
    }
}