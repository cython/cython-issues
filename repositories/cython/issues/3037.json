{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Hi I have a problem while free the memory spaces after the vector usage.\r\n\r\n```\r\ncdef vector[Mystruct] cb\r\n.... #do something\r\ncb.clear()\r\n```\r\n\r\nAfter running the program, the memory usage is not reduced which indicate the usage memory is not deallocated. in vector `.clear()` function it is not free the memory usage. In C++ 11 we can use `shrink_to_fit()` function as state in [here](https://stackoverflow.com/questions/35514909/how-to-clear-vector-in-c-from-memory), however I can't use shrink_to_fit function inside the cython, and throws this error while compiling it.\r\n\r\n```\r\nhas no member named ‘shrink_to_fit’\r\n   __pyx_v_cb.shrink_to_fit();\r\n\r\n```\r\nI also consider swap() function where we can just swap the vector by 0 length vector but its still not working.\r\n```\r\ncdef vector[Mystruct] cb\r\ncdef vector[Mystruct] dummy\r\n.... #do something\r\ncb.swap(dummy)\r\n```\r\nI also use garbage collector in python but also not working.\r\n```\r\nimport gc\r\ncdef vector[Mystruct] cb\r\n.... #do something\r\ncb.clear()\r\ngc.collect()\r\n```\r\nSo is there any solution for this problem?, I am using `Cython 0.29.11` and `gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.10)`.\r\n\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> the memory usage is not reduced\r\n\r\nDo you mean the memory used by the process? That's not necessarily a good indicator as it tends to be influenced by many factors, not just single chunks of memory.\r\n\r\n> can't use `shrink_to_fit`\r\n\r\nYou have to enable C++11 support in your C compiler for that, e.g. `CXXFLAGS=-std=c++11`.\r\n\r\nCan you provide a complete example that shows your problem? It's quite likely that the `#do something` has more impact on what you are witnessing than the `cb.clear()`.\r\n\r\nIn any case, this is most likely not related to a bug in Cython, and thus shouldn't be discussed on the bug tracker. The cython-users mailing list seems a more appropriate place.",
            "created_at": "2019-07-09T07:26:24Z",
            "html_url": "https://github.com/cython/cython/issues/3037#issuecomment-509524061",
            "id": 509524061,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3037",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTUyNDA2MQ==",
            "updated_at": "2019-07-09T07:27:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/509524061",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hello @scoder, thanks for the reply. \r\nYes, it is the memory used by the process because I have assigned a huge vector to record some data, then after I used it I want to free the memory. However, I can't free it. So do something is only cython vector `push_back()` function which spends about 2GB of memory. I think `cb.clear()` is the problem because before and after call `cb.clear()` it not reduce some memory, maybe at least 1 GB or even 2GB. Second is how to enable C++11 for cython?, I have a problem while using `extra_compile_args=[\"-std=c++11\"]` in linux.  It gives me this error `ValueError: got unknown compilation option, please remove: extra_compile_args` . The last I am sorry since I am newbie in here I don't know that the mailing list is exist. Is there any cython forum discussion which more convenient rather than a mailing list?\r\n-Thank you-",
            "created_at": "2019-07-09T07:56:26Z",
            "html_url": "https://github.com/cython/cython/issues/3037#issuecomment-509533897",
            "id": 509533897,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3037",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTUzMzg5Nw==",
            "updated_at": "2019-07-09T07:56:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/509533897",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/2309538?v=4",
                "events_url": "https://api.github.com/users/herleeyandi/events{/privacy}",
                "followers_url": "https://api.github.com/users/herleeyandi/followers",
                "following_url": "https://api.github.com/users/herleeyandi/following{/other_user}",
                "gists_url": "https://api.github.com/users/herleeyandi/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/herleeyandi",
                "id": 2309538,
                "login": "herleeyandi",
                "node_id": "MDQ6VXNlcjIzMDk1Mzg=",
                "organizations_url": "https://api.github.com/users/herleeyandi/orgs",
                "received_events_url": "https://api.github.com/users/herleeyandi/received_events",
                "repos_url": "https://api.github.com/users/herleeyandi/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/herleeyandi/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/herleeyandi/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/herleeyandi"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Hello @scoder, thanks for the reply.\r\n> Yes, it is the memory used by the process because I have assigned a huge vector to record some data, then after I used it I want to free the memory. However, I can't free it. So do something is only cython vector `push_back()` function which spends about 2GB of memory. I think `cb.clear()` is the problem because before and after call `cb.clear()` it not reduce some memory, maybe at least 1 GB or even 2GB. Second is how to enable C++11 for cython?, I have a problem while using `extra_compile_args=[\"-std=c++11\"]` in linux. It gives me this error `ValueError: got unknown compilation option, please remove: extra_compile_args` . The last I am sorry since I am newbie in here I don't know that the mailing list is exist. Is there any cython forum discussion which more convenient rather than a mailing list?\r\n> -Thank you-\r\n\r\nYou can try here: https://groups.google.com/forum/#!forum/cython-users\r\nBut answering the question, it looks like you're putting the `extra_compile_args` in the wrong place, they should be inside the arguments for `Extension`, not for `setup` (if you're using a setup file). Otherwise, you can pass arguments to `cythonize` if that's hou you're building it, or you can launch the compilation command pre-defining the flags beforehand, e.g. `CXXFLAGS=-std=c++11 python setup.py build_ext --inplace --force`.\r\n\r\nBTW, if you're returning this object outside of cython and then passing it again, it won't be a C++ vector anymore (so no methods like those), in case that's what you're doing.",
            "created_at": "2019-07-15T15:02:38Z",
            "html_url": "https://github.com/cython/cython/issues/3037#issuecomment-511439667",
            "id": 511439667,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3037",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUxMTQzOTY2Nw==",
            "updated_at": "2019-07-15T15:02:55Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/511439667",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/11860098?v=4",
                "events_url": "https://api.github.com/users/david-cortes/events{/privacy}",
                "followers_url": "https://api.github.com/users/david-cortes/followers",
                "following_url": "https://api.github.com/users/david-cortes/following{/other_user}",
                "gists_url": "https://api.github.com/users/david-cortes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/david-cortes",
                "id": 11860098,
                "login": "david-cortes",
                "node_id": "MDQ6VXNlcjExODYwMDk4",
                "organizations_url": "https://api.github.com/users/david-cortes/orgs",
                "received_events_url": "https://api.github.com/users/david-cortes/received_events",
                "repos_url": "https://api.github.com/users/david-cortes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/david-cortes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/david-cortes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/david-cortes"
            }
        },
        {
            "author_association": "NONE",
            "body": "`clear()` must not reduce allocated memory:\r\n\r\nfrom https://en.cppreference.com/w/cpp/container/vector/clear :\r\n> Leaves the capacity() of the vector unchanged (note: the standard's restriction on the changes to capacity is in the specification of vector::reserve, see [1])\r\n\r\nAs your vector is (assumily) stack allocated, simply leaving the function should suffice to not only destruct every object but also to free any space held by the vector. You can introduce an extra scope in Cython by creating a new sub-function. Not nice but also not too bad.\r\n\r\nOnly if you want to reuse the same vector, or if you hold the vector in a Extension Type and need to control its lifetime, a call to `clear()` and `shrink_to_fit()` should be neccessary.",
            "created_at": "2019-07-16T10:59:27Z",
            "html_url": "https://github.com/cython/cython/issues/3037#issuecomment-511769140",
            "id": 511769140,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3037",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUxMTc2OTE0MA==",
            "updated_at": "2019-07-16T11:04:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/511769140",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/1858546?v=4",
                "events_url": "https://api.github.com/users/sehoffmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/sehoffmann/followers",
                "following_url": "https://api.github.com/users/sehoffmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/sehoffmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/sehoffmann",
                "id": 1858546,
                "login": "sehoffmann",
                "node_id": "MDQ6VXNlcjE4NTg1NDY=",
                "organizations_url": "https://api.github.com/users/sehoffmann/orgs",
                "received_events_url": "https://api.github.com/users/sehoffmann/received_events",
                "repos_url": "https://api.github.com/users/sehoffmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/sehoffmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sehoffmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/sehoffmann"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3037/comments",
    "created_at": "2019-07-09T07:09:49Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-07-09T07:56:26Z",
            "event": "mentioned",
            "id": 2468447927,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjQ2ODQ0NzkyNw==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2468447927"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-07-09T07:56:26Z",
            "event": "subscribed",
            "id": 2468447928,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI0Njg0NDc5Mjg=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2468447928"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-07-15T15:02:38Z",
            "event": "mentioned",
            "id": 2483223956,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjQ4MzIyMzk1Ng==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2483223956"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-07-15T15:02:38Z",
            "event": "subscribed",
            "id": 2483223960,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI0ODMyMjM5NjA=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2483223960"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3037/events",
    "html_url": "https://github.com/cython/cython/issues/3037",
    "id": 465609467,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3037/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0NjU2MDk0Njc=",
    "number": 3037,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Free vector memory in cython",
    "updated_at": "2019-07-16T11:04:31Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3037",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/2309538?v=4",
        "events_url": "https://api.github.com/users/herleeyandi/events{/privacy}",
        "followers_url": "https://api.github.com/users/herleeyandi/followers",
        "following_url": "https://api.github.com/users/herleeyandi/following{/other_user}",
        "gists_url": "https://api.github.com/users/herleeyandi/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/herleeyandi",
        "id": 2309538,
        "login": "herleeyandi",
        "node_id": "MDQ6VXNlcjIzMDk1Mzg=",
        "organizations_url": "https://api.github.com/users/herleeyandi/orgs",
        "received_events_url": "https://api.github.com/users/herleeyandi/received_events",
        "repos_url": "https://api.github.com/users/herleeyandi/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/herleeyandi/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/herleeyandi/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/herleeyandi"
    }
}