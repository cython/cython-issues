{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Describe your issue\n\n#6108 did the bare minimum implementation of `PyObject_LengthHint` needed to compile and run in the Limited API - essentially \"length hint is always optional so just fail to find it and return the default value\".\r\n\r\nThat's fine in that it works and is no worse than the code that's in Cython 3.0 right now (which doesn't use length hint). However there's no reason not to do it right.\r\n\r\nThe implementation in Python is at https://github.com/python/cpython/blob/dd44ab994b7262f0704d64996e0a1bc37b233407/Objects/abstract.c#L92 and can likely be adapted.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> However there's no reason not to do it right.\r\n\r\nExcept speed. For short data structures (which are not uncommon), even just trying to read the length hint from a Python attribute and unpacking it might take a major part of the time for building the entire C/C++ data structure. The slower the sequence of C-API calls for pre-sizing the container, the larger the data structures for which it degrades the performance.\r\n\r\nHowever, it might actually be worth inlining the fast path of `PyObject_Length()` for CPython, i.e. checking `sq_length` and calling it to get a size. Most containers will provide it, and generators etc. won't have it.",
            "created_at": "2024-04-01T15:09:34Z",
            "html_url": "https://github.com/cython/cython/issues/6121#issuecomment-2029915074",
            "id": 2029915074,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6121",
            "node_id": "IC_kwDOABDGAc54_gvC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2029915074/reactions"
            },
            "updated_at": "2024-04-01T15:09:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2029915074",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6121/comments",
    "created_at": "2024-04-01T14:38:31Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-04-01T14:38:31Z",
            "event": "labeled",
            "id": 12311521989,
            "label": {
                "color": "F5AB5D",
                "name": "limited api"
            },
            "node_id": "LE_lADOABDGAc6EOjoUzwAAAALd0urF",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/12311521989"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6121/events",
    "html_url": "https://github.com/cython/cython/issues/6121",
    "id": 2218408468,
    "labels": [
        {
            "color": "F5AB5D",
            "default": false,
            "description": "",
            "id": 4210073287,
            "name": "limited api",
            "node_id": "LA_kwDOABDGAc768J7H",
            "url": "https://api.github.com/repos/cython/cython/labels/limited%20api"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6121/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6EOjoU",
    "number": 6121,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6121/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6121/timeline",
    "title": "[ENH] Implement __Pyx_PyObject_LengthHint properly on the limited API",
    "updated_at": "2024-04-01T15:09:49Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6121",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
        "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
        "followers_url": "https://api.github.com/users/da-woods/followers",
        "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
        "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/da-woods",
        "id": 10536947,
        "login": "da-woods",
        "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
        "organizations_url": "https://api.github.com/users/da-woods/orgs",
        "received_events_url": "https://api.github.com/users/da-woods/received_events",
        "repos_url": "https://api.github.com/users/da-woods/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/da-woods"
    }
}