{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I am building an extension that I want to be able to call from C++. The signature of the function is:\r\n```cython\r\ncdef public int count_cwrap(int limit) except -1\r\n```\r\n\r\nThis gets this C signature in Windows:\r\n```C\r\n__PYX_EXTERN_C int __pyx_f_19pythagorean_triples_count_cwrap(int);\r\n```\r\nand this signature in Linux:\r\n```C\r\n__PYX_EXTERN_C int count_cwrap(int);\r\n```\r\nCalling the function from windows works, but it seems like a bug to me, and would prefer the Linux behavior.\r\n\r\nHere is the full code to reproduce.\r\npythagorean_triples.pyx:\r\n```python\r\n# cython: language_level=3\r\nimport time\r\nimport cython\r\nimport numpy as np\r\n \r\ndef count(limit):\r\n    if limit < 3:\r\n       raise ValueError('Invalid limit value')\r\n    arr = np.zeros(10)\r\n    result = cython.declare(cython.int, 0)\r\n    a = cython.declare(cython.int)\r\n    b = cython.declare(cython.int)\r\n    c = cython.declare(cython.int)\r\n    for a in range(1, limit + 1):\r\n        for b in range(a + 1, limit + 1):\r\n            for c in range(b + 1, limit + 1):\r\n                if c * c > a * a + b * b:\r\n                    break\r\n\r\n                if c * c == (a * a + b * b):\r\n                    result += 1\r\n    return result\r\n\r\ncdef public int count_cwrap(int limit) except -1:\r\n    return count(limit)\r\n\r\nif __name__ == '__main__':\r\n    start = time.time()\r\n    result = count(1000)\r\n    duration = time.time() - start\r\n    print(result, duration)`\r\n```\r\n\r\nsetup_pyx.py for Windows\r\nNote that I need to export the mangled name, otherwise the function is not in the symbol table of the produced pyd file or the lib for linking. \r\n```python\r\nfrom distutils.core import setup\r\nfrom distutils.extension import Extension\r\nfrom Cython.Build import cythonize\r\n \r\nsetup(\r\n    ext_modules = cythonize(Extension('pythagorean_triples', sources = ['pythagorean_triples.pyx'], \r\n\texport_symbols=['__pyx_f_19pythagorean_triples_count_cwrap']))\r\n)\r\n```\r\n\r\nsetup_pyx.py for Linux:\r\nI don't need to export anything here. Everything is much easier and works properly.\r\n```python\r\nfrom distutils.core import setup\r\nfrom distutils.extension import Extension\r\nfrom Cython.Build import cythonize\r\n\r\nsetup(\r\n    ext_modules = cythonize(Extension('pythagorean_triples', sources = ['pythagorean_triples.pyx']))\r\n)\r\n```\r\n\r\nIn Linux, I am building with ```python3 setup_pyx.py build_ext --inplace```\r\nIn Windows I am building with ```python setup_pyx.py build_ext --inplace```\r\nI also tried compiling to C in Windows with ```cython pythagorean_triples.pyx``` The result was the same mangled function name.\r\n",
    "closed_at": "2019-04-30T16:05:25Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Hmm, could you double-check that you are generating both C files cleanly from the same .pyx file? Specifically, `cythonize()` avoids regenerating the `.c` file if it's already there and newer than the source file. Maybe you still had an old `.c` file lying around that you generated when your `.pyx` file did not have a  `private` yet?\r\n\r\nI don't have access to a Windows system myself, but this is the only explanation I have, because the generation of the  `.c` file is not platform- (or anything else-) dependent in any way.",
            "created_at": "2019-04-30T15:18:51Z",
            "html_url": "https://github.com/cython/cython/issues/2937#issuecomment-487994682",
            "id": 487994682,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2937",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Nzk5NDY4Mg==",
            "updated_at": "2019-04-30T15:18:51Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/487994682",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I am closing the issue because I found that it was created by an additional .pxd file that I used for a separate compilation using the .py with concomitant magic .pxd file. The .pxd file was not present in Linux.",
            "created_at": "2019-04-30T16:05:25Z",
            "html_url": "https://github.com/cython/cython/issues/2937#issuecomment-488012865",
            "id": 488012865,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2937",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODAxMjg2NQ==",
            "updated_at": "2019-04-30T16:05:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/488012865",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/25863991?v=4",
                "events_url": "https://api.github.com/users/Jivko1212/events{/privacy}",
                "followers_url": "https://api.github.com/users/Jivko1212/followers",
                "following_url": "https://api.github.com/users/Jivko1212/following{/other_user}",
                "gists_url": "https://api.github.com/users/Jivko1212/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Jivko1212",
                "id": 25863991,
                "login": "Jivko1212",
                "node_id": "MDQ6VXNlcjI1ODYzOTkx",
                "organizations_url": "https://api.github.com/users/Jivko1212/orgs",
                "received_events_url": "https://api.github.com/users/Jivko1212/received_events",
                "repos_url": "https://api.github.com/users/Jivko1212/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Jivko1212/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Jivko1212/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Jivko1212"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2937/comments",
    "created_at": "2019-04-30T13:08:21Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/25863991?v=4",
                "events_url": "https://api.github.com/users/Jivko1212/events{/privacy}",
                "followers_url": "https://api.github.com/users/Jivko1212/followers",
                "following_url": "https://api.github.com/users/Jivko1212/following{/other_user}",
                "gists_url": "https://api.github.com/users/Jivko1212/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Jivko1212",
                "id": 25863991,
                "login": "Jivko1212",
                "node_id": "MDQ6VXNlcjI1ODYzOTkx",
                "organizations_url": "https://api.github.com/users/Jivko1212/orgs",
                "received_events_url": "https://api.github.com/users/Jivko1212/received_events",
                "repos_url": "https://api.github.com/users/Jivko1212/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Jivko1212/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Jivko1212/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Jivko1212"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-04-30T16:05:26Z",
            "event": "closed",
            "id": 2309976929,
            "node_id": "MDExOkNsb3NlZEV2ZW50MjMwOTk3NjkyOQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2309976929"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2937/events",
    "html_url": "https://github.com/cython/cython/issues/2937",
    "id": 438769125,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2937/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0Mzg3NjkxMjU=",
    "number": 2937,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Cython 0.29.7 mangles cdef public functions on windows, but doesn't do it in Linux",
    "updated_at": "2019-04-30T16:05:26Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2937",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/25863991?v=4",
        "events_url": "https://api.github.com/users/Jivko1212/events{/privacy}",
        "followers_url": "https://api.github.com/users/Jivko1212/followers",
        "following_url": "https://api.github.com/users/Jivko1212/following{/other_user}",
        "gists_url": "https://api.github.com/users/Jivko1212/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Jivko1212",
        "id": 25863991,
        "login": "Jivko1212",
        "node_id": "MDQ6VXNlcjI1ODYzOTkx",
        "organizations_url": "https://api.github.com/users/Jivko1212/orgs",
        "received_events_url": "https://api.github.com/users/Jivko1212/received_events",
        "repos_url": "https://api.github.com/users/Jivko1212/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Jivko1212/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Jivko1212/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Jivko1212"
    }
}