{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "# Steps to reproduce â€“ MWE\r\n\r\n```python\r\nclass Klass:\r\n    @classmethod\r\n    def factory(cls):\r\n        return cls.other_factory()\r\n\r\n    @classmethod\r\n    def other_factory(cls):\r\n        return cls()\r\n```\r\n\r\nsave in ```.pyx``` and compile with cython (```build_ext -i```) in a Python 3.9 environment\r\n\r\n```\r\nPython 3.9.0a4 (default, Feb 29 2020, 15:47:57) \r\n[Clang 11.0.0 (clang-1100.0.33.17)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import cm\r\n>>> cm.Klass.factory()\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"cm.pyx\", line 4, in cm.Klass.factory\r\n    return cls.other_factory()\r\nAttributeError: type object 'type' has no attribute 'other_factory'\r\n>>> \r\n```\r\n\r\n# Observed behavior\r\n\r\nThe ```classmethod``` decorator seems to return ```cls = type(type(self))``` instead of ```cls = type(self)``` and fails.\r\n\r\n# Expected behavior\r\n\r\n```Klass.factory()``` calls ```Klass.other_factory()``` and returns a ```Klass``` instance.\r\n\r\n# Note\r\n\r\n* The same code, compiled with the same cython version, works fine with python 2.7 or 3.4-3.8.\r\n* Bug reproduced with the latest cython release from the cheese shop and GitHub master.\r\n\r\n# See Also:\r\n\r\nThis could be related to https://github.com/cython/cython/issues/3349, although as far as I understand, the poster there says that the ```classmethod``` tests now pass.",
    "closed_at": "2020-03-05T20:53:35Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "It works for me on master but not on 0.29.15. Are you sure you're forcing the rebuilding of the Cython file between changing versions?",
            "created_at": "2020-03-04T20:58:19Z",
            "html_url": "https://github.com/cython/cython/issues/3395#issuecomment-594836012",
            "id": 594836012,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3395",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDgzNjAxMg==",
            "updated_at": "2020-03-04T20:58:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/594836012",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "I double checked with a clean venv and cython from master and yes, you are correct, it works. I must have had a polluted venv somehow.\r\n\r\nThank you, I'll wait for the next release.",
            "created_at": "2020-03-05T20:53:35Z",
            "html_url": "https://github.com/cython/cython/issues/3395#issuecomment-595441360",
            "id": 595441360,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3395",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTQ0MTM2MA==",
            "updated_at": "2020-03-05T20:53:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/595441360",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/540976?v=4",
                "events_url": "https://api.github.com/users/Synss/events{/privacy}",
                "followers_url": "https://api.github.com/users/Synss/followers",
                "following_url": "https://api.github.com/users/Synss/following{/other_user}",
                "gists_url": "https://api.github.com/users/Synss/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Synss",
                "id": 540976,
                "login": "Synss",
                "node_id": "MDQ6VXNlcjU0MDk3Ng==",
                "organizations_url": "https://api.github.com/users/Synss/orgs",
                "received_events_url": "https://api.github.com/users/Synss/received_events",
                "repos_url": "https://api.github.com/users/Synss/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Synss/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Synss/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Synss"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3395/comments",
    "created_at": "2020-03-04T20:25:48Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/540976?v=4",
                "events_url": "https://api.github.com/users/Synss/events{/privacy}",
                "followers_url": "https://api.github.com/users/Synss/followers",
                "following_url": "https://api.github.com/users/Synss/following{/other_user}",
                "gists_url": "https://api.github.com/users/Synss/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Synss",
                "id": 540976,
                "login": "Synss",
                "node_id": "MDQ6VXNlcjU0MDk3Ng==",
                "organizations_url": "https://api.github.com/users/Synss/orgs",
                "received_events_url": "https://api.github.com/users/Synss/received_events",
                "repos_url": "https://api.github.com/users/Synss/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Synss/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Synss/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Synss"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-03-05T20:53:35Z",
            "event": "closed",
            "id": 3102867427,
            "node_id": "MDExOkNsb3NlZEV2ZW50MzEwMjg2NzQyNw==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3102867427"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3395/events",
    "html_url": "https://github.com/cython/cython/issues/3395",
    "id": 575743553,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3395/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1NzU3NDM1NTM=",
    "number": 3395,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "classmethod broken with Python 3.9",
    "updated_at": "2020-03-05T20:53:35Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3395",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/540976?v=4",
        "events_url": "https://api.github.com/users/Synss/events{/privacy}",
        "followers_url": "https://api.github.com/users/Synss/followers",
        "following_url": "https://api.github.com/users/Synss/following{/other_user}",
        "gists_url": "https://api.github.com/users/Synss/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Synss",
        "id": 540976,
        "login": "Synss",
        "node_id": "MDQ6VXNlcjU0MDk3Ng==",
        "organizations_url": "https://api.github.com/users/Synss/orgs",
        "received_events_url": "https://api.github.com/users/Synss/received_events",
        "repos_url": "https://api.github.com/users/Synss/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Synss/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Synss/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Synss"
    }
}