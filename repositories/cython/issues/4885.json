{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!--\r\n**PLEASE READ THIS FIRST:**\r\n- DO NOT use the bug and feature tracker for general questions and support requests.\r\n  Use the `cython-users` mailing list instead.\r\n  It has a wider audience, so you get more and better answers.\r\n- Did you search for similar issues already?\r\n  Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release?\r\n  It might already have what you want to report.\r\n  Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\nFollowing https://github.com/cython/cython/commit/31d40c8c62acef9509675155fe5b5bb8e48dba5a, it appears that annotating functions with `int` changes the behavior when passing numpy integer types\r\n\r\n**To Reproduce**\r\nCode to reproduce the behaviour:\r\n\r\nBefore:\r\n```\r\nIn [1]: %load_ext Cython\r\n\r\nIn [2]: %%cython\r\n   ...: def f(x: int):\r\n   ...:     return x\r\n   ...:\r\nld: warning: -pie being ignored. It is only used when linking a main executable\r\n\r\nIn [3]: import numpy as np\r\n\r\nIn [4]: f(np.int64(1))\r\nOut[4]: 1\r\n\r\n% conda list cython\r\n# Name                    Version                   Build  Channel\r\ncython                    0.29.30         py310hd4537e4_0    conda-forge\r\n```\r\n\r\nAfter:\r\n```\r\nIn [1]: %load_ext Cython\r\n\r\nIn [3]: %%cython\r\n   ...: def f(x: int):\r\n   ...:     return x\r\n   ...:\r\n\r\nIn [4]: import numpy as np\r\n\r\nIn [5]: f(np.int64(1))\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\nInput In [5], in <cell line: 1>()\r\n----> 1 f(np.int64(1))\r\n\r\nTypeError: Argument 'x' has incorrect type (expected int, got numpy.int64)\r\n\r\n\r\n% conda list cython\r\n# Name                    Version                   Build  Channel\r\ncython                    3.0.0a10                 pypi_0    pypi\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nNot sure if this is expected behavior, but prior I would expect annotating arguments with `: int` to also accept numpy types\r\n\r\n**Environment (please complete the following information):**\r\n - OS: macOS\r\n - Python version: 3.10\r\n - Cython version: https://github.com/cython/cython/commit/31d40c8c62acef9509675155fe5b5bb8e48dba5a\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
    "closed_at": "2022-07-11T18:56:02Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "That's probably unintended I think.",
            "created_at": "2022-07-11T18:47:16Z",
            "html_url": "https://github.com/cython/cython/issues/4885#issuecomment-1180746705",
            "id": 1180746705,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4885",
            "node_id": "IC_kwDOABDGAc5GYMPR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180746705/reactions"
            },
            "updated_at": "2022-07-11T18:47:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180746705",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This behaviour is correct. NumPy's `int64` is not a subtype of `int`.\r\n```python\r\n>>> import numpy\r\n>>> numpy.int64\r\n<class 'numpy.int64'>\r\n>>> numpy.int64.__mro__\r\n(<class 'numpy.int64'>, <class 'numpy.signedinteger'>, <class 'numpy.integer'>, <class 'numpy.number'>, <class 'numpy.generic'>, <class 'object'>)\r\n>>> isinstance(numpy.int64(1), int)\r\nFalse\r\n```\r\n(NumPy 0.17.4, Python 3.8.10)\r\n\r\nThe difference is that Cython 0.x did not take type annotations with Python's `int` type into account, at all.",
            "created_at": "2022-07-11T18:56:02Z",
            "html_url": "https://github.com/cython/cython/issues/4885#issuecomment-1180753845",
            "id": 1180753845,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4885",
            "node_id": "IC_kwDOABDGAc5GYN-1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180753845/reactions"
            },
            "updated_at": "2022-07-11T18:56:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180753845",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Okay that is reasonable. So prior to https://github.com/cython/cython/commit/31d40c8c62acef9509675155fe5b5bb8e48dba5a `: int` was incorrectly accepting/ignoring(?) numpy types?",
            "created_at": "2022-07-11T19:06:15Z",
            "html_url": "https://github.com/cython/cython/issues/4885#issuecomment-1180762681",
            "id": 1180762681,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4885",
            "node_id": "IC_kwDOABDGAc5GYQI5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180762681/reactions"
            },
            "updated_at": "2022-07-11T19:06:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180762681",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647082?v=4",
                "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
                "followers_url": "https://api.github.com/users/mroeschke/followers",
                "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
                "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mroeschke",
                "id": 10647082,
                "login": "mroeschke",
                "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
                "organizations_url": "https://api.github.com/users/mroeschke/orgs",
                "received_events_url": "https://api.github.com/users/mroeschke/received_events",
                "repos_url": "https://api.github.com/users/mroeschke/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mroeschke"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Okay that is reasonable. So prior to [31d40c8](https://github.com/cython/cython/commit/31d40c8c62acef9509675155fe5b5bb8e48dba5a) `: int` was incorrectly accepting/ignoring(?) numpy types?\r\n\r\nCan't say if that's the change ID, but you probably tried it. Yes, it was ignored before (in Cython 0.x) and not rejected.\r\n\r\nI don't know right now if rejecting is the correct thing to do (depends on whether it still accepts subtypes), but in any case, it's your code that need fixing here. Thanks for bringing this up, though. It's worth testing on our side whether the new behaviour is correct as it is now.",
            "created_at": "2022-07-11T19:16:59Z",
            "html_url": "https://github.com/cython/cython/issues/4885#issuecomment-1180772085",
            "id": 1180772085,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4885",
            "node_id": "IC_kwDOABDGAc5GYSb1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180772085/reactions"
            },
            "updated_at": "2022-07-11T19:16:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180772085",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Kind of related to this: would it make sense to be able to disable annotation typing on a per-function or per-class basis? I can't see any good reason why it shouldn't be possible, and it lets people turn it off locally if/when they disagree on Cython's interpretation of the rules?",
            "created_at": "2022-07-11T20:26:45Z",
            "html_url": "https://github.com/cython/cython/issues/4885#issuecomment-1180835372",
            "id": 1180835372,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4885",
            "node_id": "IC_kwDOABDGAc5GYh4s",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180835372/reactions"
            },
            "updated_at": "2022-07-11T20:26:45Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180835372",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> disable annotation typing on a per-function or per-class basis\n\n Yes, let's allow that.\n",
            "created_at": "2022-07-11T20:45:25Z",
            "html_url": "https://github.com/cython/cython/issues/4885#issuecomment-1180852570",
            "id": 1180852570,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4885",
            "node_id": "IC_kwDOABDGAc5GYmFa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180852570/reactions"
            },
            "updated_at": "2022-07-11T20:45:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180852570",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4885/comments",
    "created_at": "2022-07-11T18:30:02Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-07-11T18:56:02Z",
            "event": "closed",
            "id": 6971985394,
            "node_id": "CE_lADOABDGAc5NjMPOzwAAAAGfkA3y",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6971985394"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-07-11T18:56:12Z",
            "event": "labeled",
            "id": 6971986235,
            "label": {
                "color": "444444",
                "name": "R: invalid"
            },
            "node_id": "LE_lADOABDGAc5NjMPOzwAAAAGfkBE7",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6971986235"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4885/events",
    "html_url": "https://github.com/cython/cython/issues/4885",
    "id": 1301070798,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425557122,
            "name": "R: invalid",
            "node_id": "MDU6TGFiZWw0MjU1NTcxMjI=",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20invalid"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4885/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5NjMPO",
    "number": 4885,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4885/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4885/timeline",
    "title": "[BUG]: `int` function argument annotation does not allow numpy integers on main ",
    "updated_at": "2022-07-11T20:45:26Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4885",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10647082?v=4",
        "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
        "followers_url": "https://api.github.com/users/mroeschke/followers",
        "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
        "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mroeschke",
        "id": 10647082,
        "login": "mroeschke",
        "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
        "organizations_url": "https://api.github.com/users/mroeschke/orgs",
        "received_events_url": "https://api.github.com/users/mroeschke/received_events",
        "repos_url": "https://api.github.com/users/mroeschke/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mroeschke"
    }
}