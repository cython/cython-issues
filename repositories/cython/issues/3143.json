{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Cython functions are not compatible with unittest.mock's `create_autospec` and asyncio's `iscoroutinefunction` when imported into a CPython module.\r\n\r\nI'm not super familiar with the inner workings of cython and how it integrates with cpython, but getting the functions to work seems like the responsibility of cython, not cpython.\r\n\r\n----------\r\n\r\nCPython's unittest.mock uses FunctionTypes, a tuple with 2 objects, to determine if an object is callable for the purposes of automatically creating a mock object.\r\n\r\nhttps://github.com/python/cpython/blob/master/Lib/unittest/mock.py#L2715\r\n\r\nShould Cython patch FunctionTypes to also include cyfunction types? Or is there a better way of making this change?\r\n\r\n----------\r\n\r\nAdditionally, CPython's `asyncio.iscoroutinefunction` cannot determine that a cythonized function is async. \r\n\r\n[iscoroutinefunction](https://github.com/python/cpython/blob/ae239f6b0626e926613a4a1dbafa323bd41fec32/Lib/asyncio/coroutines.py#L164) looks for one of two things: [inspect saying it's a coroutine](https://github.com/python/cpython/blob/ae239f6b0626e926613a4a1dbafa323bd41fec32/Lib/inspect.py#L189) or the function having `_is_coroutine` assigned to a specific object (internal use).\r\n\r\nI think the best way to do this is to make `_has_code_flag(obj, CO_COROUTINE)` return True for cython functions.\r\n\r\n---------------\r\n\r\nPointers on what to modify in cython's code base are welcome!",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3143/comments",
    "created_at": "2019-09-13T19:50:45Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3143/events",
    "html_url": "https://github.com/cython/cython/issues/3143",
    "id": 493490681,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3143/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0OTM0OTA2ODE=",
    "number": 3143,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "CPython create_autospec does not work with cyfunctions ",
    "updated_at": "2019-09-13T19:50:45Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3143",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/111300?v=4",
        "events_url": "https://api.github.com/users/dhiltonp/events{/privacy}",
        "followers_url": "https://api.github.com/users/dhiltonp/followers",
        "following_url": "https://api.github.com/users/dhiltonp/following{/other_user}",
        "gists_url": "https://api.github.com/users/dhiltonp/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/dhiltonp",
        "id": 111300,
        "login": "dhiltonp",
        "node_id": "MDQ6VXNlcjExMTMwMA==",
        "organizations_url": "https://api.github.com/users/dhiltonp/orgs",
        "received_events_url": "https://api.github.com/users/dhiltonp/received_events",
        "repos_url": "https://api.github.com/users/dhiltonp/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/dhiltonp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dhiltonp/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/dhiltonp"
    }
}