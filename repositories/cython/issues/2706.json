{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Cython does not include definitions for `std::make_pair`\r\n\r\nThe blog post https://molpopgen.github.io/fwdpy/docs/examples/cython/WritingExtensions includes the following example\r\n\r\n```\r\n%%cython --cplus --compile-args=-std=c++11 -I $fwdpy_includes -I $fwdpp_includes -l sequence -l gsl -l gslcblas\r\n\r\nfrom fwdpy.fwdpy cimport *\r\nfrom libcpp.utility cimport pair\r\nimport numpy as np\r\n\r\nctypedef vector[double] vd\r\nctypedef pair[vd,vd] pvdvd\r\n\r\n#Annoyingly, Cython currently does not \r\n#expose std::make_pair, so we will \r\n#do it here ourselves!\r\n#If we don't have std::make_pair,\r\n#we end up making extra temporary copies\r\n#of our return values in memory.  That's \r\n#not cool, as we're doing this because\r\n#we care about efficiency!\r\ncdef extern from \"<utility>\" namespace \"std\" nogil:\r\n    pair[T,U] make_pair[T,U](T&,U&)\r\n\r\ncdef pvdvd freq_esize_cpp(const singlepop_t * pop):\r\n    cdef vd freq,esize\r\n    cdef double twoN = 2.0*float(pop.N)\r\n    cdef size_t i = 0\r\n    cdef size_t nm=0\r\n    for i in range(pop.mcounts.size()):\r\n        if pop.mcounts[i]>0:\r\n            if pop.mutations[i].neutral is False:\r\n                freq.push_back(float(pop.mcounts[i])/twoN)\r\n                #s records the effect size/selection coefficient\r\n                esize.push_back(pop.mutations[i].s)\r\n    #For some reason, we need to provide casts\r\n    #so that Cython can get the types right for the call to\r\n    #make_pair:\r\n    return make_pair(<vd>freq,<vd>esize)\r\n\r\ndef freq_esize(Spop pop):\r\n    return freq_esize_cpp(pop.pop.get())\r\n```\r\n\r\nIs this the \"best practice\" way? If so, would it make sense to include the make_pair definition in `Includes/libcpp/`?",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Yes, for sure. PRs welcome.\n\nOn Fri, Nov 9, 2018, 5:17 AM Leonard Lausen <notifications@github.com wrote:\n\n> Cython does not include definitions for std::make_pair\n>\n> The blog post\n> https://molpopgen.github.io/fwdpy/docs/examples/cython/WritingExtensions\n> includes the following example\n>\n> %%cython --cplus --compile-args=-std=c++11 -I $fwdpy_includes -I $fwdpp_includes -l sequence -l gsl -l gslcblas\n>\n> from fwdpy.fwdpy cimport *\n> from libcpp.utility cimport pair\n> import numpy as np\n>\n> ctypedef vector[double] vd\n> ctypedef pair[vd,vd] pvdvd\n>\n> #Annoyingly, Cython currently does not\n> #expose std::make_pair, so we will\n> #do it here ourselves!\n> #If we don't have std::make_pair,\n> #we end up making extra temporary copies\n> #of our return values in memory.  That's\n> #not cool, as we're doing this because\n> #we care about efficiency!\n> cdef extern from \"<utility>\" namespace \"std\" nogil:\n>     pair[T,U] make_pair[T,U](T&,U&)\n>\n> cdef pvdvd freq_esize_cpp(const singlepop_t * pop):\n>     cdef vd freq,esize\n>     cdef double twoN = 2.0*float(pop.N)\n>     cdef size_t i = 0\n>     cdef size_t nm=0\n>     for i in range(pop.mcounts.size()):\n>         if pop.mcounts[i]>0:\n>             if pop.mutations[i].neutral is False:\n>                 freq.push_back(float(pop.mcounts[i])/twoN)\n>                 #s records the effect size/selection coefficient\n>                 esize.push_back(pop.mutations[i].s)\n>     #For some reason, we need to provide casts\n>     #so that Cython can get the types right for the call to\n>     #make_pair:\n>     return make_pair(<vd>freq,<vd>esize)\n>\n> def freq_esize(Spop pop):\n>     return freq_esize_cpp(pop.pop.get())\n>\n> Is this the \"best practice\" way? If so, would it make sense to include the\n> make_pair definition in Includes/libcpp/?\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/cython/cython/issues/2706>, or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAdqgdEq4NjnD9Gt0IV6ctDBGN0Z3vb4ks5utQHAgaJpZM4YV702>\n> .\n>\n",
            "created_at": "2018-11-09T07:15:18Z",
            "html_url": "https://github.com/cython/cython/issues/2706#issuecomment-437271452",
            "id": 437271452,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2706",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzI3MTQ1Mg==",
            "updated_at": "2018-11-09T07:15:18Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/437271452",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "node_id": "MDQ6VXNlcjQ4NjAxNw==",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "author_association": "NONE",
            "body": "Also hope this to improve the conversion of `std::pair` used in `std::map`:\r\n\r\n```python\r\nfrom libcpp.pair cimport pair as cpair\r\nfrom libcpp.map cimport map as cmap\r\n\r\nctypedef cpair[int, int] ipair\r\n\r\ncdef cmap[ipair, int] counter\r\n\r\ncdef int i, j, count\r\ncounter[i, j] = count  # Which turns (i, j) into a tuple, and turns back into ipair again!\r\n```\r\n\r\nLet `counter[i, j] = count` can be write as:\r\n\r\n```python\r\nfrom libcpp.utility cimport make_pair\r\n\r\ncounter[make_pair(i, j)] = count\r\n```",
            "created_at": "2019-05-01T05:20:14Z",
            "html_url": "https://github.com/cython/cython/issues/2706#issuecomment-488212936",
            "id": 488212936,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2706",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODIxMjkzNg==",
            "updated_at": "2019-05-01T05:20:14Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/488212936",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/10264720?v=4",
                "events_url": "https://api.github.com/users/KmolYuan/events{/privacy}",
                "followers_url": "https://api.github.com/users/KmolYuan/followers",
                "following_url": "https://api.github.com/users/KmolYuan/following{/other_user}",
                "gists_url": "https://api.github.com/users/KmolYuan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/KmolYuan",
                "id": 10264720,
                "login": "KmolYuan",
                "node_id": "MDQ6VXNlcjEwMjY0NzIw",
                "organizations_url": "https://api.github.com/users/KmolYuan/orgs",
                "received_events_url": "https://api.github.com/users/KmolYuan/received_events",
                "repos_url": "https://api.github.com/users/KmolYuan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/KmolYuan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/KmolYuan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/KmolYuan"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@KmolYuan, that looks like a (separate) feature that Cython could implement internally. PR welcome for both, although adding `make_pair` to `libcpp` is obviously the trivial first step.",
            "created_at": "2019-05-01T05:30:32Z",
            "html_url": "https://github.com/cython/cython/issues/2706#issuecomment-488213940",
            "id": 488213940,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2706",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODIxMzk0MA==",
            "updated_at": "2019-05-01T05:30:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/488213940",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I have not tried new signature of `std::make_pair` with c++11 or 14 yet. For the type `V1`, `V2` are `std::decay<T1>::type` and `std::decay<T2>::type`, which are hard to description them.\r\n\r\n```c++\r\ntemplate< class T1, class T2 >\r\nstd::pair<V1,V2> make_pair( T1&& t, T2&& u );  // 11\r\n\r\ntemplate< class T1, class T2 >\r\nconstexpr std::pair<V1,V2> make_pair( T1&& t, T2&& u );  // 14\r\n```\r\n\r\nC++ 98:\r\n\r\n```python\r\npair[T1, T2] make_pair[T1, T2](T1, x, T2 y)\r\n```",
            "created_at": "2019-05-01T05:52:33Z",
            "html_url": "https://github.com/cython/cython/issues/2706#issuecomment-488216033",
            "id": 488216033,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2706",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODIxNjAzMw==",
            "updated_at": "2019-05-01T06:01:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/488216033",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/10264720?v=4",
                "events_url": "https://api.github.com/users/KmolYuan/events{/privacy}",
                "followers_url": "https://api.github.com/users/KmolYuan/followers",
                "following_url": "https://api.github.com/users/KmolYuan/following{/other_user}",
                "gists_url": "https://api.github.com/users/KmolYuan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/KmolYuan",
                "id": 10264720,
                "login": "KmolYuan",
                "node_id": "MDQ6VXNlcjEwMjY0NzIw",
                "organizations_url": "https://api.github.com/users/KmolYuan/orgs",
                "received_events_url": "https://api.github.com/users/KmolYuan/received_events",
                "repos_url": "https://api.github.com/users/KmolYuan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/KmolYuan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/KmolYuan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/KmolYuan"
            }
        },
        {
            "author_association": "NONE",
            "body": "The ready-made solution is to call the constructor:\r\n\r\n```python\r\ncounter[ipair(i, j)] = count\r\n```\r\n",
            "created_at": "2019-05-01T05:55:52Z",
            "html_url": "https://github.com/cython/cython/issues/2706#issuecomment-488216355",
            "id": 488216355,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2706",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODIxNjM1NQ==",
            "updated_at": "2019-05-01T05:55:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/488216355",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/10264720?v=4",
                "events_url": "https://api.github.com/users/KmolYuan/events{/privacy}",
                "followers_url": "https://api.github.com/users/KmolYuan/followers",
                "following_url": "https://api.github.com/users/KmolYuan/following{/other_user}",
                "gists_url": "https://api.github.com/users/KmolYuan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/KmolYuan",
                "id": 10264720,
                "login": "KmolYuan",
                "node_id": "MDQ6VXNlcjEwMjY0NzIw",
                "organizations_url": "https://api.github.com/users/KmolYuan/orgs",
                "received_events_url": "https://api.github.com/users/KmolYuan/received_events",
                "repos_url": "https://api.github.com/users/KmolYuan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/KmolYuan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/KmolYuan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/KmolYuan"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2706/comments",
    "created_at": "2018-11-09T04:17:03Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/10264720?v=4",
                "events_url": "https://api.github.com/users/KmolYuan/events{/privacy}",
                "followers_url": "https://api.github.com/users/KmolYuan/followers",
                "following_url": "https://api.github.com/users/KmolYuan/following{/other_user}",
                "gists_url": "https://api.github.com/users/KmolYuan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/KmolYuan",
                "id": 10264720,
                "login": "KmolYuan",
                "node_id": "MDQ6VXNlcjEwMjY0NzIw",
                "organizations_url": "https://api.github.com/users/KmolYuan/orgs",
                "received_events_url": "https://api.github.com/users/KmolYuan/received_events",
                "repos_url": "https://api.github.com/users/KmolYuan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/KmolYuan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/KmolYuan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/KmolYuan"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-05-01T05:30:32Z",
            "event": "mentioned",
            "id": 2311343074,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjMxMTM0MzA3NA==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2311343074"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/10264720?v=4",
                "events_url": "https://api.github.com/users/KmolYuan/events{/privacy}",
                "followers_url": "https://api.github.com/users/KmolYuan/followers",
                "following_url": "https://api.github.com/users/KmolYuan/following{/other_user}",
                "gists_url": "https://api.github.com/users/KmolYuan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/KmolYuan",
                "id": 10264720,
                "login": "KmolYuan",
                "node_id": "MDQ6VXNlcjEwMjY0NzIw",
                "organizations_url": "https://api.github.com/users/KmolYuan/orgs",
                "received_events_url": "https://api.github.com/users/KmolYuan/received_events",
                "repos_url": "https://api.github.com/users/KmolYuan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/KmolYuan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/KmolYuan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/KmolYuan"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-05-01T05:30:32Z",
            "event": "subscribed",
            "id": 2311343075,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIzMTEzNDMwNzU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2311343075"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2706/events",
    "html_url": "https://github.com/cython/cython/issues/2706",
    "id": 379017106,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2706/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNzkwMTcxMDY=",
    "number": 2706,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "std::make_pair",
    "updated_at": "2019-05-01T06:01:43Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2706",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/946903?v=4",
        "events_url": "https://api.github.com/users/leezu/events{/privacy}",
        "followers_url": "https://api.github.com/users/leezu/followers",
        "following_url": "https://api.github.com/users/leezu/following{/other_user}",
        "gists_url": "https://api.github.com/users/leezu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/leezu",
        "id": 946903,
        "login": "leezu",
        "node_id": "MDQ6VXNlcjk0NjkwMw==",
        "organizations_url": "https://api.github.com/users/leezu/orgs",
        "received_events_url": "https://api.github.com/users/leezu/received_events",
        "repos_url": "https://api.github.com/users/leezu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/leezu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/leezu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/leezu"
    }
}