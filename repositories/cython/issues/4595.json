{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "The parse function structure of the parser implementation in `Cython/Compiler/Parsing.py` has diverged from the old Grammar in CPython and certainly does not match the new PEG parser. Additionally, several flags were added over time that make it less clear what kind of expression is allowed and supposed to be parsed where. This ticket asks to\r\n\r\n- adapt the parse function split and their names to what CPython uses in its own parser, as closely as possible (but keeping the `p_` prefix for readability)\r\n- remove flag options where possible and reasonable\r\n- split parse functions that currently take options into separate functions that parse different things, and use them in the appropriate places.\r\n\r\nBasically, it should be clear from the name of a called parse function in which state the parser now changes and what it is allowed to see next. This state should not depend on additional options (\"parse X next, unless I'm telling you not to do what I'm asking you to do\").\r\n\r\nThis can (and should best) be done in multiple iterations, both to keep the changes easy to review and to allow us to see where we are going along the way.\r\n\r\nKnown fields that require a cleanup are\r\n- `p_test()` as entry point for expressions\r\n- the integration of lambda expressions\r\n- star expressions\r\n- conditional expressions\r\n- named expressions (walrus operator)\r\n\r\nAlong the way, the following missing syntax features can be added:\r\n- parenthesised context managers (https://docs.python.org/3/whatsnew/3.10.html#new-features)\r\n- general expressions as decorators (#4570, [PEP 614](https://www.python.org/dev/peps/pep-0614/))\r\n\r\nThe [Python test suite](https://github.com/python/cpython/tree/main/Lib/test) has tests for them.\r\n\r\nCPython's old parser grammar: https://github.com/python/cpython/blob/3.9/Grammar/Grammar\r\nCPython's new PEG parser grammar: https://github.com/python/cpython/blob/main/Grammar/python.gram",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "Maybe also the \"parenthasised context managers\" from Python 3.10 (https://docs.python.org/3/whatsnew/3.10.html#new-features) could be included in this issue?",
            "created_at": "2022-01-27T07:13:10Z",
            "html_url": "https://github.com/cython/cython/issues/4595#issuecomment-1022912617",
            "id": 1022912617,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4595",
            "node_id": "IC_kwDOABDGAc48-Ghp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1022912617/reactions"
            },
            "updated_at": "2022-01-27T07:13:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1022912617",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes, absolutely. And also #4570 (PEP 614, expressions as decorators), while we're at it.",
            "created_at": "2022-01-27T09:03:39Z",
            "html_url": "https://github.com/cython/cython/issues/4595#issuecomment-1022989816",
            "id": 1022989816,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4595",
            "node_id": "IC_kwDOABDGAc48-ZX4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1022989816/reactions"
            },
            "updated_at": "2022-01-27T09:03:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1022989816",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4595/comments",
    "created_at": "2022-01-27T00:56:50Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-01-27T00:56:50Z",
            "event": "labeled",
            "id": 5960398461,
            "label": {
                "color": "444444",
                "name": "Parsing"
            },
            "node_id": "LE_lADOABDGAc5Cf4ALzwAAAAFjRHZ9",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5960398461"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-01-27T00:56:50Z",
            "event": "labeled",
            "id": 5960398462,
            "label": {
                "color": "444444",
                "name": "cleanup"
            },
            "node_id": "LE_lADOABDGAc5Cf4ALzwAAAAFjRHZ-",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5960398462"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4595/events",
    "html_url": "https://github.com/cython/cython/issues/4595",
    "id": 1115652107,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553653,
            "name": "Parsing",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTM=",
            "url": "https://api.github.com/repos/cython/cython/labels/Parsing"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425558030,
            "name": "cleanup",
            "node_id": "MDU6TGFiZWw0MjU1NTgwMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/cleanup"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4595/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5Cf4AL",
    "number": 4595,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4595/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4595/timeline",
    "title": "Refactor parser structure to match CPython's grammar more closely",
    "updated_at": "2022-01-27T09:20:35Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4595",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
        "events_url": "https://api.github.com/users/scoder/events{/privacy}",
        "followers_url": "https://api.github.com/users/scoder/followers",
        "following_url": "https://api.github.com/users/scoder/following{/other_user}",
        "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/scoder",
        "id": 491659,
        "login": "scoder",
        "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
        "organizations_url": "https://api.github.com/users/scoder/orgs",
        "received_events_url": "https://api.github.com/users/scoder/received_events",
        "repos_url": "https://api.github.com/users/scoder/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/scoder"
    }
}