{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Is your feature request related to a problem? Please describe.\n\nIn my code, I would like to use a read-only memoryview using fused dtypes:\r\n```cython\r\n# cython: language_level = 3\r\n\r\nctypedef fused dtype_t:\r\n    float\r\n    double\r\n\r\ncpdef bint _foo(const dtype_t[:] value):\r\n    return False\r\n```\r\n\r\nBut this leads to the following \"not-implemented\" error:\r\n\r\n```\r\n‚ùØ cythonize -a -i fused_readonly.pyx\r\nCompiling /home/maxnoe/test_Cython/fused_readonly.pyx because it changed.\r\n[1/1] Cythonizing /home/maxnoe/test_Cython/fused_readonly.pyx\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n\r\nctypedef fused dtype_t:\r\n    float\r\n    double\r\n\r\ncpdef bint _foo(const dtype_t[:] value):\r\n                             ^\r\n------------------------------------------------------------\r\n\r\nfused_readonly.pyx:7:30: Compiler crash in AnalyseDeclarationsTransform\r\n\r\nFile 'ModuleNode.py', line 124, in analyse_declarations: ModuleNode(fused_readonly.pyx:1:0,\r\n    full_module_name = 'fused_readonly')\r\nFile 'Nodes.py', line 431, in analyse_declarations: StatListNode(fused_readonly.pyx:3:0)\r\nFile 'Nodes.py', line 2359, in analyse_declarations: CFuncDefNode(fused_readonly.pyx:7:6,\r\n    modifiers = [...]/0,\r\n    overridable = 1,\r\n    visibility = 'private')\r\nFile 'Nodes.py', line 681, in analyse: CFuncDeclaratorNode(fused_readonly.pyx:7:15,\r\n    calling_convention = '',\r\n    overridable = 1)\r\nFile 'Nodes.py', line 891, in analyse: CArgDeclNode(fused_readonly.pyx:7:16,\r\n    is_generic = 1,\r\n    outer_attrs = [...]/2)\r\nFile 'Nodes.py', line 1093, in analyse: MemoryViewSliceTypeNode(fused_readonly.pyx:7:30,\r\n    is_arg = True,\r\n    name = 'memoryview')\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/Nodes.py\", line 1093, in analyse\r\n    self.type = PyrexTypes.MemoryViewSliceType(base_type, axes_specs)\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/PyrexTypes.py\", line 625, in __init__\r\n    self.dtype_name = Buffer.mangle_dtype_name(self.dtype)\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/Buffer.py\", line 631, in mangle_dtype_name\r\n    return prefix + dtype.specialization_name()\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/PyrexTypes.py\", line 57, in specialization_name\r\n    common_subs = (self.empty_declaration_code()\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/PyrexTypes.py\", line 51, in empty_declaration_code\r\n    self._empty_declaration = self.declaration_code('')\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/PyrexTypes.py\", line 1582, in declaration_code\r\n    return self.const_base_type.declaration_code(\"const %s\" % entity_code, for_display, dll_linkage, pyrex)\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Compiler/PyrexTypes.py\", line 1649, in declaration_code\r\n    raise Exception(\"This may never happen, please report a bug\")\r\nException: This may never happen, please report a bug\r\nTraceback (most recent call last):\r\n  File \"/usr/bin/cythonize\", line 33, in <module>\r\n    sys.exit(load_entry_point('Cython==0.29.32', 'console_scripts', 'cythonize')())\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Build/Cythonize.py\", line 225, in main\r\n    cython_compile(path, options)\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Build/Cythonize.py\", line 97, in cython_compile\r\n    ext_modules = cythonize(\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1127, in cythonize\r\n    cythonize_one(*args)\r\n  File \"/usr/lib/python3.10/site-packages/Cython/Build/Dependencies.py\", line 1250, in cythonize_one\r\n    raise CompileError(None, pyx_file)\r\nCython.Compiler.Errors.CompileError: /home/maxnoe/test_Cython/fused_readonly.pyx\r\n```\r\n\r\n\n\n### Describe the solution you'd like.\n\nSupport read-only memoryviews for fused dtypes\n\n### Describe alternatives you've considered.\n\n_No response_\n\n### Additional context\n\n_No response_",
    "closed_at": "2022-09-20T16:51:13Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "This is fixed in the 3.0 alpha releases (I think in https://github.com/cython/cython/pull/3853, but I haven't checked that for sure). It probably won't be backported to the stable branch (if nothing else, it's diverged enough that it doesn't backport cleanly).",
            "created_at": "2022-09-20T16:51:13Z",
            "html_url": "https://github.com/cython/cython/issues/5039#issuecomment-1252632101",
            "id": 1252632101,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5039",
            "node_id": "IC_kwDOABDGAc5KqaYl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1252632101/reactions"
            },
            "updated_at": "2022-09-20T16:54:22Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1252632101",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Good to know! Thanks",
            "created_at": "2022-09-20T16:57:56Z",
            "html_url": "https://github.com/cython/cython/issues/5039#issuecomment-1252639756",
            "id": 1252639756,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5039",
            "node_id": "IC_kwDOABDGAc5KqcQM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1252639756/reactions"
            },
            "updated_at": "2022-09-20T16:57:56Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1252639756",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5488440?v=4",
                "events_url": "https://api.github.com/users/maxnoe/events{/privacy}",
                "followers_url": "https://api.github.com/users/maxnoe/followers",
                "following_url": "https://api.github.com/users/maxnoe/following{/other_user}",
                "gists_url": "https://api.github.com/users/maxnoe/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/maxnoe",
                "id": 5488440,
                "login": "maxnoe",
                "node_id": "MDQ6VXNlcjU0ODg0NDA=",
                "organizations_url": "https://api.github.com/users/maxnoe/orgs",
                "received_events_url": "https://api.github.com/users/maxnoe/received_events",
                "repos_url": "https://api.github.com/users/maxnoe/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/maxnoe/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/maxnoe/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/maxnoe"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "FWIW there is a *very* hacky way to transform a read-only memoryview into a read-write memoryview. I'd much rather people just used the Cython 3 alpha though. However if you want to look it's at https://github.com/scikit-learn/scikit-learn/blob/2a391bea9a409745e5c297c70bcebe51274b9d39/sklearn/utils/_readonly_array_wrapper.pyx",
            "created_at": "2022-09-20T17:02:35Z",
            "html_url": "https://github.com/cython/cython/issues/5039#issuecomment-1252644674",
            "id": 1252644674,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5039",
            "node_id": "IC_kwDOABDGAc5KqddC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1252644674/reactions"
            },
            "updated_at": "2022-09-20T17:02:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1252644674",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5039/comments",
    "created_at": "2022-09-20T11:08:58Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-09-20T16:51:13Z",
            "event": "closed",
            "id": 7424073646,
            "node_id": "CE_lADOABDGAc5SNW-WzwAAAAG6gl-u",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/7424073646"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5039/events",
    "html_url": "https://github.com/cython/cython/issues/5039",
    "id": 1379233686,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5039/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5SNW-W",
    "number": 5039,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5039/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5039/timeline",
    "title": "[ENH] read-only memory views do not work with fused dtypes",
    "updated_at": "2022-09-20T17:02:35Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5039",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5488440?v=4",
        "events_url": "https://api.github.com/users/maxnoe/events{/privacy}",
        "followers_url": "https://api.github.com/users/maxnoe/followers",
        "following_url": "https://api.github.com/users/maxnoe/following{/other_user}",
        "gists_url": "https://api.github.com/users/maxnoe/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/maxnoe",
        "id": 5488440,
        "login": "maxnoe",
        "node_id": "MDQ6VXNlcjU0ODg0NDA=",
        "organizations_url": "https://api.github.com/users/maxnoe/orgs",
        "received_events_url": "https://api.github.com/users/maxnoe/received_events",
        "repos_url": "https://api.github.com/users/maxnoe/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/maxnoe/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/maxnoe/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/maxnoe"
    }
}