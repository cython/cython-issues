{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "When trying to compile some Python code with Cython, I got the following kind of errors:\r\n\r\n```\r\nerror: redefinition of XXX\r\n```\r\n\r\nI've managed to reduce my code to a reproducible example:\r\n\r\n```\r\n# cython: language_level=3\r\n\r\ncdef f1(x, r):\r\n    pass\r\n\r\ncdef f2(x1, r):\r\n    pass\r\n\r\ncdef map = {\r\n    \"f1\": f1,\r\n    \"f2\": f2,\r\n}\r\n```\r\n\r\nWhen trying to compile it with `Cython version 0.29.20`, I get the following output:\r\n\r\n```\r\nCompiling /home/lothiraldan/cython-bug/test2.pyx because it changed.\r\n[1/1] Cythonizing /home/lothiraldan/cython-bug/test2.pyx\r\nbuilding 'test2' extension\r\ngcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/lothiraldan/.pyenv/versions/3.7.5/include/python3.7m -c /home/lothiraldan/cython-bug/test2.c -o build/temp.linux-x86_64-3.7/home/lothiraldan/cython-bug/test2.o\r\n/home/lothiraldan/cython-bug/test2.c:1406:13: error: redefinition of ‘__pyx_doc_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap’\r\n 1406 | static char __pyx_doc_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap[] = \"wrap(x1, r)\";\r\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1213:13: note: previous definition of ‘__pyx_doc_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap’ was here\r\n 1213 | static char __pyx_doc_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap[] = \"wrap(x, r)\";\r\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1407:20: error: redefinition of ‘__pyx_mdef_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap’\r\n 1407 | static PyMethodDef __pyx_mdef_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap = {\"wrap\", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap};\r\n      |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1214:20: note: previous definition of ‘__pyx_mdef_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap’ was here\r\n 1214 | static PyMethodDef __pyx_mdef_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap = {\"wrap\", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap};\r\n      |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1408:18: error: redefinition of ‘__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap’\r\n 1408 | static PyObject *__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1215:18: note: previous definition of ‘__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap’ was here\r\n 1215 | static PyObject *__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1470:18: error: redefinition of ‘__pyx_pf_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap’\r\n 1470 | static PyObject *__pyx_pf_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap(PyObject *__pyx_self, PyObject *__pyx_v_x1, PyObject *__pyx_v_r) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1277:18: note: previous definition of ‘__pyx_pf_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap’ was here\r\n 1277 | static PyObject *__pyx_pf_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap(PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_r) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1524:18: error: redefinition of ‘__Pyx_CFunc_object____object____object___to_py’\r\n 1524 | static PyObject *__Pyx_CFunc_object____object____object___to_py(PyObject *(*__pyx_v_f)(PyObject *, PyObject *)) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1331:18: note: previous definition of ‘__Pyx_CFunc_object____object____object___to_py’ was here\r\n 1331 | static PyObject *__Pyx_CFunc_object____object____object___to_py(PyObject *(*__pyx_v_f)(PyObject *, PyObject *)) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1470:18: warning: ‘__pyx_pf_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap’ defined but not used [-Wunused-function]\r\n 1470 | static PyObject *__pyx_pf_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_wrap(PyObject *__pyx_self, PyObject *__pyx_v_x1, PyObject *__pyx_v_r) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1408:18: warning: ‘__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap’ defined but not used [-Wunused-function]\r\n 1408 | static PyObject *__pyx_pw_11cfunc_dot_to_py_46__Pyx_CFunc_object____object____object___to_py_1wrap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/home/lothiraldan/cython-bug/test2.c:1331:18: warning: ‘__Pyx_CFunc_object____object____object___to_py’ defined but not used [-Wunused-function]\r\n 1331 | static PyObject *__Pyx_CFunc_object____object____object___to_py(PyObject *(*__pyx_v_f)(PyObject *, PyObject *)) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nerror: command 'gcc' failed with exit status 1\r\n```\r\n\r\nI only get the issue when I the functions have a the same of parameters but different parameters names. If I add type to some parameter of one function, I also don't get an error.\r\n\r\nI used the workaround for now, so it's not an urgent issue for me.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "It probably give an error but it seems like a relatively pointless thing to do: you're not putting a bunch of `cdef` functions in a `dict` - you're putting a bunch of Python wrappers round `cdef` functions into a `dict`. It's pretty much equivalent to if you'd just declared the functions as `def/cpdef`",
            "created_at": "2020-06-30T16:27:59Z",
            "html_url": "https://github.com/cython/cython/issues/3716#issuecomment-651904491",
            "id": 651904491,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3716",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTkwNDQ5MQ==",
            "updated_at": "2020-06-30T16:27:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/651904491",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "It doesn't look hugely easy to fix. The utility code is generated https://github.com/cython/cython/blob/9c26b302791515f608d4b200f692dcec9f066229/Cython/Compiler/PyrexTypes.py#L3279. Earlier, it tries to reuse `self.to_py_function` of the function type, however each `cdef` function has its own instance of the type.\r\n\r\n-----------------------------\r\n\r\nAn alternative way of fixing it is https://github.com/cython/cython/blob/9c26b302791515f608d4b200f692dcec9f066229/Cython/Compiler/Nodes.py#L3384 the `DefNodeWrapper` tries to get a unique prefix. However, it only gets a prefix from the utility code module, not the overall module.",
            "created_at": "2020-06-30T17:08:32Z",
            "html_url": "https://github.com/cython/cython/issues/3716#issuecomment-651926166",
            "id": 651926166,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3716",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTkyNjE2Ng==",
            "updated_at": "2020-06-30T17:11:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/651926166",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3716/comments",
    "created_at": "2020-06-30T10:39:19Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3716/events",
    "html_url": "https://github.com/cython/cython/issues/3716",
    "id": 648067595,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3716/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU2NDgwNjc1OTU=",
    "number": 3716,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Redefinition error when putting functions in a dict",
    "updated_at": "2020-06-30T17:11:32Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3716",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/243665?v=4",
        "events_url": "https://api.github.com/users/Lothiraldan/events{/privacy}",
        "followers_url": "https://api.github.com/users/Lothiraldan/followers",
        "following_url": "https://api.github.com/users/Lothiraldan/following{/other_user}",
        "gists_url": "https://api.github.com/users/Lothiraldan/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Lothiraldan",
        "id": 243665,
        "login": "Lothiraldan",
        "node_id": "MDQ6VXNlcjI0MzY2NQ==",
        "organizations_url": "https://api.github.com/users/Lothiraldan/orgs",
        "received_events_url": "https://api.github.com/users/Lothiraldan/received_events",
        "repos_url": "https://api.github.com/users/Lothiraldan/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Lothiraldan/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Lothiraldan"
    }
}