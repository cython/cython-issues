{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!--\r\n**PLEASE READ THIS FIRST:**\r\n- DO NOT use the bug and feature tracker for general questions and support requests.\r\n  Use the `cython-users` mailing list instead.\r\n  It has a wider audience, so you get more and better answers.\r\n- Did you search for similar issues already?\r\n  Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release?\r\n  It might already have what you want to report.\r\n  Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Describe the bug**\r\nThis works in C:\r\n\r\n```c\r\n#include <stdio.h>\r\n\r\nstruct A { const int a; };\r\n\r\nint main() {\r\n    struct A a = {42};\r\n    printf(\"%d\\n\", a.a);\r\n}\r\n```\r\n\r\nBut not in Cython:\r\n\r\n```cython\r\n# cython: language_level=3\r\n\r\ncdef struct A:\r\n    const int a\r\n\r\ncdef A a = A(42)\r\nprint(a.a)\r\n```\r\n\r\nSometimes we get an error by the C compiler, as in the example above:\r\n\r\n```\r\nerror: cannot assign to non-static data member 'a' with const-qualified type 'const int'\r\n  __pyx_t_1.a = 42;\r\n  ~~~~~~~~~~~ ^\r\n```\r\n\r\nSometimes I get an error from the Cython compiler, unfortunately I haven't been able to come up with a minimal example:\r\n\r\n\r\n```\r\n  Error compiling Cython file:\r\n  ------------------------------------------------------------\r\n  ...\r\n\r\n      try:\r\n          value = obj['a']\r\n      except KeyError:\r\n          raise ValueError(\"No value specified for struct attribute 'a'\")\r\n      result.a = value\r\n           ^\r\n  ------------------------------------------------------------\r\n\r\n  FromPyStructUtility:20:10: Assignment to const attribute 'a'\r\n```\r\n\r\n**Environment (please complete the following information):**\r\nCython version 0.29.30\r\n\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "My feeling is that this will be hard to fix:\r\n\r\n1. Cython currently keeps code C89 compatible. That means that it puts the declarations first and the initialization after. Obviously in this case it could be directly initialized, but that wouldn't work if it the value it was being initialized with required temps.\r\n2. For an `extern` struct Cython doesn't know that the description you've given it is complete or ordered (hence wants to initialize fields by name). Obviously that doesn't apply here, but the code generation is mostly the same for extern and non-extern structures.\r\n\r\nNone of this is impossible, but I wouldn't expect this to work soon",
            "created_at": "2022-07-31T13:11:48Z",
            "html_url": "https://github.com/cython/cython/issues/4939#issuecomment-1200422666",
            "id": 1200422666,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4939",
            "node_id": "IC_kwDOABDGAc5HjP8K",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1200422666/reactions"
            },
            "updated_at": "2022-07-31T13:11:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1200422666",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4939/comments",
    "created_at": "2022-07-31T12:08:05Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4939/events",
    "html_url": "https://github.com/cython/cython/issues/4939",
    "id": 1323444099,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4939/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5O4ieD",
    "number": 4939,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4939/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4939/timeline",
    "title": "[BUG] Cannot construct struct with const members",
    "updated_at": "2022-07-31T13:11:48Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4939",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/175722?v=4",
        "events_url": "https://api.github.com/users/jonashaag/events{/privacy}",
        "followers_url": "https://api.github.com/users/jonashaag/followers",
        "following_url": "https://api.github.com/users/jonashaag/following{/other_user}",
        "gists_url": "https://api.github.com/users/jonashaag/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jonashaag",
        "id": 175722,
        "login": "jonashaag",
        "node_id": "MDQ6VXNlcjE3NTcyMg==",
        "organizations_url": "https://api.github.com/users/jonashaag/orgs",
        "received_events_url": "https://api.github.com/users/jonashaag/received_events",
        "repos_url": "https://api.github.com/users/jonashaag/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jonashaag/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jonashaag/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jonashaag"
    }
}