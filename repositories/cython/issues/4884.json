{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!--\r\n**Note:**\r\n- DO NOT use the bug and feature tracker for general questions and support requests.\r\n  Use the `cython-users` mailing list instead.\r\n  It has a wider audience, so you get more and better answers.\r\n- Did you search for similar issues already?\r\n  Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release?\r\n  It might already have what you want to report.\r\n  Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\n\r\nFrom https://github.com/pandas-dev/pandas/commit/56dc7194007f8392b0314b9166d6dd60b084e58a: We have a `const uint8_t[:] buf` and want to do\r\n\r\n```cython\r\n(&buf[start])[:lngt].rstrip(b\"abc\")\r\n```\r\n\r\nThis seems unoptimized in Cython (it actually constructs a `bytes` object and calls `.strip()`) and it's much faster to write\r\n\r\n```cython\r\nwhile lngt > 0 and buf[start+lngt-1] in b\"abc\":\r\n    lngt -= 1\r\nres = (&buf[start])[:lngt]\r\n```\r\n\r\n**Describe the solution you'd like**\r\n\r\nCython can turn `.strip()` into the aforementioned C loop and remove constructing the `bytes` object and the call to `.strip()`",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I suspect the answer is \"probably not\". Typed memoryviews are fairly lightweight by design and we've deliberately tried not to add too much to them beyond \"access the memory\"\r\n\r\n```\r\nbuf[start:start+lngt].rstrip(b\"abc\")\r\n```\r\n\r\nThis doesn't actually seem to work for me (and I wouldn't expect it to). It creates a Python memoryview object, and that doesn't have an `rstrip` function",
            "created_at": "2022-07-11T17:31:55Z",
            "html_url": "https://github.com/cython/cython/issues/4884#issuecomment-1180679417",
            "id": 1180679417,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4884",
            "node_id": "IC_kwDOABDGAc5GX7z5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180679417/reactions"
            },
            "updated_at": "2022-07-11T17:31:55Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180679417",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Sorry, I fixed the example. I'm not sure how much of this is related to memory views; this is also a problem if you have a random `bytes` object. Maybe I should have made the example simpler but I wanted to give enough context.",
            "created_at": "2022-07-11T21:54:00Z",
            "html_url": "https://github.com/cython/cython/issues/4884#issuecomment-1180907135",
            "id": 1180907135,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4884",
            "node_id": "IC_kwDOABDGAc5GYzZ_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1180907135/reactions"
            },
            "updated_at": "2022-07-11T21:54:00Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1180907135",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/175722?v=4",
                "events_url": "https://api.github.com/users/jonashaag/events{/privacy}",
                "followers_url": "https://api.github.com/users/jonashaag/followers",
                "following_url": "https://api.github.com/users/jonashaag/following{/other_user}",
                "gists_url": "https://api.github.com/users/jonashaag/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jonashaag",
                "id": 175722,
                "login": "jonashaag",
                "node_id": "MDQ6VXNlcjE3NTcyMg==",
                "organizations_url": "https://api.github.com/users/jonashaag/orgs",
                "received_events_url": "https://api.github.com/users/jonashaag/received_events",
                "repos_url": "https://api.github.com/users/jonashaag/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jonashaag/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jonashaag/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jonashaag"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ok, so basically, what you do is\r\n```cython\r\ncdef char* string = b\"xyzabc\"\r\nprint( string[:length].rstrip(\"abc\") )\r\n```\r\nThat could be optimised. It just needs a C function to adapt the start index and length based on the string content after calculating them from the slice. Candidates are:\r\n* `strip([chars])`\r\n* `lstrip([chars])`\r\n* `rstrip([chars])`\r\n* `removeprefix(prefix)`\r\n* `removesuffix(prefix)`\r\n\r\nNote that the `.*strip()` methods accept zero or one argument (including `None`), defaulting to `b'\\t\\n\\v\\f\\r '`\r\n```python\r\n>>> b'\\t\\n\\v\\f\\r '.strip()\r\nb''\r\n```\r\nAlso note that this applies to `char*`, `bytes` and `bytearray`, since you can write e.g.\r\n```cython\r\ncdef char* string = b\"xyzabc\"\r\nprint( (<bytearray>string[:length]).rstrip(\"abc\") )\r\n```",
            "created_at": "2022-07-12T06:07:08Z",
            "html_url": "https://github.com/cython/cython/issues/4884#issuecomment-1181353358",
            "id": 1181353358,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4884",
            "node_id": "IC_kwDOABDGAc5GagWO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1181353358/reactions"
            },
            "updated_at": "2022-07-12T06:11:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1181353358",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4884/comments",
    "created_at": "2022-07-11T17:21:18Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-07-12T06:07:23Z",
            "event": "labeled",
            "id": 6974696096,
            "label": {
                "color": "444444",
                "name": "enhancement"
            },
            "node_id": "LE_lADOABDGAc5Ni7K4zwAAAAGfuWqg",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6974696096"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-07-12T06:07:23Z",
            "event": "labeled",
            "id": 6974696100,
            "label": {
                "color": "444444",
                "name": "Optimization"
            },
            "node_id": "LE_lADOABDGAc5Ni7K4zwAAAAGfuWqk",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/6974696100"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4884/events",
    "html_url": "https://github.com/cython/cython/issues/4884",
    "id": 1301000888,
    "labels": [
        {
            "color": "444444",
            "default": true,
            "description": null,
            "id": 425556243,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw0MjU1NTYyNDM=",
            "url": "https://api.github.com/repos/cython/cython/labels/enhancement"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556272,
            "name": "Optimization",
            "node_id": "MDU6TGFiZWw0MjU1NTYyNzI=",
            "url": "https://api.github.com/repos/cython/cython/labels/Optimization"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4884/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5Ni7K4",
    "number": 4884,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4884/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4884/timeline",
    "title": "[ENH] Fast `.{l,r,}strip()` for `uint8_t[:]` objects",
    "updated_at": "2022-07-12T06:11:25Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4884",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/175722?v=4",
        "events_url": "https://api.github.com/users/jonashaag/events{/privacy}",
        "followers_url": "https://api.github.com/users/jonashaag/followers",
        "following_url": "https://api.github.com/users/jonashaag/following{/other_user}",
        "gists_url": "https://api.github.com/users/jonashaag/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jonashaag",
        "id": 175722,
        "login": "jonashaag",
        "node_id": "MDQ6VXNlcjE3NTcyMg==",
        "organizations_url": "https://api.github.com/users/jonashaag/orgs",
        "received_events_url": "https://api.github.com/users/jonashaag/received_events",
        "repos_url": "https://api.github.com/users/jonashaag/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jonashaag/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jonashaag/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jonashaag"
    }
}