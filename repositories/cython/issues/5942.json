{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\r\n\r\nIf you have a package include directory path name with, say, a directory with literal brackets in it (containing invalid glob syntax), Cython will choke on compilation on a regular expression exception (`re.error`).\r\n\r\nIn the function `find_versioned_file` in `Cython/Utils.py`, an attempt is made to find versioned files by slapping a glob pattern on the end of a file path and invoking Python's `glob.glob`, but this also will attempt to interpret any glob-like patterns within the path itself, and cause an exception if they are invalid (or at best doesn't work as expected). This should be readily apparent by inspection (line 317, tag 3.0.8):\r\n```python\r\n    path_prefix = os.path.join(directory, filename)\r\n\r\n    matching_files = glob.glob(path_prefix + \".cython-*\" + suffix)\r\n```\r\n\r\nIf `directory` is `/tmp/src/[Hello-World]`, `filename` is `pair`, and `suffix` is `.pxd`, then an attempt made to parse `/tmp/src/[Hello-World]/pair.cython-*.pxd` fails:\r\n```\r\n>>> path_prefix='/tmp/src/[Hello-World]/pair.cython-*.pxd'\r\n>>> glob.glob(path_prefix)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/lib/python3.8/glob.py\", line 21, in glob\r\n    return list(iglob(pathname, recursive=recursive))\r\n  File \"/usr/lib/python3.8/glob.py\", line 73, in _iglob\r\n    for dirname in dirs:\r\n  File \"/usr/lib/python3.8/glob.py\", line 74, in _iglob\r\n    for name in glob_in_dir(dirname, basename, dironly):\r\n  File \"/usr/lib/python3.8/glob.py\", line 85, in _glob1\r\n    return fnmatch.filter(names, pattern)\r\n  File \"/usr/lib/python3.8/fnmatch.py\", line 52, in filter\r\n    match = _compile_pattern(pat)\r\n  File \"/usr/lib/python3.8/fnmatch.py\", line 46, in _compile_pattern\r\n    return re.compile(res).match\r\n  File \"/usr/lib/python3.8/re.py\", line 252, in compile\r\n    return _compile(pattern, flags)\r\n  File \"/usr/lib/python3.8/re.py\", line 304, in _compile\r\n    p = sre_compile.compile(pattern, flags)\r\n  File \"/usr/lib/python3.8/sre_compile.py\", line 764, in compile\r\n    p = sre_parse.parse(p, flags)\r\n  File \"/usr/lib/python3.8/sre_parse.py\", line 948, in parse\r\n    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)\r\n  File \"/usr/lib/python3.8/sre_parse.py\", line 443, in _parse_sub\r\n    itemsappend(_parse(source, state, verbose, nested + 1,\r\n  File \"/usr/lib/python3.8/sre_parse.py\", line 834, in _parse\r\n    p = _parse_sub(source, state, sub_verbose, nested + 1)\r\n  File \"/usr/lib/python3.8/sre_parse.py\", line 443, in _parse_sub\r\n    itemsappend(_parse(source, state, verbose, nested + 1,\r\n  File \"/usr/lib/python3.8/sre_parse.py\", line 598, in _parse\r\n    raise source.error(msg, len(this) + 1 + len(that))\r\nre.error: bad character range o-W at position 9\r\n```\r\n\r\n### Code to reproduce the behaviour:\r\n\r\nThe easiest way to reproduce this is to rename your Cython development directory to `[Hello-World]` and run `python3 runtests.py`; it will immediately fail on the self-same error.\r\n\r\n### Expected behaviour\r\n\r\nThe include directory should be searched successfully for versioned import files and no exception issued.\r\n\r\n### OS\r\n\r\nUbuntu Linux 20.04 LTS\r\n\r\n### Python version\r\n\r\n3.8.10\r\n\r\n### Cython version\r\n\r\n3.0.8\r\n\r\n### Additional context\r\n\r\nFor a fix, there are a few considerations here.\r\n\r\nOne way is to escape the troublesome characters; theoretically, you can do so by enclosing them in brackets, and there is even a function introduced into Python 3.4 for doing this:\r\n```\r\nPython 3.8.10 (default, May 26 2023, 14:05:08)\r\n[GCC 9.4.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import glob\r\n>>> glob.escape('/tmp/src/[Hello-World]/')\r\n'/tmp/src/[[]Hello-World]/'\r\n>>> d=glob.escape('/tmp/src/[Hello-World]/')\r\n>>> glob.glob(d+\"*\")\r\n['/tmp/src/[Hello-World]/pair.pxd']\r\n```\r\nBut, Cython has to be backwards-compatible with versions before 3.4, so for now, Cython would have to do the escaping itself. \r\n\r\nThis seems obscure, but it's got much wider implications than are immediately apparent.",
    "closed_at": "2024-02-27T12:24:16Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "The reproduction instructions are wrong; they trigger the same error but from a different root cause. To trigger this root cause, from the development directory do:\r\n```\r\nPYTHONPATH=\"[Hello-World]\" python3 runtests.py\r\n```\r\n",
            "created_at": "2024-01-19T14:33:21Z",
            "html_url": "https://github.com/cython/cython/issues/5942#issuecomment-1900526048",
            "id": 1900526048,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5942",
            "node_id": "IC_kwDOABDGAc5xR7ng",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1900526048/reactions"
            },
            "updated_at": "2024-01-19T14:33:21Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1900526048",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/123980305?v=4",
                "events_url": "https://api.github.com/users/eewanco/events{/privacy}",
                "followers_url": "https://api.github.com/users/eewanco/followers",
                "following_url": "https://api.github.com/users/eewanco/following{/other_user}",
                "gists_url": "https://api.github.com/users/eewanco/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/eewanco",
                "id": 123980305,
                "login": "eewanco",
                "node_id": "U_kgDOB2PKEQ",
                "organizations_url": "https://api.github.com/users/eewanco/orgs",
                "received_events_url": "https://api.github.com/users/eewanco/received_events",
                "repos_url": "https://api.github.com/users/eewanco/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/eewanco/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/eewanco/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/eewanco"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5942/comments",
    "created_at": "2024-01-12T11:25:43Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/123980305?v=4",
                "events_url": "https://api.github.com/users/eewanco/events{/privacy}",
                "followers_url": "https://api.github.com/users/eewanco/followers",
                "following_url": "https://api.github.com/users/eewanco/following{/other_user}",
                "gists_url": "https://api.github.com/users/eewanco/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/eewanco",
                "id": 123980305,
                "login": "eewanco",
                "node_id": "U_kgDOB2PKEQ",
                "organizations_url": "https://api.github.com/users/eewanco/orgs",
                "received_events_url": "https://api.github.com/users/eewanco/received_events",
                "repos_url": "https://api.github.com/users/eewanco/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/eewanco/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/eewanco/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/eewanco"
            },
            "commit_id": "8f54c895a694b71e7923a844d48476cf1024654d",
            "commit_url": "https://api.github.com/repos/eewanco/cython/commits/8f54c895a694b71e7923a844d48476cf1024654d",
            "created_at": "2024-01-19T14:26:10Z",
            "event": "referenced",
            "id": 11538252118,
            "node_id": "REFE_lADOABDGAc575VN9zwAAAAKvu8FW",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11538252118"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/123980305?v=4",
                "events_url": "https://api.github.com/users/eewanco/events{/privacy}",
                "followers_url": "https://api.github.com/users/eewanco/followers",
                "following_url": "https://api.github.com/users/eewanco/following{/other_user}",
                "gists_url": "https://api.github.com/users/eewanco/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/eewanco",
                "id": 123980305,
                "login": "eewanco",
                "node_id": "U_kgDOB2PKEQ",
                "organizations_url": "https://api.github.com/users/eewanco/orgs",
                "received_events_url": "https://api.github.com/users/eewanco/received_events",
                "repos_url": "https://api.github.com/users/eewanco/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/eewanco/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/eewanco/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/eewanco"
            },
            "commit_id": "8a52eadf94f11ca75694a5dfc714df87bd3d0dc4",
            "commit_url": "https://api.github.com/repos/eewanco/cython/commits/8a52eadf94f11ca75694a5dfc714df87bd3d0dc4",
            "created_at": "2024-01-25T12:03:27Z",
            "event": "referenced",
            "id": 11596396516,
            "node_id": "REFE_lADOABDGAc575VN9zwAAAAKzMvfk",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11596396516"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": "e286742f1a2392894c7dc1df754bbdddc8aa25fb",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/e286742f1a2392894c7dc1df754bbdddc8aa25fb",
            "created_at": "2024-02-18T11:09:38Z",
            "event": "referenced",
            "id": 11839396131,
            "node_id": "REFE_lADOABDGAc575VN9zwAAAALBrtkj",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11839396131"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-02-19T10:15:28Z",
            "event": "milestoned",
            "id": 11847385667,
            "milestone": {
                "title": "3.0.9"
            },
            "node_id": "MIE_lADOABDGAc575VN9zwAAAALCKMJD",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11847385667"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-02-19T10:15:38Z",
            "event": "labeled",
            "id": 11847387640,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "LE_lADOABDGAc575VN9zwAAAALCKMn4",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11847387640"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-02-19T10:15:38Z",
            "event": "labeled",
            "id": 11847387645,
            "label": {
                "color": "444444",
                "name": "Build System"
            },
            "node_id": "LE_lADOABDGAc575VN9zwAAAALCKMn9",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11847387645"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": "f2954a065f31463ff01cf93cdb3c3ff0722642e4",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/f2954a065f31463ff01cf93cdb3c3ff0722642e4",
            "created_at": "2024-02-27T12:14:05Z",
            "event": "referenced",
            "id": 11935397602,
            "node_id": "REFE_lADOABDGAc575VN9zwAAAALHZ7bi",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11935397602"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": "f2954a065f31463ff01cf93cdb3c3ff0722642e4",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/f2954a065f31463ff01cf93cdb3c3ff0722642e4",
            "created_at": "2024-02-27T12:24:16Z",
            "event": "closed",
            "id": 11935515703,
            "node_id": "CE_lADOABDGAc575VN9zwAAAALHaYQ3",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/11935515703"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5942/events",
    "html_url": "https://github.com/cython/cython/issues/5942",
    "id": 2078626685,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556353,
            "name": "Build System",
            "node_id": "MDU6TGFiZWw0MjU1NTYzNTM=",
            "url": "https://api.github.com/repos/cython/cython/labels/Build%20System"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5942/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 24,
        "created_at": "2024-01-10T08:17:10Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/107",
        "id": 10399078,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/107/labels",
        "node_id": "MI_kwDOABDGAc4Anq1m",
        "number": 107,
        "open_issues": 1,
        "state": "open",
        "title": "3.0.9",
        "updated_at": "2024-02-27T12:24:16Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/107"
    },
    "node_id": "I_kwDOABDGAc575VN9",
    "number": 5942,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5942/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5942/timeline",
    "title": "[BUG] Package include paths containing literal glob patterns cause exception",
    "updated_at": "2024-02-27T12:24:16Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5942",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/123980305?v=4",
        "events_url": "https://api.github.com/users/eewanco/events{/privacy}",
        "followers_url": "https://api.github.com/users/eewanco/followers",
        "following_url": "https://api.github.com/users/eewanco/following{/other_user}",
        "gists_url": "https://api.github.com/users/eewanco/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/eewanco",
        "id": 123980305,
        "login": "eewanco",
        "node_id": "U_kgDOB2PKEQ",
        "organizations_url": "https://api.github.com/users/eewanco/orgs",
        "received_events_url": "https://api.github.com/users/eewanco/received_events",
        "repos_url": "https://api.github.com/users/eewanco/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/eewanco/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/eewanco/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/eewanco"
    }
}