{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Continuing from #5238. I think it makes sense to discuss this in a dedicated issue.\r\n\r\nThe current default on CPython is `CYTHON_COMPILING_IN_CPYTHON`, which uses the CPython private API, and this isn't documented anywhere, resulting in many grievances in both users and developers.\r\n\r\nIn #5238, I said\r\n\r\n> There are a couple things, some very simple, we can do to help mitigate this.\r\n> \r\n> 1) Document the compilation stability contracts\r\n> \r\n> ~~2) Detect unsafe uses~~\r\n> \r\n> ~~When loading a Cython module that was built against a different CPython version, issue a warning.~~\r\n> \r\n> 3) Adopt a safe default\r\n> \r\n> This would be the biggest change. Currently, Cython is defaulting to `CYTHON_COMPILING_IN_CPYTHON` when building on CPython. Like mentioned above, this comes with a very strict stability contract, having it as a default is problematic.\r\n> IMO the unsafe option should be opt-in, rather than opt-out. Users that build packages in this mode need to be aware of contract. `CYTHON_COMPILING_IN_LIMITED_API` should be the default, or at least we should require the user to explicitly specify which option to use.\r\n> \r\n> If you really want to keep `CYTHON_COMPILING_IN_CPYTHON` as the default, the only option I see is to validate compatibility against each Python release ~~(including each patch digit)~~ and only default to it on those versions.\r\n> \r\n> With a bit more work, a better compromise could be reached, where Cython could support a CPython public API mode, which would be a more performant safe default, and the current CPython private API mode, for users for whom the stability contract is suitable.\r\n> Most of the code should be the same between the two modes anyway, and as offered above, the CPython upstream would work with the Cython devs to fill the gaps in the public API.",
    "closed_at": "2023-02-28T07:39:34Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "It seems ABI resulting from private API is supposed to be stable, barring from critical issues, so 2) is not needed.",
            "created_at": "2023-02-28T04:04:11Z",
            "html_url": "https://github.com/cython/cython/issues/5275#issuecomment-1447543123",
            "id": 1447543123,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5275",
            "node_id": "IC_kwDOABDGAc5WR8FT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1447543123/reactions"
            },
            "updated_at": "2023-02-28T04:04:11Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1447543123",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11718923?v=4",
                "events_url": "https://api.github.com/users/FFY00/events{/privacy}",
                "followers_url": "https://api.github.com/users/FFY00/followers",
                "following_url": "https://api.github.com/users/FFY00/following{/other_user}",
                "gists_url": "https://api.github.com/users/FFY00/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/FFY00",
                "id": 11718923,
                "login": "FFY00",
                "node_id": "MDQ6VXNlcjExNzE4OTIz",
                "organizations_url": "https://api.github.com/users/FFY00/orgs",
                "received_events_url": "https://api.github.com/users/FFY00/received_events",
                "repos_url": "https://api.github.com/users/FFY00/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/FFY00/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/FFY00/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/FFY00"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I'm going to claim this is a duplicate of https://github.com/cython/cython/issues/5249. That issue is about introducing a \"compatible as possible\" mode, and this is mostly arguing for that mode to be the default.\r\n\r\nNote that the limited API mode isn't really ready yet, so we definitely don't want to make it default now!",
            "created_at": "2023-02-28T07:39:34Z",
            "html_url": "https://github.com/cython/cython/issues/5275#issuecomment-1447714408",
            "id": 1447714408,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5275",
            "node_id": "IC_kwDOABDGAc5WSl5o",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1447714408/reactions"
            },
            "updated_at": "2023-02-28T07:39:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1447714408",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5275/comments",
    "created_at": "2023-02-27T23:23:06Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11718923?v=4",
                "events_url": "https://api.github.com/users/FFY00/events{/privacy}",
                "followers_url": "https://api.github.com/users/FFY00/followers",
                "following_url": "https://api.github.com/users/FFY00/following{/other_user}",
                "gists_url": "https://api.github.com/users/FFY00/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/FFY00",
                "id": 11718923,
                "login": "FFY00",
                "node_id": "MDQ6VXNlcjExNzE4OTIz",
                "organizations_url": "https://api.github.com/users/FFY00/orgs",
                "received_events_url": "https://api.github.com/users/FFY00/received_events",
                "repos_url": "https://api.github.com/users/FFY00/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/FFY00/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/FFY00/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/FFY00"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-02-28T03:56:04Z",
            "event": "renamed",
            "id": 8622507503,
            "node_id": "RTE_lADOABDGAc5ffkkGzwAAAAIB8QXv",
            "performed_via_github_app": null,
            "rename": {
                "from": "Cython builds unstable modules",
                "to": "Unstable Cython builds"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/8622507503"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-02-28T07:39:35Z",
            "event": "closed",
            "id": 8623640535,
            "node_id": "CE_lADOABDGAc5ffkkGzwAAAAICAk_X",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/8623640535"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-02-28T07:39:55Z",
            "event": "labeled",
            "id": 8623642838,
            "label": {
                "color": "444444",
                "name": "R: duplicate"
            },
            "node_id": "LE_lADOABDGAc5ffkkGzwAAAAICAljW",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/8623642838"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5275/events",
    "html_url": "https://github.com/cython/cython/issues/5275",
    "id": 1602111750,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556894,
            "name": "R: duplicate",
            "node_id": "MDU6TGFiZWw0MjU1NTY4OTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20duplicate"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5275/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5ffkkG",
    "number": 5275,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5275/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5275/timeline",
    "title": "Unstable Cython builds",
    "updated_at": "2023-02-28T07:39:55Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5275",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11718923?v=4",
        "events_url": "https://api.github.com/users/FFY00/events{/privacy}",
        "followers_url": "https://api.github.com/users/FFY00/followers",
        "following_url": "https://api.github.com/users/FFY00/following{/other_user}",
        "gists_url": "https://api.github.com/users/FFY00/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/FFY00",
        "id": 11718923,
        "login": "FFY00",
        "node_id": "MDQ6VXNlcjExNzE4OTIz",
        "organizations_url": "https://api.github.com/users/FFY00/orgs",
        "received_events_url": "https://api.github.com/users/FFY00/received_events",
        "repos_url": "https://api.github.com/users/FFY00/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/FFY00/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/FFY00/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/FFY00"
    }
}