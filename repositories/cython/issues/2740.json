{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Setting `Cython.Compiler.Options.emit_code_comments = False` does not work when generating .c code from .py files.\r\n\r\n```python\r\nfrom distutils.core import setup\r\nfrom Cython.Distutils import build_ext\r\nfrom Cython.Compiler import Options\r\nfrom Cython.Build import cythonize\r\n\r\nOptions.emit_code_comments = False  # not being applied\r\n\r\n...\r\n\r\nsetup(\r\n    ext_modules=cythonize(\"mymodule.py\")\r\n    cmdclass={'build_ext': build_ext}\r\n)\r\n```\r\n\r\nThe generated .c file contains the code comments, which should be disabled since  `emit_code_comments` is set to false.\r\n\r\n[Code.py:1856](https://github.com/cython/cython/blob/0.29.1/Cython/Compiler/Code.py#L1856):\r\n\r\n```python\r\ndef emit_marker(self):\r\n        pos, trace = self.last_pos\r\n        self.last_marked_pos = pos\r\n        self.last_pos = None\r\n        self.write(\"\\n\")\r\n        if self.code_config.emit_code_comments:\r\n            self.indent()\r\n            self.write(\"/* %s */\\n\" % self._build_marker(pos))\r\n```\r\n\r\n`self.code_config.emit_code_comments` is `True` even when setting `Options.emit_code_comments` to `False`.\r\n\r\nThe [documentation](https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#Cython.Compiler.Options.embed_pos_in_docstring) says it's an option but actually it's currently a [compiler directive](https://github.com/cython/cython/blob/0.29.1/Cython/Compiler/Options.py#L187). Sounds like there was going to be a transition from being an option to being a compiler directive, but the option variable is still there and not being used.\r\n\r\nHere's where the value is passed to the code config. It's obtained from the directives, not the Options.\r\n[ModuleNode.py:53](https://github.com/cython/cython/blob/0.29.1/Cython/Compiler/ModuleNode.py#L53):\r\n\r\n```python\r\nreturn Code.CCodeConfig(\r\n        emit_linenums=emit_linenums,\r\n        emit_code_comments=env.directives['emit_code_comments'],\r\n        c_line_in_traceback=options.c_line_in_traceback)\r\n```\r\n\r\nSo I tried to set `emit_code_comments` as a compiler directive instead, and it worked as expected (no comments added to the .c file):\r\n\r\n```python\r\nfrom distutils.core import setup\r\nfrom Cython.Distutils import build_ext\r\nfrom Cython.Compiler import Options\r\nfrom Cython.Build import cythonize\r\n\r\ncompiler_directives = Options.get_directive_defaults()\r\ncompiler_directives[\"emit_code_comments\"] = False  # works\r\n\r\n...\r\n\r\nsetup(\r\n    ext_modules=cythonize(\"mymodule.py\",\r\n                          compiler_directives=compiler_directives))\r\n    cmdclass={'build_ext': build_ext}\r\n)\r\n```\r\n\r\nTested in Cython 0.29.1.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Hmm, right. I think we should add a warning when users disable it and remove it from the docs. It's been non-functional for a while now.",
            "created_at": "2018-11-30T08:29:06Z",
            "html_url": "https://github.com/cython/cython/issues/2740#issuecomment-443128972",
            "id": 443128972,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2740",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MzEyODk3Mg==",
            "updated_at": "2018-11-30T08:29:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/443128972",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks for the report and the investigation.",
            "created_at": "2018-11-30T08:29:36Z",
            "html_url": "https://github.com/cython/cython/issues/2740#issuecomment-443129101",
            "id": 443129101,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2740",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MzEyOTEwMQ==",
            "updated_at": "2018-11-30T08:29:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/443129101",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I have also come across this issue. My particular motivation for wanting to suppress comments is that they contain system specific paths and hence change if built in a different environment. This means the version generated by `setuptools_scm` changes by merely building a project.\r\n\r\nSee also my question on StackOverflow: https://stackoverflow.com/questions/57921071",
            "created_at": "2019-09-13T10:37:44Z",
            "html_url": "https://github.com/cython/cython/issues/2740#issuecomment-531188716",
            "id": 531188716,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2740",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTE4ODcxNg==",
            "updated_at": "2019-09-13T10:37:44Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/531188716",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/2622379?v=4",
                "events_url": "https://api.github.com/users/jnhansen/events{/privacy}",
                "followers_url": "https://api.github.com/users/jnhansen/followers",
                "following_url": "https://api.github.com/users/jnhansen/following{/other_user}",
                "gists_url": "https://api.github.com/users/jnhansen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jnhansen",
                "id": 2622379,
                "login": "jnhansen",
                "node_id": "MDQ6VXNlcjI2MjIzNzk=",
                "organizations_url": "https://api.github.com/users/jnhansen/orgs",
                "received_events_url": "https://api.github.com/users/jnhansen/received_events",
                "repos_url": "https://api.github.com/users/jnhansen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jnhansen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jnhansen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jnhansen"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "File paths should usually be relative, and thus shouldn't affect the code comments. There are probably exceptions to this, though.\r\n\r\nPRs welcome for both, updating the docs, and avoiding absolute paths in more cases (which isn't directly related to this ticket, though).",
            "created_at": "2019-09-13T10:48:33Z",
            "html_url": "https://github.com/cython/cython/issues/2740#issuecomment-531191309",
            "id": 531191309,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2740",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTE5MTMwOQ==",
            "updated_at": "2019-09-13T10:48:33Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/531191309",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "My generated C code contains several comments that include paths such as \r\n\r\n`\"../../../../anaconda3/envs/env/lib/python3.7/site-packages/Cython/Includes/numpy/__init__.pxd\":310`\r\n\r\nwhich I suppose is technically relative ;-)\r\n\r\nFor now I'll work around this another way but may create a PR at some point.",
            "created_at": "2019-09-13T10:56:02Z",
            "html_url": "https://github.com/cython/cython/issues/2740#issuecomment-531193284",
            "id": 531193284,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2740",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTE5MzI4NA==",
            "updated_at": "2019-09-13T10:56:09Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/531193284",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/2622379?v=4",
                "events_url": "https://api.github.com/users/jnhansen/events{/privacy}",
                "followers_url": "https://api.github.com/users/jnhansen/followers",
                "following_url": "https://api.github.com/users/jnhansen/following{/other_user}",
                "gists_url": "https://api.github.com/users/jnhansen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jnhansen",
                "id": 2622379,
                "login": "jnhansen",
                "node_id": "MDQ6VXNlcjI2MjIzNzk=",
                "organizations_url": "https://api.github.com/users/jnhansen/orgs",
                "received_events_url": "https://api.github.com/users/jnhansen/received_events",
                "repos_url": "https://api.github.com/users/jnhansen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jnhansen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jnhansen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jnhansen"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2740/comments",
    "created_at": "2018-11-30T07:42:27Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-11-30T08:26:42Z",
            "event": "labeled",
            "id": 1997325495,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE5OTczMjU0OTU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1997325495"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-11-30T08:26:43Z",
            "event": "labeled",
            "id": 1997325497,
            "label": {
                "color": "444444",
                "name": "Build System"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE5OTczMjU0OTc=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1997325497"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-11-30T08:26:43Z",
            "event": "labeled",
            "id": 1997325501,
            "label": {
                "color": "444444",
                "name": "Documentation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE5OTczMjU1MDE=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1997325501"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2740/events",
    "html_url": "https://github.com/cython/cython/issues/2740",
    "id": 386073027,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425556353,
            "name": "Build System",
            "node_id": "MDU6TGFiZWw0MjU1NTYzNTM=",
            "url": "https://api.github.com/repos/cython/cython/labels/Build%20System"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425561345,
            "name": "Documentation",
            "node_id": "MDU6TGFiZWw0MjU1NjEzNDU=",
            "url": "https://api.github.com/repos/cython/cython/labels/Documentation"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2740/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzODYwNzMwMjc=",
    "number": 2740,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Options.emit_code_comments is not used",
    "updated_at": "2019-09-13T10:56:09Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2740",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/26092447?v=4",
        "events_url": "https://api.github.com/users/yuriescl/events{/privacy}",
        "followers_url": "https://api.github.com/users/yuriescl/followers",
        "following_url": "https://api.github.com/users/yuriescl/following{/other_user}",
        "gists_url": "https://api.github.com/users/yuriescl/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/yuriescl",
        "id": 26092447,
        "login": "yuriescl",
        "node_id": "MDQ6VXNlcjI2MDkyNDQ3",
        "organizations_url": "https://api.github.com/users/yuriescl/orgs",
        "received_events_url": "https://api.github.com/users/yuriescl/received_events",
        "repos_url": "https://api.github.com/users/yuriescl/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/yuriescl/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/yuriescl/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/yuriescl"
    }
}