{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nLooks like test suite fails in 'coverage_cmd_src_pkg_layout` unit\r\n\r\n\r\n### Code to reproduce the behaviour:\r\n\r\nI'm packaging your module as an rpm package so I'm using the typical PEP517 based build, install and test cycle used on building packages from non-root account.\r\n- `python3 -sBm build -w --no-isolation`\r\n- because I'm calling `build` with `--no-isolation` I'm using during all processes only locally installed modules\r\n- install .whl file in </install/prefix> using 'installer` module\r\n- run pytest with $PYTHONPATH pointing to sitearch and sitelib inside </install/prefix>\r\n- build is performed in env which is *`cut off from access to the public network`* (pytest is executed with `-m \"not network\"`)\r\n\r\n\r\n### Expected behaviour\r\n\r\ntest suite should not fail\r\n\r\n### OS\r\n\r\nLinux x86/64\r\n\r\n### Python version\r\n\r\n3.8.18\r\n\r\n### Cython version\r\n\r\n3.0.5\r\n\r\n### Additional context\r\n\r\nHere is last part of pytest log:\r\n```console\r\n======================================================================\r\nFAIL: runTest (__main__.EndToEndTest)\r\n[-1] End-to-end coverage_cmd_src_pkg_layout\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"runtests.py\", line 2079, in runTest\r\n    self.assertEqual(0, res, \"non-zero exit status, last output was:\\n%r\\n-- stdout:%s\\n-- stderr:%s\\n\" % (\r\nAssertionError: 0 != 1 : non-zero exit status, last output was:\r\n'/usr/bin/python3 -m pip install .'\r\n-- stdout:Defaulting to user installation because normal site-packages is not writeable\r\nProcessing /home/tkloczko/rpmbuild/BUILD/cython-3.0.5/TEST_TMP/run/coverage_cmd_src_pkg_layout\r\n  Preparing metadata (setup.py): started\r\n  Preparing metadata (setup.py): finished with status 'done'\r\nBuilding wheels for collected packages: pkg\r\n  Building wheel for pkg (setup.py): started\r\n  Building wheel for pkg (setup.py): finished with status 'done'\r\n  Created wheel for pkg: filename=pkg-0.0.0-cp38-cp38-linux_x86_64.whl size=88126 sha256=c0ae9b7b09f7f070084972c0d82c224b17ccbe8653796fee2d513e4cd8b045d7\r\n  Stored in directory: /tmp/pip-ephem-wheel-cache-e0osouer/wheels/72/08/2b/23800fa4a838e2f3cea3689bef0cc5da1a80e1ca75e5915aab\r\nSuccessfully built pkg\r\nInstalling collected packages: pkg\r\n\r\n-- stderr:ERROR: Could not install packages due to an OSError: [Errno 13] Permission denied: '/home/tkloczko/.local/lib/python3.8/site-packages/pkg'\r\nCheck the permissions.\r\n\r\n\r\n\r\n\r\n----------------------------------------------------------------------\r\nRan 15463 tests in 10665.013s\r\n\r\nFAILED (failures=1, skipped=78)\r\nFollowing tests excluded because of missing dependencies on your system:\r\n   run.numpy_pythran\r\n   run.numpy_pythran_unit\r\n   TestCodeFormat\r\nMost expensive pipeline stages: 'AnalyseDeclarationsTransform': 368.07 / 8321 (0.044 / run, 31.0%), 'generate_pyx_code_stage': 234.13 / 2736 (0.086 / run, 19.7%), 'inject_utility_code_stage': 152.02 / 3077 (0.049 / run, 12.8%), 'parse': 95.82 / 6449 (0.015 / run, 8.1%), 'AnalyseExpressionsTransform': 33.69 / 7163 (0.005 / run, 2.8%), 'ControlFlowAnalysis': 25.47 / 7164 (0.004 / run, 2.1%), 'RemoveUnreachableCode': 19.30 / 15487 (0.001 / run, 1.6%), 'MarkClosureVisitor': 16.29 / 8323 (0.002 / run, 1.4%), 'PostParse': 13.67 / 8323 (0.002 / run, 1.2%), 'InterpretCompilerDirectives': 13.39 / 8323 (0.002 / run, 1.1%)\r\nTimes:\r\ncompile-cpp :  4337.84 sec  (1386,  3.130 / run) - slowest: 'cpp:test_dataclasses' (172.31s), 'cpp:test_unicode' (105.07s), 'cpp:test_coroutines_pep492' (77.83s), 'cpp:test_grammar' (47.00s), 'cpp:test_asyncgen' (41.49s), 'cpp:memslice' (36.29s), 'cpp:numpy_test' (35.01s), 'cpp:test_exceptions' (30.93s)\r\ncompile-c   :  3785.97 sec  (1211,  3.126 / run) - slowest: 'c:test_dataclasses' (172.37s), 'c:test_unicode' (133.42s), 'c:test_coroutines_pep492' (91.82s), 'c:test_grammar' (55.27s), 'c:memslice' (47.98s), 'c:test_asyncgen' (44.24s), 'c:numpy_test' (39.17s), 'c:test_exceptions' (34.65s)\r\ncython      :   839.03 sec  (2831,  0.296 / run) - slowest: 'cpp:test_dataclasses' (24.34s), 'c:test_dataclasses' (9.88s), 'c:test_unicode' (6.88s), 'cpp:test_unicode' (6.43s), 'cpp:test_coroutines_pep492' (6.22s), 'c:test_coroutines_pep492' (5.76s), 'cpp:numpy_test' (5.46s), 'c:cyfunction_defaults' (5.20s)\r\nrun         :   470.26 sec  (1656,  0.284 / run) - slowest: 'c:test_coroutines_pep492' (164.46s), 'c:test_fstring' (84.30s), 'cpp:memslice' (33.21s), 'c:memslice' (32.53s), 'c:trashcan' (26.41s), 'cpp:trashcan' (26.11s), 'c:test_named_expressions' (13.64s), 'c:test_grammar' (6.31s)\r\netoe-build  :   467.40 sec  (  99,  4.721 / run) - slowest: 'c:memoryview_compare_type_pointers(1)' (18.03s), 'c:relative_cimport(1)' (15.99s), 'c:memoryview_acq_count(1)' (15.08s), 'c:public_fused_types(1)' (14.11s), 'c:pure_pxd(1)' (12.61s), 'c:cdef_multiple_inheritance_errors(1)' (11.89s), 'c:relative_cimport_compare(1)' (10.41s), 'c:coverage_api(2)' (10.24s)\r\netoe-run    :    79.54 sec  ( 200,  0.398 / run) - slowest: 'c:coverage_cmd_src_pkg_layout(1)' (7.10s), 'c:cpdef_pickle(1)' (4.01s), 'c:importas_from_package(1)' (3.47s), 'c:importas_from_package(4)' (3.40s), 'c:cythonize_with_annotate_via_cli(5)' (3.27s), 'c:cythonize_script_package(1)' (3.12s), 'c:cythonize_script(1)' (2.80s), 'c:cythonize_with_annotate_via_cli(3)' (2.48s)\r\nimport      :     2.89 sec  (1656,  0.002 / run) - slowest: 'c:test_dataclasses' (0.04s), 'cpp:test_dataclasses' (0.02s), 'c:pep526_variable_annotations' (0.02s), 'c:r_pyclassdefault' (0.01s), 'c:memslice' (0.01s), 'c:test_exceptions' (0.01s), 'c:r_lepage_3' (0.01s), 'cpp:cpp_stl_numeric_ops' (0.01s)\r\npyrun       :     0.68 sec  (  74,  0.009 / run) - slowest: 'py:posonly' (0.06s), 'py:pure_py' (0.05s), 'py:constant_folding' (0.04s), 'py:generators_py' (0.04s), 'py:methodmangling_T5' (0.03s), 'py:withstat_py' (0.02s), 'py:uninitialized' (0.02s), 'py:ext_auto_richcmp' (0.02s)\r\npyimport    :     0.09 sec  (  74,  0.001 / run) - slowest: 'py:constant_folding' (0.00s), 'py:pure_py' (0.00s), 'py:pep526_variable_annotations' (0.00s), 'py:pure_cdef_class_dataclass' (0.00s), 'py:posonly' (0.00s), 'py:pep557_dataclasses' (0.00s), 'py:generators_py' (0.00s), 'py:methodmangling_T5' (0.00s)\r\nALL DONE\r\nCompiler output for module parallel:\r\nparallel.cpp: In function ‘int __pyx_pymod_exec_parallel(PyObject*)’:\r\nparallel.cpp:2477:47: warning: comparison of integer expressions of different signedness: ‘Py_ssize_t’ {aka ‘long int’} and ‘size_t’ {aka ‘long unsigned int’} [-Wsign-compare]\r\n 2477 |                 for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\r\n      |                                     ~~~~~~~~~~^~~~~~~~~~~\r\n\r\nCompiler output for module parallel:\r\nparallel.cpp: In function ‘int __pyx_pymod_exec_parallel(PyObject*)’:\r\nparallel.cpp:2463:47: warning: comparison of integer expressions of different signedness: ‘Py_ssize_t’ {aka ‘long int’} and ‘size_t’ {aka ‘long unsigned int’} [-Wsign-compare]\r\n 2463 |                 for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\r\n      |                                     ~~~~~~~~~~^~~~~~~~~~~\r\n\r\n```\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Here is list of installed modules in build env\r\n<details>\r\n\r\n```console\r\nPackage                       Version\r\n----------------------------- -------\r\nalabaster                     0.7.13\r\nBabel                         2.13.1\r\nbuild                         1.0.0\r\ncharset-normalizer            3.3.1\r\ncoverage                      7.3.2\r\ncppclean                      0.13\r\ndistro                        1.8.0\r\ndocutils                      0.20.1\r\ngpg                           1.23.0\r\nidna                          3.4\r\nimagesize                     1.4.1\r\nimportlib-metadata            6.8.0\r\ninstaller                     0.7.0\r\njedi                          0.19.1\r\nJinja2                        3.1.2\r\nMarkupSafe                    2.1.3\r\nnumpy                         1.24.4\r\npackaging                     23.2\r\nparso                         0.8.3\r\nPygments                      2.16.1\r\npyproject_hooks               1.0.0\r\npython-dateutil               2.8.2\r\npytz                          2023.3\r\nrequests                      2.31.0\r\nsetuptools                    68.2.2\r\nsix                           1.16.0\r\nsnowballstemmer               2.2.0\r\nSphinx                        7.1.2\r\nsphinx-issues                 3.0.1\r\nsphinx-tabs                   3.4.1\r\nsphinxcontrib-applehelp       1.0.4\r\nsphinxcontrib-devhelp         1.0.2\r\nsphinxcontrib-htmlhelp        2.0.4\r\nsphinxcontrib-jsmath          1.0.1\r\nsphinxcontrib-qthelp          1.0.3\r\nsphinxcontrib-serializinghtml 1.1.9\r\ntomli                         2.0.1\r\nurllib3                       1.26.18\r\nwheel                         0.41.2\r\nzipp                          3.17.0\r\n```\r\n</details>\r\n",
            "created_at": "2023-10-31T16:00:42Z",
            "html_url": "https://github.com/cython/cython/issues/5788#issuecomment-1787516996",
            "id": 1787516996,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5788",
            "node_id": "IC_kwDOABDGAc5qi1hE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1787516996/reactions"
            },
            "updated_at": "2023-10-31T16:00:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1787516996",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31284574?v=4",
                "events_url": "https://api.github.com/users/kloczek/events{/privacy}",
                "followers_url": "https://api.github.com/users/kloczek/followers",
                "following_url": "https://api.github.com/users/kloczek/following{/other_user}",
                "gists_url": "https://api.github.com/users/kloczek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kloczek",
                "id": 31284574,
                "login": "kloczek",
                "node_id": "MDQ6VXNlcjMxMjg0NTc0",
                "organizations_url": "https://api.github.com/users/kloczek/orgs",
                "received_events_url": "https://api.github.com/users/kloczek/received_events",
                "repos_url": "https://api.github.com/users/kloczek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kloczek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kloczek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kloczek"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> ```\r\n> '/usr/bin/python3 -m pip install .'\r\n> ```\r\n\r\nI don't understand that line in the test. It probably won't work outside of venvs, and it modifies the venv just by running the test. That's bad, we should never do that.\r\n\r\nThe test was added in https://github.com/cython/cython/pull/3831. It fails without that line.",
            "created_at": "2023-10-31T20:09:19Z",
            "html_url": "https://github.com/cython/cython/issues/5788#issuecomment-1787960754",
            "id": 1787960754,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5788",
            "node_id": "IC_kwDOABDGAc5qkh2y",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1787960754/reactions"
            },
            "updated_at": "2023-10-31T20:09:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1787960754",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "In any case, it's a bug in the test, not in Cython itself. Excluding the test is fine if you want to make the test suite pass again.",
            "created_at": "2023-10-31T20:10:30Z",
            "html_url": "https://github.com/cython/cython/issues/5788#issuecomment-1787962194",
            "id": 1787962194,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5788",
            "node_id": "IC_kwDOABDGAc5qkiNS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1787962194/reactions"
            },
            "updated_at": "2023-10-31T20:10:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1787962194",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "> In any case, it's a bug in the test, not in Cython itself. \r\n\r\nOK. So I give green lit to star use it 👍 \r\nThx for your expertise 😄 \r\nIs it possible somehow exclude that ingle unit on test suite execution?\r\nI'm asking because whole whole cython test suite is executed as single pytest unit? 🤔 \r\n\r\nBTW: it would be really good to star moving current test suite units piece by piece under the pytest hood to be able speedup test suite execution by use for example with xdist pytest extension. I know that it may be long and not easy proces but at least some new units should not longer go under current hood.\r\n\r\n> Excluding the test is fine if you want to make the test suite pass again.\r\n\r\nThat would be used only as temporary workaround because in my packaging process test suite is executed one time.\r\n",
            "created_at": "2023-10-31T23:42:20Z",
            "html_url": "https://github.com/cython/cython/issues/5788#issuecomment-1788182076",
            "id": 1788182076,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5788",
            "node_id": "IC_kwDOABDGAc5qlX48",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1788182076/reactions"
            },
            "updated_at": "2023-10-31T23:42:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1788182076",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31284574?v=4",
                "events_url": "https://api.github.com/users/kloczek/events{/privacy}",
                "followers_url": "https://api.github.com/users/kloczek/followers",
                "following_url": "https://api.github.com/users/kloczek/following{/other_user}",
                "gists_url": "https://api.github.com/users/kloczek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kloczek",
                "id": 31284574,
                "login": "kloczek",
                "node_id": "MDQ6VXNlcjMxMjg0NTc0",
                "organizations_url": "https://api.github.com/users/kloczek/orgs",
                "received_events_url": "https://api.github.com/users/kloczek/received_events",
                "repos_url": "https://api.github.com/users/kloczek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kloczek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kloczek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kloczek"
            }
        },
        {
            "author_association": "NONE",
            "body": "Correction: I forgot that current test suite has nothing to do with pytest 😞 ",
            "created_at": "2023-10-31T23:44:02Z",
            "html_url": "https://github.com/cython/cython/issues/5788#issuecomment-1788183273",
            "id": 1788183273,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5788",
            "node_id": "IC_kwDOABDGAc5qlYLp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1788183273/reactions"
            },
            "updated_at": "2023-10-31T23:44:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1788183273",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31284574?v=4",
                "events_url": "https://api.github.com/users/kloczek/events{/privacy}",
                "followers_url": "https://api.github.com/users/kloczek/followers",
                "following_url": "https://api.github.com/users/kloczek/following{/other_user}",
                "gists_url": "https://api.github.com/users/kloczek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kloczek",
                "id": 31284574,
                "login": "kloczek",
                "node_id": "MDQ6VXNlcjMxMjg0NTc0",
                "organizations_url": "https://api.github.com/users/kloczek/orgs",
                "received_events_url": "https://api.github.com/users/kloczek/received_events",
                "repos_url": "https://api.github.com/users/kloczek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kloczek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kloczek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kloczek"
            }
        },
        {
            "author_association": "NONE",
            "body": "Just tested 3.0.6 and test suite still fails\r\n<details>\r\n\r\n```console\r\nrunTest (__main__.CythonCompileTestCase)\r\n[-1] compiling (cpp/cy2) vector_demo ... ok\r\nrunTest (__main__.CythonCompileTestCase)\r\n[-1] compiling (cpp/cy2) wrapper_vector ... ok\r\n\r\n======================================================================\r\nERROR: runTest (__main__.CythonRunTestCase)\r\n[-1] compiling (c/cy2) and running numpy_math\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/unixccompiler.py\", line 266, in link\r\n    self.spawn(linker + ld_args)\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/ccompiler.py\", line 1041, in spawn\r\n    spawn(cmd, dry_run=self.dry_run, **kwargs)\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/spawn.py\", line 70, in spawn\r\n    raise DistutilsExecError(\r\ndistutils.errors.DistutilsExecError: command '/usr/bin/gcc' failed with exit code 1\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"runtests.py\", line 1550, in run\r\n    ext_so_path = self.runCompileTest()\r\n  File \"runtests.py\", line 1163, in runCompileTest\r\n    return self.compile(\r\n  File \"runtests.py\", line 1482, in compile\r\n    so_path = self.run_distutils(test_directory, module, workdir, incdir)\r\n  File \"runtests.py\", line 1378, in run_distutils\r\n    build_extension.run()\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/command/build_ext.py\", line 345, in run\r\n    self.build_extensions()\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/command/build_ext.py\", line 467, in build_extensions\r\n    self._build_extensions_serial()\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/command/build_ext.py\", line 493, in _build_extensions_serial\r\n    self.build_extension(ext)\r\n  File \"runtests.py\", line 637, in build_extension\r\n    _build_ext.build_extension(self, ext)\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/command/build_ext.py\", line 572, in build_extension\r\n    self.compiler.link_shared_object(\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/ccompiler.py\", line 752, in link_shared_object\r\n    self.link(\r\n  File \"/usr/lib/python3.8/site-packages/setuptools/_distutils/unixccompiler.py\", line 268, in link\r\n    raise LinkError(msg)\r\ndistutils.errors.LinkError: command '/usr/bin/gcc' failed with exit code 1\r\n\r\n======================================================================\r\nFAIL: runTest (__main__.EndToEndTest)\r\n[-1] End-to-end coverage_cmd_src_pkg_layout\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"runtests.py\", line 2097, in runTest\r\n    self.assertEqual(0, res, \"non-zero exit status, last output was:\\n%r\\n-- stdout:%s\\n-- stderr:%s\\n\" % (\r\nAssertionError: 0 != 1 : non-zero exit status, last output was:\r\n'/usr/bin/python3 -m pip install .'\r\n-- stdout:Defaulting to user installation because normal site-packages is not writeable\r\nProcessing /home/tkloczko/rpmbuild/BUILD/cython-3.0.6/TEST_TMP/run/coverage_cmd_src_pkg_layout\r\n  Preparing metadata (setup.py): started\r\n  Preparing metadata (setup.py): finished with status 'done'\r\nBuilding wheels for collected packages: pkg\r\n  Building wheel for pkg (setup.py): started\r\n  Building wheel for pkg (setup.py): finished with status 'done'\r\n  Created wheel for pkg: filename=pkg-0.0.0-cp38-cp38-linux_x86_64.whl size=88223 sha256=d5461010286373f928737ecd2ea0c411c31ff1875e860fa98b44b1a4cfaeed76\r\n  Stored in directory: /tmp/pip-ephem-wheel-cache-i8dvatiu/wheels/0a/d5/77/700c2371a971e875ea860bb1371ac44147d80449dfe350d569\r\nSuccessfully built pkg\r\nInstalling collected packages: pkg\r\n\r\n-- stderr:ERROR: Could not install packages due to an OSError: [Errno 13] Permission denied: '/home/tkloczko/.local/lib/python3.8/site-packages/pkg'\r\nCheck the permissions.\r\n\r\n\r\n\r\n\r\n----------------------------------------------------------------------\r\nRan 15453 tests in 15569.114s\r\n\r\nFAILED (failures=1, errors=1, skipped=78)\r\nFollowing tests excluded because of missing dependencies on your system:\r\n   run.numpy_pythran\r\n   run.numpy_pythran_unit\r\n   TestCodeFormat\r\nMost expensive pipeline stages: 'AnalyseDeclarationsTransform': 318.87 / 8351 (0.038 / run, 29.8%), 'generate_pyx_code_stage': 216.35 / 2721 (0.080 / run, 20.2%), 'inject_utility_code_stage': 140.63 / 3062 (0.046 / run, 13.1%), 'parse': 85.12 / 6479 (0.013 / run, 7.9%), 'AnalyseExpressionsTransform': 30.87 / 7193 (0.004 / run, 2.9%), 'ControlFlowAnalysis': 25.94 / 7194 (0.004 / run, 2.4%), 'RemoveUnreachableCode': 17.67 / 15547 (0.001 / run, 1.6%), 'MarkClosureVisitor': 15.44 / 8353 (0.002 / run, 1.4%), 'PostParse': 12.59 / 8353 (0.002 / run, 1.2%), 'InterpretCompilerDirectives': 11.63 / 8353 (0.001 / run, 1.1%)\r\nTimes:\r\ncompile-cpp :  6709.57 sec  (1386,  4.841 / run) - slowest: 'cpp:test_dataclasses' (222.39s), 'cpp:test_unicode' (180.71s), 'cpp:numpy_test' (150.09s), 'cpp:test_coroutines_pep492' (142.35s), 'cpp:test_grammar' (81.44s), 'cpp:test_asyncgen' (77.25s), 'cpp:memslice' (65.47s), 'cpp:test_exceptions' (53.79s)\r\ncompile-c   :  6266.12 sec  (1210,  5.179 / run) - slowest: 'c:test_dataclasses' (251.07s), 'c:test_unicode' (228.96s), 'c:numpy_test' (169.21s), 'c:test_coroutines_pep492' (157.36s), 'c:test_grammar' (94.13s), 'c:test_asyncgen' (81.69s), 'c:memslice' (77.00s), 'c:test_exceptions' (59.36s)\r\ncython      :   760.33 sec  (2831,  0.269 / run) - slowest: 'cpp:numpy_test' (11.69s), 'cpp:test_dataclasses' (11.17s), 'c:test_dataclasses' (10.66s), 'c:test_unicode' (6.42s), 'cpp:test_unicode' (5.93s), 'cpp:test_coroutines_pep492' (5.80s), 'c:parallel' (5.51s), 'c:test_coroutines_pep492' (5.47s)\r\netoe-build  :   652.80 sec  (  99,  6.594 / run) - slowest: 'c:extern_varobject_extensions(1)' (28.89s), 'c:memoryview_compare_type_pointers(1)' (28.34s), 'c:memoryview_acq_count(1)' (23.40s), 'c:public_fused_types(1)' (22.38s), 'c:cdef_multiple_inheritance_errors(1)' (19.16s), 'c:pure_pxd(1)' (18.15s), 'c:line_profile_test(1)' (17.06s), 'c:pep442_tp_finalize_cimport(1)' (16.78s)\r\nrun         :   608.80 sec  (1655,  0.368 / run) - slowest: 'c:test_coroutines_pep492' (271.78s), 'c:test_fstring' (138.65s), 'cpp:memslice' (25.43s), 'c:memslice' (24.97s), 'c:trashcan' (22.28s), 'cpp:trashcan' (22.15s), 'c:test_named_expressions' (18.51s), 'c:test_grammar' (8.71s)\r\netoe-run    :    82.44 sec  ( 200,  0.412 / run) - slowest: 'c:cpdef_pickle(1)' (5.55s), 'c:coverage_cmd_src_pkg_layout(1)' (4.80s), 'c:importas_from_package(4)' (4.25s), 'c:importas_from_package(1)' (4.19s), 'c:cythonize_script_package(1)' (3.84s), 'c:cythonize_with_annotate_via_cli(5)' (3.74s), 'c:cythonize_script(1)' (3.26s), 'c:cythonize_with_annotate_via_cli(3)' (3.19s)\r\nimport      :     2.63 sec  (1655,  0.002 / run) - slowest: 'c:pep526_variable_annotations' (0.05s), 'cpp:external_ref_reassignment' (0.03s), 'c:special_methods_T561_py3' (0.02s), 'c:test_dataclasses' (0.02s), 'cpp:test_dataclasses' (0.02s), 'c:extra_walrus' (0.02s), 'cpp:methodmangling_pure' (0.02s), 'cpp:numpy_test' (0.01s)\r\npyrun       :     0.71 sec  (  74,  0.010 / run) - slowest: 'py:posonly' (0.07s), 'py:methodmangling_T5' (0.07s), 'py:pure_py' (0.05s), 'py:pep526_variable_annotations' (0.04s), 'py:generators_py' (0.03s), 'py:constant_folding' (0.03s), 'py:withstat_py' (0.02s), 'py:uninitialized' (0.02s)\r\npyimport    :     0.10 sec  (  74,  0.001 / run) - slowest: 'py:pep526_variable_annotations' (0.01s), 'py:onelinesuite' (0.00s), 'py:methodmangling_T5' (0.00s), 'py:pep557_dataclasses' (0.00s), 'py:pure_py' (0.00s), 'py:extra_walrus' (0.00s), 'py:posonly' (0.00s), 'py:constant_folding' (0.00s)\r\nALL DONE\r\nCompiler output for module function_pointer_struct:\r\nfunction_pointer_struct.cpp:2510:18: warning: ‘PyObject* __Pyx_CFunc_int__lParenint__comma_int__rParenexcept__3F__2D1_to_py_1a_1b(int (*)(int, int))’ defined but not used [-Wunused-function]\r\n 2510 | static PyObject *__Pyx_CFunc_int__lParenint__comma_int__rParenexcept__3F__2D1_to_py_1a_1b(int (*__pyx_v_f)(int, int)) {\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nCompiler output for module breaking_loop:\r\nbreaking_loop.c:1955:12: warning: ‘__pyx_f_13breaking_loop_func’ defined but not used [-Wunused-function]\r\n 1955 | static int __pyx_f_13breaking_loop_func(CYTHON_UNUSED Py_ssize_t __pyx_v_n) {\r\n      |            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nCompiler output for module breaking_loop:\r\nbreaking_loop.cpp:1967:12: warning: ‘int __pyx_f_13breaking_loop_func(Py_ssize_t)’ defined but not used [-Wunused-function]\r\n 1967 | static int __pyx_f_13breaking_loop_func(CYTHON_UNUSED Py_ssize_t __pyx_v_n) {\r\n      |            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nCompiler output for module breaking_loop:\r\nbreaking_loop.c:1949:12: warning: ‘__pyx_f_13breaking_loop_func’ defined but not used [-Wunused-function]\r\n 1949 | static int __pyx_f_13breaking_loop_func(CYTHON_UNUSED Py_ssize_t __pyx_v_n) {\r\n      |            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nCompiler output for module breaking_loop:\r\nbreaking_loop.cpp:1961:12: warning: ‘int __pyx_f_13breaking_loop_func(Py_ssize_t)’ defined but not used [-Wunused-function]\r\n 1961 | static int __pyx_f_13breaking_loop_func(CYTHON_UNUSED Py_ssize_t __pyx_v_n) {\r\n      |            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nCompiler output for module parallel:\r\nparallel.cpp: In function ‘int __pyx_pymod_exec_parallel(PyObject*)’:\r\nparallel.cpp:2477:47: warning: comparison of integer expressions of different signedness: ‘Py_ssize_t’ {aka ‘long int’} and ‘size_t’ {aka ‘long unsigned int’} [-Wsign-compare]\r\n 2477 |                 for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\r\n      |                                     ~~~~~~~~~~^~~~~~~~~~~\r\n\r\nCompiler output for module parallel:\r\nparallel.cpp: In function ‘int __pyx_pymod_exec_parallel(PyObject*)’:\r\nparallel.cpp:2463:47: warning: comparison of integer expressions of different signedness: ‘Py_ssize_t’ {aka ‘long int’} and ‘size_t’ {aka ‘long unsigned int’} [-Wsign-compare]\r\n 2463 |                 for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\r\n      |                                     ~~~~~~~~~~^~~~~~~~~~~\r\n\r\n```\r\n</details>\r\n\r\nSo test suite still tries to install module in account sitelib directory.",
            "created_at": "2023-11-26T21:18:52Z",
            "html_url": "https://github.com/cython/cython/issues/5788#issuecomment-1826899812",
            "id": 1826899812,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5788",
            "node_id": "IC_kwDOABDGAc5s5Edk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1826899812/reactions"
            },
            "updated_at": "2023-11-26T21:18:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1826899812",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31284574?v=4",
                "events_url": "https://api.github.com/users/kloczek/events{/privacy}",
                "followers_url": "https://api.github.com/users/kloczek/followers",
                "following_url": "https://api.github.com/users/kloczek/following{/other_user}",
                "gists_url": "https://api.github.com/users/kloczek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kloczek",
                "id": 31284574,
                "login": "kloczek",
                "node_id": "MDQ6VXNlcjMxMjg0NTc0",
                "organizations_url": "https://api.github.com/users/kloczek/orgs",
                "received_events_url": "https://api.github.com/users/kloczek/received_events",
                "repos_url": "https://api.github.com/users/kloczek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kloczek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kloczek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kloczek"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5788/comments",
    "created_at": "2023-10-31T15:52:28Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-10-31T20:17:14Z",
            "event": "labeled",
            "id": 10825605532,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "LE_lADOABDGAc51d7PezwAAAAKFQaGc",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10825605532"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-10-31T20:17:14Z",
            "event": "labeled",
            "id": 10825605536,
            "label": {
                "color": "444444",
                "name": "Testing"
            },
            "node_id": "LE_lADOABDGAc51d7PezwAAAAKFQaGg",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10825605536"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-10-31T20:17:19Z",
            "event": "milestoned",
            "id": 10825606349,
            "milestone": {
                "title": "3.0.x"
            },
            "node_id": "MIE_lADOABDGAc51d7PezwAAAAKFQaTN",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10825606349"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5788/events",
    "html_url": "https://github.com/cython/cython/issues/5788",
    "id": 1970779102,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425558326,
            "name": "Testing",
            "node_id": "MDU6TGFiZWw0MjU1NTgzMjY=",
            "url": "https://api.github.com/repos/cython/cython/labels/Testing"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5788/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 5,
        "created_at": "2023-07-23T12:57:42Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/99",
        "id": 9687005,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/99/labels",
        "node_id": "MI_kwDOABDGAc4Ak8_d",
        "number": 99,
        "open_issues": 14,
        "state": "open",
        "title": "3.0.x",
        "updated_at": "2023-11-27T08:21:51Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/99"
    },
    "node_id": "I_kwDOABDGAc51d7Pe",
    "number": 5788,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5788/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5788/timeline",
    "title": "[BUG] 3.0.5: test suite fails",
    "updated_at": "2023-11-26T21:18:53Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5788",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/31284574?v=4",
        "events_url": "https://api.github.com/users/kloczek/events{/privacy}",
        "followers_url": "https://api.github.com/users/kloczek/followers",
        "following_url": "https://api.github.com/users/kloczek/following{/other_user}",
        "gists_url": "https://api.github.com/users/kloczek/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kloczek",
        "id": 31284574,
        "login": "kloczek",
        "node_id": "MDQ6VXNlcjMxMjg0NTc0",
        "organizations_url": "https://api.github.com/users/kloczek/orgs",
        "received_events_url": "https://api.github.com/users/kloczek/received_events",
        "repos_url": "https://api.github.com/users/kloczek/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kloczek/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kloczek/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kloczek"
    }
}