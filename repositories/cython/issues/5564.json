{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nref https://github.com/david-cortes/hpfrec/issues/14\r\n\r\nWith the latest cython==3.0.0, some 'for' loops using `prange` in `.pyx` files are being compiled into something that isn't able to finish the loop (this is about just deterministically-numbered for's), but will work correctly (that is, the program is able to exit from the loop) if switched to regular `range` or if compiled with an older cython version.\r\n\r\nI haven't been able to produce a minimally reproducible example and am not sure what exactly is wrong, nor how to debug it, but I have this particular example here:\r\nhttps://github.com/david-cortes/hpfrec/blob/aac53899f9b93071a1a2267f41f61f603c4a33d9/hpfrec/cython_loops.pxi#L579\r\n\r\nIf adding `printf` lines, I am seeing that the code is able to enter the loop, and at least some individual iterations are able to reach the last line inside the 'for' chunk if I add a printf in each loop iteration, but if adding a `printf` statement right outside of the 'for' indentation, it never reaches that line.\r\n\r\nThe issue happens with both GCC and CLANG.\r\n\r\nAttached is the generated C file in case it helps. The translated chunk starts at L21624 in the C file.\r\n[cython_double_nonwindows.zip](https://github.com/cython/cython/files/12164391/cython_double_nonwindows.zip)\r\n\r\n\r\n### Code to reproduce the behaviour:\r\n\r\nhttps://github.com/david-cortes/hpfrec/blob/aac53899f9b93071a1a2267f41f61f603c4a33d9/hpfrec/cython_loops.pxi#L579\r\n\r\n### Expected behaviour\r\n\r\nThe `prange` loop should reach the end of the execution in the code above, which is deterministic and not dependant on any variable that would get modified inside the loop.\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Python version\r\n\r\n3.9\r\n\r\n### Cython version\r\n\r\n3.0.0\r\n\r\n### Additional context\r\n\r\n_No response_",
    "closed_at": "2023-08-21T20:07:17Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Are there any instructions saying that we'd need to run the in that example if we wanted to reproduce it?\r\n\r\nMy current theory is that it's re-acquiring the GIL to check if some function has errored and we're ending up with a dead-lock there. You could try marking any functions/function pointers that you use in the loop as `noexcept` to prevent that.\r\n\r\nThat's a complete semi-informed guess though so don't take it too seriously",
            "created_at": "2023-07-26T07:50:48Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1651165046",
            "id": 1651165046,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5iasd2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1651165046/reactions"
            },
            "updated_at": "2023-07-26T07:50:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1651165046",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Are there any instructions saying that we'd need to run the in that example if we wanted to reproduce it?\r\n> \r\n> My current theory is that it's re-acquiring the GIL to check if some function has errored and we're ending up with a dead-lock there. You could try marking any functions/function pointers that you use in the loop as `noexcept` to prevent that.\r\n> \r\n> That's a complete semi-informed guess though so don't take it too seriously\r\n\r\nThanks for the hint. It's definitely related as adding compiler directive `legacy_implicit_noexcept=True` makes the problem go away.\r\n\r\nHowever, in this case, the `cdef`'d function that hangs is only calling functions from `libc.math` and `scipy.special.cython_special`, which I understand are declared from \"extern\" and thus should be implicit `noexcept`s according to [the docs](https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values).\r\n\r\n(BTW if `prange` calling a non-`noexcept` function is something that will end up hanging, it'd be nice to turn it into a compilation error intead)\r\n\r\nAs for an example to trigger the bug - sorry, forgot about that part. Steps would be to clone the repository, reset to the commit above, then build the extension, and then execute the example in the readme of the repository. As code:\r\n```shell\r\ngit clone https://github.com/david-cortes/hpfrec.git\r\ncd hpfrec\r\ngit reset --hard aac53899f9b93071a1a2267f41f61f603c4a33d9\r\npython setup.py build_ext --inplace --force\r\n```\r\n\r\nThen launch python and execute the following:\r\n```python\r\nimport numpy as np\r\nfrom scipy.sparse import random as sp_random\r\nfrom hpfrec import HPF\r\n\r\nX = sp_random(100, 100, random_state=123)\r\nHPF().fit(X)\r\n```",
            "created_at": "2023-07-26T14:34:18Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1651934508",
            "id": 1651934508,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5idoUs",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1651934508/reactions"
            },
            "updated_at": "2023-07-26T14:34:18Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1651934508",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11860098?v=4",
                "events_url": "https://api.github.com/users/david-cortes/events{/privacy}",
                "followers_url": "https://api.github.com/users/david-cortes/followers",
                "following_url": "https://api.github.com/users/david-cortes/following{/other_user}",
                "gists_url": "https://api.github.com/users/david-cortes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/david-cortes",
                "id": 11860098,
                "login": "david-cortes",
                "node_id": "MDQ6VXNlcjExODYwMDk4",
                "organizations_url": "https://api.github.com/users/david-cortes/orgs",
                "received_events_url": "https://api.github.com/users/david-cortes/received_events",
                "repos_url": "https://api.github.com/users/david-cortes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/david-cortes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/david-cortes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/david-cortes"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks for confirming.\r\n\r\n> However, in this case, the cdef'd function that hangs is only calling functions from libc.math and scipy.special.cython_special, which I understand are declared from \"extern\" and thus should be implicit noexcepts according to [the docs](https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values).\r\n\r\nI think the complication is that you go through a function pointer which is declared non-externally. So the function pointer exception won't have the implicit `noexcept`.\r\n\r\n> (BTW if prange calling a non-noexcept function is something that will end up hanging, it'd be nice to turn it into a compilation error intead)\r\n\r\nMy hope is we can fix it rather than have to turn it into an error. But either way we should definitely do something better than hang.\r\n\r\nThanks for the information - that should be enough to dig into it a little more, time permitting\r\n\r\n",
            "created_at": "2023-07-26T19:22:03Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1652360694",
            "id": 1652360694,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5ifQX2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1652360694/reactions"
            },
            "updated_at": "2023-07-26T19:22:03Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1652360694",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think I've got to the bottom of this, although I tested it on the simpler example in #5577 rather than your code.\r\n\r\nI believe there's probably a subtle error in your code: a `nogil` function says that it *can* be run without the GIL, but doesn't guarantee that it's run without the GIL. `prange` blocks *must* be run without the GIL (although you get away with it most of the time unless you hit something that needs to re-acquire the GIL).\r\n\r\nFrankly that's so subtle that I'm not sure anyone can be expected to spot it. Therefore my proposed fix is to get rid of the requirement and make absolutely 100% sure that the GIL is released before entering a `prange` block.",
            "created_at": "2023-07-29T21:24:52Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1656905183",
            "id": 1656905183,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5iwl3f",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1656905183/reactions"
            },
            "updated_at": "2023-07-29T21:24:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1656905183",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I think I've got to the bottom of this, although I tested it on the simpler example in #5577 rather than your code.\r\n> \r\n> I believe there's probably a subtle error in your code: a `nogil` function says that it _can_ be run without the GIL, but doesn't guarantee that it's run without the GIL. `prange` blocks _must_ be run without the GIL (although you get away with it most of the time unless you hit something that needs to re-acquire the GIL).\r\n> \r\n> Frankly that's so subtle that I'm not sure anyone can be expected to spot it. Therefore my proposed fix is to get rid of the requirement and make absolutely 100% sure that the GIL is released before entering a `prange` block.\r\n\r\n~Adding an explicit `with nogil:` before entering the `prange` part doesn't seem to solve the issue either.~ Actually it does, just seems to execute much slower in my use-case.",
            "created_at": "2023-07-30T18:48:42Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1657240474",
            "id": 1657240474,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5ix3ua",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1657240474/reactions"
            },
            "updated_at": "2023-07-30T18:49:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1657240474",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11860098?v=4",
                "events_url": "https://api.github.com/users/david-cortes/events{/privacy}",
                "followers_url": "https://api.github.com/users/david-cortes/followers",
                "following_url": "https://api.github.com/users/david-cortes/following{/other_user}",
                "gists_url": "https://api.github.com/users/david-cortes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/david-cortes",
                "id": 11860098,
                "login": "david-cortes",
                "node_id": "MDQ6VXNlcjExODYwMDk4",
                "organizations_url": "https://api.github.com/users/david-cortes/orgs",
                "received_events_url": "https://api.github.com/users/david-cortes/received_events",
                "repos_url": "https://api.github.com/users/david-cortes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/david-cortes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/david-cortes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/david-cortes"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Do you know if it's the `with nogil:` that makes it run slower? or does `with nogil` plus `legacy_implicit_noexcept=True` run at normal speed?\r\n\r\n Just considering what to do here\r\n* f the `with nogil:` is an appreciable slowdown then I should think twice about adding it implicitly.\r\n* With the `legacy_implicit_noexcept` we know if does have a performance hit in some circumstances - the question is what the best way to tell users about it is.",
            "created_at": "2023-07-30T21:16:35Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1657268605",
            "id": 1657268605,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5ix-l9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1657268605/reactions"
            },
            "updated_at": "2023-07-30T21:16:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1657268605",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Do you know if it's the `with nogil:` that makes it run slower? or does `with nogil` plus `legacy_implicit_noexcept=True` run at normal speed?\r\n> \r\n> Just considering what to do here\r\n> \r\n> * f the `with nogil:` is an appreciable slowdown then I should think twice about adding it implicitly.\r\n> * With the `legacy_implicit_noexcept` we know if does have a performance hit in some circumstances - the question is what the best way to tell users about it is.\r\n\r\nIf adding `with nogil` before entering the `prange`, it seems to run slower than if compiled with older cython (where it wasn't required), and it seems to prevent the code from running fully in parallel inside the `prange`. The slowdown goes beyond just the loss of multi-threading.\r\n\r\nAdding `legacy_implicit_noexcept=True` seems to fix the speed issue, regardless of whether there is a `with nogil` or not, so the `with nogil` is probably not to blame.",
            "created_at": "2023-07-31T16:15:00Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1658707586",
            "id": 1658707586,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5i3d6C",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1658707586/reactions"
            },
            "updated_at": "2023-07-31T19:11:04Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1658707586",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11860098?v=4",
                "events_url": "https://api.github.com/users/david-cortes/events{/privacy}",
                "followers_url": "https://api.github.com/users/david-cortes/followers",
                "following_url": "https://api.github.com/users/david-cortes/following{/other_user}",
                "gists_url": "https://api.github.com/users/david-cortes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/david-cortes",
                "id": 11860098,
                "login": "david-cortes",
                "node_id": "MDQ6VXNlcjExODYwMDk4",
                "organizations_url": "https://api.github.com/users/david-cortes/orgs",
                "received_events_url": "https://api.github.com/users/david-cortes/received_events",
                "repos_url": "https://api.github.com/users/david-cortes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/david-cortes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/david-cortes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/david-cortes"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks again. That suggests to me my proposed fix is probably fine, but we should get people some better diagnostics when they're using `except *` functions (especially those where the `except *` has been added implicitly by Cython) in `nogil` sections.",
            "created_at": "2023-08-01T06:51:01Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1659675242",
            "id": 1659675242,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5i7KJq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1659675242/reactions"
            },
            "updated_at": "2023-08-01T06:51:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1659675242",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Thanks again. That suggests to me my proposed fix is probably fine, but we should get people some better diagnostics when they're using `except *` functions (especially those where the `except *` has been added implicitly by Cython) in `nogil` sections.\r\n\r\nThe problem still happens with functions that are declared from `extern`, even when not accessed through a function pointer. I haven't been able to create a minimal example, but the same repository above was updated to avoid going through function pointers and the issue persists. I guess it might have to do with using `cimport as` or `ctypedef` but I'm not 100% sure.\r\n\r\nHere it would show a slowdown if one removes the compiler directive `legacy_implicit_noexcept=True` from file `cython_float_nonwindows.pyx`. It might not be very noticeable in this example, but as the data sizes grow, it becomes very noticeable compared to the old implicit `noexcept` logic:\r\n```shell\r\ngit clone https://github.com/david-cortes/hpfrec.git\r\ncd hpfrec\r\ngit reset --hard ca11bd17d9125d46591f9c18c86bde4231f098f8\r\npython setup.py build_ext --inplace --force\r\n```\r\n```python\r\nimport numpy as np\r\nfrom scipy.sparse import random as sp_random\r\nfrom hpfrec import HPF\r\n\r\nX = sp_random(100, 100, random_state=123)\r\nHPF().fit(X)\r\n```",
            "created_at": "2023-08-01T16:14:35Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1660649390",
            "id": 1660649390,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5i-3-u",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1660649390/reactions"
            },
            "updated_at": "2023-08-01T16:14:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1660649390",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11860098?v=4",
                "events_url": "https://api.github.com/users/david-cortes/events{/privacy}",
                "followers_url": "https://api.github.com/users/david-cortes/followers",
                "following_url": "https://api.github.com/users/david-cortes/following{/other_user}",
                "gists_url": "https://api.github.com/users/david-cortes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/david-cortes",
                "id": 11860098,
                "login": "david-cortes",
                "node_id": "MDQ6VXNlcjExODYwMDk4",
                "organizations_url": "https://api.github.com/users/david-cortes/orgs",
                "received_events_url": "https://api.github.com/users/david-cortes/received_events",
                "repos_url": "https://api.github.com/users/david-cortes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/david-cortes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/david-cortes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/david-cortes"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It looks like the functions that are causing issues are the scipy special ones:\r\n\r\n```\r\n__pyx_t_8 = __pyx_fuse_1__pyx_f_5scipy_7special_14cython_special_psi((__pyx_v_G_sh[(__pyx_v_uid_st + __pyx_v_j)]), 0); if (unlikely(__Pyx_ErrOccurredWithGIL())) __PYX_ERR(0, 569, __pyx_L6_error)\r\n```\r\n\r\n(The thing to search for the in the C code to identify this is `__Pyx_ErrOccurredWithGIL`). This looks like a fused function rather than something purely extern. I haven't been able to identify where it comes from in Scipy but I'll report it to them to see if it can be made `noexcept`",
            "created_at": "2023-08-02T07:10:16Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1661629851",
            "id": 1661629851,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5jCnWb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1661629851/reactions"
            },
            "updated_at": "2023-08-02T07:10:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1661629851",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think this is closed by https://github.com/cython/cython/commit/3c54aad4698a5ac9f5febeea1f1fdbf543a22790\r\n\r\nThere's definitely more stuff I'd like to do about improving fused functions, and improving diagnostics for this. But I think the immediate \"it crashes\" issue is done.",
            "created_at": "2023-08-21T20:07:17Z",
            "html_url": "https://github.com/cython/cython/issues/5564#issuecomment-1686969296",
            "id": 1686969296,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5564",
            "node_id": "IC_kwDOABDGAc5kjRvQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1686969296/reactions"
            },
            "updated_at": "2023-08-21T20:07:17Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1686969296",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 11,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5564/comments",
    "created_at": "2023-07-25T18:30:24Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": "ff57a5cafbc6be64d22493881edc0960258f757e",
            "commit_url": "https://api.github.com/repos/da-woods/cython/commits/ff57a5cafbc6be64d22493881edc0960258f757e",
            "created_at": "2023-07-29T21:19:34Z",
            "event": "referenced",
            "id": 9955467266,
            "node_id": "REFE_lADOABDGAc5siOf2zwAAAAJRZGAC",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/9955467266"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-07-30T10:04:11Z",
            "event": "milestoned",
            "id": 9956492631,
            "milestone": {
                "title": "3.0.1"
            },
            "node_id": "MIE_lADOABDGAc5siOf2zwAAAAJRdAVX",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/9956492631"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": "3c54aad4698a5ac9f5febeea1f1fdbf543a22790",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/3c54aad4698a5ac9f5febeea1f1fdbf543a22790",
            "created_at": "2023-08-21T19:43:02Z",
            "event": "referenced",
            "id": 10149832679,
            "node_id": "REFE_lADOABDGAc5siOf2zwAAAAJc-ifn",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10149832679"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-08-21T20:07:17Z",
            "event": "closed",
            "id": 10150044741,
            "node_id": "CE_lADOABDGAc5siOf2zwAAAAJc_WRF",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10150044741"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5564/events",
    "html_url": "https://github.com/cython/cython/issues/5564",
    "id": 1820911606,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5564/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 45,
        "created_at": "2023-07-23T12:56:47Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/98",
        "id": 9687004,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/98/labels",
        "node_id": "MI_kwDOABDGAc4Ak8_c",
        "number": 98,
        "open_issues": 0,
        "state": "open",
        "title": "3.0.1",
        "updated_at": "2023-08-23T10:42:09Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/98"
    },
    "node_id": "I_kwDOABDGAc5siOf2",
    "number": 5564,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5564/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5564/timeline",
    "title": "[BUG] Compiled `prange` loop isn't able to exit section",
    "updated_at": "2023-08-21T20:07:17Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5564",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11860098?v=4",
        "events_url": "https://api.github.com/users/david-cortes/events{/privacy}",
        "followers_url": "https://api.github.com/users/david-cortes/followers",
        "following_url": "https://api.github.com/users/david-cortes/following{/other_user}",
        "gists_url": "https://api.github.com/users/david-cortes/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/david-cortes",
        "id": 11860098,
        "login": "david-cortes",
        "node_id": "MDQ6VXNlcjExODYwMDk4",
        "organizations_url": "https://api.github.com/users/david-cortes/orgs",
        "received_events_url": "https://api.github.com/users/david-cortes/received_events",
        "repos_url": "https://api.github.com/users/david-cortes/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/david-cortes/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/david-cortes/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/david-cortes"
    }
}