{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Describe the bug\n\nArgument annotations are ignored in .pxd files. The type of an argument with an annotation is always set to object\n\n### Code to reproduce the behaviour:\n\n.pxd file --\n```cython\ncpdef function(a: str):\n```\n\n.py file\n```python\nimport cython\n@cython.ccall\ncpdef function(a: str):\n   ...\n```\n\nThis fails to cythonize with a 'Function signature does not match previous declaration' error\n\n\n### Expected behaviour\n\n_No response_\n\n### OS\n\n_No response_\n\n### Python version\n\n_No response_\n\n### Cython version\n\n_No response_\n\n### Additional context\n\nThe immediate cause of the bug is that the if <test>: at line 998 of Nodes.py fails. The lines are\n```\n        if (self.annotation and env and env.directives['annotation_typing']\n                # CSimpleBaseTypeNode has a name attribute; CAnalysedBaseTypeNode\n                # (and maybe other options) doesn't\n                and getattr(self.base_type, \"name\", None) is None):\n```\n\nIt's the last clause -- ```getattr(self.base_type, \"name\", None) is None``` -- that evaluates to false. If I remove the last clause, annotations work in a simple test .pxd files but I don't know what other implications there are.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Is the clause preventing annotations from working trying to check whether the type is specified before the argument name? I'm planning on attempting to figure this out and try to fix it and would appreciate any insight on what the code is trying to do.\n\nBTW, my goal here is to prevent cross module calls from segfaulting when nonecheck in on because the modules each think that the other is checking for None.",
            "created_at": "2025-06-09T10:15:20Z",
            "html_url": "https://github.com/cython/cython/issues/6945#issuecomment-2955351036",
            "id": 2955351036,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6945",
            "node_id": "IC_kwDOABDGAc6wJxP8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2955351036/reactions"
            },
            "updated_at": "2025-06-09T10:15:20Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2955351036",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/234443?v=4",
                "events_url": "https://api.github.com/users/jpe/events{/privacy}",
                "followers_url": "https://api.github.com/users/jpe/followers",
                "following_url": "https://api.github.com/users/jpe/following{/other_user}",
                "gists_url": "https://api.github.com/users/jpe/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jpe",
                "id": 234443,
                "login": "jpe",
                "node_id": "MDQ6VXNlcjIzNDQ0Mw==",
                "organizations_url": "https://api.github.com/users/jpe/orgs",
                "received_events_url": "https://api.github.com/users/jpe/received_events",
                "repos_url": "https://api.github.com/users/jpe/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jpe/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jpe/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jpe",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The easiest way to work this out is probably to comment out the line and see what tests fail - that'll most likely tell you quite quickly.\n\n> Is the clause preventing annotations from working trying to check whether the type is specified before the argument name?\n\nI think it is. I'm not sure of all the details off the top of my head, but if you have a declaration like `cdef void(something):` it's a little ambiguous if `something` is a type name with an unnamed argument, or an object argument called `something`. I think it's to do with trying to work that our but I'm not completely sure how or why.",
            "created_at": "2025-06-09T18:24:09Z",
            "html_url": "https://github.com/cython/cython/issues/6945#issuecomment-2956590717",
            "id": 2956590717,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6945",
            "node_id": "IC_kwDOABDGAc6wOf59",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2956590717/reactions"
            },
            "updated_at": "2025-06-09T18:24:09Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2956590717",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6945/comments",
    "created_at": "2025-06-06T14:06:09Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6945/events",
    "html_url": "https://github.com/cython/cython/issues/6945",
    "id": 3124891478,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6945/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc66Qg9W",
    "number": 6945,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6945/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6945/timeline",
    "title": "[BUG] Argument annotations are ignored in .pxd files",
    "type": null,
    "updated_at": "2025-06-09T18:24:10Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6945",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/234443?v=4",
        "events_url": "https://api.github.com/users/jpe/events{/privacy}",
        "followers_url": "https://api.github.com/users/jpe/followers",
        "following_url": "https://api.github.com/users/jpe/following{/other_user}",
        "gists_url": "https://api.github.com/users/jpe/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jpe",
        "id": 234443,
        "login": "jpe",
        "node_id": "MDQ6VXNlcjIzNDQ0Mw==",
        "organizations_url": "https://api.github.com/users/jpe/orgs",
        "received_events_url": "https://api.github.com/users/jpe/received_events",
        "repos_url": "https://api.github.com/users/jpe/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jpe/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jpe/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jpe",
        "user_view_type": "public"
    }
}