{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "We would like to use the -Wshadow C compiler flag to discover mistakes in our code. However, applying that flag across the board gives warnings from cython-generated code.\r\n\r\nHere's an example\r\n\r\n```cython\r\n# cython: language_level = 3\r\n\r\ndef a(x):\r\n    pass\r\n\r\ndef b():\r\n    a(1)\r\n```\r\n\r\nWith Cython version 0.29.17 it generates code that shadows local variables:\r\n```\r\n$ cython cythonshadow.pyx && gcc -Werror=shadow -I/usr/include/python3.8 cythonshadow.c  -c\r\ncythonshadow.c: In function ‘__Pyx_PyObject_Call2Args’:\r\ncythonshadow.c:1903:19: error: declaration of ‘args’ shadows a previous local [-Werror=shadow]\r\n 1903 |         PyObject *args[2] = {arg1, arg2};\r\n      |                   ^~~~\r\ncythonshadow.c:1900:15: note: shadowed declaration is here\r\n 1900 |     PyObject *args, *result = NULL;\r\n      |               ^~~~\r\ncythonshadow.c:1909:19: error: declaration of ‘args’ shadows a previous local [-Werror=shadow]\r\n 1909 |         PyObject *args[2] = {arg1, arg2};\r\n      |                   ^~~~\r\ncythonshadow.c:1900:15: note: shadowed declaration is here\r\n 1900 |     PyObject *args, *result = NULL;\r\n      |               ^~~~\r\ncc1: some warnings being treated as errors\r\n```\r\n\r\nIf more people thinks this is desirable, I can prepare a pull request. Vote thumbs up! If people vote thumbs down and prefer readable generated code, let's just close the bug without action.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "`__Pyx_PyObject_Call2Args` has simplified considerably for Cython 3 so in the long-term this specific warning will go away. However, I think we're generally trying to remove as many C warnings as is reasonably possible, so a PR against the 0.29.x branch would be welcome.",
            "created_at": "2020-09-09T17:03:49Z",
            "html_url": "https://github.com/cython/cython/issues/3822#issuecomment-689696651",
            "id": 689696651,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3822",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTY5NjY1MQ==",
            "performed_via_github_app": null,
            "updated_at": "2020-09-09T17:03:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/689696651",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> a PR against the 0.29.x branch would be welcome.\r\n\r\n… if it shows a very low risk of breaking other people's code. If this is already fixed in the latest Cython releases, then the arguments for backporting (or creating) a fix need to be weighed off against the risk of breakage in a (very) stable release series.\r\n\r\nAlso, I'd rather like to avoid making 0.29.x diverge itself from the master branch, rather than only the other way round. That increases the risk of difficult to resolve merge conflicts and unnoticed merge accidents (such as: still works but generates dead/duplicate/useless code).",
            "created_at": "2020-09-09T19:03:46Z",
            "html_url": "https://github.com/cython/cython/issues/3822#issuecomment-689756444",
            "id": 689756444,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3822",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTc1NjQ0NA==",
            "performed_via_github_app": null,
            "updated_at": "2020-09-09T19:03:46Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/689756444",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "No worries, let's do it in master.\r\n\r\nHowever, I found that the code purposedly uses shadowed variables in the  __PYX_MARK_ERR_POS() macro. If this macro is expanded on a module level, it sets global variables `__pyx_filename` and `__pyx_lineno`. However, in a node level, it writes to local variables instead.\r\n\r\nThis was the first error in the test suite ran with CFLAGS=\"-Werror=shadow\", maybe there are more places where shadowing is used as a feature.\r\n\r\nI'll give up for now on this issue.",
            "created_at": "2020-09-09T19:14:13Z",
            "html_url": "https://github.com/cython/cython/issues/3822#issuecomment-689761692",
            "id": 689761692,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3822",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTc2MTY5Mg==",
            "performed_via_github_app": null,
            "updated_at": "2020-09-09T19:28:09Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/689761692",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/1099712?v=4",
                "events_url": "https://api.github.com/users/kalvdans/events{/privacy}",
                "followers_url": "https://api.github.com/users/kalvdans/followers",
                "following_url": "https://api.github.com/users/kalvdans/following{/other_user}",
                "gists_url": "https://api.github.com/users/kalvdans/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kalvdans",
                "id": 1099712,
                "login": "kalvdans",
                "node_id": "MDQ6VXNlcjEwOTk3MTI=",
                "organizations_url": "https://api.github.com/users/kalvdans/orgs",
                "received_events_url": "https://api.github.com/users/kalvdans/received_events",
                "repos_url": "https://api.github.com/users/kalvdans/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kalvdans/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kalvdans/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kalvdans"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> it sets global variables __pyx_filename and __pyx_lineno. However, in a node level, it writes to local variables instead.\r\n\r\nYes, local variables are the right thing to use here. I think we tried removing the global variables as part of the PEP-489 / module-local state changes. Probably still lingering in an unmerged PR somewhere, but I guess it could just be done independently.",
            "created_at": "2020-09-10T05:13:37Z",
            "html_url": "https://github.com/cython/cython/issues/3822#issuecomment-689987607",
            "id": 689987607,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3822",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTk4NzYwNw==",
            "performed_via_github_app": null,
            "updated_at": "2020-09-10T05:13:37Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/689987607",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "(In case it wasn't clear: PR welcome.)",
            "created_at": "2020-09-10T05:15:10Z",
            "html_url": "https://github.com/cython/cython/issues/3822#issuecomment-689988172",
            "id": 689988172,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3822",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTk4ODE3Mg==",
            "performed_via_github_app": null,
            "updated_at": "2020-09-10T05:15:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/689988172",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3822/comments",
    "created_at": "2020-09-09T16:14:24Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-09-10T05:16:00Z",
            "event": "labeled",
            "id": 3748996816,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM3NDg5OTY4MTY=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3748996816"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-09-10T05:16:00Z",
            "event": "labeled",
            "id": 3748996818,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDM3NDg5OTY4MTg=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/3748996818"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3822/events",
    "html_url": "https://github.com/cython/cython/issues/3822",
    "id": 696951489,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3822/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU2OTY5NTE0ODk=",
    "number": 3822,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[ENH] Avoid shadow variables",
    "updated_at": "2020-09-10T05:16:00Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3822",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/1099712?v=4",
        "events_url": "https://api.github.com/users/kalvdans/events{/privacy}",
        "followers_url": "https://api.github.com/users/kalvdans/followers",
        "following_url": "https://api.github.com/users/kalvdans/following{/other_user}",
        "gists_url": "https://api.github.com/users/kalvdans/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kalvdans",
        "id": 1099712,
        "login": "kalvdans",
        "node_id": "MDQ6VXNlcjEwOTk3MTI=",
        "organizations_url": "https://api.github.com/users/kalvdans/orgs",
        "received_events_url": "https://api.github.com/users/kalvdans/received_events",
        "repos_url": "https://api.github.com/users/kalvdans/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kalvdans/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kalvdans/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kalvdans"
    }
}