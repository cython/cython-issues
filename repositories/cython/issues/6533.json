{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nhttps://github.com/cython/cython/issues/6514#issuecomment-2496065962\r\n\r\nTake this example:\r\nhttps://cython.readthedocs.io/en/latest/src/userguide/sharing_declarations.html#sharing-c-functions\r\n\r\nWhen generating a spammery.cpp file using ``cython --embed -3 spammery.pyx`` and compile it using gcc/g++ depending on whether I'm using C++ or C, running the executable I get ModuleNotFoundError at runtime even if I've added ``sys.path.append('.')`` or ``sys.path.append('')`` to the spammery.pyx file.\r\n\r\nIn addition, when I add import sys etc, the errorline cython cites is \"import sys\" (or I recon any statement before cimport) as the cause of ModuleNotFoundError, given that there any statements prior, in either case there's a runtime error.\n\n### Code to reproduce the behaviour:\n\nvolume.pyx\r\n```cython\r\ncdef float cube(float x):\r\n  return x * x * x\r\n```\r\n\r\nvolume.pxd\r\n```cython\r\ncdef float cube(float x)\r\n```\r\n\r\nspammery.pyx\r\n```cython\r\nimport sys\r\nsys.path.append('.')\r\nsys.path.append('')\r\n\r\nfrom volume cimport cube\r\n\r\ndef menu(description, size):\r\n    print(description, \":\", cube(size),\r\n          \"cubic metres of spam\")\r\n\r\nmenu(\"Entree\", 1)\r\nmenu(\"Main course\", 3)\r\nmenu(\"Dessert\", 2)\r\n```\n\n### Expected behaviour\n\nNo compile or runtime errors.\n\n### OS\n\nDebian 12 (bookworm)\n\n### Python version\n\n3.11.2\n\n### Cython version\n\n3.1.0a1\n\n### Additional context\n\n_No response_",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I think that all cimports happen before anything else in the module, so will happen before your changes to `sys.path`. I don't think that's easy to change.\r\n\r\nWe should probably point to the right lines though when showing the error message.",
            "created_at": "2024-12-04T19:54:47Z",
            "html_url": "https://github.com/cython/cython/issues/6533#issuecomment-2518434700",
            "id": 2518434700,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6533",
            "node_id": "IC_kwDOABDGAc6WHEOM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2518434700/reactions"
            },
            "updated_at": "2024-12-04T19:55:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2518434700",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I think that all cimports happen before anything else in the module, so will happen before your changes to `sys.path`. I don't think that's easy to change.\r\n> \r\n> We should probably point to the right lines though when showing the error message.\r\n\r\nThanks for the response.\r\nSo is the behavior laid out in the design of Cython that it will by default allow import and cimport modules in sys.path default locations, but not in the current location?\r\nWhy is that, when Python by default will import not only anything in the current work directory but subdirectories etc if they have an ``__init__.py`` file and such?\r\n\r\nIs it out of a security concern that Python doesn't seem to share, and could be easily bypassed by an evil module/program copying another evil module into a sys.path directory at runtime before importing?\r\n\r\nIt seems like such a strange design choice to me and not in compliance with how Python operates?",
            "created_at": "2024-12-06T08:21:51Z",
            "html_url": "https://github.com/cython/cython/issues/6533#issuecomment-2522490294",
            "id": 2522490294,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6533",
            "node_id": "IC_kwDOABDGAc6WWiW2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2522490294/reactions"
            },
            "updated_at": "2024-12-06T08:22:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2522490294",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68166790?v=4",
                "events_url": "https://api.github.com/users/Source61/events{/privacy}",
                "followers_url": "https://api.github.com/users/Source61/followers",
                "following_url": "https://api.github.com/users/Source61/following{/other_user}",
                "gists_url": "https://api.github.com/users/Source61/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Source61",
                "id": 68166790,
                "login": "Source61",
                "node_id": "MDQ6VXNlcjY4MTY2Nzkw",
                "organizations_url": "https://api.github.com/users/Source61/orgs",
                "received_events_url": "https://api.github.com/users/Source61/received_events",
                "repos_url": "https://api.github.com/users/Source61/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Source61/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Source61/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Source61",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6533/comments",
    "created_at": "2024-12-04T11:08:33Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6533/events",
    "html_url": "https://github.com/cython/cython/issues/6533",
    "id": 2717373800,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6533/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6h99Vo",
    "number": 6533,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6533/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6533/timeline",
    "title": "[BUG] ModuleNotFoundError when cimporting from embedded cython program",
    "updated_at": "2024-12-06T08:22:30Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6533",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/68166790?v=4",
        "events_url": "https://api.github.com/users/Source61/events{/privacy}",
        "followers_url": "https://api.github.com/users/Source61/followers",
        "following_url": "https://api.github.com/users/Source61/following{/other_user}",
        "gists_url": "https://api.github.com/users/Source61/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Source61",
        "id": 68166790,
        "login": "Source61",
        "node_id": "MDQ6VXNlcjY4MTY2Nzkw",
        "organizations_url": "https://api.github.com/users/Source61/orgs",
        "received_events_url": "https://api.github.com/users/Source61/received_events",
        "repos_url": "https://api.github.com/users/Source61/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Source61/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Source61/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Source61",
        "user_view_type": "public"
    }
}