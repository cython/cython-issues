{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nSegmentation fault.\r\n\r\nReproducer: https://github.com/iphydf/toktok-stack/tree/cython-example/third_party/python/cython/bug\r\n\r\n```gdb\r\n#13 0.975 Program received signal SIGSEGV, Segmentation fault.\r\n#13 0.975 __pyx_f_10helloworld_3Foo_foo (__pyx_v_self=0x7f26fedf5bf0,\r\n#13 0.975     __pyx_v_bar=0x7f26ff332a20 <_Py_NoneStruct>) at helloworld.c:3217\r\n#13 0.975 3217\t  ((struct __pyx_vtabstruct_10helloworld_Bar *)__pyx_v_bar->__pyx_vtab)->bar(__pyx_v_bar); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)\r\n#13 0.975 #0  __pyx_f_10helloworld_3Foo_foo (__pyx_v_self=0x7f26fedf5bf0,\r\n#13 0.975     __pyx_v_bar=0x7f26ff332a20 <_Py_NoneStruct>) at helloworld.c:3217\r\n#13 2.274 #1  0x00007f26febde35b in __pyx_pf_10helloworld_3Foo___init__ (\r\n#13 2.274     __pyx_v_self=0x7f26fedf5bf0, __pyx_v_bar=0x7f26ff332a20 <_Py_NoneStruct>)\r\n#13 2.274     at helloworld.c:3354\r\n#13 2.274 #2  0x00007f26febde22b in __pyx_pw_10helloworld_3Foo_1__init__ (\r\n#13 2.274     __pyx_v_self=0x7f26fedf5bf0, __pyx_args=0x7f26ff348f38 <_PyRuntime+58904>,\r\n#13 2.274     __pyx_kwds=0x0) at helloworld.c:3318\r\n#13 2.274 #3  0x00007f26ff007133 in type_call (type=<optimized out>,\r\n#13 2.274     args=0x7f26ff348f38 <_PyRuntime+58904>, kwds=0x0)\r\n#13 2.274     at Objects/typeobject.c:1103\r\n#13 2.275 #4  0x00007f26febe677f in __Pyx_PyObject_Call (\r\n#13 2.275     func=0x7f26febf0380 <__pyx_type_10helloworld_Foo>,\r\n#13 2.275     arg=0x7f26ff348f38 <_PyRuntime+58904>, kw=0x0) at helloworld.c:6774\r\n#13 2.275 #5  0x00007f26febe69ee in __Pyx_PyObject_FastCallDict (\r\n#13 2.275     func=0x7f26febf0380 <__pyx_type_10helloworld_Foo>, args=0x7ffc7982bb28,\r\n#13 2.275     _nargs=9223372036854775808, kwargs=0x0) at helloworld.c:6872\r\n#13 2.275 #6  0x00007f26febe6c61 in __Pyx_PyObject_CallNoArg (\r\n#13 2.275     func=0x7f26febf0380 <__pyx_type_10helloworld_Foo>) at helloworld.c:7081\r\n#13 2.275 #7  0x00007f26febe48df in __pyx_pymod_exec_helloworld (\r\n#13 2.275     __pyx_pyinit_module=0x7f26fec244a0) at helloworld.c:5570\r\n#13 2.276 #8  0x00007f26ff09363f in PyModule_ExecDef (module=0x7f26fec244a0,\r\n#13 2.276     def=<optimized out>) at Objects/moduleobject.c:419\r\n#13 2.276 #9  0x00007f26ff099bc9 in _imp_exec_builtin_impl (mod=<optimized out>,\r\n#13 2.276     module=<optimized out>) at Python/import.c:2438\r\n#13 2.276 #10 _imp_exec_builtin (module=<optimized out>, mod=<optimized out>)\r\n#13 2.276     at Python/clinic/import.c.h:504\r\n#13 2.276 #11 0x00007f26ff021921 in cfunction_vectorcall_O (func=0x7f26fee66890,\r\n#13 2.276     args=0x7f26fede6ba8, nargsf=<optimized out>, kwnames=<optimized out>)\r\n#13 2.276     at ./Include/cpython/methodobject.h:52\r\n#13 2.277 #12 0x00007f26ff011eec in _PyEval_EvalFrameDefault (tstate=<optimized out>,\r\n#13 2.277     frame=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:5376\r\n#13 2.277 #13 0x00007f26ff00c2fa in _PyEval_EvalFrame (throwflag=0,\r\n#13 2.277     frame=0x7f26fed4d078, tstate=0x7f26ff3632d8 <_PyRuntime+166328>)\r\n#13 2.277     at ./Include/internal/pycore_ceval.h:73\r\n#13 2.277 #14 _PyEval_Vector (tstate=0x7f26ff3632d8 <_PyRuntime+166328>,\r\n#13 2.277     func=<optimized out>, locals=<optimized out>, args=<optimized out>,\r\n#13 2.277     argcount=<optimized out>, kwnames=<optimized out>) at Python/ceval.c:6434\r\n#13 2.278 #15 0x00007f26ff0220f4 in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=2,\r\n#13 2.278     args=0x7ffc7982be00, callable=0x7f26fee2bce0,\r\n#13 2.278     tstate=0x7f26ff3632d8 <_PyRuntime+166328>)\r\n#13 2.278     at ./Include/internal/pycore_call.h:92\r\n#13 2.278 #16 object_vacall (tstate=tstate@entry=0x7f26ff3632d8 <_PyRuntime+166328>,\r\n#13 2.278     base=base@entry=0x0, callable=0x7f26fee2bce0, vargs=<optimized out>)\r\n#13 2.278     at Objects/call.c:819\r\n#13 2.278 #17 0x00007f26ff042370 in PyObject_CallMethodObjArgs (obj=0x0,\r\n#13 2.278     name=<optimized out>) at Objects/call.c:878\r\n#13 2.278 #18 0x00007f26ff041d7e in import_find_and_load (abs_name=0x7f26fec0adb0,\r\n#13 2.278     tstate=0x7f26ff3632d8 <_PyRuntime+166328>) at Python/import.c:1748\r\n#13 2.279 #19 PyImport_ImportModuleLevelObject (name=0x7f26fec0adb0,\r\n#13 2.279     globals=<optimized out>, locals=<optimized out>,\r\n#13 2.279     fromlist=0x7f26ff332a20 <_Py_NoneStruct>, level=0) at Python/import.c:1847\r\n#13 2.279 #20 0x00007f26ff0139bb in import_name (level=0x7f26ff33ac68 <_PyRuntime+840>,\r\n#13 2.279     fromlist=0x7f26ff332a20 <_Py_NoneStruct>, name=0x7f26fec0adb0,\r\n#13 2.279     frame=0x7f26fed4d020, tstate=<optimized out>) at Python/ceval.c:7422\r\n#13 2.279 #21 _PyEval_EvalFrameDefault (tstate=<optimized out>, frame=<optimized out>,\r\n#13 2.279     throwflag=<optimized out>) at Python/ceval.c:3946\r\n#13 2.279 #22 0x00007f26ff00c2fa in _PyEval_EvalFrame (throwflag=0,\r\n#13 2.279     frame=0x7f26fed4d020, tstate=0x7f26ff3632d8 <_PyRuntime+166328>)\r\n#13 2.279     at ./Include/internal/pycore_ceval.h:73\r\n#13 2.280 #23 _PyEval_Vector (tstate=tstate@entry=0x7f26ff3632d8 <_PyRuntime+166328>,\r\n#13 2.280     func=func@entry=0x7f26feea5f80, locals=locals@entry=0x7f26feecdb40,\r\n#13 2.280     args=args@entry=0x0, argcount=argcount@entry=0, kwnames=kwnames@entry=0x0)\r\n#13 2.280     at Python/ceval.c:6434\r\n#13 2.280 #24 0x00007f26ff08e538 in PyEval_EvalCode (co=0x7f26feed1620,\r\n#13 2.280     globals=<optimized out>, locals=0x7f26feecdb40) at Python/ceval.c:1148\r\n#13 2.280 #25 0x00007f26ff0ac943 in run_eval_code_obj (\r\n#13 2.280     tstate=tstate@entry=0x7f26ff3632d8 <_PyRuntime+166328>,\r\n#13 2.280     co=co@entry=0x7f26feed1620, globals=globals@entry=0x7f26feecdb40,\r\n#13 2.280     locals=locals@entry=0x7f26feecdb40) at Python/pythonrun.c:1741\r\n#13 2.281 #26 0x00007f26ff0a8fba in run_mod (mod=mod@entry=0x7f26febf18e0,\r\n#13 2.281     filename=filename@entry=0x7f26feecddb0,\r\n#13 2.281     globals=globals@entry=0x7f26feecdb40, locals=locals@entry=0x7f26feecdb40,\r\n#13 2.281     flags=flags@entry=0x7ffc7982c3b8, arena=arena@entry=0x7f26fedf74d0)\r\n#13 2.281     at Python/pythonrun.c:1762\r\n#13 2.282 #27 0x00007f26ff0be5c3 in pyrun_file (fp=fp@entry=0x7f26fed66570,\r\n#13 2.282     filename=filename@entry=0x7f26feecddb0, start=start@entry=257,\r\n#13 2.282     globals=globals@entry=0x7f26feecdb40, locals=locals@entry=0x7f26feecdb40,\r\n#13 2.282     closeit=closeit@entry=1, flags=0x7ffc7982c3b8) at Python/pythonrun.c:1657\r\n#13 2.283 #28 0x00007f26ff0bdd37 in _PyRun_SimpleFileObject (fp=0x7f26fed66570,\r\n#13 2.283     filename=0x7f26feecddb0, closeit=1, flags=0x7ffc7982c3b8)\r\n#13 2.283     at Python/pythonrun.c:440\r\n#13 2.283 #29 0x00007f26ff0bd924 in _PyRun_AnyFileObject (fp=0x7f26fed66570,\r\n#13 2.283     filename=0x7f26feecddb0, closeit=1, flags=0x7ffc7982c3b8)\r\n#13 2.283     at Python/pythonrun.c:79\r\n#13 2.284 #30 0x00007f26ff0b8226 in pymain_run_file_obj (skip_source_first_line=0,\r\n#13 2.284     filename=0x7f26feecddb0, program_name=0x7f26feebba50) at Modules/main.c:360\r\n#13 2.284 #31 pymain_run_file (config=0x7f26ff349320 <_PyRuntime+59904>)\r\n#13 2.284     at Modules/main.c:379\r\n#13 2.284 #32 pymain_run_python (exitcode=0x7ffc7982c3b0) at Modules/main.c:601\r\n#13 2.284 #33 Py_RunMain () at Modules/main.c:680\r\n#13 2.284 #34 0x00007f26ff07ece7 in Py_BytesMain (argc=<optimized out>,\r\n#13 2.284     argv=<optimized out>) at Modules/main.c:734\r\n#13 2.285 #35 0x00007f26ff3c26d1 in libc_start_main_stage2 (main=0x561bb86d6180 <main>,\r\n#13 2.285     argc=2, argv=0x7ffc7982c538) at src/env/__libc_start_main.c:95\r\n#13 2.285 #36 0x0000561bb86d6046 in _start ()\r\n```\r\n\r\n### Code to reproduce the behaviour:\r\n\r\n```cython\r\n# cython: language_level=3, linetrace=True\r\nfrom typing import Optional\r\n\r\n\r\ncdef class Bar:\r\n\r\n    cdef int bar(self):\r\n        return 0\r\n\r\n\r\ncdef class Foo:\r\n\r\n    cdef foo(self, Bar bar):\r\n        bar.bar()\r\n\r\n    def __init__(self, bar: Optional[Bar] = None):\r\n        self.foo(bar)\r\n\r\n\r\nFoo()\r\n```\r\n\r\n\r\n### Expected behaviour\r\n\r\nI'd expect an error like: `AttributeError: 'NoneType' object has no attribute 'bar'`\r\n\r\nThis is what happens when `Bar.bar` is not a `cdef` but a regular `def`.\r\n\r\nOr perhaps it should do a type check and throw a type error if None isn't allowed there. Ideally at compile time, but if not, then at runtime.\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Python version\r\n\r\n3.11\r\n\r\n### Cython version\r\n\r\n53ff506512377e70602b617adcc69940d3f7b4b9\r\n\r\n### Additional context\r\n\r\n_No response_",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6023/comments",
    "created_at": "2024-02-22T16:17:45Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6023/events",
    "html_url": "https://github.com/cython/cython/issues/6023",
    "id": 2149436215,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6023/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6AHcs3",
    "number": 6023,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6023/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6023/timeline",
    "title": "[BUG] Segfault when passing None to `cdef` method.",
    "updated_at": "2024-02-22T16:24:14Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6023",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
        "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
        "followers_url": "https://api.github.com/users/iphydf/followers",
        "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
        "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/iphydf",
        "id": 10647936,
        "login": "iphydf",
        "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
        "organizations_url": "https://api.github.com/users/iphydf/orgs",
        "received_events_url": "https://api.github.com/users/iphydf/received_events",
        "repos_url": "https://api.github.com/users/iphydf/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/iphydf"
    }
}