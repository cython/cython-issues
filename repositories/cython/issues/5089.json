{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I'm filing this as we discovered that C files generated with older versions of cython can generate code which accesses internal cpython APIs which were changed/removed in python 3.10, which leads me to conclude that distributing generated cython code in source distributions is unsafe.\r\n\r\nThe [documentation](https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#distributing-cython-modules) currently recommends distributing generated source code so that one does not require cython at build/install time:\r\n\r\n> It is strongly recommended that you distribute the generated .c files as well as your Cython sources, so that users can install your module without needing to have Cython available.\r\n\r\nThis should be amended and reversed, and it would be really great if the examples clearly expressed how to ensure that possibly incompatible C files don't mistakenly end up in source distributions.\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "\r\nInvestigating further, it appears that I am mistaken.\r\n\r\nThe issue we ran into in particular was with `_PyGen_Send` missing in 3.10, which is handled by cython in: https://github.com/cython/cython/commit/782a87336d88496b022bf0f2791c818221f4743a\r\n\r\nIf I'm reading this correctly, then the generated code should support `cpython <= 3.10` after this fix.\r\n\r\nWere we to follow the upstream intentions (as I think I understand them now), then we would have bumped a minimal bound dependency on Cython when adding support for python 3.10, so that code generated for `cpython <= 3.10` would work.\r\n\r\nDo I understand correctly that the generated code should still support all versions of cpython leading up to the version which a given version of cython supports ?\r\n",
            "created_at": "2022-10-18T06:02:44Z",
            "html_url": "https://github.com/cython/cython/issues/5089#issuecomment-1281854434",
            "id": 1281854434,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5089",
            "node_id": "IC_kwDOABDGAc5MZ4vi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1281854434/reactions"
            },
            "updated_at": "2022-10-18T06:02:44Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1281854434",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1928351?v=4",
                "events_url": "https://api.github.com/users/gtristan/events{/privacy}",
                "followers_url": "https://api.github.com/users/gtristan/followers",
                "following_url": "https://api.github.com/users/gtristan/following{/other_user}",
                "gists_url": "https://api.github.com/users/gtristan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gtristan",
                "id": 1928351,
                "login": "gtristan",
                "node_id": "MDQ6VXNlcjE5MjgzNTE=",
                "organizations_url": "https://api.github.com/users/gtristan/orgs",
                "received_events_url": "https://api.github.com/users/gtristan/received_events",
                "repos_url": "https://api.github.com/users/gtristan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gtristan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gtristan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gtristan"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> If I'm reading this correctly, then the generated code should support cpython <= 3.10 after this fix.\r\n\r\n> Do I understand correctly that the generated code should still support all versions of cpython leading up to the version which a given version of cython supports ?\r\n\r\nYes (within limits... current releases of Cython supports back to CPython 2.7 and ~3.4... I'm not sure of the exact numbers off the top of my head, but it isn't completely unlimited)\r\n\r\n---------------\r\n\r\nW.r.t. the advice in the documentation: there's pros and cons. The main benefit of shipping the .c files is that you don't force your users to depend on Cython (however I think it's now possible to use Cython only as an install-time dependency so that's less onorous than it was).\r\n\r\nThe main problem with shipping the .c files is that they aren't guaranteed forwards compatible and CPython is modifying the c-API fairly frequently these days. It may still be a good idea for projects that are actively maintained and have someone who can regenerate the .c files if needed for a new Python release to ship them.\r\n\r\nBasically it's less clear what the best advice is any more so an update to the documentation is welcome.",
            "created_at": "2022-10-18T06:47:30Z",
            "html_url": "https://github.com/cython/cython/issues/5089#issuecomment-1281890878",
            "id": 1281890878,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5089",
            "node_id": "IC_kwDOABDGAc5MaBo-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1281890878/reactions"
            },
            "updated_at": "2022-10-18T06:49:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1281890878",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> The main problem with shipping the .c files is that they aren't guaranteed forwards compatible and CPython is modifying the c-API fairly frequently these days.\r\n\r\nI presume this is a problem because Cython generated code will access internal APIs, and upstream CPython can freely change these internals in a stable release cycle (e.g. internals can change from 3.10.x -> 3.10.y), because there is no promise of stability for these APIs.\r\n\r\nMakes sense...",
            "created_at": "2022-10-18T07:01:42Z",
            "html_url": "https://github.com/cython/cython/issues/5089#issuecomment-1281903060",
            "id": 1281903060,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5089",
            "node_id": "IC_kwDOABDGAc5MaEnU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1281903060/reactions"
            },
            "updated_at": "2022-10-18T07:01:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1281903060",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1928351?v=4",
                "events_url": "https://api.github.com/users/gtristan/events{/privacy}",
                "followers_url": "https://api.github.com/users/gtristan/followers",
                "following_url": "https://api.github.com/users/gtristan/following{/other_user}",
                "gists_url": "https://api.github.com/users/gtristan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gtristan",
                "id": 1928351,
                "login": "gtristan",
                "node_id": "MDQ6VXNlcjE5MjgzNTE=",
                "organizations_url": "https://api.github.com/users/gtristan/orgs",
                "received_events_url": "https://api.github.com/users/gtristan/received_events",
                "repos_url": "https://api.github.com/users/gtristan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gtristan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gtristan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gtristan"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes, although most of the breakages tend to be at major releases though (e.g. 3.10 - 3.11) - it's fairly rare to need to update Cython for a stable release change",
            "created_at": "2022-10-18T07:11:06Z",
            "html_url": "https://github.com/cython/cython/issues/5089#issuecomment-1281913443",
            "id": 1281913443,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5089",
            "node_id": "IC_kwDOABDGAc5MaHJj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1281913443/reactions"
            },
            "updated_at": "2022-10-18T07:11:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1281913443",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "> W.r.t. the advice in the documentation: there's pros and cons. The main benefit of shipping the .c files is that you don't force your users to depend on Cython (however I think it's now possible to use Cython only as an install-time dependency so that's less onorous than it was).\r\n\r\nJust to update, I've encoded `Cython>=0.29.25` as a build-system dependency in `pyproject.toml` and have observed that:\r\n* `pip install .` will automatically install these dependencies into a `/tmp` directory\r\n* `pip install <source tarball>` will also do this\r\n* `pip install --no-index <source tarball>` will bail out if the dependency on cython is not met on the host\r\n\r\nThe only way I can envision the distributed generated files being used, is if cython is not available on the host, and `setup.py` is invoked directly.\r\n",
            "created_at": "2022-10-18T07:36:05Z",
            "html_url": "https://github.com/cython/cython/issues/5089#issuecomment-1281939908",
            "id": 1281939908,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5089",
            "node_id": "IC_kwDOABDGAc5MaNnE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1281939908/reactions"
            },
            "updated_at": "2022-10-18T07:36:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1281939908",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1928351?v=4",
                "events_url": "https://api.github.com/users/gtristan/events{/privacy}",
                "followers_url": "https://api.github.com/users/gtristan/followers",
                "following_url": "https://api.github.com/users/gtristan/following{/other_user}",
                "gists_url": "https://api.github.com/users/gtristan/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gtristan",
                "id": 1928351,
                "login": "gtristan",
                "node_id": "MDQ6VXNlcjE5MjgzNTE=",
                "organizations_url": "https://api.github.com/users/gtristan/orgs",
                "received_events_url": "https://api.github.com/users/gtristan/received_events",
                "repos_url": "https://api.github.com/users/gtristan/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gtristan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gtristan/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gtristan"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "At this point I think it makes more sense to clearly enumerate the pros and cons than make a strong recommendation. ",
            "created_at": "2022-10-18T15:55:08Z",
            "html_url": "https://github.com/cython/cython/issues/5089#issuecomment-1282623482",
            "id": 1282623482,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5089",
            "node_id": "IC_kwDOABDGAc5Mc0f6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1282623482/reactions"
            },
            "updated_at": "2022-10-18T15:55:08Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1282623482",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "node_id": "MDQ6VXNlcjQ4NjAxNw==",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5089/comments",
    "created_at": "2022-10-18T05:37:34Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-10-18T07:37:08Z",
            "event": "labeled",
            "id": 7608673552,
            "label": {
                "color": "444444",
                "name": "Documentation"
            },
            "node_id": "LE_lADOABDGAc5UMpnEzwAAAAHFgyUQ",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/7608673552"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5089/events",
    "html_url": "https://github.com/cython/cython/issues/5089",
    "id": 1412602308,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425561345,
            "name": "Documentation",
            "node_id": "MDU6TGFiZWw0MjU1NjEzNDU=",
            "url": "https://api.github.com/repos/cython/cython/labels/Documentation"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5089/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5UMpnE",
    "number": 5089,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5089/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5089/timeline",
    "title": "Don't recomment distributing generated code in source distributions",
    "updated_at": "2022-10-18T15:55:08Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5089",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1928351?v=4",
        "events_url": "https://api.github.com/users/gtristan/events{/privacy}",
        "followers_url": "https://api.github.com/users/gtristan/followers",
        "following_url": "https://api.github.com/users/gtristan/following{/other_user}",
        "gists_url": "https://api.github.com/users/gtristan/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gtristan",
        "id": 1928351,
        "login": "gtristan",
        "node_id": "MDQ6VXNlcjE5MjgzNTE=",
        "organizations_url": "https://api.github.com/users/gtristan/orgs",
        "received_events_url": "https://api.github.com/users/gtristan/received_events",
        "repos_url": "https://api.github.com/users/gtristan/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gtristan/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gtristan/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gtristan"
    }
}