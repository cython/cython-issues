{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\nI'm getting exactly the same problem as the others in this thread (#2950). Not exactly sure what's up.\r\n\r\nThis bug only occurs when I try to build my project completely using `python -m build` without having built the project beforehand. Building the project with `python setup.py build_ext --inplace` before running `python -m build` seems to fix the problem.\r\n\r\nAny ideas on what's up?\r\n\r\n**To Reproduce**\r\nCode to reproduce the behaviour:\r\nexplained above.\r\n\r\n**Expected behavior**\r\nI expect the build to succeed\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Windows\r\n - Python version: 3.10.5\r\n - Cython version: 3.0.0a10\r\n\r\n**Additional context**\r\nHere is the project code:\r\nhttps://github.com/rubatopy/rubato/tree/cython\r\nHere are the relevant stacktraces\r\n![image](https://user-images.githubusercontent.com/35586618/181880350-ca09ccfb-4eeb-4bbe-8dbf-9cd270f10068.png)\r\n![image](https://user-images.githubusercontent.com/35586618/181880370-437a1387-d952-4a6a-b051-9eb398c54476.png)\r\n\r\n",
    "closed_at": "2022-07-31T02:04:35Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Can you double-check the version of Cython you're using. It works for me on 3.0.0a10 (as I'd expect). It doesn't work on any of the 0.29.x releases (but I wouldn't expect it to)",
            "created_at": "2022-07-30T07:45:17Z",
            "html_url": "https://github.com/cython/cython/issues/4937#issuecomment-1200110844",
            "id": 1200110844,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4937",
            "node_id": "IC_kwDOABDGAc5HiDz8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1200110844/reactions"
            },
            "updated_at": "2022-07-30T07:45:17Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1200110844",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Yes I'm using 3.0.0a10 (just double checked). Does it work for you when doing `pip install -e .` ?",
            "created_at": "2022-07-30T08:20:15Z",
            "html_url": "https://github.com/cython/cython/issues/4937#issuecomment-1200115485",
            "id": 1200115485,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4937",
            "node_id": "IC_kwDOABDGAc5HiE8d",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1200115485/reactions"
            },
            "updated_at": "2022-07-30T08:20:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1200115485",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35586618?v=4",
                "events_url": "https://api.github.com/users/tinmarr/events{/privacy}",
                "followers_url": "https://api.github.com/users/tinmarr/followers",
                "following_url": "https://api.github.com/users/tinmarr/following{/other_user}",
                "gists_url": "https://api.github.com/users/tinmarr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tinmarr",
                "id": 35586618,
                "login": "tinmarr",
                "node_id": "MDQ6VXNlcjM1NTg2NjE4",
                "organizations_url": "https://api.github.com/users/tinmarr/orgs",
                "received_events_url": "https://api.github.com/users/tinmarr/received_events",
                "repos_url": "https://api.github.com/users/tinmarr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tinmarr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tinmarr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tinmarr"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "So by \"it works for me\" what I mean is \"a small file containing `from __future__ import annotations` works for me when I compile it with `cython` from the command line\". I definitely haven't tried building that full project. Sorry - I skim read it an missed the bit about `build` vs `build_ext` which is probably the core of the issue.\r\n\r\nI suspect that some combination of distutils/setuptools/pip is running it was a different version of Cython than you think. But I don't personally know why that'd be, why `build_ext` is different from `build`, or how to fix it.",
            "created_at": "2022-07-30T08:31:47Z",
            "html_url": "https://github.com/cython/cython/issues/4937#issuecomment-1200116890",
            "id": 1200116890,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4937",
            "node_id": "IC_kwDOABDGAc5HiFSa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1200116890/reactions"
            },
            "updated_at": "2022-07-30T08:31:47Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1200116890",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Ok I figured it out. You were on the right track.\r\n\r\nIn the pyproject.toml file under the build-system requirements you need to specify the Cython version like so\r\n\r\n```toml\r\n[build-system]\r\nrequires = [\"setuptools ~= 63.2\", \"wheel ~= 0.37\", \"Cython ~= 3.0.0a10\"]\r\nbuild-backend = \"setuptools.build_meta\"\r\n```",
            "created_at": "2022-07-31T02:04:34Z",
            "html_url": "https://github.com/cython/cython/issues/4937#issuecomment-1200330677",
            "id": 1200330677,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4937",
            "node_id": "IC_kwDOABDGAc5Hi5e1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1200330677/reactions"
            },
            "updated_at": "2022-07-31T02:04:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1200330677",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35586618?v=4",
                "events_url": "https://api.github.com/users/tinmarr/events{/privacy}",
                "followers_url": "https://api.github.com/users/tinmarr/followers",
                "following_url": "https://api.github.com/users/tinmarr/following{/other_user}",
                "gists_url": "https://api.github.com/users/tinmarr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tinmarr",
                "id": 35586618,
                "login": "tinmarr",
                "node_id": "MDQ6VXNlcjM1NTg2NjE4",
                "organizations_url": "https://api.github.com/users/tinmarr/orgs",
                "received_events_url": "https://api.github.com/users/tinmarr/received_events",
                "repos_url": "https://api.github.com/users/tinmarr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tinmarr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tinmarr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tinmarr"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4937/comments",
    "created_at": "2022-07-30T07:41:17Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35586618?v=4",
                "events_url": "https://api.github.com/users/tinmarr/events{/privacy}",
                "followers_url": "https://api.github.com/users/tinmarr/followers",
                "following_url": "https://api.github.com/users/tinmarr/following{/other_user}",
                "gists_url": "https://api.github.com/users/tinmarr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tinmarr",
                "id": 35586618,
                "login": "tinmarr",
                "node_id": "MDQ6VXNlcjM1NTg2NjE4",
                "organizations_url": "https://api.github.com/users/tinmarr/orgs",
                "received_events_url": "https://api.github.com/users/tinmarr/received_events",
                "repos_url": "https://api.github.com/users/tinmarr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tinmarr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tinmarr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tinmarr"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2022-07-31T02:04:35Z",
            "event": "closed",
            "id": 7095750427,
            "node_id": "CE_lADOABDGAc5O2kYDzwAAAAGm8I8b",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/7095750427"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4937/events",
    "html_url": "https://github.com/cython/cython/issues/4937",
    "id": 1322927619,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4937/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5O2kYD",
    "number": 4937,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/4937/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4937/timeline",
    "title": "[BUG] future feature annotations is not defined",
    "updated_at": "2022-07-31T02:04:35Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4937",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35586618?v=4",
        "events_url": "https://api.github.com/users/tinmarr/events{/privacy}",
        "followers_url": "https://api.github.com/users/tinmarr/followers",
        "following_url": "https://api.github.com/users/tinmarr/following{/other_user}",
        "gists_url": "https://api.github.com/users/tinmarr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tinmarr",
        "id": 35586618,
        "login": "tinmarr",
        "node_id": "MDQ6VXNlcjM1NTg2NjE4",
        "organizations_url": "https://api.github.com/users/tinmarr/orgs",
        "received_events_url": "https://api.github.com/users/tinmarr/received_events",
        "repos_url": "https://api.github.com/users/tinmarr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tinmarr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tinmarr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tinmarr"
    }
}