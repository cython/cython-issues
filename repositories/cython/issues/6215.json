{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Describe your issue\n\nIf we're aiming for \"refcounting needs to be thread-safe in free-threading mode\" then I think we also need to apply it to typed memoryviews.\r\n\r\nThe internal `cdef class memoryview` type should be threadsafe (because it already is...), however the C struct that's used to represent local variables isn't:\r\n\r\n\r\n```\r\ntypedef struct {\r\n  struct {{memview_struct_name}} *memview;\r\n  char *data;\r\n  Py_ssize_t shape[{{max_dims}}];\r\n  Py_ssize_t strides[{{max_dims}}];\r\n  Py_ssize_t suboffsets[{{max_dims}}];\r\n} {{memviewslice_name}};\r\n```\r\n\r\nDirectly assigning to that would normally be protected by the GIL, however we can no longer rely on that. The struct is also too big to handle with atomic operations. Therefore I think the struct needs a `Py_mutex` adding to it in free-threading mode to lock it. Notes:\r\n\r\n1. This only needs to be used where it may already be assigned, and where multiple threads may be interacting with it.\r\n2. We need to avoid copying the `Py_mutex` itself when copying the struct - the mutex state shouldn't be copied.",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6215/comments",
    "created_at": "2024-05-26T17:38:12Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-05-26T17:38:12Z",
            "event": "labeled",
            "id": 12937570261,
            "label": {
                "color": "A37CC3",
                "name": "nogil CPython"
            },
            "node_id": "LE_lADOABDGAc6KJ7-ZzwAAAAMDI6fV",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/12937570261"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6215/events",
    "html_url": "https://github.com/cython/cython/issues/6215",
    "id": 2317860761,
    "labels": [
        {
            "color": "A37CC3",
            "default": false,
            "description": "",
            "id": 6871764375,
            "name": "nogil CPython",
            "node_id": "LA_kwDOABDGAc8AAAABmZbNlw",
            "url": "https://api.github.com/repos/cython/cython/labels/nogil%20CPython"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6215/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6KJ7-Z",
    "number": 6215,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6215/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6215/timeline",
    "title": "Lock memoryviewslice struct in free-threading mode",
    "updated_at": "2024-05-29T07:41:40Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6215",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
        "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
        "followers_url": "https://api.github.com/users/da-woods/followers",
        "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
        "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/da-woods",
        "id": 10536947,
        "login": "da-woods",
        "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
        "organizations_url": "https://api.github.com/users/da-woods/orgs",
        "received_events_url": "https://api.github.com/users/da-woods/received_events",
        "repos_url": "https://api.github.com/users/da-woods/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/da-woods"
    }
}