{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nIn the top of one file, I have an import and then I define a typed variable `cdef set variable`. Cythonizing this for C++ just generates the call `__Pyx_RaiseUnexpectedTypeError(\"set\", o)` without ever defining this `__Pyx_RaiseUnexpectedTypeError`. So the build fails\r\n\r\n```\r\nninja: Entering directory `D:/py4godot_cython/build/windows64'\r\n[0/1] Regenerating build files.\r\nThe Meson build system\r\nVersion: 1.5.1\r\nSource dir: D:\\py4godot_cython\r\nBuild dir: D:\\py4godot_cython\\build\\windows64\r\nBuild type: cross build\r\nProject name: py4godot\r\nProject version: undefined\r\nC++ compiler for the host machine: cl (msvc 19.40.33811 \"Microsoft (R) C/C++-Optimierungscompiler Version 19.40.33811 f�r x64\")\r\nC++ linker for the host machine: link link 14.40.33811.0\r\nC++ compiler for the build machine: cl (msvc 19.40.33811 \"Microsoft (R) C/C++-Optimierungscompiler Version 19.40.33811 f�r x64\")\r\nC++ linker for the build machine: link link 14.40.33811.0\r\nBuild machine cpu family: x86_64\r\nBuild machine cpu: x86_64\r\nHost machine cpu family: x86_64\r\nHost machine cpu: x86_64\r\nTarget machine cpu family: x86_64\r\nTarget machine cpu: x86_64\r\nMessage: system:windows\r\nMessage: cpu_familiy:x86_64\r\nMessage: platform:64\r\nMessage: machine:windows\r\nMessage: msvc\r\nMessage: D:\\py4godot_cython\r\nProgram python3 found: YES (D:/py4godot_cython/python_files/cpython-3.12.4-windows64/python/install/python.exe)\r\nWARNING: You should add the boolean check kwarg to the run_command call.\r\n         It currently defaults to false,\r\n         but it will default to true in future releases of meson.\r\n         See also: https://github.com/mesonbuild/meson/issues/9300\r\nProgram godot found: YES\r\nBuild targets in project: 953\r\n\r\npy4godot undefined\r\n\r\n  User defined options\r\n    Cross files: D:\\py4godot_cython\\platforms\\windows64.cross\r\n                 D:\\py4godot_cython\\platforms\\compilers\\msvc_compiler.native\r\n                 D:\\py4godot_cython\\platforms\\binary_dirs\\python_ver_compile.cross\r\n    buildtype  : release\r\n\r\nFound ninja-1.10.2.git.kitware.jobserver-1 at D:\\py4godot_cython\\myenv\\Scripts\\ninja.EXE\r\nCleaning... 0 files.                                                                                                                                                               \r\n[1/2] Compiling C++ object py4godot#test_file.dll.p/py4godot_test_file.cpp.obj\r\nFAILED: py4godot#test_file.dll.p/py4godot_test_file.cpp.obj\r\n\"cl\" \"-Ipy4godot#test_file.dll.p\" \"-I.\" \"-I..\\..\" \"-I..\\..\\py4godot\\gdextension-api\" \"-I..\\..\\py4godot\\core\" \"-I..\\..\\py4godot\\enums\" \"-I..\\..\\py4godot\\classes\" \"-I..\\..\\py4godot\\p\r\nluginscript_api\" \"-I..\\..\\py4godot\\godot_bindings\" \"-I..\\..\\py4godot\\script_instance\" \"-I..\\..\\py4godot\\core\\variant4\" \"-I..\\..\\py4godot\\cppcore\" \"-I..\\..\\py4godot\\cppenums\" \"-I..\\\r\n..\\py4godot\\cppclasses\" \"-I..\\..\\py4godot\\cpputils\" \"-I..\\..\\py4godot\\script_language\" \"-I..\\..\\py4godot\\pluginscript_api\\utils\" \"-ID:\\py4godot_cython\\python_files\\cpython-3.12.4-w\r\nindows64\\python\\install\\Include\" \"/MD\" \"/nologo\" \"/showIncludes\" \"/utf-8\" \"/Zc:__cplusplus\" \"/W2\" \"/EHsc\" \"/O2\" \"/Gw\" \"/bigobj\" \"-d2SSAOptimizer-\" \"/DEBUG:FULL\" \"/Z7\" \"/DLIBRARY_EXPORTS=1\" \"/Fdpy4godot#test_file.dll.p\\py4godot_test_file.cpp.pdb\" /Fopy4godot#test_file.dll.p/py4godot_test_file.cpp.obj \"/c\" ../../py4godot/test_file.cpp\r\n../../py4godot/test_file.cpp(1969): error C3861: \"__Pyx_RaiseUnexpectedTypeError\": Bezeichner wurde nicht gefunden.\r\nninja: build stopped: subcommand failed.\r\n```\r\n\r\n### Code to reproduce the behaviour:\r\n\r\ntest_function.pyx\r\n```cython\r\n# This can be empty. It doesn't really matter if anything is inside here\r\n```\r\ntest_file.pyx\r\n\r\n```cython\r\n# distutils: language=c++\r\nfrom py4godot.test_function import *\r\n\r\ncdef set to_delete = {type(1), type(1.), type(True)}\r\n```\r\n\r\nChanging the cdef set to just cdef fixes the build error.\r\n\r\n\r\n### Expected behaviour\r\n\r\nUsing cdef set after the import should generate valid code.\r\n\r\n### OS\r\n\r\nWindows 11\r\n\r\n### Python version\r\n\r\n3.11.4\r\n\r\n### Cython version\r\n\r\n3.0.10\r\n\r\n### Additional context\r\n\r\n_No response_",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "It looks like it isn't including the right utility code. When you do `from py4godot.test_function import *` it does a check that if you import `to_delete` then it must be a `set`. But doesn't include everything needed for this check",
            "created_at": "2024-08-04T10:38:35Z",
            "html_url": "https://github.com/cython/cython/issues/6320#issuecomment-2267494902",
            "id": 2267494902,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6320",
            "node_id": "IC_kwDOABDGAc6HJzn2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2267494902/reactions"
            },
            "updated_at": "2024-08-04T10:38:35Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2267494902",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6320/comments",
    "created_at": "2024-08-03T13:12:13Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-08-04T10:37:16Z",
            "event": "labeled",
            "id": 13754776128,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "LE_lADOABDGAc6R0E_7zwAAAAMz2TpA",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13754776128"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-08-04T10:37:16Z",
            "event": "labeled",
            "id": 13754776130,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "LE_lADOABDGAc6R0E_7zwAAAAMz2TpC",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/13754776130"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2024-08-04T16:22:20Z",
            "event": "renamed",
            "id": 13755491945,
            "node_id": "RTE_lADOABDGAc6R0E_7zwAAAAMz5CZp",
            "performed_via_github_app": null,
            "rename": {
                "from": "Undefined __Pyx_RaiseUnexpectedTypeError being called when using cdef [type] after import[BUG] ",
                "to": "[BUG] Undefined __Pyx_RaiseUnexpectedTypeError being called when using cdef [type] after import"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/13755491945"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6320/events",
    "html_url": "https://github.com/cython/cython/issues/6320",
    "id": 2446348283,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6320/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc6R0E_7",
    "number": 6320,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6320/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6320/timeline",
    "title": "[BUG] Undefined __Pyx_RaiseUnexpectedTypeError being called when using cdef [type] after import",
    "updated_at": "2024-08-04T16:22:20Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6320",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/40867286?v=4",
        "events_url": "https://api.github.com/users/niklas2902/events{/privacy}",
        "followers_url": "https://api.github.com/users/niklas2902/followers",
        "following_url": "https://api.github.com/users/niklas2902/following{/other_user}",
        "gists_url": "https://api.github.com/users/niklas2902/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/niklas2902",
        "id": 40867286,
        "login": "niklas2902",
        "node_id": "MDQ6VXNlcjQwODY3Mjg2",
        "organizations_url": "https://api.github.com/users/niklas2902/orgs",
        "received_events_url": "https://api.github.com/users/niklas2902/received_events",
        "repos_url": "https://api.github.com/users/niklas2902/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/niklas2902/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/niklas2902/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/niklas2902"
    }
}