{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!--\r\n**Note:**\r\n- Do not use the bug and feature tracker for support requests. Use the `cython-users` mailing list instead.\r\n- Did you search for similar issues already? Please do, it helps to save us precious time that we otherwise could not invest into development.\r\n- Did you try the latest master branch or pre-release? It might already have what you want to report. Also see the [Changelog](https://github.com/cython/cython/blob/master/CHANGES.rst) regarding recent changes.\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n            v13 = US0_1()\r\n        else:\r\n            v13 = US0_0()\r\n        v4[v5] = v13\r\n        method1(v0, v1, v2, v3, v4, v7)\r\ncdef void method0(unsigned long long v0, unsigned long long v1, unsigned long long v2, ((US0 [::1]) [::1]) v3, unsigned long long v4):\r\n                                                                                                    ^       \r\n------------------------------------------------------------\r\n\r\ncython_experiments\\test3\\testm.pyx:53:101: Invalid base type for memoryview slice: US0[::1]\r\n```\r\n\r\nThe error message says it all. I assumed that since the [array feature request](https://github.com/cython/cython/issues/3991) was closed that memory views would be fully composable with other types, but now the compiler is telling me that this is not the case. I am not sure whether this issue should be a feature request or a bug report.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nGoing back to the previous method of compiling non-primitives as objects.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "At any rate, I am going to uncheck arrays that support tuples and redirect them to this. If memory views do not allow nesting of other memory views, they won't be able to do that in a tuple either even if the tuple allows regular objects.",
            "created_at": "2021-02-02T16:39:28Z",
            "html_url": "https://github.com/cython/cython/issues/3995#issuecomment-771772103",
            "id": 771772103,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3995",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc3MTc3MjEwMw==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-02T16:39:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/771772103",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
                "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrakgr/followers",
                "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrakgr",
                "id": 6266635,
                "login": "mrakgr",
                "node_id": "MDQ6VXNlcjYyNjY2MzU=",
                "organizations_url": "https://api.github.com/users/mrakgr/orgs",
                "received_events_url": "https://api.github.com/users/mrakgr/received_events",
                "repos_url": "https://api.github.com/users/mrakgr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrakgr"
            }
        },
        {
            "author_association": "NONE",
            "body": "Actually, what I wrote in the last post is not strictly true. In the future, in stack tuple arrays, I could just codegen the nested views as objects. The Spiral compiler knows what their actual type is and will cast them. The generated code will have `object` where it could have more concrete types, but that is not a huge issue.\r\n\r\nThe real problem with this kind of insufficiency in Cython's type system is that it presents me with a dilemma of whether I want to do checked runtime casting or unsafe one. Since I am not explicitly doing unsafe casting, the compiler does the smart thing and defaults to checked casting.\r\n\r\nI feel this is right, but it will have a performance impact. I can't ignore that other people might call Cython code from the outside with invalid arguments. I can't make the decision to remove safe casts lightly.\r\n\r\nUltimately, for me to accept the array request as being fulfilled, the type of its element cannot have any restrictions.",
            "created_at": "2021-02-03T08:55:00Z",
            "html_url": "https://github.com/cython/cython/issues/3995#issuecomment-772344314",
            "id": 772344314,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3995",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc3MjM0NDMxNA==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-03T08:55:00Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/772344314",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
                "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrakgr/followers",
                "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrakgr",
                "id": 6266635,
                "login": "mrakgr",
                "node_id": "MDQ6VXNlcjYyNjY2MzU=",
                "organizations_url": "https://api.github.com/users/mrakgr/orgs",
                "received_events_url": "https://api.github.com/users/mrakgr/received_events",
                "repos_url": "https://api.github.com/users/mrakgr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrakgr"
            }
        },
        {
            "author_association": "NONE",
            "body": "Also, is it possible to actually create these memory views from regular Python? When I tried assigning a freshly made `cython.view.array` to an object variable I got an error. I tried `import cython` just now in regular Python code, but `cython.view.array` does not exist in it.\r\n\r\nI will to add this to my list of requests. The primitive array should be a regular object on the Python side and not a special Cython feature.",
            "created_at": "2021-02-03T09:02:07Z",
            "html_url": "https://github.com/cython/cython/issues/3995#issuecomment-772348591",
            "id": 772348591,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3995",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc3MjM0ODU5MQ==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-03T09:02:07Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/772348591",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
                "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrakgr/followers",
                "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrakgr",
                "id": 6266635,
                "login": "mrakgr",
                "node_id": "MDQ6VXNlcjYyNjY2MzU=",
                "organizations_url": "https://api.github.com/users/mrakgr/orgs",
                "received_events_url": "https://api.github.com/users/mrakgr/received_events",
                "repos_url": "https://api.github.com/users/mrakgr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrakgr"
            }
        },
        {
            "author_association": "NONE",
            "body": "I recall seeing in a talk yesterday how a C++ vector would get converted automatically to a Python list when returned from a Cython function. Would it be acceptable if this turned out to be the behavior with memory views? It might. I'll stick with Numpy arrays for the time being though.",
            "created_at": "2021-02-03T09:07:39Z",
            "html_url": "https://github.com/cython/cython/issues/3995#issuecomment-772352180",
            "id": 772352180,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3995",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc3MjM1MjE4MA==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-03T09:07:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/772352180",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
                "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrakgr/followers",
                "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrakgr",
                "id": 6266635,
                "login": "mrakgr",
                "node_id": "MDQ6VXNlcjYyNjY2MzU=",
                "organizations_url": "https://api.github.com/users/mrakgr/orgs",
                "received_events_url": "https://api.github.com/users/mrakgr/received_events",
                "repos_url": "https://api.github.com/users/mrakgr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrakgr"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Usually, memory views that contain other memory views can be implemented by adding another dimension to them.\r\n\r\nThe case where this won't work is if the memory views that you want to store have different sizes. Not sure if there are all that many use cases for that.",
            "created_at": "2021-02-05T09:17:07Z",
            "html_url": "https://github.com/cython/cython/issues/3995#issuecomment-773904128",
            "id": 773904128,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3995",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc3MzkwNDEyOA==",
            "performed_via_github_app": null,
            "updated_at": "2021-02-05T09:17:07Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/773904128",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3995/comments",
    "created_at": "2021-02-02T16:20:20Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-02-05T09:08:48Z",
            "event": "renamed",
            "id": 4295066709,
            "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDI5NTA2NjcwOQ==",
            "performed_via_github_app": null,
            "rename": {
                "from": "[ENH] Nested memory views",
                "to": "[ENH] Memory views with a memory view as item type"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/4295066709"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-02-05T09:09:33Z",
            "event": "labeled",
            "id": 4295069754,
            "label": {
                "color": "444444",
                "name": "Cython Language Feature"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDQyOTUwNjk3NTQ=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4295069754"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-02-05T09:09:33Z",
            "event": "labeled",
            "id": 4295069756,
            "label": {
                "color": "c2e0c6",
                "name": "feature"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDQyOTUwNjk3NTY=",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/4295069756"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3995/events",
    "html_url": "https://github.com/cython/cython/issues/3995",
    "id": 799431003,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "description": null,
            "id": 425559948,
            "name": "Cython Language Feature",
            "node_id": "MDU6TGFiZWw0MjU1NTk5NDg=",
            "url": "https://api.github.com/repos/cython/cython/labels/Cython%20Language%20Feature"
        },
        {
            "color": "c2e0c6",
            "default": false,
            "description": null,
            "id": 414805463,
            "name": "feature",
            "node_id": "MDU6TGFiZWw0MTQ4MDU0NjM=",
            "url": "https://api.github.com/repos/cython/cython/labels/feature"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3995/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU3OTk0MzEwMDM=",
    "number": 3995,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "[ENH] Memory views with a memory view as item type",
    "updated_at": "2021-02-05T09:17:07Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3995",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6266635?v=4",
        "events_url": "https://api.github.com/users/mrakgr/events{/privacy}",
        "followers_url": "https://api.github.com/users/mrakgr/followers",
        "following_url": "https://api.github.com/users/mrakgr/following{/other_user}",
        "gists_url": "https://api.github.com/users/mrakgr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mrakgr",
        "id": 6266635,
        "login": "mrakgr",
        "node_id": "MDQ6VXNlcjYyNjY2MzU=",
        "organizations_url": "https://api.github.com/users/mrakgr/orgs",
        "received_events_url": "https://api.github.com/users/mrakgr/received_events",
        "repos_url": "https://api.github.com/users/mrakgr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mrakgr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mrakgr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mrakgr"
    }
}