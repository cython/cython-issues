{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "**Describe the bug**\r\n\r\nWith Cython version 0.29.24 and Python 3.8.11, I have a compiled dependency that a pyspark script needs to execute on a Spark worker (through a Pyspark [map function](https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.RDD.map.html)).\r\n\r\nMy setup file looks like this:\r\n```python\r\nfrom distutils.core import setup\r\nfrom distutils.extension import Extension\r\nfrom Cython.Distutils import build_ext\r\n\r\next_modules = [\r\n    Extension(\"pyspark_script\", [\"pyspark_script.pyx\"]),\r\n    Extension(\"modules.toolbox\", [\"modules/toolbox.pyx\"])\r\n]\r\n\r\nsetup(name=\"Sample Program\", cmdclass={\"build_ext\": build_ext}, ext_modules=ext_modules)\r\n```\r\nI import the module in my pyspark script with `from modules import toolbox`and I compile my files (`$ python setup.py build_ext --inplace`).\r\nThen I execute the code with spark-submit, passing the toolbox module path to my worker with a `--py-files` argument, \r\n`$ spark-submit --py-files modules/product.cpython-38-darwin.so,modules/toolbox.cpython-38-darwin.so --master spark://localhost:7077 main.py`\r\nBut I have a `ModuleNotFound` error (\"No module named 'modules'\").\r\n\r\nIf I change the `ext_modules` of my setup file to:\r\n```python\r\next_modules = [\r\n    Extension(\"pyspark_script\", [\"pyspark_script.pyx\"]),\r\n    Extension(\"toolbox\", [\"modules/toolbox.pyx\"])\r\n]\r\n```\r\nthen I can send the compiled toolbox file to the workers and they can execute it but my master can't find the module anymore. So I have move the file in the dependency (`mv toolbox.cpython-38-darwin.so modules`) in the modules folder and finally it works.\r\n\r\nBut I don't understand what _does my change in the config file implies?_\r\nWhy changing the `Extension` first argument from `\"modules.toolbox\"`to `\"toolbox\"` works for my workers?\r\nI looked in the 2 versions of toolbox.c transpiled file but I don't know enough about import conventions in Cython/Python and I can't find any helpful documentation on that point...\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "1. Please ask support questions on the cython-users mailing list rather than here\r\n2. If you use \"modules.toolbox\" as a module name and do not specify \"module\", then you could not import from module, but you could use \"from modules.toolbox import x\" and compiled exception would be in the \"./module\"\r\n3. If you use \"toolbox\" then this name would be used for the exception and compiled version would be in the current working directory\r\n\r\nThis is not about cython, this is about how distutils work",
            "created_at": "2021-09-24T08:13:30Z",
            "html_url": "https://github.com/cython/cython/issues/4384#issuecomment-926435772",
            "id": 926435772,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4384",
            "node_id": "IC_kwDOABDGAc43OEm8",
            "performed_via_github_app": null,
            "updated_at": "2021-09-24T08:14:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/926435772",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hi @0dminnimda, thank you for your help and sorry if I didn't send my request to the right place...\r\nI am not sure I completely understood your answer (what do you mean when you say \"do not specify \"module\"\"?), but the thing is:\r\n1) If I use \"modules.toolbox\" as a module name, I _can_ import both as \"from modules.toolbox import x\" and \"\"from modules import toolbox\" if the code is executed on the master. The problem is only related with the execution on the workers.\r\n 2) the problem seems to be related to the transpiled C code itself because this is the only difference in output between the two situation. That's why I thought it could be a Cython problem and not related to distutils. I don't have much clue what is going on but only the workers can't find the modules when I used `Extension(\"toolbox\", [\"modules/toolbox.pyx\"])` and `from modules.toolbox import add_one` and other combination doesn't work.",
            "created_at": "2021-09-28T17:27:04Z",
            "html_url": "https://github.com/cython/cython/issues/4384#issuecomment-929466676",
            "id": 929466676,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4384",
            "node_id": "IC_kwDOABDGAc43Zok0",
            "performed_via_github_app": null,
            "updated_at": "2021-09-28T17:27:04Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/929466676",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5038435?v=4",
                "events_url": "https://api.github.com/users/GodefroyClair/events{/privacy}",
                "followers_url": "https://api.github.com/users/GodefroyClair/followers",
                "following_url": "https://api.github.com/users/GodefroyClair/following{/other_user}",
                "gists_url": "https://api.github.com/users/GodefroyClair/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/GodefroyClair",
                "id": 5038435,
                "login": "GodefroyClair",
                "node_id": "MDQ6VXNlcjUwMzg0MzU=",
                "organizations_url": "https://api.github.com/users/GodefroyClair/orgs",
                "received_events_url": "https://api.github.com/users/GodefroyClair/received_events",
                "repos_url": "https://api.github.com/users/GodefroyClair/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/GodefroyClair/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/GodefroyClair/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/GodefroyClair"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> 1. If I use \"modules.toolbox\" as a module name, I _can_ import both as \"from modules.toolbox import x\" and \"\"from modules import toolbox\" if the code is executed on the master.\r\n\r\nSorry for my mistake.\r\n\r\n> 1. The problem is only related with the execution on the workers.\r\n\r\nMaybe it have something to do with pyspark, I'm not knowledgeable about that package to say anything.",
            "created_at": "2021-09-28T20:42:57Z",
            "html_url": "https://github.com/cython/cython/issues/4384#issuecomment-929610083",
            "id": 929610083,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4384",
            "node_id": "IC_kwDOABDGAc43aLlj",
            "performed_via_github_app": null,
            "updated_at": "2021-09-28T21:09:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/929610083",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The reason I mentioned cython-users mailing list is because it have bigger audience and probably could provide more assistance, for me right now it's not really clear, so until it'll will become apparent that the issue is with cython I encourage you to post your problem in cython-users mailing list and maybe report this to pyspark's issue tracker if you wish.",
            "created_at": "2021-09-28T20:47:05Z",
            "html_url": "https://github.com/cython/cython/issues/4384#issuecomment-929612773",
            "id": 929612773,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/4384",
            "node_id": "IC_kwDOABDGAc43aMPl",
            "performed_via_github_app": null,
            "updated_at": "2021-09-28T20:51:18Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/929612773",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/4384/comments",
    "created_at": "2021-09-23T11:56:19Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5038435?v=4",
                "events_url": "https://api.github.com/users/GodefroyClair/events{/privacy}",
                "followers_url": "https://api.github.com/users/GodefroyClair/followers",
                "following_url": "https://api.github.com/users/GodefroyClair/following{/other_user}",
                "gists_url": "https://api.github.com/users/GodefroyClair/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/GodefroyClair",
                "id": 5038435,
                "login": "GodefroyClair",
                "node_id": "MDQ6VXNlcjUwMzg0MzU=",
                "organizations_url": "https://api.github.com/users/GodefroyClair/orgs",
                "received_events_url": "https://api.github.com/users/GodefroyClair/received_events",
                "repos_url": "https://api.github.com/users/GodefroyClair/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/GodefroyClair/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/GodefroyClair/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/GodefroyClair"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-09-23T12:05:08Z",
            "event": "renamed",
            "id": 5349296085,
            "node_id": "RTE_lADOABDGAc477ElFzwAAAAE-18fV",
            "performed_via_github_app": null,
            "rename": {
                "from": "Pyspark workers can't find a dependency compiled with Cython",
                "to": "maybe a [BUG] Pyspark workers can't find a dependency compiled with Cython"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/5349296085"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-09-28T17:27:04Z",
            "event": "mentioned",
            "id": 5375491735,
            "node_id": "MEE_lADOABDGAc477ElFzwAAAAFAZ36X",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5375491735"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/52697657?v=4",
                "events_url": "https://api.github.com/users/0dminnimda/events{/privacy}",
                "followers_url": "https://api.github.com/users/0dminnimda/followers",
                "following_url": "https://api.github.com/users/0dminnimda/following{/other_user}",
                "gists_url": "https://api.github.com/users/0dminnimda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/0dminnimda",
                "id": 52697657,
                "login": "0dminnimda",
                "node_id": "MDQ6VXNlcjUyNjk3NjU3",
                "organizations_url": "https://api.github.com/users/0dminnimda/orgs",
                "received_events_url": "https://api.github.com/users/0dminnimda/received_events",
                "repos_url": "https://api.github.com/users/0dminnimda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/0dminnimda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/0dminnimda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/0dminnimda"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2021-09-28T17:27:05Z",
            "event": "subscribed",
            "id": 5375491742,
            "node_id": "SE_lADOABDGAc477ElFzwAAAAFAZ36e",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/5375491742"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/4384/events",
    "html_url": "https://github.com/cython/cython/issues/4384",
    "id": 1005340997,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/4384/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc477ElF",
    "number": 4384,
    "performed_via_github_app": null,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/4384/timeline",
    "title": "maybe a [BUG] Pyspark workers can't find a dependency compiled with Cython",
    "updated_at": "2021-09-28T21:09:02Z",
    "url": "https://api.github.com/repos/cython/cython/issues/4384",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5038435?v=4",
        "events_url": "https://api.github.com/users/GodefroyClair/events{/privacy}",
        "followers_url": "https://api.github.com/users/GodefroyClair/followers",
        "following_url": "https://api.github.com/users/GodefroyClair/following{/other_user}",
        "gists_url": "https://api.github.com/users/GodefroyClair/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/GodefroyClair",
        "id": 5038435,
        "login": "GodefroyClair",
        "node_id": "MDQ6VXNlcjUwMzg0MzU=",
        "organizations_url": "https://api.github.com/users/GodefroyClair/orgs",
        "received_events_url": "https://api.github.com/users/GodefroyClair/received_events",
        "repos_url": "https://api.github.com/users/GodefroyClair/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/GodefroyClair/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/GodefroyClair/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/GodefroyClair"
    }
}