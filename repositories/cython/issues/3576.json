{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "One example is https://github.com/kif/freesas:\r\n```\r\nrunning build_ext\r\ncythoning freesas/_distance.pyx to freesas/_distance.c\r\n/opt/VirtualEnv/py38/lib/python3.8/site-packages/Cython/Compiler/Main.py:344: FutureWarning: Cython directive 'language_level' not set, using '3str' for now (Py3). This has changed from earlier releases! File: /home/jerome/workspace/freesas/freesas/_distance.pyx\r\n  tree = Parsing.p_module(s, pxd, full_module_name)\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    \"\"\"\r\n    cdef floating sigma = 0.40567 * radius\r\n    return exp(- pos * pos / (2.0 * sigma * sigma)) * 0.3989422804014327 / sigma\r\n\r\n\r\nIF HAVE_OPENMP:\r\n  ^\r\n------------------------------------------------------------\r\n\r\nfreesas/_distance.pyx:76:3: Compile-time name 'HAVE_OPENMP' not defined\r\n```\r\n\r\nWhat is/was the rational: setup.py determines if the architecture/compiler are suitable for openmp parallelization and includes one or the other version of the source code. In more recent code (silx, pyFAI), we are doing this detection at runtime, not compile-time, so this issue does not appear.",
    "closed_at": "2020-05-06T19:36:15Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Here is the section of the setup.py:\r\n```    def patch_extension(self, ext):\r\n        \"\"\"\r\n        Patch an extension according to requested Cython and OpenMP usage.\r\n\r\n        :param Extension ext: An extension\r\n        \"\"\"\r\n        # Cytonize\r\n        if not self.use_cython:\r\n            self.patch_with_default_cythonized_files(ext)\r\n        else:\r\n            from Cython.Build import cythonize\r\n            patched_exts = cythonize(\r\n                [ext],\r\n                compiler_directives={'embedsignature': True,\r\n                                     'language_level': 3},\r\n                force=self.force_cython,\r\n                compile_time_env={\"HAVE_OPENMP\": self.use_openmp}\r\n            )\r\n            ext.sources = patched_exts[0].sources\r\n```",
            "created_at": "2020-05-06T06:11:40Z",
            "html_url": "https://github.com/cython/cython/issues/3576#issuecomment-624460539",
            "id": 624460539,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3576",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2MDUzOQ==",
            "updated_at": "2020-05-06T06:11:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/624460539",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I notice there is also a warning about the Python3 syntax which is not used. This means the `cythonize` is either not called or not with the proper options.",
            "created_at": "2020-05-06T06:15:40Z",
            "html_url": "https://github.com/cython/cython/issues/3576#issuecomment-624461656",
            "id": 624461656,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3576",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2MTY1Ng==",
            "updated_at": "2020-05-06T06:15:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/624461656",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Once the compile-time extension has been passed, it is OK:\r\n```\r\ncython -E HAVE_OPENMP=True freesas/_distance.pyx\r\npython setup.py build\r\n```",
            "created_at": "2020-05-06T06:22:06Z",
            "html_url": "https://github.com/cython/cython/issues/3576#issuecomment-624463607",
            "id": 624463607,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3576",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2MzYwNw==",
            "updated_at": "2020-05-06T06:22:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/624463607",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I double checked and there are also issues within silx where the compiler directives are not taken into account. \r\nhttps://github.com/silx-kit/silx/issues/3027\r\nSo there is probably something that changed between cython 0.29 and cython3 when it comes to the integration within setuptools build_ext\r\n",
            "created_at": "2020-05-06T06:55:31Z",
            "html_url": "https://github.com/cython/cython/issues/3576#issuecomment-624475502",
            "id": 624475502,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3576",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ3NTUwMg==",
            "updated_at": "2020-05-06T06:55:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/624475502",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "https://github.com/cython/cython/pull/3561 looks to be the most recent relevant change to setuptools, so is a likely cause?",
            "created_at": "2020-05-06T17:46:27Z",
            "html_url": "https://github.com/cython/cython/issues/3576#issuecomment-624793429",
            "id": 624793429,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3576",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDc5MzQyOQ==",
            "updated_at": "2020-05-06T17:46:27Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/624793429",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I have re-shuffled our setup.py and apparently it works again ... I suspect the bug was on our side.",
            "created_at": "2020-05-06T19:36:15Z",
            "html_url": "https://github.com/cython/cython/issues/3576#issuecomment-624847753",
            "id": 624847753,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3576",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDg0Nzc1Mw==",
            "updated_at": "2020-05-06T19:36:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/624847753",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3576/comments",
    "created_at": "2020-05-06T06:11:10Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-05-06T06:56:34Z",
            "event": "renamed",
            "id": 3307128475,
            "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzMwNzEyODQ3NQ==",
            "rename": {
                "from": "Cython3 fails to generate code with compule-time constants",
                "to": "Cython3 fails to generate code due to missing compile-time constants / compiler directives"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/3307128475"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-05-06T06:56:52Z",
            "event": "renamed",
            "id": 3307129198,
            "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzMwNzEyOTE5OA==",
            "rename": {
                "from": "Cython3 fails to generate code due to missing compile-time constants / compiler directives",
                "to": "Cython3 fails: missing compile-time constants / compiler directives"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/3307129198"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
                "events_url": "https://api.github.com/users/kif/events{/privacy}",
                "followers_url": "https://api.github.com/users/kif/followers",
                "following_url": "https://api.github.com/users/kif/following{/other_user}",
                "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kif",
                "id": 1018880,
                "login": "kif",
                "node_id": "MDQ6VXNlcjEwMTg4ODA=",
                "organizations_url": "https://api.github.com/users/kif/orgs",
                "received_events_url": "https://api.github.com/users/kif/received_events",
                "repos_url": "https://api.github.com/users/kif/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kif"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2020-05-06T19:36:15Z",
            "event": "closed",
            "id": 3309995302,
            "node_id": "MDExOkNsb3NlZEV2ZW50MzMwOTk5NTMwMg==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3309995302"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3576/events",
    "html_url": "https://github.com/cython/cython/issues/3576",
    "id": 613074184,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3576/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU2MTMwNzQxODQ=",
    "number": 3576,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Cython3 fails: missing compile-time constants / compiler directives",
    "updated_at": "2020-05-06T19:36:15Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3576",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/1018880?v=4",
        "events_url": "https://api.github.com/users/kif/events{/privacy}",
        "followers_url": "https://api.github.com/users/kif/followers",
        "following_url": "https://api.github.com/users/kif/following{/other_user}",
        "gists_url": "https://api.github.com/users/kif/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kif",
        "id": 1018880,
        "login": "kif",
        "node_id": "MDQ6VXNlcjEwMTg4ODA=",
        "organizations_url": "https://api.github.com/users/kif/orgs",
        "received_events_url": "https://api.github.com/users/kif/received_events",
        "repos_url": "https://api.github.com/users/kif/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kif/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kif/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kif"
    }
}