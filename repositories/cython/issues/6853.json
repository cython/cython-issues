{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nI am trying to compile a wheel using the limited API feature of Cython 3.1 and when I use `abi3audit` to check the built wheel, some symbols should have not been used. I am building the wheel for Python 3.11 stable ABI and `abi3audit` has found symbols that will be in the stable API for version 3.14 of Python.\n\n\n### Code to reproduce the behaviour:\n\nWith this code, only `Py_TYPE` appears in the built wheel. In my use case, `Py_REFCNT` also appears.\n\n```cython\ncpdef int test(int a, int b):\n    return a + b\n```\n\n\n### Expected behaviour\n\nI would have expected my wheel to be compatible with the stable API of version 3.11.\n\n### OS\n\nLinux\n\n### Python version\n\n3.12.7\n\n### Cython version\n\n3.1.0\n\n### Additional context\n\nI am currently using the following compiler directives for building my wheel \n\n```\n-Xboundscheck=False -Xlanguage_level=3   -Xembedsignature=True  -Xc_string_type=str -Xc_string_encoding=utf-8  -Xwraparound=False\n```\n\nThe resulting `abi3audit` command line and results:\n\n```bash\nabi3audit --report --assume-minimum-abi3 3.11 build/cy_test.abi3.so \n```\n\n```json\n{\n  \"specs\": {\n    \"build/cy_test.abi3.so\": {\n      \"kind\": \"object\",\n      \"object\": {\n        \"name\": \"cy_test.abi3.so\",\n        \"result\": {\n          \"is_abi3\": true,\n          \"is_abi3_baseline_compatible\": false,\n          \"baseline\": \"3.11\",\n          \"computed\": \"3.14\",\n          \"non_abi3_symbols\": [],\n          \"future_abi3_objects\": {\n            \"Py_TYPE\": \"3.14\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n",
    "closed_at": "2025-05-09T18:08:24Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
        "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
        "followers_url": "https://api.github.com/users/da-woods/followers",
        "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
        "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/da-woods",
        "id": 10536947,
        "login": "da-woods",
        "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
        "organizations_url": "https://api.github.com/users/da-woods/orgs",
        "received_events_url": "https://api.github.com/users/da-woods/received_events",
        "repos_url": "https://api.github.com/users/da-woods/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/da-woods",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I think this is a false positive from abi3audit.\n\nThe status of the various macros in the limited API is really badly documented and they've been resistant to documenting it further (although I'm definitely not the only one that's been confused by it). But I believe they are in the Limited API and are OK to use. \n\nIn Python 3.12 `Py_TYPE` looks to be a static inline function (https://github.com/python/cpython/blob/0b05ead877f909b7efe712db758012d9dbece7ce/Include/object.h#L218) which means that it will be included independently into each binary.\n\nIn Python 3.14 it gets changed into a non-static function which has to be linked to the definition in Python. \n\nSo I think abi3audit is just seeing the static inline definition and misreporting it. `Py_REFCNT` is almost certainly similar.\n\nIf you try to use your library in Python 3.11 does it work?\n",
            "created_at": "2025-05-09T11:16:58Z",
            "html_url": "https://github.com/cython/cython/issues/6853#issuecomment-2866164585",
            "id": 2866164585,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6853",
            "node_id": "IC_kwDOABDGAc6q1jNp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2866164585/reactions"
            },
            "updated_at": "2025-05-09T11:16:58Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2866164585",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@da-woods You are right! It works fine despite the error coming from `abi3audit`. Sorry for the inconvenience.",
            "created_at": "2025-05-09T15:31:59Z",
            "html_url": "https://github.com/cython/cython/issues/6853#issuecomment-2867009909",
            "id": 2867009909,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6853",
            "node_id": "IC_kwDOABDGAc6q4xl1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2867009909/reactions"
            },
            "updated_at": "2025-05-09T15:31:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2867009909",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/12542576?v=4",
                "events_url": "https://api.github.com/users/benoit9126/events{/privacy}",
                "followers_url": "https://api.github.com/users/benoit9126/followers",
                "following_url": "https://api.github.com/users/benoit9126/following{/other_user}",
                "gists_url": "https://api.github.com/users/benoit9126/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/benoit9126",
                "id": 12542576,
                "login": "benoit9126",
                "node_id": "MDQ6VXNlcjEyNTQyNTc2",
                "organizations_url": "https://api.github.com/users/benoit9126/orgs",
                "received_events_url": "https://api.github.com/users/benoit9126/received_events",
                "repos_url": "https://api.github.com/users/benoit9126/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/benoit9126/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/benoit9126/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/benoit9126",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "No problem. Thanks for trying out the limited API mode.\n\nDo report the issue to abi3audit if you haven't already. \n\nI'll close this issue since I think we're both convinced it's a false positive",
            "created_at": "2025-05-09T18:08:24Z",
            "html_url": "https://github.com/cython/cython/issues/6853#issuecomment-2867516467",
            "id": 2867516467,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/6853",
            "node_id": "IC_kwDOABDGAc6q6tQz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/2867516467/reactions"
            },
            "updated_at": "2025-05-09T18:08:24Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/2867516467",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/6853/comments",
    "created_at": "2025-05-09T09:49:38Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-09T15:32:00Z",
            "event": "mentioned",
            "id": 17593104629,
            "node_id": "MEE_lADOABDGAc615FSBzwAAAAQYoXj1",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17593104629"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-09T15:32:01Z",
            "event": "subscribed",
            "id": 17593104649,
            "node_id": "SE_lADOABDGAc615FSBzwAAAAQYoXkJ",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17593104649"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-09T18:08:24Z",
            "event": "closed",
            "id": 17595046920,
            "node_id": "CE_lADOABDGAc615FSBzwAAAAQYvxwI",
            "performed_via_github_app": null,
            "state_reason": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17595046920"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-09T18:08:36Z",
            "event": "labeled",
            "id": 17595049137,
            "label": {
                "color": "000000",
                "name": "R: third party"
            },
            "node_id": "LE_lADOABDGAc615FSBzwAAAAQYvySx",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17595049137"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2025-05-09T18:08:36Z",
            "event": "labeled",
            "id": 17595049151,
            "label": {
                "color": "F5AB5D",
                "name": "limited api"
            },
            "node_id": "LE_lADOABDGAc615FSBzwAAAAQYvyS_",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/17595049151"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/6853/events",
    "html_url": "https://github.com/cython/cython/issues/6853",
    "id": 3051639937,
    "labels": [
        {
            "color": "000000",
            "default": false,
            "description": "",
            "id": 1840758668,
            "name": "R: third party",
            "node_id": "MDU6TGFiZWwxODQwNzU4NjY4",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20third%20party"
        },
        {
            "color": "F5AB5D",
            "default": false,
            "description": "",
            "id": 4210073287,
            "name": "limited api",
            "node_id": "LA_kwDOABDGAc768J7H",
            "url": "https://api.github.com/repos/cython/cython/labels/limited%20api"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/6853/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc615FSB",
    "number": 6853,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/6853/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/6853/timeline",
    "title": "[BUG] Py_TYPE and Py_REFCNT are used in limited api (3.11)",
    "type": null,
    "updated_at": "2025-05-09T18:08:36Z",
    "url": "https://api.github.com/repos/cython/cython/issues/6853",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/12542576?v=4",
        "events_url": "https://api.github.com/users/benoit9126/events{/privacy}",
        "followers_url": "https://api.github.com/users/benoit9126/followers",
        "following_url": "https://api.github.com/users/benoit9126/following{/other_user}",
        "gists_url": "https://api.github.com/users/benoit9126/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/benoit9126",
        "id": 12542576,
        "login": "benoit9126",
        "node_id": "MDQ6VXNlcjEyNTQyNTc2",
        "organizations_url": "https://api.github.com/users/benoit9126/orgs",
        "received_events_url": "https://api.github.com/users/benoit9126/received_events",
        "repos_url": "https://api.github.com/users/benoit9126/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/benoit9126/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/benoit9126/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/benoit9126",
        "user_view_type": "public"
    }
}