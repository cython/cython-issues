{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "I've got a python-space class that is a thin wrapper around a np.ndarray, and I'd like to make this into a buffer-protocol-compliant cython class so I can pass it to memoryview-expecting cython functions without having to unwrap it every time.\r\n\r\nMy intuition was that this would look like\r\n\r\n```\r\ncdef Wrapper:\r\n    cdef readonly:\r\n        ndarray _orig\r\n\r\n    def __cinit__(self, ndarray orig, *args, **kwargs):\r\n        self._orig = orig\r\n\r\n    def __getbuffer__(self, Py_buffer *view, int flags):\r\n        self._orig.__getbuffer__(view, flags)\r\n\r\n     def __releasebuffer__(self, Py_buffer *view):\r\n         self._orig.__releasebuffer__(view)\r\n```\r\n\r\nWhen I do this, I get a compile-time error pointing to `self._orig.__releasebuffer__` reading `Cannot convert Py_buffer * to Python object` which suggests to me that `__releasebuffer__` is not in the ndarray c-namespace.\r\n\r\nSo the request is for a recipe or docs on how to create one memoryview-class that just wraps another.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "These magic methods are invented by Cython, they're not actually part of the API. What you want to do is call the [C-API function](https://docs.python.org/3/c-api/buffer.html) `PyObject_GetBuffer()` on the Numpy array to have it fill in the buffer. You don't need to actually do anything in the release method, since it'll never be called - the array will be saved in the buffer, so it will have the release method called on itself. The function can be cimported from `cpython.buffer`, and you don't need to return anything.",
            "created_at": "2019-07-19T08:47:22Z",
            "html_url": "https://github.com/cython/cython/issues/3048#issuecomment-513148459",
            "id": 513148459,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3048",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzE0ODQ1OQ==",
            "updated_at": "2019-07-19T08:47:22Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/513148459",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/8453732?v=4",
                "events_url": "https://api.github.com/users/TeamSpen210/events{/privacy}",
                "followers_url": "https://api.github.com/users/TeamSpen210/followers",
                "following_url": "https://api.github.com/users/TeamSpen210/following{/other_user}",
                "gists_url": "https://api.github.com/users/TeamSpen210/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TeamSpen210",
                "id": 8453732,
                "login": "TeamSpen210",
                "node_id": "MDQ6VXNlcjg0NTM3MzI=",
                "organizations_url": "https://api.github.com/users/TeamSpen210/orgs",
                "received_events_url": "https://api.github.com/users/TeamSpen210/received_events",
                "repos_url": "https://api.github.com/users/TeamSpen210/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TeamSpen210/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TeamSpen210/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TeamSpen210"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3048/comments",
    "created_at": "2019-07-18T03:35:19Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3048/events",
    "html_url": "https://github.com/cython/cython/issues/3048",
    "id": 469554938,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3048/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0Njk1NTQ5Mzg=",
    "number": 3048,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "REQ: recipe/docs for creating a buffer-protocol class by wrapping another",
    "updated_at": "2019-07-19T08:47:22Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3048",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/8078968?v=4",
        "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}",
        "followers_url": "https://api.github.com/users/jbrockmendel/followers",
        "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}",
        "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jbrockmendel",
        "id": 8078968,
        "login": "jbrockmendel",
        "node_id": "MDQ6VXNlcjgwNzg5Njg=",
        "organizations_url": "https://api.github.com/users/jbrockmendel/orgs",
        "received_events_url": "https://api.github.com/users/jbrockmendel/received_events",
        "repos_url": "https://api.github.com/users/jbrockmendel/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jbrockmendel"
    }
}