{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Is your feature request related to a problem? Please describe.\n\nIn my code, I would like to do [...]\r\n```cython\r\ncdef class Test:\r\n     def __cinit__(self, const cnp.int8_t[:] monotonic_cst):\r\n              self.monotonic_cst = monotonic_cst\r\n\r\n     def __reduce__(self):\r\n        \"\"\"Enable pickling the splitter.\"\"\"\r\n        return (\r\n            type(self),\r\n            (\r\n                self.monotonic_cst.base,\r\n            ), self.__getstate__())\r\n\r\ntest = Test(np.array([1,1], dtype=np.int8))\r\njoblib.dump(test, 'fname.pickle')\r\n```\r\n\n\n### Describe the solution you'd like.\n\nTBD. @da-woods would you mind expanding on what soln you had in mind? Is it something a beginner contributor for Cython like me would be able to implement?\n\n### Describe alternatives you've considered.\n\n_No response_\n\n### Additional context\n\nThis was brought up in the mailing list by @da-woods \r\n\r\n\"I wonder if we could make memoryviews properly pickleable in Cython (provided that base is pickleable). There's only really a small amount of extra information to be saved. Might be worth creating an issue for that.\"",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "My first thought on how to do this:\r\n\r\n* make the [`memoryviewslice` class]( https://github.com/cython/cython/blob/aa5e8668a9ef3dc047c305fa4971129849d0ab19/Cython/Utility/MemoryView.pyx#L947) pickleable since this is what gets passed to Python when memoryviews are converted to objects, and I think this is what it'll try pickling by default.\r\n* Require `base` to be pickleable and not `None`.\r\n* The tricky bit is converting `buffer.buf` (i.e. the `void*`) into something pickleable. I think what you want to do is get a fresh buffer to the underlying object, check that it's a direct memoryview (the most common type), check that `buffer.buf` is contained within the fresh buffer, and then convert it to an offset.\r\n* Indirect memoryviews could probably be handled fairly similarly, but are much less common so probably wouldn't need to be in the first iteration.\r\n\r\nI haven't tried any of this, so there may be something I'm missing, but I think it'd cover a lot of cases anyway.",
            "created_at": "2023-08-16T06:58:28Z",
            "html_url": "https://github.com/cython/cython/issues/5629#issuecomment-1680066867",
            "id": 1680066867,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5629",
            "node_id": "IC_kwDOABDGAc5kI8kz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1680066867/reactions"
            },
            "updated_at": "2023-08-16T06:58:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1680066867",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "@da-woods you mention that the soln. I posted (i.e code in the PR description) was not valid. Isn't `base` just a pointer to the raw array data, so it would be fine?\r\n\r\nI'm looking at https://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html#memoryview-objects-and-cython-arrays.\r\n\r\n^I noticed there is no description for `base`. Perhaps that can be remedied?",
            "created_at": "2023-08-16T18:40:59Z",
            "html_url": "https://github.com/cython/cython/issues/5629#issuecomment-1681102999",
            "id": 1681102999,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5629",
            "node_id": "IC_kwDOABDGAc5kM5iX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1681102999/reactions"
            },
            "updated_at": "2023-08-16T18:40:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1681102999",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3460267?v=4",
                "events_url": "https://api.github.com/users/adam2392/events{/privacy}",
                "followers_url": "https://api.github.com/users/adam2392/followers",
                "following_url": "https://api.github.com/users/adam2392/following{/other_user}",
                "gists_url": "https://api.github.com/users/adam2392/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/adam2392",
                "id": 3460267,
                "login": "adam2392",
                "node_id": "MDQ6VXNlcjM0NjAyNjc=",
                "organizations_url": "https://api.github.com/users/adam2392/orgs",
                "received_events_url": "https://api.github.com/users/adam2392/received_events",
                "repos_url": "https://api.github.com/users/adam2392/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/adam2392/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/adam2392/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/adam2392"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think `base` is a Python object that the memoryview is a view of. The trouble with just pickling base is that the memoryview isn't necessarily a view of the whole thing. e.g.\r\n\r\n```\r\ncdef double[:] mview1 = arr[50:]  # view excluding first 50 elements\r\ncdef double[:] mview2 = arr2d[1, :]  # single row or column\r\ncdef double[:] mview3 = arr[::2]  # every second elemnt\r\n```\r\n\r\nSo `base` alone isn't sufficient to define the memoryview generally.\r\n\r\n> ^I noticed there is no description for base. Perhaps that can be remedied?\r\n\r\nWe could definitely improve that",
            "created_at": "2023-08-16T19:42:43Z",
            "html_url": "https://github.com/cython/cython/issues/5629#issuecomment-1681176525",
            "id": 1681176525,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/5629",
            "node_id": "IC_kwDOABDGAc5kNLfN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/1681176525/reactions"
            },
            "updated_at": "2023-08-16T19:42:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/1681176525",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/5629/comments",
    "created_at": "2023-08-15T21:44:32Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-08-15T21:44:32Z",
            "event": "mentioned",
            "id": 10101726923,
            "node_id": "MEE_lADOABDGAc5uZeKjzwAAAAJaHB7L",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10101726923"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-08-15T21:44:32Z",
            "event": "subscribed",
            "id": 10101726929,
            "node_id": "SE_lADOABDGAc5uZeKjzwAAAAJaHB7R",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10101726929"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-08-16T18:40:59Z",
            "event": "mentioned",
            "id": 10111654487,
            "node_id": "MEE_lADOABDGAc5uZeKjzwAAAAJas5pX",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10111654487"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2023-08-16T18:40:59Z",
            "event": "subscribed",
            "id": 10111654494,
            "node_id": "SE_lADOABDGAc5uZeKjzwAAAAJas5pe",
            "performed_via_github_app": null,
            "url": "https://api.github.com/repos/cython/cython/issues/events/10111654494"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/5629/events",
    "html_url": "https://github.com/cython/cython/issues/5629",
    "id": 1852170915,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/5629/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc5uZeKj",
    "number": 5629,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/5629/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/5629/timeline",
    "title": "[ENH] Make memoryviews pickleable",
    "updated_at": "2023-08-16T19:42:43Z",
    "url": "https://api.github.com/repos/cython/cython/issues/5629",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3460267?v=4",
        "events_url": "https://api.github.com/users/adam2392/events{/privacy}",
        "followers_url": "https://api.github.com/users/adam2392/followers",
        "following_url": "https://api.github.com/users/adam2392/following{/other_user}",
        "gists_url": "https://api.github.com/users/adam2392/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/adam2392",
        "id": 3460267,
        "login": "adam2392",
        "node_id": "MDQ6VXNlcjM0NjAyNjc=",
        "organizations_url": "https://api.github.com/users/adam2392/orgs",
        "received_events_url": "https://api.github.com/users/adam2392/received_events",
        "repos_url": "https://api.github.com/users/adam2392/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/adam2392/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adam2392/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/adam2392"
    }
}