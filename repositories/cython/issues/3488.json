{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "This seems like a mistake, as Python's `bytearray` is a strict superset of Python's `bytes` â€” so when accepting a `bytes` argument, I can't think of a good reason not to accept a `bytearray` object, but right now this fails:\r\n\r\n```\r\n# iscsi.pyx\r\n\r\ncdef class Task:\r\n    cdef scsi_task *_task\r\n\r\n    def __init__(self, bytes cdb, scsi_xfer_dir direction, size_t xferlen):\r\n        self._task = scsi_create_task(len(cdb), cdb, direction, xferlen)\r\n\r\n    @property\r\n    def status(self):\r\n        return scsi_task_get_status(self._task, NULL)\r\n```\r\n\r\n```\r\n# iscsi_test.py\r\nclass TaskTest(unittest.TestCase):\r\n    def test_bytearray(self):\r\n        task = iscsi.Task(\r\n            bytearray(b\"\\x12\\x00\\x00\\x00\\x60\\x00\"), iscsi.SCSI_XFER_READ, 96\r\n        )\r\n        self.assertIsNotNone(task)\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nself = <tests.iscsi_test.TaskTest testMethod=test_bytearray>\r\n\r\n    def test_bytearray(self):\r\n>       task = iscsi.Task(\r\n            bytearray(b\"\\x12\\x00\\x00\\x00\\x60\\x00\"), iscsi.SCSI_XFER_READ, 96\r\n        )\r\nE       TypeError: Argument 'cdb' has incorrect type (expected bytes, got bytearray)\r\n\r\ntests/iscsi_test.py:28: TypeError\r\n```\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "This looks correct to me:\r\n\r\n```\r\n>>> isinstance(bytearray(), bytes)\r\nFalse\r\n```\r\n\r\nI'd have thought there's two options:\r\n1. don't type it, in which case Python duck-typing solves your problems.\r\n2. Type it using a const memoryview, which'll accept both: `const unsigned char[::1] cdb`\r\n\r\n------------------------------\r\n\r\nIt'd also be useless for creating optimized C code - for example `len(something_typed_as_bytes)` will efficiently directly call `PyBytes_Size`. But `PyBytes_Size` won't work with a `bytearray`. You've therefore lost all the advantages of actually specifying the type.",
            "created_at": "2020-04-04T14:49:17Z",
            "html_url": "https://github.com/cython/cython/issues/3488#issuecomment-609039796",
            "id": 609039796,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3488",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTAzOTc5Ng==",
            "updated_at": "2020-04-04T14:54:45Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/609039796",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I guess that part that confuses me is that this is unlike the way Python's own typing works (with both mypy and pytype):\r\n\r\n```\r\n$ cat example.py\r\ndef foo(b: bytes):\r\n    return b\r\n\r\nfoo(b'')\r\nfoo(bytearray(b''))\r\nfoo('')\r\n$ mypy example.py \r\nexample.py:6: error: Argument 1 to \"foo\" has incompatible type \"str\"; expected \"bytes\"\r\nFound 1 error in 1 file (checked 1 source file)\r\n```\r\n\r\nWhen typing with PEP484 `bytes` accept both",
            "created_at": "2020-04-04T14:58:34Z",
            "html_url": "https://github.com/cython/cython/issues/3488#issuecomment-609041115",
            "id": 609041115,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3488",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTA0MTExNQ==",
            "updated_at": "2020-04-04T14:58:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/609041115",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/74834?v=4",
                "events_url": "https://api.github.com/users/Flameeyes/events{/privacy}",
                "followers_url": "https://api.github.com/users/Flameeyes/followers",
                "following_url": "https://api.github.com/users/Flameeyes/following{/other_user}",
                "gists_url": "https://api.github.com/users/Flameeyes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Flameeyes",
                "id": 74834,
                "login": "Flameeyes",
                "node_id": "MDQ6VXNlcjc0ODM0",
                "organizations_url": "https://api.github.com/users/Flameeyes/orgs",
                "received_events_url": "https://api.github.com/users/Flameeyes/received_events",
                "repos_url": "https://api.github.com/users/Flameeyes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Flameeyes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Flameeyes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Flameeyes"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "If you search for \"mypy bytearray\" or similar it looks like they've taken the deliberate decision to accept this because they feel the Python interface is sufficiently similar even though it isn't strictly true.\r\n\r\nCython is using the C interface where the two types aren't the same and so it would break useful optimizations if Cython accepted this. I'm reasonably sure more people use Cython for the useful optimizations than as a static type-checker.",
            "created_at": "2020-04-04T15:13:21Z",
            "html_url": "https://github.com/cython/cython/issues/3488#issuecomment-609043171",
            "id": 609043171,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3488",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTA0MzE3MQ==",
            "updated_at": "2020-04-04T15:13:21Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/609043171",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Fair point. Although I think that the mypy implementation is currently redefining `bytes` to the buffer protocol, but that's also a different topic here.\r\n\r\nIs it okay if I reuse this issue to add notes to the documentation about this?",
            "created_at": "2020-04-04T15:56:59Z",
            "html_url": "https://github.com/cython/cython/issues/3488#issuecomment-609049226",
            "id": 609049226,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3488",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTA0OTIyNg==",
            "updated_at": "2020-04-04T15:56:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/609049226",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/74834?v=4",
                "events_url": "https://api.github.com/users/Flameeyes/events{/privacy}",
                "followers_url": "https://api.github.com/users/Flameeyes/followers",
                "following_url": "https://api.github.com/users/Flameeyes/following{/other_user}",
                "gists_url": "https://api.github.com/users/Flameeyes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Flameeyes",
                "id": 74834,
                "login": "Flameeyes",
                "node_id": "MDQ6VXNlcjc0ODM0",
                "organizations_url": "https://api.github.com/users/Flameeyes/orgs",
                "received_events_url": "https://api.github.com/users/Flameeyes/received_events",
                "repos_url": "https://api.github.com/users/Flameeyes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Flameeyes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Flameeyes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Flameeyes"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "It looks like there's already something to this effect in the documentation:\r\n\r\nhttps://cython.readthedocs.io/en/latest/src/tutorial/strings.html#accepting-strings-from-python-code\r\n\r\n> In the case that the API only deals with byte strings, i.e. binary data or encoded text, it is best not to type the input argument as something like bytes, because that would restrict the allowed input to exactly that type and exclude both subtypes and other kinds of byte containers, e.g. bytearray objects or memory views.\r\n\r\nThe challenge is always to find the place in the documentation where the information will be seen might the right people who need to see it. I'm sure improvements to the documentation are welcome (although I won't be the one deciding if they're accepted)",
            "created_at": "2020-04-04T16:04:56Z",
            "html_url": "https://github.com/cython/cython/issues/3488#issuecomment-609050375",
            "id": 609050375,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3488",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTA1MDM3NQ==",
            "updated_at": "2020-04-04T16:04:56Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/609050375",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the pointer! Indeed I have skipped over that paragraph because of the \"strings\" in the title, and missed that part :)\r\n\r\nI guess I'll have a think through of how to make it more explicit.",
            "created_at": "2020-04-04T16:06:39Z",
            "html_url": "https://github.com/cython/cython/issues/3488#issuecomment-609050646",
            "id": 609050646,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3488",
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTA1MDY0Ng==",
            "updated_at": "2020-04-04T16:06:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/609050646",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/74834?v=4",
                "events_url": "https://api.github.com/users/Flameeyes/events{/privacy}",
                "followers_url": "https://api.github.com/users/Flameeyes/followers",
                "following_url": "https://api.github.com/users/Flameeyes/following{/other_user}",
                "gists_url": "https://api.github.com/users/Flameeyes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Flameeyes",
                "id": 74834,
                "login": "Flameeyes",
                "node_id": "MDQ6VXNlcjc0ODM0",
                "organizations_url": "https://api.github.com/users/Flameeyes/orgs",
                "received_events_url": "https://api.github.com/users/Flameeyes/received_events",
                "repos_url": "https://api.github.com/users/Flameeyes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Flameeyes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Flameeyes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Flameeyes"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3488/comments",
    "created_at": "2020-04-04T13:52:42Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/74834?v=4",
                "events_url": "https://api.github.com/users/Flameeyes/events{/privacy}",
                "followers_url": "https://api.github.com/users/Flameeyes/followers",
                "following_url": "https://api.github.com/users/Flameeyes/following{/other_user}",
                "gists_url": "https://api.github.com/users/Flameeyes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Flameeyes",
                "id": 74834,
                "login": "Flameeyes",
                "node_id": "MDQ6VXNlcjc0ODM0",
                "organizations_url": "https://api.github.com/users/Flameeyes/orgs",
                "received_events_url": "https://api.github.com/users/Flameeyes/received_events",
                "repos_url": "https://api.github.com/users/Flameeyes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Flameeyes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Flameeyes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Flameeyes"
            },
            "commit_id": "a887d0cf3ff3e8559215991081197104df034763",
            "commit_url": "https://api.github.com/repos/Flameeyes/python-scsi/commits/a887d0cf3ff3e8559215991081197104df034763",
            "created_at": "2020-04-04T13:55:46Z",
            "event": "referenced",
            "id": 3200065682,
            "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMDAwNjU2ODI=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3200065682"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/74834?v=4",
                "events_url": "https://api.github.com/users/Flameeyes/events{/privacy}",
                "followers_url": "https://api.github.com/users/Flameeyes/followers",
                "following_url": "https://api.github.com/users/Flameeyes/following{/other_user}",
                "gists_url": "https://api.github.com/users/Flameeyes/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Flameeyes",
                "id": 74834,
                "login": "Flameeyes",
                "node_id": "MDQ6VXNlcjc0ODM0",
                "organizations_url": "https://api.github.com/users/Flameeyes/orgs",
                "received_events_url": "https://api.github.com/users/Flameeyes/received_events",
                "repos_url": "https://api.github.com/users/Flameeyes/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Flameeyes/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Flameeyes/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Flameeyes"
            },
            "commit_id": "8231b1c29b670f067986ad5566df1c0b3cfaca0d",
            "commit_url": "https://api.github.com/repos/Flameeyes/cython-iscsi/commits/8231b1c29b670f067986ad5566df1c0b3cfaca0d",
            "created_at": "2020-04-04T16:01:18Z",
            "event": "referenced",
            "id": 3200218780,
            "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMDAyMTg3ODA=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3200218780"
        },
        {
            "actor": {
                "avatar_url": "https://avatars1.githubusercontent.com/in/10562?v=4",
                "events_url": "https://api.github.com/users/mergify%5Bbot%5D/events{/privacy}",
                "followers_url": "https://api.github.com/users/mergify%5Bbot%5D/followers",
                "following_url": "https://api.github.com/users/mergify%5Bbot%5D/following{/other_user}",
                "gists_url": "https://api.github.com/users/mergify%5Bbot%5D/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/apps/mergify",
                "id": 37929162,
                "login": "mergify[bot]",
                "node_id": "MDM6Qm90Mzc5MjkxNjI=",
                "organizations_url": "https://api.github.com/users/mergify%5Bbot%5D/orgs",
                "received_events_url": "https://api.github.com/users/mergify%5Bbot%5D/received_events",
                "repos_url": "https://api.github.com/users/mergify%5Bbot%5D/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mergify%5Bbot%5D/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mergify%5Bbot%5D/subscriptions",
                "type": "Bot",
                "url": "https://api.github.com/users/mergify%5Bbot%5D"
            },
            "commit_id": "fae97b5c8dfa956634f40903b9835cfa6a53ad3a",
            "commit_url": "https://api.github.com/repos/python-scsi/cython-iscsi/commits/fae97b5c8dfa956634f40903b9835cfa6a53ad3a",
            "created_at": "2020-04-04T16:23:12Z",
            "event": "referenced",
            "id": 3200239106,
            "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMDAyMzkxMDY=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3200239106"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3488/events",
    "html_url": "https://github.com/cython/cython/issues/3488",
    "id": 593872950,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3488/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1OTM4NzI5NTA=",
    "number": 3488,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Python `bytearray` not accepted for Cython `bytes` argument",
    "updated_at": "2020-04-04T16:06:39Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3488",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/74834?v=4",
        "events_url": "https://api.github.com/users/Flameeyes/events{/privacy}",
        "followers_url": "https://api.github.com/users/Flameeyes/followers",
        "following_url": "https://api.github.com/users/Flameeyes/following{/other_user}",
        "gists_url": "https://api.github.com/users/Flameeyes/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Flameeyes",
        "id": 74834,
        "login": "Flameeyes",
        "node_id": "MDQ6VXNlcjc0ODM0",
        "organizations_url": "https://api.github.com/users/Flameeyes/orgs",
        "received_events_url": "https://api.github.com/users/Flameeyes/received_events",
        "repos_url": "https://api.github.com/users/Flameeyes/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Flameeyes/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Flameeyes/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Flameeyes"
    }
}