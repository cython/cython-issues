{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\n\nIt seems that Cython arrays do not report their size correctly.\n\nWhile this is not strictly a bug (the [spec](https://docs.python.org/3/library/sys.html) of `sys.getsizeof` indicates that extensions might not have `__sizeof__` implemented and thus report a wrong size), I believe this can almost qualify as one.\n\n\n\n\n### Code to reproduce the behaviour:\n\n\n```cython\nfrom cpython cimport array\nfrom cython.view cimport array as cvarray\nimport numpy as np\nimport sys\n\na = array.array('i', [0]*1000_000)\nb = cvarray(shape=(1000_000,), itemsize=sizeof(int), format=\"i\")\nc = np.empty([1000_1000], dtype=np.uint32)\n\nprint(sys.getsizeof(a), sys.getsizeof(b), sys.getsizeof(c))\n```\n\nReports `4000080 112 40004112`\n\n### Expected behaviour\n\nIt should report the size of the allocation when it owns it.\n\n### OS\n\n_No response_\n\n### Python version\n\n3.12\n\n### Cython version\n\n3.1.1\n\n### Additional context\n\nI found this issue while investigating a leak, printing the size of all objects the gc knows. It was surprised to not see the Cython arrays among the top items. In the end the leak turned out to be due to not enough gc collections.\n\nI use Cython arrays for my extensions rather than numpy arrays since I do not want to link to numpy.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "That does seem reasonable for owned arrays\n\nIt should be relatively easy to implement -  it's just defined as a `cdef class` in the Cython utility code https://github.com/cython/cython/blob/4b7cb2e7b0b8eb97863d1df01145b02fd3f90212/Cython/Utility/MemoryView.pyx#L112",
            "created_at": "2025-08-04T19:04:02Z",
            "html_url": "https://github.com/cython/cython/issues/7073#issuecomment-3152009938",
            "id": 3152009938,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7073",
            "node_id": "IC_kwDOABDGAc6739rS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3152009938/reactions"
            },
            "updated_at": "2025-08-04T19:04:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3152009938",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Would there be interest in providing more methods as well ?\n\nCython arrays are perfect to avoid linking or requiring numpy, but they have a some small limitations which prevent them to be a complete replacement for multidimensional data container. I'd be willing to work on and contribute a more complete implementation (which wouldn't add overhead of course).",
            "created_at": "2025-08-09T19:30:12Z",
            "html_url": "https://github.com/cython/cython/issues/7073#issuecomment-3172053316",
            "id": 3172053316,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7073",
            "node_id": "IC_kwDOABDGAc69EbFE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3172053316/reactions"
            },
            "updated_at": "2025-08-09T19:30:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3172053316",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2546609?v=4",
                "events_url": "https://api.github.com/users/axeldavy/events{/privacy}",
                "followers_url": "https://api.github.com/users/axeldavy/followers",
                "following_url": "https://api.github.com/users/axeldavy/following{/other_user}",
                "gists_url": "https://api.github.com/users/axeldavy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/axeldavy",
                "id": 2546609,
                "login": "axeldavy",
                "node_id": "MDQ6VXNlcjI1NDY2MDk=",
                "organizations_url": "https://api.github.com/users/axeldavy/orgs",
                "received_events_url": "https://api.github.com/users/axeldavy/received_events",
                "repos_url": "https://api.github.com/users/axeldavy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/axeldavy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/axeldavy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/axeldavy",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I'd be willing to work on and contribute a more complete implementation\n\nI think the question is \"what\"?  I definitely wouldn't want to reimplement the Numpy array/matrix maths type of operations.  But small usability stuff could definitely be considered.\n\n> (which wouldn't add overhead of course).\n\nThe main overhead I'd be worried about is probably compile-time. This code gets bundled into a lot of files and it's already fairly slow to compile (although the recent \"shared module\" feature helps with that a bit). Again - that's implying that we shouldn't add anything too big.",
            "created_at": "2025-08-09T19:37:49Z",
            "html_url": "https://github.com/cython/cython/issues/7073#issuecomment-3172056731",
            "id": 3172056731,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7073",
            "node_id": "IC_kwDOABDGAc69Eb6b",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3172056731/reactions"
            },
            "updated_at": "2025-08-09T19:37:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3172056731",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "On top of my mind, I can't recall exactly what feature I missed the most. I remember several times having to \"np.asarray\" the cython buffers just to make code work. I'll investigate exactly which (probably some related to the buffer protocol), but on top of them, I'm thinking very basic operations like copy() (which is useful to make live caches), basic indexing (slicing). A nice to have, though I would understand you'd not be too fond of it, would be basic operations like `+-/*` and `*= += /=` with array of same size or scalar.",
            "created_at": "2025-08-09T19:48:45Z",
            "html_url": "https://github.com/cython/cython/issues/7073#issuecomment-3172060988",
            "id": 3172060988,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7073",
            "node_id": "IC_kwDOABDGAc69Ec88",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3172060988/reactions"
            },
            "updated_at": "2025-08-09T19:49:12Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3172060988",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2546609?v=4",
                "events_url": "https://api.github.com/users/axeldavy/events{/privacy}",
                "followers_url": "https://api.github.com/users/axeldavy/followers",
                "following_url": "https://api.github.com/users/axeldavy/following{/other_user}",
                "gists_url": "https://api.github.com/users/axeldavy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/axeldavy",
                "id": 2546609,
                "login": "axeldavy",
                "node_id": "MDQ6VXNlcjI1NDY2MDk=",
                "organizations_url": "https://api.github.com/users/axeldavy/orgs",
                "received_events_url": "https://api.github.com/users/axeldavy/received_events",
                "repos_url": "https://api.github.com/users/axeldavy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/axeldavy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/axeldavy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/axeldavy",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Based on a quick look, it seems like they should have slicing (although I haven't tested it mysef recently).\n\n`copy()` sees reasonable although you do need to define what it should mean for arrays that aren't allocated by Cython (probably just create one with the same shape, but maybe different strides, that is allocated by Cython?).\n\n------------------------------\n\nAs an aside - I think you can inherit from the class, which does give you an easy way to extend it beyond what Cython provides by default.",
            "created_at": "2025-08-09T20:07:39Z",
            "html_url": "https://github.com/cython/cython/issues/7073#issuecomment-3172069384",
            "id": 3172069384,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/7073",
            "node_id": "IC_kwDOABDGAc69EfAI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/cython/cython/issues/comments/3172069384/reactions"
            },
            "updated_at": "2025-08-09T20:07:39Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/3172069384",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/7073/comments",
    "created_at": "2025-08-04T11:57:46Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/7073/events",
    "html_url": "https://github.com/cython/cython/issues/7073",
    "id": 3289137114,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/7073/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOABDGAc7EDD_a",
    "number": 7073,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/cython/cython/issues/7073/reactions"
    },
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/cython/cython/issues/7073/timeline",
    "title": "[BUG] Cython array reports wrong size",
    "type": null,
    "updated_at": "2025-08-09T20:07:39Z",
    "url": "https://api.github.com/repos/cython/cython/issues/7073",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2546609?v=4",
        "events_url": "https://api.github.com/users/axeldavy/events{/privacy}",
        "followers_url": "https://api.github.com/users/axeldavy/followers",
        "following_url": "https://api.github.com/users/axeldavy/following{/other_user}",
        "gists_url": "https://api.github.com/users/axeldavy/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/axeldavy",
        "id": 2546609,
        "login": "axeldavy",
        "node_id": "MDQ6VXNlcjI1NDY2MDk=",
        "organizations_url": "https://api.github.com/users/axeldavy/orgs",
        "received_events_url": "https://api.github.com/users/axeldavy/received_events",
        "repos_url": "https://api.github.com/users/axeldavy/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/axeldavy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/axeldavy/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/axeldavy",
        "user_view_type": "public"
    }
}