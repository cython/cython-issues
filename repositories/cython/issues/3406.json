{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Disabling the `cache_builtins` option in setup.py:\r\n```\r\nOptions.cache_builtins = False\r\n```\r\ncauses code that uses `MemoryView` to fail to compile:\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    if not is_slice:\r\n\r\n        if start < 0:\r\n            start += shape\r\n        if not 0 <= start < shape:\r\n            _err_dim(IndexError, \"Index out of bounds (axis %d)\", dim)\r\n                    ^\r\n------------------------------------------------------------\r\n\r\nView.MemoryView:832:21: Accessing Python global or builtin not allowed without gil\r\n```\r\n\r\n(There are several such errors building the file, all stemming from doing a lookup on the exception type without the GIL held.)\r\n\r\nTo fix this, the GIL should be locked before calling _err_dim.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "I've done this a tiny bit differently to how you've suggested, since I think the whole point of `_err_dim` was avoiding writing duplicate `with gil:` code but the basic diagnosis was good.",
            "created_at": "2020-03-11T16:19:53Z",
            "html_url": "https://github.com/cython/cython/issues/3406#issuecomment-597729419",
            "id": 597729419,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3406",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzcyOTQxOQ==",
            "updated_at": "2020-03-11T16:19:53Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/597729419",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        },
        {
            "author_association": "NONE",
            "body": "Great, thanks for the quick turnaround! Your way will prevent someone from mocking `ValueError`, but on the other hand I can't see anyone wanting to actually _do_ that, so it should work!",
            "created_at": "2020-03-11T16:23:30Z",
            "html_url": "https://github.com/cython/cython/issues/3406#issuecomment-597731513",
            "id": 597731513,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3406",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzczMTUxMw==",
            "updated_at": "2020-03-11T16:23:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/597731513",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/3952613?v=4",
                "events_url": "https://api.github.com/users/thirtythreeforty/events{/privacy}",
                "followers_url": "https://api.github.com/users/thirtythreeforty/followers",
                "following_url": "https://api.github.com/users/thirtythreeforty/following{/other_user}",
                "gists_url": "https://api.github.com/users/thirtythreeforty/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/thirtythreeforty",
                "id": 3952613,
                "login": "thirtythreeforty",
                "node_id": "MDQ6VXNlcjM5NTI2MTM=",
                "organizations_url": "https://api.github.com/users/thirtythreeforty/orgs",
                "received_events_url": "https://api.github.com/users/thirtythreeforty/received_events",
                "repos_url": "https://api.github.com/users/thirtythreeforty/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/thirtythreeforty/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/thirtythreeforty/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/thirtythreeforty"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Your way will prevent someone from mocking ValueError, but on the other hand I can't see anyone wanting to actually do that, so it should work\r\n\r\nI was just adding a comment to that effect in the PR description when you replied:\r\n\r\n>I guess this slightly breaks the contract of the cache_builtins option, that you should be able to monkey-patch builtin stuff (including exceptions). With that said - it's an implementation detail that it's written in Cython. If it was written in C then it'd just use the standard exception definitions in the headers and the user wouldn't be able to change them anyway.\r\n\r\nI think the \"implementation detail\" excuse makes it OK but we'll see if it makes it past review...",
            "created_at": "2020-03-11T16:29:26Z",
            "html_url": "https://github.com/cython/cython/issues/3406#issuecomment-597734757",
            "id": 597734757,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/3406",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzczNDc1Nw==",
            "updated_at": "2020-03-11T16:29:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/597734757",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3406/comments",
    "created_at": "2020-03-10T16:50:29Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/10536947?v=4",
                "events_url": "https://api.github.com/users/da-woods/events{/privacy}",
                "followers_url": "https://api.github.com/users/da-woods/followers",
                "following_url": "https://api.github.com/users/da-woods/following{/other_user}",
                "gists_url": "https://api.github.com/users/da-woods/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/da-woods",
                "id": 10536947,
                "login": "da-woods",
                "node_id": "MDQ6VXNlcjEwNTM2OTQ3",
                "organizations_url": "https://api.github.com/users/da-woods/orgs",
                "received_events_url": "https://api.github.com/users/da-woods/received_events",
                "repos_url": "https://api.github.com/users/da-woods/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/da-woods/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/da-woods/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/da-woods"
            },
            "commit_id": "38a1c1292062bf48482197d1b14f7c379a5e883b",
            "commit_url": "https://api.github.com/repos/da-woods/cython/commits/38a1c1292062bf48482197d1b14f7c379a5e883b",
            "created_at": "2020-03-11T16:16:23Z",
            "event": "referenced",
            "id": 3119533559,
            "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMxMTk1MzM1NTk=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/3119533559"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/3406/events",
    "html_url": "https://github.com/cython/cython/issues/3406",
    "id": 578721837,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/3406/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1Nzg3MjE4Mzc=",
    "number": 3406,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "MemoryView implementation incompatible with Options.cache_builtins = False",
    "updated_at": "2020-03-11T16:29:27Z",
    "url": "https://api.github.com/repos/cython/cython/issues/3406",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/3952613?v=4",
        "events_url": "https://api.github.com/users/thirtythreeforty/events{/privacy}",
        "followers_url": "https://api.github.com/users/thirtythreeforty/followers",
        "following_url": "https://api.github.com/users/thirtythreeforty/following{/other_user}",
        "gists_url": "https://api.github.com/users/thirtythreeforty/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/thirtythreeforty",
        "id": 3952613,
        "login": "thirtythreeforty",
        "node_id": "MDQ6VXNlcjM5NTI2MTM=",
        "organizations_url": "https://api.github.com/users/thirtythreeforty/orgs",
        "received_events_url": "https://api.github.com/users/thirtythreeforty/received_events",
        "repos_url": "https://api.github.com/users/thirtythreeforty/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/thirtythreeforty/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/thirtythreeforty/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/thirtythreeforty"
    }
}