{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/cython/cython/issues/3021/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/cython/cython/pulls/3021/commits"
        },
        "html": {
            "href": "https://github.com/cython/cython/pull/3021"
        },
        "issue": {
            "href": "https://api.github.com/repos/cython/cython/issues/3021"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/cython/cython/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/cython/cython/pulls/3021/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/cython/cython/pulls/3021"
        },
        "statuses": {
            "href": "https://api.github.com/repos/cython/cython/statuses/a97b539143dbe972ad0c8521d9fd56a9a32969e3"
        }
    },
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "base": {
        "label": "cython:master",
        "ref": "master",
        "repo": {
            "archive_url": "https://api.github.com/repos/cython/cython/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/cython/cython/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/cython/cython/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/cython/cython/branches{/branch}",
            "clone_url": "https://github.com/cython/cython.git",
            "collaborators_url": "https://api.github.com/repos/cython/cython/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/cython/cython/comments{/number}",
            "commits_url": "https://api.github.com/repos/cython/cython/commits{/sha}",
            "compare_url": "https://api.github.com/repos/cython/cython/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/cython/cython/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/cython/cython/contributors",
            "created_at": "2010-11-21T07:44:20Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/cython/cython/deployments",
            "description": "The most widely used Python to C compiler",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/cython/cython/downloads",
            "events_url": "https://api.github.com/repos/cython/cython/events",
            "fork": false,
            "forks": 874,
            "forks_count": 874,
            "forks_url": "https://api.github.com/repos/cython/cython/forks",
            "full_name": "cython/cython",
            "git_commits_url": "https://api.github.com/repos/cython/cython/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/cython/cython/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/cython/cython/git/tags{/sha}",
            "git_url": "git://github.com/cython/cython.git",
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://cython.org",
            "hooks_url": "https://api.github.com/repos/cython/cython/hooks",
            "html_url": "https://github.com/cython/cython",
            "id": 1099265,
            "issue_comment_url": "https://api.github.com/repos/cython/cython/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/cython/cython/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/cython/cython/issues{/number}",
            "keys_url": "https://api.github.com/repos/cython/cython/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/cython/cython/labels{/name}",
            "language": "Python",
            "languages_url": "https://api.github.com/repos/cython/cython/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/cython/cython/merges",
            "milestones_url": "https://api.github.com/repos/cython/cython/milestones{/number}",
            "mirror_url": null,
            "name": "cython",
            "node_id": "MDEwOlJlcG9zaXRvcnkxMDk5MjY1",
            "notifications_url": "https://api.github.com/repos/cython/cython/notifications{?since,all,participating}",
            "open_issues": 683,
            "open_issues_count": 683,
            "owner": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486082?v=4",
                "events_url": "https://api.github.com/users/cython/events{/privacy}",
                "followers_url": "https://api.github.com/users/cython/followers",
                "following_url": "https://api.github.com/users/cython/following{/other_user}",
                "gists_url": "https://api.github.com/users/cython/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cython",
                "id": 486082,
                "login": "cython",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ4NjA4Mg==",
                "organizations_url": "https://api.github.com/users/cython/orgs",
                "received_events_url": "https://api.github.com/users/cython/received_events",
                "repos_url": "https://api.github.com/users/cython/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cython/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cython/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/cython"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/cython/cython/pulls{/number}",
            "pushed_at": "2019-08-22T14:01:50Z",
            "releases_url": "https://api.github.com/repos/cython/cython/releases{/id}",
            "size": 55184,
            "ssh_url": "git@github.com:cython/cython.git",
            "stargazers_count": 4308,
            "stargazers_url": "https://api.github.com/repos/cython/cython/stargazers",
            "statuses_url": "https://api.github.com/repos/cython/cython/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/cython/cython/subscribers",
            "subscription_url": "https://api.github.com/repos/cython/cython/subscription",
            "svn_url": "https://github.com/cython/cython",
            "tags_url": "https://api.github.com/repos/cython/cython/tags",
            "teams_url": "https://api.github.com/repos/cython/cython/teams",
            "trees_url": "https://api.github.com/repos/cython/cython/git/trees{/sha}",
            "updated_at": "2019-08-22T14:03:27Z",
            "url": "https://api.github.com/repos/cython/cython",
            "watchers": 4308,
            "watchers_count": 4308
        },
        "sha": "0ab70ccae4dbdc20aabf718db63440e4dc874915",
        "user": {
            "avatar_url": "https://avatars3.githubusercontent.com/u/486082?v=4",
            "events_url": "https://api.github.com/users/cython/events{/privacy}",
            "followers_url": "https://api.github.com/users/cython/followers",
            "following_url": "https://api.github.com/users/cython/following{/other_user}",
            "gists_url": "https://api.github.com/users/cython/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/cython",
            "id": 486082,
            "login": "cython",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ4NjA4Mg==",
            "organizations_url": "https://api.github.com/users/cython/orgs",
            "received_events_url": "https://api.github.com/users/cython/received_events",
            "repos_url": "https://api.github.com/users/cython/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/cython/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/cython/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/cython"
        }
    },
    "body": "Work in progress",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316358923"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316358923"
                }
            },
            "author_association": "MEMBER",
            "body": "Please use a `//` comment here so that it doesn't get copied into the generated code file. (`/*â€¦*/` comments are not discarded when they span multiple lines)",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:17:34Z",
            "diff_hunk": "@@ -126,26 +126,43 @@ static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name\n //  function that does not accept them.\n \n static int __Pyx_CheckKeywordStrings(\n-    PyObject *kwdict,\n+    PyObject *kw,  // dict (for METH_VARARGS) or tuple (for METH_FASTCALL)\n     const char* function_name,\n     int kw_allowed)\n {\n     PyObject* key = 0;\n     Py_ssize_t pos = 0;\n #if CYTHON_COMPILING_IN_PYPY\n     /* PyPy appears to check keywords at call time, not at unpacking time => not much to do here */\n-    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))\n+    if (!kw_allowed && PyDict_Next(kw, &pos, &key, 0))\n         goto invalid_keyword;\n     return 1;\n #else\n-    while (PyDict_Next(kwdict, &pos, &key, 0)) {\n+    if (CYTHON_METH_FASTCALL && PyTuple_Check(kw)) {\n+        if (unlikely(PyTuple_GET_SIZE(kw) == 0))\n+            return 1;\n+        if (!kw_allowed)\n+            goto invalid_keyword;\n+#if PY_VERSION_HEX < 0x03090000\n+        /* On CPython >= 3.9, the FASTCALL protocol guarantees that keyword\n+         * names are strings (see https://bugs.python.org/issue37540) */",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316358923",
            "id": 316358923,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM1ODkyMw==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 35,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 35,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316358923",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316359404"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316359404"
                }
            },
            "author_association": "MEMBER",
            "body": "Sad, but at least explicit.",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:18:48Z",
            "diff_hunk": "@@ -1935,6 +1937,9 @@ def _synthesize_assignment(self, node, env):\n             rhs.binding = True\n \n         node.is_cyfunction = rhs.binding\n+        if rhs.binding:\n+            # For the moment, CyFunctions do not support METH_FASTCALL",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316359404",
            "id": 316359404,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM1OTQwNA==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 14,
            "path": "Cython/Compiler/ParseTreeTransforms.py",
            "position": 14,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316359404",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316360157"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316360157"
                }
            },
            "author_association": "MEMBER",
            "body": "`key` is only `unlikely()` when `!kw_allowed`. Otherwise, I'd not take a guess.",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:20:33Z",
            "diff_hunk": "@@ -126,26 +126,43 @@ static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name\n //  function that does not accept them.\n \n static int __Pyx_CheckKeywordStrings(\n-    PyObject *kwdict,\n+    PyObject *kw,  // dict (for METH_VARARGS) or tuple (for METH_FASTCALL)\n     const char* function_name,\n     int kw_allowed)\n {\n     PyObject* key = 0;\n     Py_ssize_t pos = 0;\n #if CYTHON_COMPILING_IN_PYPY\n     /* PyPy appears to check keywords at call time, not at unpacking time => not much to do here */\n-    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))\n+    if (!kw_allowed && PyDict_Next(kw, &pos, &key, 0))\n         goto invalid_keyword;\n     return 1;\n #else\n-    while (PyDict_Next(kwdict, &pos, &key, 0)) {\n+    if (CYTHON_METH_FASTCALL && PyTuple_Check(kw)) {\n+        if (unlikely(PyTuple_GET_SIZE(kw) == 0))\n+            return 1;\n+        if (!kw_allowed)\n+            goto invalid_keyword;\n+#if PY_VERSION_HEX < 0x03090000\n+        /* On CPython >= 3.9, the FASTCALL protocol guarantees that keyword\n+         * names are strings (see https://bugs.python.org/issue37540) */\n+        for (pos = 0; pos < PyTuple_GET_SIZE(kw); pos++) {\n+            key = PyTuple_GET_ITEM(kw, pos);\n+            if (unlikely(!PyUnicode_Check(key)))\n+                goto invalid_keyword_type;\n+        }\n+#endif\n+        return 1;\n+    }\n+\n+    while (PyDict_Next(kw, &pos, &key, 0)) {\n         #if PY_MAJOR_VERSION < 3\n         if (unlikely(!PyString_Check(key)))\n         #endif\n             if (unlikely(!PyUnicode_Check(key)))\n                 goto invalid_keyword_type;\n     }\n-    if ((!kw_allowed) && unlikely(key))\n+    if (unlikely(key) && !kw_allowed)",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316360157",
            "id": 316360157,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM2MDE1Nw==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 53,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 53,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316360157",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316362575"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316362575"
                }
            },
            "author_association": "MEMBER",
            "body": "I wonder if it would be worth letting the caller pass a constant flag to distinguish the two cases, rather than splitting them at runtime. Could allow the C compiler to do some better magic. Then again, today's CPUs would probably handle the runtime tests quite fineâ€¦",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:26:42Z",
            "diff_hunk": "@@ -201,7 +225,18 @@ static int __Pyx_ParseOptionalKeywords(\n     PyObject*** name;\n     PyObject*** first_kw_arg = argnames + num_pos_args;\n \n-    while (PyDict_Next(kwds, &pos, &key, &value)) {\n+    while (1) {\n+        if (CYTHON_METH_FASTCALL && PyTuple_Check(kwds)) {",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316362575",
            "id": 316362575,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM2MjU3NQ==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 111,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 111,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316362575",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316364015"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316364015"
                }
            },
            "author_association": "MEMBER",
            "body": "It's probably worth running a tight loop with only object pointer comparisons first. Keyword names are almost always interned. If comparisons are really needed as fallback, there is also an inlined `__Pyx_PyUnicode_Equals()` function in `StringTools.c`, although I guess that case is less relevant in practice.",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:30:25Z",
            "diff_hunk": "@@ -350,3 +386,67 @@ static int __Pyx_MergeKeywords(PyObject *kwdict, PyObject *source_mapping) {\n     Py_XDECREF(iter);\n     return -1;\n }\n+\n+\n+/////////////// fastcall.proto ///////////////\n+\n+// We define various functions and macros with two variants:\n+//..._FASTCALL and ..._VARARGS\n+\n+// The first is used when METH_FASTCALL is enabled and the second is used\n+// otherwise. If the Python implementation does not support METH_FASTCALL\n+// (because it's an old version of CPython or it's not CPython at all),\n+// then the ..._FASTCALL macros simply alias ..._VARARGS\n+\n+#define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)\n+#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)\n+#define __Pyx_KwValues_VARARGS(args, nargs) NULL\n+#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStr(kw, s)\n+#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)\n+#if CYTHON_METH_FASTCALL\n+    #define __Pyx_Arg_FASTCALL(args, i) args[i]\n+    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)\n+    #define __Pyx_KwValues_FASTCALL(args, nargs) (&args[nargs])\n+    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);\n+    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)\n+#else\n+    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS\n+    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS\n+    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS\n+    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS\n+    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS\n+#endif\n+\n+#if CYTHON_COMPILING_IN_CPYTHON\n+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)\n+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)\n+#else\n+/* Not CPython, so certainly no METH_FASTCALL support */\n+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)\n+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)\n+#endif\n+\n+\n+/////////////// fastcall ///////////////\n+//@requires: ObjectHandling.c::TupleAndListFromArray\n+\n+#if CYTHON_METH_FASTCALL\n+// kwnames: tuple with names of keyword arguments\n+// kwvalues: C array with values of keyword arguments\n+// s: str with the keyword name to look for\n+static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s)\n+{\n+    Py_ssize_t i;\n+    for (i = 0; i < PyTuple_GET_SIZE(kwnames); i++)\n+    {\n+        PyObject *cmp = PyUnicode_RichCompare(s, PyTuple_GET_ITEM(kwnames, i), Py_EQ);",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316364015",
            "id": 316364015,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM2NDAxNQ==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 196,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 196,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316364015",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316368402"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316368402"
                }
            },
            "author_association": "MEMBER",
            "body": "If you put the comment in a separate line, it will not be copied into the output.",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:42:10Z",
            "diff_hunk": "@@ -126,26 +126,43 @@ static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name\n //  function that does not accept them.\n \n static int __Pyx_CheckKeywordStrings(\n-    PyObject *kwdict,\n+    PyObject *kw,  // dict (for METH_VARARGS) or tuple (for METH_FASTCALL)",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316368402",
            "id": 316368402,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM2ODQwMg==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 14,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 14,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316368402",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316371428"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316371428"
                }
            },
            "author_association": "MEMBER",
            "body": "I wonder if a method like `.as_fastcall_signature()` on signature objects might be a good idea, rather than the copying here. Don't know.",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:50:15Z",
            "diff_hunk": "@@ -3093,6 +3093,36 @@ def analyse_signature(self, env):\n                 if arg.is_generic and (arg.type.is_extension_type or arg.type.is_builtin_type):\n                     arg.needs_type_test = 1\n \n+        # Decide whether to use METH_FASTCALL\n+        # 1. If we use METH_NOARGS or METH_O, keep that. We can only change\n+        #    METH_VARARGS to METH_FASTCALL\n+        # 2. Special methods like __call__ always use the METH_VARGARGS\n+        #    calling convention\n+        # 3. For the moment, CyFunctions do not support METH_FASTCALL\n+        mf = sig.method_flags()\n+        if (mf and TypeSlots.method_varargs in mf and\n+                not self.entry.is_special and not self.is_cyfunction):\n+            # 4. If the function uses the full args tuple, it's more\n+            #    efficient to use METH_VARARGS. This happens when the function\n+            #    takes *args but no other positional arguments (apart from\n+            #    possibly self). We don't do the analogous check for keyword\n+            #    arguments since the kwargs dict is copied anyway.\n+            if self.star_arg:\n+                uses_args_tuple = True\n+                for arg in self.args:\n+                    if (arg.is_generic and not arg.kw_only and\n+                            not arg.is_self_arg and not arg.is_type_arg):\n+                        # Other positional argument\n+                        uses_args_tuple = False\n+            else:\n+                uses_args_tuple = False\n+\n+            if not uses_args_tuple:\n+                # We need to copy the signature since it may be a global\n+                # constant like TypeSlots.pyfunction_signature\n+                sig = self.entry.signature = copy.copy(sig)\n+                sig.use_fastcall = True",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316371428",
            "id": 316371428,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM3MTQyOA==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 32,
            "path": "Cython/Compiler/Nodes.py",
            "position": 32,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316371428",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316373652"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316373652"
                }
            },
            "author_association": "MEMBER",
            "body": "Would it make sense to store these two signature strings as constants somewhere? Maybe even in the signature objects? Or at least get the right one directly from the signature object, based on its `self.use_fastcall`?",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T19:55:43Z",
            "diff_hunk": "@@ -3453,9 +3483,16 @@ def generate_function_header(self, code, with_pymethdef, proto_only=0):\n         if entry.scope.is_c_class_scope and entry.name == \"__ipow__\":\n             arg_code_list.append(\"CYTHON_UNUSED PyObject *unused\")\n         if sig.has_generic_args:\n-            arg_code_list.append(\n-                \"PyObject *%s, PyObject *%s\" % (\n-                    Naming.args_cname, Naming.kwds_cname))\n+            varargs_args = \"PyObject *%s, PyObject *%s\" % (\n+                    Naming.args_cname, Naming.kwds_cname)\n+            if sig.use_fastcall:\n+                fastcall_args = \"PyObject *const *%s, Py_ssize_t %s, PyObject *%s\" % (\n+                        Naming.args_cname, Naming.nargs_cname, Naming.kwds_cname)",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316373652",
            "id": 316373652,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM3MzY1Mg==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 48,
            "path": "Cython/Compiler/Nodes.py",
            "position": 48,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:03Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316373652",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316375544"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316375544"
                }
            },
            "author_association": "MEMBER",
            "body": "Note that this defeats the auto-indentation. Why not generate 3 separate lines?",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T20:00:11Z",
            "diff_hunk": "@@ -3518,8 +3555,18 @@ def generate_argument_declarations(self, env, code):\n \n         # Assign nargs variable as len(args), but avoid an \"unused\" warning in the few cases where we don't need it.\n         if self.signature_has_generic_args():\n-            code.putln(\"CYTHON_UNUSED const Py_ssize_t %s = PyTuple_GET_SIZE(%s);\" % (\n-                Naming.nargs_cname, Naming.args_cname))\n+            nargs_code = \"CYTHON_UNUSED const Py_ssize_t %s = PyTuple_GET_SIZE(%s);\" % (\n+                        Naming.nargs_cname, Naming.args_cname)\n+            if self.signature.use_fastcall:\n+                code.putln(\"#if !CYTHON_METH_FASTCALL\\n%s\\n#endif\" % nargs_code)",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316375544",
            "id": 316375544,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM3NTU0NA==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 66,
            "path": "Cython/Compiler/Nodes.py",
            "position": 66,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:04Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316375544",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316379588"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316379588"
                }
            },
            "author_association": "MEMBER",
            "body": "I actually wonder if this is really unlikely enough to merit a branch hint. Maybe we should remove it? (Ok, that's a bit unrelated to this PRâ€¦)",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-21T20:09:59Z",
            "diff_hunk": "@@ -3723,13 +3776,16 @@ def generate_tuple_and_keyword_parsing_code(self, args, success_label, code):\n         if accept_kwd_args:\n             kw_unpacking_condition = Naming.kwds_cname\n         else:\n-            kw_unpacking_condition = \"%s && PyDict_Size(%s) > 0\" % (\n-                Naming.kwds_cname, Naming.kwds_cname)\n+            kw_unpacking_condition = \"%s && __Pyx_NumKwargs_%s(%s) > 0\" % (\n+                Naming.kwds_cname, self.signature.fastvar, Naming.kwds_cname)\n+\n+        if self.num_required_kw_args > 0:\n+            kw_unpacking_condition = \"likely(%s)\" % kw_unpacking_condition\n+        else:\n+            kw_unpacking_condition = \"unlikely(%s)\" % kw_unpacking_condition",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316379588",
            "id": 316379588,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjM3OTU4OA==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 174,
            "path": "Cython/Compiler/Nodes.py",
            "position": 174,
            "pull_request_review_id": 278017546,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-21T20:17:04Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316379588",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316610590"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316610590"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "OK, got it. I'm reverting this.",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-22T10:44:40Z",
            "diff_hunk": "@@ -126,26 +126,43 @@ static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name\n //  function that does not accept them.\n \n static int __Pyx_CheckKeywordStrings(\n-    PyObject *kwdict,\n+    PyObject *kw,  // dict (for METH_VARARGS) or tuple (for METH_FASTCALL)\n     const char* function_name,\n     int kw_allowed)\n {\n     PyObject* key = 0;\n     Py_ssize_t pos = 0;\n #if CYTHON_COMPILING_IN_PYPY\n     /* PyPy appears to check keywords at call time, not at unpacking time => not much to do here */\n-    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))\n+    if (!kw_allowed && PyDict_Next(kw, &pos, &key, 0))\n         goto invalid_keyword;\n     return 1;\n #else\n-    while (PyDict_Next(kwdict, &pos, &key, 0)) {\n+    if (CYTHON_METH_FASTCALL && PyTuple_Check(kw)) {\n+        if (unlikely(PyTuple_GET_SIZE(kw) == 0))\n+            return 1;\n+        if (!kw_allowed)\n+            goto invalid_keyword;\n+#if PY_VERSION_HEX < 0x03090000\n+        /* On CPython >= 3.9, the FASTCALL protocol guarantees that keyword\n+         * names are strings (see https://bugs.python.org/issue37540) */\n+        for (pos = 0; pos < PyTuple_GET_SIZE(kw); pos++) {\n+            key = PyTuple_GET_ITEM(kw, pos);\n+            if (unlikely(!PyUnicode_Check(key)))\n+                goto invalid_keyword_type;\n+        }\n+#endif\n+        return 1;\n+    }\n+\n+    while (PyDict_Next(kw, &pos, &key, 0)) {\n         #if PY_MAJOR_VERSION < 3\n         if (unlikely(!PyString_Check(key)))\n         #endif\n             if (unlikely(!PyUnicode_Check(key)))\n                 goto invalid_keyword_type;\n     }\n-    if ((!kw_allowed) && unlikely(key))\n+    if (unlikely(key) && !kw_allowed)",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316610590",
            "id": 316610590,
            "in_reply_to_id": 316360157,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjYxMDU5MA==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 53,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 53,
            "pull_request_review_id": 278333851,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-22T10:44:40Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316610590",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316613754"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316613754"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Agreed. Keeping the `likely()` in case that kwargs are required?",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-22T10:53:30Z",
            "diff_hunk": "@@ -3723,13 +3776,16 @@ def generate_tuple_and_keyword_parsing_code(self, args, success_label, code):\n         if accept_kwd_args:\n             kw_unpacking_condition = Naming.kwds_cname\n         else:\n-            kw_unpacking_condition = \"%s && PyDict_Size(%s) > 0\" % (\n-                Naming.kwds_cname, Naming.kwds_cname)\n+            kw_unpacking_condition = \"%s && __Pyx_NumKwargs_%s(%s) > 0\" % (\n+                Naming.kwds_cname, self.signature.fastvar, Naming.kwds_cname)\n+\n+        if self.num_required_kw_args > 0:\n+            kw_unpacking_condition = \"likely(%s)\" % kw_unpacking_condition\n+        else:\n+            kw_unpacking_condition = \"unlikely(%s)\" % kw_unpacking_condition",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316613754",
            "id": 316613754,
            "in_reply_to_id": 316379588,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjYxMzc1NA==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 174,
            "path": "Cython/Compiler/Nodes.py",
            "position": 174,
            "pull_request_review_id": 278337745,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-22T10:53:31Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316613754",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/cython/cython/pull/3021#discussion_r316645379"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/3021"
                },
                "self": {
                    "href": "https://api.github.com/repos/cython/cython/pulls/comments/316645379"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I decided not to do that since the `PyTuple_Check(kwds)` call is extremely fast. Given that it's called on an already slow path (parsing keyword arguments), I figured that it wasn't worth the effort to optimize this better.\r\n\r\nOne thing I can do is doing this check just once instead of every loop iteration (the compiler doesn't know that the result of `PyTuple_Check(kwds)` won't change during the loop).",
            "commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "created_at": "2019-08-22T12:18:20Z",
            "diff_hunk": "@@ -201,7 +225,18 @@ static int __Pyx_ParseOptionalKeywords(\n     PyObject*** name;\n     PyObject*** first_kw_arg = argnames + num_pos_args;\n \n-    while (PyDict_Next(kwds, &pos, &key, &value)) {\n+    while (1) {\n+        if (CYTHON_METH_FASTCALL && PyTuple_Check(kwds)) {",
            "html_url": "https://github.com/cython/cython/pull/3021#discussion_r316645379",
            "id": 316645379,
            "in_reply_to_id": 316362575,
            "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjY0NTM3OQ==",
            "original_commit_id": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "original_position": 111,
            "path": "Cython/Utility/FunctionArguments.c",
            "position": 111,
            "pull_request_review_id": 278377188,
            "pull_request_url": "https://api.github.com/repos/cython/cython/pulls/3021",
            "updated_at": "2019-08-22T12:18:20Z",
            "url": "https://api.github.com/repos/cython/cython/pulls/comments/316645379",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/cython/cython/issues/3021/comments",
    "commit_data": [
        {
            "author": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            },
            "comments_url": "https://api.github.com/repos/cython/cython/commits/a97b539143dbe972ad0c8521d9fd56a9a32969e3/comments",
            "commit": {
                "author": {
                    "date": "2019-08-19T13:41:06Z",
                    "email": "jeroen.k.demeyer@gmail.com",
                    "name": "Jeroen Demeyer"
                },
                "comment_count": 0,
                "committer": {
                    "date": "2019-08-21T14:46:24Z",
                    "email": "jeroen.k.demeyer@gmail.com",
                    "name": "Jeroen Demeyer"
                },
                "message": "Use METH_FASTCALL on CPython >= 3.7",
                "tree": {
                    "sha": "52ad07838941dbbf7720407cb1fcee912272214c",
                    "url": "https://api.github.com/repos/cython/cython/git/trees/52ad07838941dbbf7720407cb1fcee912272214c"
                },
                "url": "https://api.github.com/repos/cython/cython/git/commits/a97b539143dbe972ad0c8521d9fd56a9a32969e3",
                "verification": {
                    "payload": null,
                    "reason": "unsigned",
                    "signature": null,
                    "verified": false
                }
            },
            "committer": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            },
            "html_url": "https://github.com/cython/cython/commit/a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "node_id": "MDY6Q29tbWl0Mjk4NTcwMzE6YTk3YjUzOTE0M2RiZTk3MmFkMGM4NTIxZDlmZDU2YTlhMzI5NjllMw==",
            "parents": [
                {
                    "html_url": "https://github.com/cython/cython/commit/0ab70ccae4dbdc20aabf718db63440e4dc874915",
                    "sha": "0ab70ccae4dbdc20aabf718db63440e4dc874915",
                    "url": "https://api.github.com/repos/cython/cython/commits/0ab70ccae4dbdc20aabf718db63440e4dc874915"
                }
            ],
            "sha": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
            "url": "https://api.github.com/repos/cython/cython/commits/a97b539143dbe972ad0c8521d9fd56a9a32969e3"
        }
    ],
    "commits_url": "https://api.github.com/repos/cython/cython/pulls/3021/commits",
    "created_at": "2019-06-28T15:07:31Z",
    "diff_url": "https://github.com/cython/cython/pull/3021.diff",
    "head": {
        "label": "jdemeyer:METH_FASTCALL",
        "ref": "METH_FASTCALL",
        "repo": {
            "archive_url": "https://api.github.com/repos/jdemeyer/cython/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/jdemeyer/cython/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/jdemeyer/cython/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/jdemeyer/cython/branches{/branch}",
            "clone_url": "https://github.com/jdemeyer/cython.git",
            "collaborators_url": "https://api.github.com/repos/jdemeyer/cython/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/jdemeyer/cython/comments{/number}",
            "commits_url": "https://api.github.com/repos/jdemeyer/cython/commits{/sha}",
            "compare_url": "https://api.github.com/repos/jdemeyer/cython/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/jdemeyer/cython/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/jdemeyer/cython/contributors",
            "created_at": "2015-01-26T10:54:42Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/jdemeyer/cython/deployments",
            "description": "A Python to C compiler",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/jdemeyer/cython/downloads",
            "events_url": "https://api.github.com/repos/jdemeyer/cython/events",
            "fork": true,
            "forks": 2,
            "forks_count": 2,
            "forks_url": "https://api.github.com/repos/jdemeyer/cython/forks",
            "full_name": "jdemeyer/cython",
            "git_commits_url": "https://api.github.com/repos/jdemeyer/cython/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/jdemeyer/cython/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/jdemeyer/cython/git/tags{/sha}",
            "git_url": "git://github.com/jdemeyer/cython.git",
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "http://cython.org",
            "hooks_url": "https://api.github.com/repos/jdemeyer/cython/hooks",
            "html_url": "https://github.com/jdemeyer/cython",
            "id": 29857031,
            "issue_comment_url": "https://api.github.com/repos/jdemeyer/cython/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/jdemeyer/cython/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/jdemeyer/cython/issues{/number}",
            "keys_url": "https://api.github.com/repos/jdemeyer/cython/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/jdemeyer/cython/labels{/name}",
            "language": "Python",
            "languages_url": "https://api.github.com/repos/jdemeyer/cython/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/jdemeyer/cython/merges",
            "milestones_url": "https://api.github.com/repos/jdemeyer/cython/milestones{/number}",
            "mirror_url": null,
            "name": "cython",
            "node_id": "MDEwOlJlcG9zaXRvcnkyOTg1NzAzMQ==",
            "notifications_url": "https://api.github.com/repos/jdemeyer/cython/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "node_id": "MDQ6VXNlcjM2MjU3ODU=",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/jdemeyer/cython/pulls{/number}",
            "pushed_at": "2019-08-22T10:41:41Z",
            "releases_url": "https://api.github.com/repos/jdemeyer/cython/releases{/id}",
            "size": 55168,
            "ssh_url": "git@github.com:jdemeyer/cython.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/jdemeyer/cython/stargazers",
            "statuses_url": "https://api.github.com/repos/jdemeyer/cython/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/jdemeyer/cython/subscribers",
            "subscription_url": "https://api.github.com/repos/jdemeyer/cython/subscription",
            "svn_url": "https://github.com/jdemeyer/cython",
            "tags_url": "https://api.github.com/repos/jdemeyer/cython/tags",
            "teams_url": "https://api.github.com/repos/jdemeyer/cython/teams",
            "trees_url": "https://api.github.com/repos/jdemeyer/cython/git/trees{/sha}",
            "updated_at": "2018-10-22T18:38:17Z",
            "url": "https://api.github.com/repos/jdemeyer/cython",
            "watchers": 0,
            "watchers_count": 0
        },
        "sha": "a97b539143dbe972ad0c8521d9fd56a9a32969e3",
        "user": {
            "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
            "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
            "followers_url": "https://api.github.com/users/jdemeyer/followers",
            "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
            "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/jdemeyer",
            "id": 3625785,
            "login": "jdemeyer",
            "node_id": "MDQ6VXNlcjM2MjU3ODU=",
            "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
            "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
            "repos_url": "https://api.github.com/users/jdemeyer/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/jdemeyer"
        }
    },
    "html_url": "https://github.com/cython/cython/pull/3021",
    "id": 292867654,
    "issue_url": "https://api.github.com/repos/cython/cython/issues/3021",
    "labels": [],
    "locked": false,
    "merge_commit_sha": "3860332f1237b3593427d46207d5f0c86fa0f51f",
    "merged_at": null,
    "milestone": null,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjkyODY3NjU0",
    "number": 3021,
    "patch_url": "https://github.com/cython/cython/pull/3021.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/cython/cython/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/cython/cython/pulls/3021/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/cython/cython/statuses/a97b539143dbe972ad0c8521d9fd56a9a32969e3",
    "title": "Use METH_FASTCALL on Python >= 3.7",
    "updated_at": "2019-08-22T12:18:20Z",
    "url": "https://api.github.com/repos/cython/cython/pulls/3021",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
        "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
        "followers_url": "https://api.github.com/users/jdemeyer/followers",
        "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
        "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jdemeyer",
        "id": 3625785,
        "login": "jdemeyer",
        "node_id": "MDQ6VXNlcjM2MjU3ODU=",
        "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
        "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
        "repos_url": "https://api.github.com/users/jdemeyer/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jdemeyer"
    }
}